<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Metadata for Hugo Shortcodes Â· Christian Mahnke</title>
    <meta name="author" content="Christian Mahnke">
<meta http-equiv="Content-Language" content="en">

<meta name="description" content="For my blogs I use a Hugo theme as a kind of function library&hellip;">
<meta property="og:type" content="article" /><meta property="og:url" content="https://christianmahnke.de/en/post/hugo-shortcode-metadate/" /><meta property="og:title" content="Metadata for Hugo Shortcodes" />
<meta property="og:image" content="https://christianmahnke.de/en/post/hugo-shortcode-metadate/ogPreview.en_hu_5e241c784cdd4b9d.jpg" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />



<meta name="keywords" content=", Hugo">
<meta name="generator" content="Hugo 0.152.2">
<meta name="projektemacher.org:build-date" content="2025-11-01 23:48:47.316538693 &#43;0000 UTC m=&#43;155.295759898">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no">

<link rel="icon" type="image/svg+xml" href="https://christianmahnke.de/images/cm.svg">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <meta name="theme-color" content="#701611"><link href="https://christianmahnke.de/css/3dcde2e700baa65d3814003bfc8fa7f9.min.df28516c1fc60576c14374d9f01d3ea3a0cab312068a1b7d21ed18bf6ff6017d.css" rel="stylesheet" integrity="sha256-3yhRbB/GBXbBQ3TZ8B0&#43;o6DKsxIGiht9Ie0Yv2/2AX0=">
<script src="https://christianmahnke.de/js/5d85c20c8f862f9ecfa0aee0edbc8fe4.min.827123595458f866f40f1851c8ff2a73fb4bc4bbe9d020799836600f1c370928.js" integrity="sha256-gnEjWVRY+Gb0DxhRyP8qc/tLxLvp0CB5mDZgDxw3CSg="></script>
<link rel="icon" type="image/png" href="https://christianmahnke.de/images/favicon-32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://christianmahnke.de/images/favicon-16.png" sizes="16x16">
    

    <link rel="shortcut icon" href="https://christianmahnke.de/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://christianmahnke.de/images/favicon.ico" type="image/x-icon">

    <link rel="alternate" type="text/bibtex" href="https://christianmahnke.de/en/post/hugo-shortcode-metadate/citation.bib" title="Christian Mahnke" />
    </head><body class="section-post dir-posthugo-shortcode-metadate  ">
      <a name="top"></a>
      <div class="page-wrapper">
        <div class="main">
          <header class="header header-main" id="head" data-sticky-class="sticky-top">
    <div class="wrapper">
        <label class="menu-open" for="menu-toggle">
            <i class="menu-open-icon"></i>
        </label>
        <div class="menu">
            <nav class="top top-menu">
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="menu-icon"></i></label>
    <ul class="navigation-list"><li class="navigation-item navto-"><a class="navigation-link" href="https://christianmahnke.de/en/" title="Focuses">Focuses<i class="link-icon"></i></a></li><li class="navigation-item navto-collections"><a class="navigation-link" href="https://christianmahnke.de/en/collections" title="Collections">Collections<i class="link-icon"></i></a></li><li class="navigation-item current navto-post"><a class="navigation-link" href="https://christianmahnke.de/en/post" title="Blog">Blog<i class="link-icon"></i></a></li><li class="navigation-item navto-links"><a class="navigation-link" href="https://christianmahnke.de/en/links" title="Links">Links<i class="link-icon"></i></a></li><li class="navigation-item navto-about"><a class="navigation-link" href="https://christianmahnke.de/en/about" title="About">About<i class="link-icon"></i></a></li><li class="navigation-item navto-search"><form action="https://christianmahnke.de/en/search/" method="get" class="search-form" id="menu-search-form"><input name="q" type="text" placeholder="Search" class="search-input" id="menu-search-input"><button type="submit" class="search-button" id="menu-search-button"><i class="search-icon"></i></button></form></li><li class="navigation-item lang">
              <a href="https://christianmahnke.de/post/hugo-shortcode-metadate/" title="Deutsch">Deutsch</a>
            </li></ul>
  </nav>
        </div>
        <div class="home-link">
            <a href="https://christianmahnke.de/"><h1 class="header-title">Christian Mahnke</h1></a>
        </div></div>
    <div class="header-spacer"></div>
    <a href="#top">
        <div class="backToTop"></div>
    </a>
</header>
<div class="content-container single">
    
<div class="post ">
  <div class="content">
      <h1 class="post-title">Metadata for Hugo Shortcodes</h1><div class="date">
          <time class="post-data" datetime="2024-01-30T18:22:44&#43;02:00">Tuesday, January 30, 2024</time>
        </div><div class="post-body"><p>For my blogs I use a Hugo theme as a kind of function library&hellip;</p>
<p>&hellip; which of course also includes some shortcodes. And if these require JavaScript functionality, for example, it used to be the case that this was simply integrated into a large bundle. Regardless of whether the shortcode needed it on a page, it was always delivered&hellip;</p>
<p>Not a very scalable solution, especially if the shortcode is never used. The normal way to solve this problem in Hugo is a flag that the shortcode sets and that is then evaluated when the HTML header is generated. Here is a similar example from the <a href="https://gohugo.io/content-management/diagrams/" target="_blank">documentation</a>:</p>
<p>As part of the shortcode (Instead of <a href="https://gohugo.io/methods/page/store/" target="_blank"><code>.Page.Store</code></a> you sometimes see the older <a href="https://gohugo.io/methods/page/scratch/" target="_blank"><code>.Scratch</code></a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="na">.Page.Store.Set</span><span class="w"> </span><span class="s">&#34;hasMermaid&#34;</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></div><p>As part of the template that creates the HTML header:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="na">.Store.Get</span><span class="w"> </span><span class="s">&#34;hasMermaid&#34;</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;module&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">import</span> <span class="nx">mermaid</span> <span class="nx">from</span> <span class="s1">&#39;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mermaid</span><span class="p">.</span><span class="nx">initialize</span><span class="p">({</span> <span class="nx">startOnLoad</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></div><p>But especially for a function library (or in general) this is not a good / elegant solution, as the shortcodes and the header template are hard linked to each other. Therefore, new shortcodes always require adjustments to the templates. Wouldn&rsquo;t it be nicer if the information about the required scripts and stylesheets could be stored directly with the shortcode?</p>
<h2 id="extend-shortcodes">Extend shortcodes</h2>
<p>Since shortcodes are simply templates, you can do pretty much anything in them, e.g. define further templates, here the file <code>/layouts/shortcodes/toc.html</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toc&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toc-header&#34;</span><span class="p">&gt;</span><span class="cp">{{</span><span class="w"> </span><span class="nx">i18n</span><span class="w"> </span><span class="s">&#34;toc&#34;</span><span class="w"> </span><span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="na">.Page.TableOfContents</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="s">&#34;_partials/shortcodes/toc-metadata.html&#34;</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="s">&#34;css&#34;</span><span class="w"> </span><span class="k">slice</span><span class="w"> </span><span class="s">&#34;js&#34;</span><span class="w"> </span><span class="k">slice</span><span class="w"> </span><span class="s">&#34;scss&#34;</span><span class="w"> </span><span class="o">(</span><span class="k">slice</span><span class="w"> </span><span class="s">&#34;scss/toc.scss&#34;</span><span class="o">))</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">jsonify</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span></code></pre></div><p>The important part here is the definition of an additional template (<code>define</code>), this follows a naming convention so that it can be found again:</p>
<ul>
<li>The template is stored in the virtual directory <code>_partials/shortcodes/</code></li>
<li>The name is that of the shortcode / template (<code>toc</code>), followed by <code>-metadata.html</code>.</li>
</ul>
<p>The shortcode defines a simple data structure in the form (as YAML):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">css</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>-<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">js</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>-<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">scss</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>-<span class="w">
</span></span></span></code></pre></div><p>This structure is serialised as JSON so that it can simply be passed as a string, the latter is probably optional.</p>
<h2 id="evaluate-shortcode-metadata">Evaluate shortcode metadata</h2>
<p>But the above is only half the story, somehow the data must also be available when generating the HTML header or the respective files (CSS and JavaScript).</p>
<p>Since you can only check whether a shortcode is used on a page, you first need a list of all the shortcodes used, which you can then use as a cache so that you don&rsquo;t have to look at the required pages and templates as often later on:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="nx">$includes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dict</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodeTags</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">slice</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">$page</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="na">$.Site.Pages</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nx">$page</span><span class="na">.File</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">findRESubmatch</span><span class="w"> </span><span class="s">`{{[&lt;%]\s*([^\s]*)\b.*\s*[%&gt;]}}`</span><span class="w"> </span><span class="nx">$page</span><span class="na">.RawContent</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="nx">partial</span><span class="w"> </span><span class="s">&#34;shortcodes/shortcode-helper-extract-matches.html&#34;</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="s">&#34;matches&#34;</span><span class="w"> </span><span class="nx">$matches</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodeTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$shortcodeTags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">append</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cm">{{/* Remove shortcodes starting with &#39;/&#39; */}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">slice</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">$tag</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">$shortcodeTags</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="o">(</span><span class="nx">hasPrefix</span><span class="w"> </span><span class="nx">$tag</span><span class="w"> </span><span class="s">&#34;/&#34;</span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$shortcodes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">append</span><span class="w"> </span><span class="nx">$tag</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cm">{{/* Remove any duplicates */}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$shortcodes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">uniq</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="nx">$candidates</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">slice</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">$shortcode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">$shortcodes</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cm">{{/* Find definition of each found shortcode, this way we can make sure to include the ones defined by any theme */}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodeFile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">printf</span><span class="w"> </span><span class="s">&#34;layouts/shortcodes/%s.html&#34;</span><span class="w"> </span><span class="nx">$shortcode</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">fileExists</span><span class="w"> </span><span class="nx">$shortcodeFile</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$shortcodeContent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readFile</span><span class="w"> </span><span class="nx">$shortcodeFile</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">{{/* Get the inline partial returning the required metadata for the shortcode */}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">findRESubmatch</span><span class="w"> </span><span class="s">`{{-?\s*define\s*&#34;(.*-metadata.*)&#34;\s*-?}}`</span><span class="w"> </span><span class="nx">$shortcodeContent</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$template</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">(</span><span class="nx">partial</span><span class="w"> </span><span class="s">&#34;shortcodes/shortcode-helper-extract-matches.html&#34;</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="s">&#34;matches&#34;</span><span class="w"> </span><span class="nx">$matches</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="k">len</span><span class="w"> </span><span class="nx">$template</span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="nx">$template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="nx">$template</span><span class="w"> </span><span class="nx">0</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cm">{{/* Changed for Hugo 0.146.0 */}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="nx">$template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">replace</span><span class="w"> </span><span class="nx">$template</span><span class="w"> </span><span class="s">&#34;_partials/&#34;</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">unmarshal</span><span class="w"> </span><span class="o">(</span><span class="nx">partialCached</span><span class="w"> </span><span class="nx">$template</span><span class="w"> </span><span class="na">.</span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">isset</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="s">&#34;js&#34;</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">        <span class="cp">{{-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">eq</span><span class="w"> </span><span class="o">(</span><span class="k">printf</span><span class="w"> </span><span class="s">&#34;%T&#34;</span><span class="w"> </span><span class="o">(</span><span class="k">index</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="s">&#34;js&#34;</span><span class="o">))</span><span class="w"> </span><span class="s">&#34;string&#34;</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">          <span class="cp">{{-</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">merge</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="s">&#34;js&#34;</span><span class="w"> </span><span class="o">(</span><span class="k">slice</span><span class="w"> </span><span class="o">(</span><span class="k">index</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="s">&#34;js&#34;</span><span class="o">)))</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">        <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">        <span class="cp">{{-</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">merge</span><span class="w"> </span><span class="nx">$include</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="s">&#34;js&#34;</span><span class="w"> </span><span class="k">slice</span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">{{/* ... */}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cp">{{-</span><span class="w"> </span><span class="nx">$includes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">merge</span><span class="w"> </span><span class="nx">$includes</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="nx">$shortcode</span><span class="w"> </span><span class="nx">$include</span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cm">{{/* Return a JSON containing all shortcodes and their required includes */}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="nx">$includes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">jsonify</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">{{/* Can also be a seperate file */}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="s">&#34;_partials/shortcodes/shortcode-helper-extract-matches.html&#34;</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="na">.matches</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="nx">$rMatches</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">slice</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">$matches</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$rMatches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$rMatches</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">append</span><span class="w"> </span><span class="o">(</span><span class="k">index</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="nx">1</span><span class="o">)</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{-</span><span class="w"> </span><span class="nx">return</span><span class="w"> </span><span class="nx">$rMatches</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">-}}</span>
</span></span></code></pre></div><p>The resulting data structure now has the advantage that all possible shortcodes are known and the presence of each page can be easily checked. The template above can be stored in a variable via <code>partialCached</code>, which ensures that the complete page content only has to be run through once. The next fragment shows the use of the HTML header template:</p>
<pre tabindex="0"><code>{{- $includes := unmarshal (partialCached &#34;shortcodes/shortcode-helper-cache.html&#34; .) -}}

{{- if reflect.IsMap $includes -}}
  {{/* Loop through the shortcode cache, check if one is used in the current page and collect the necessary requirements (includes) */}}
  {{- range $shortcodeName, $refs := $includes  -}}
    {{- if $context.HasShortcode $shortcodeName -}}
      {{- if isset $refs &#34;js&#34; -}}
        {{- $js = $js | append (index $refs &#34;js&#34;) -}}
      {{- end -}}
      {{- if isset $refs &#34;css&#34; -}}
        {{- $css = $css | append (index $refs &#34;css&#34;) -}}
      {{- end -}}
      {{- if isset $refs &#34;scss&#34; -}}
        {{- $scss = $scss | append (index $refs &#34;scss&#34;) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
</code></pre><p>After the loop has run through, you have variables that contain the required CSS, SCSS and JavaScript files&hellip;</p>
<h2 id="potential-improvements">Potential improvements</h2>
<ul>
<li>Serialisation in JSON for transfer between the templates is not necessary. You could simply do without it</li>
<li>The check of whether a file really contains a metadata definition is superfluous, without it these could also be overwritten, e.g. if the shortcode is defined in a theme.</li>
</ul>
<h2 id="update-1542025">Update 15.4.2025</h2>
<p>With Hugo 0.146.0 the <a href="https://github.com/gohugoio/hugo/pull/13541" target="_blank">structure of the templates has changed</a>, therefore the path had to be changed to <code>define</code>.</p></div>
  </div><div class="post-footer"><div class="spacer">
      </div>
      <div class="meta"><div class="cite-container"><details class="cite">
  <summary class="cite_summary">
    Cite this article
  </summary><div class="cite-body">
    <div class="cite-proposal">
      <span class="cite-author">Mahnke, Christian</span> <span class="cite-year">(2024)</span>: <span class="cite-title">Metadata for Hugo Shortcodes</span>. In:  <a class="cite-source-link" href="https://christianmahnke.de/">ChristianMahnke.de</a> [Weblog], Jan 30, 2024. Online publication: <a class="cite-link" href="https://christianmahnke.de/post/hugo-shortcode-metadate/">https://christianmahnke.de/post/hugo-shortcode-metadate/</a>.
    </div>
    <a class="bibtex-download" href="https://christianmahnke.de/en/post/hugo-shortcode-metadate/citation.bib" title="Download as BibTex">Download as BibTex</a>
  </div>
</details>
</div><div class="tags-heading">Tags</div>
        <div class="tags"><a href="https://christianmahnke.de/en/tags/Hugo" title="Hugo">#Hugo</a></div>
      </div>
    </div>
  
</div>

  </div>

        </div><footer class="footer" role="contentinfo">
    <div class="spacer"></div>
    <div class="content">
        <div class="wrapper">
            <div class="menu-wrapper">
                <div class="footer-nav">
                    <h3 class="footer-nav">Navigation</h3>
                    <nav class="top top-menu">
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="menu-icon"></i></label>
    <ul class="navigation-list"><li class="navigation-item navto-"><a class="navigation-link" href="https://christianmahnke.de/en/" title="Focuses">Focuses<i class="link-icon"></i></a></li><li class="navigation-item navto-collections"><a class="navigation-link" href="https://christianmahnke.de/en/collections" title="Collections">Collections<i class="link-icon"></i></a></li><li class="navigation-item current navto-post"><a class="navigation-link" href="https://christianmahnke.de/en/post" title="Blog">Blog<i class="link-icon"></i></a></li><li class="navigation-item navto-links"><a class="navigation-link" href="https://christianmahnke.de/en/links" title="Links">Links<i class="link-icon"></i></a></li><li class="navigation-item navto-about"><a class="navigation-link" href="https://christianmahnke.de/en/about" title="About">About<i class="link-icon"></i></a></li><li class="navigation-item navto-search"><form action="https://christianmahnke.de/en/search/" method="get" class="search-form" id="menu-search-form"><input name="q" type="text" placeholder="Search" class="search-input" id="menu-search-input"><button type="submit" class="search-button" id="menu-search-button"><i class="search-icon"></i></button></form></li><li class="navigation-item lang">
              <a href="https://christianmahnke.de/post/hugo-shortcode-metadate/" title="Deutsch">Deutsch</a>
            </li></ul>
  </nav>
                </div>
            </div>
            <div class="link-wrapper">
                <h3 class="footer-links">Links</h3>
                <ul class="footer-links"><li class="footer-link"><a href="https://github.com/cmahnke" target="_blank" title="GitHub"><div class="link-image github"></div>GitHub</a></li><li class="footer-link"><a href="https://projektemacher.org/" target="_blank" title="Projektemacher"><img class="link-image projektemacher" alt="Projektemacher Logo" src="https://christianmahnke.de/images/laborant.svg">Projektemacher</a></li><li class="footer-link"><a href="https://orcid.org/0009-0003-1361-4159" target="_blank" title="ORCID"><div class="link-image orcid"></div>0009-0003-1361-4159</a></li><li class="footer-link"><a href="https://www.linkedin.com/in/cmahnke" target="_blank" title="LinkedIn"><div class="link-image linkedin"></div>LinkedIn</a></li><li class="footer-link"><a href="https://www.librarything.com/profile/cmahnke" target="_blank" title="LibraryThing"><div class="link-image librarything"></div>LibraryThing</a></li><li class="footer-link"><a href="https://openbiblio.social/@cmahnke" rel="me" target="_blank" title="Mastodon"><div class="link-image mastodon"></div>@cmahnke@openbiblio.social</a></li><li class="footer-link"><a href="https://www.instagram.com/projektemacher/" target="_blank" title="Instagram" style="display: none;"><div class="link-image instagram"></div>Instagram</a></li><li class="footer-link"><a href="https://term.museum-digital.de/md-de/persinst/322830" target="_blank" title="museum:digital" style="display: none;"><div class="link-image md-term"></div>museum:digital</a></li></ul>
            </div>
            <div class="footer-placeholder"></div>
            <div class="contact-wrapper">
                <h3 class="footer-contact">Contact</h3><div class="footer-contact"><h4 class="contact-link">Mail</h4><a href="mailto:mail@christianmahnke.de" title="Send eMail">mail@christianmahnke.de</a></div><h3 class="footer-privacy"><a href="https://christianmahnke.de/privacy" title="Privacy policy">Privacy policy</a></h3>
                <h1 class=footer-title><img class="footer-icon" alt="Projektemacher.org" src="https://christianmahnke.de/images/cm-black.svg">Christian Mahnke</h1>
            </div>
        </div>
    </div>
    <div class="copyright"><a href="https://christianmahnke.de">&copy; MMXXI - MMXXV Christian Mahnke</a>
        <span class="icons-right"><a href="https://projektemacher.org"><img class="icon" alt="Projektemacher.org" src="https://christianmahnke.de/images/cm.svg"></a></span>
    </div>

</footer>


<script type="text/javascript">
    document.querySelector(".type-text")&&!document.querySelector(".subsection")?enterView({selector:".type-text",enter:function(e){e.classList.add("show")},offset:.25,once:!0}):document.querySelector(".type-text")&&document.querySelectorAll(".type-text").forEach(e=>e.classList.add("show","instant")),document.querySelector(".iframe-wrapper")&&enterView({selector:".iframe-wrapper",enter:function(e){e.classList.add("show")},offset:.45,once:!0}),document.addEventListener("DOMContentLoaded",function(){document.querySelector(".backToTop").removeAttribute("href"),document.addEventListener("scroll",function(){window.scrollY>window.innerHeight?document.querySelector("#head").classList.add("show-top-button"):document.querySelector("#head").classList.remove("show-top-button")})})
</script>
</div>
    </body>
 </html>
