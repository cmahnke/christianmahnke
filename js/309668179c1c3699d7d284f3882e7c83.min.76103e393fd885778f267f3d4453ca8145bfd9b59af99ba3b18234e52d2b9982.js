/*! Bundled license information:

openseadragon/build/openseadragon/openseadragon.js:
  (*! openseadragon 5.0.1 *)
  (*! Built on 2024-12-09 *)
  (*! Git commit: v5.0.1-0-480de92d *)
  (*! http://openseadragon.github.io *)
  (*! License: http://openseadragon.github.io/license/ *)

@annotorious/openseadragon/dist/annotorious-openseadragon.es.js:
  (*! https://mths.be/punycode v1.4.1 by @mathias *)
*/(()=>{e4=Object.create,wu=Object.defineProperty,Ru=Object.getOwnPropertyDescriptor,vu=Object.getOwnPropertyNames,Hu=Object.getPrototypeOf,l0=Object.prototype.hasOwnProperty,lu=(e,t)=>function(){return t||(0,e[vu(e)[0]])((t={exports:{}}).exports,t),t.exports},f0=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of vu(t))!l0.call(e,o)&&o!==n&&wu(e,o,{get:()=>t[o],enumerable:!(s=Ru(t,o))||s.enumerable});return e},Uo=(e,t,n)=>(n=e!=null?e4(Hu(e)):{},f0(t||!e||!e.__esModule?wu(n,"default",{value:e,enumerable:!0}):n,e)),iu=lu({"node_modules/openseadragon/build/openseadragon/openseadragon.js"(e,t){function n(e){return new n.Viewer(e)}(function(e){e.version={versionStr:"5.0.1",major:parseInt("5",10),minor:parseInt("0",10),revision:parseInt("1",10)};var s={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},o=Object.prototype.toString,t=Object.prototype.hasOwnProperty;e.isFunction=function(t){return e.type(t)==="function"},e.isArray=Array.isArray||function(t){return e.type(t)==="array"},e.isWindow=function(e){return e&&typeof e=="object"&&"setInterval"in e},e.type=function(e){return e==null?String(e):s[o.call(e)]||"object"},e.isPlainObject=function(s){if(!s||n.type(s)!=="object"||s.nodeType||e.isWindow(s))return!1;if(s.constructor&&!t.call(s,"constructor")&&!t.call(s.constructor.prototype,"isPrototypeOf"))return!1;var o,i;for(i in s)o=i;return o===0[0]||t.call(s,o)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=function(){var t=document.createElement("canvas");return!!(e.isFunction(t.getContext)&&t.getContext("2d"))}(),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch{t=!0}return t},e.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),e.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),e.supportsEventListenerOptions=function(){var n,t=0;if(e.supportsAddEventListener)try{n={get capture(){return t++,!1},get once(){return t++,!1},get passive(){return t++,!1}},window.addEventListener("test",null,n),window.removeEventListener("test",null,n)}catch{t=0}return t>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,s=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(n,1)/s}return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()})(n),function(e){e.extend=function(){var s,o,i,r,c,l,d,t=arguments[0]||{},h=arguments.length,u=!1,a=1;for(typeof t=="boolean"&&(u=t,t=arguments[1]||{},a=2),typeof t!="object"&&!n.isFunction(t)&&(t={}),h===a&&(t=this,--a);a<h;a++)if(c=arguments[a],c!==null||c!==0[0])for(o in c){if(r=Object.getOwnPropertyDescriptor(c,o),r!==0[0]){if(r.get||r.set){Object.defineProperty(t,o,r);continue}s=r.value}else{e.console.warn('Could not copy inherited property "'+o+'".');continue}if(t===s)continue;u&&s&&(n.isPlainObject(s)||(l=n.isArray(s)))?(i=t[o],l?(l=!1,d=i&&n.isArray(i)?i:[]):d=i&&n.isPlainObject(i)?i:{},t[o]=n.extend(u,d,s)):s!==0[0]&&(t[o]=s)}return t},s=function(){if(typeof navigator!="object")return!1;var e=navigator.userAgent;return typeof e=="string"&&(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1||e.indexOf("iPod")!==-1)},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:s(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,maxTilesPerFrame:1,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,overlayPreserveContentDirection:!0,opacity:1,compositeOperation:null,drawer:["webgl","canvas","html"],drawerOptions:{webgl:{},canvas:{},html:{},custom:{}},preload:!1,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},delegate:function(e,t){return function(){var n=arguments;return n===0[0]&&(n=[]),t.apply(e,n)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(t){return e._viewers.get(this.getElement(t))},getElement:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e},getElementPosition:function(t){var s,o,n=new e.Point;for(t=e.getElement(t),s=e.getElementStyle(t).position==="fixed",o=a(t,s);o;)n.x+=t.offsetLeft,n.y+=t.offsetTop,s&&(n=n.plus(e.getPageScroll())),t=o,s=e.getElementStyle(t).position==="fixed",o=a(t,s);return n},getElementOffset:function(t){t=e.getElement(t);var s,o,n=t&&t.ownerDocument,i={top:0,left:0};return n?(s=n.documentElement,typeof t.getBoundingClientRect!="undefined"&&(i=t.getBoundingClientRect()),o=n===n.window?n:n.nodeType===9&&(n.defaultView||n.parentWindow),new e.Point(i.left+(o.pageXOffset||s.scrollLeft)-(s.clientLeft||0),i.top+(o.pageYOffset||s.scrollTop)-(s.clientTop||0))):new e.Point},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var n={};return e.getCssPropertyWithVendorPrefix=function(t){if(n[t]!==0[0])return n[t];var o,i,a,c,r=document.createElement("div").style,s=null;if(r[t]!==0[0])s=t;else for(i=["Webkit","Moz","MS","O","webkit","moz","ms","o"],c=e.capitalizeFirstLetter(t),o=0;o<i.length;o++)if(a=i[o]+c,r[a]!==0[0]){s=a;break}return n[t]=s,s},e.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var n=e%t;return n<0&&(n+=t),n},pointInElement:function(t,n){t=e.getElement(t);var s=e.getElementOffset(t),o=e.getElementSize(t);return n.x>=s.x&&n.x<s.x+o.x&&n.y<s.y+o.y&&n.y>=s.y},getMousePosition:function(t){if(typeof t.pageX=="number")e.getMousePosition=function(t){var n=new e.Point;return n.x=t.pageX,n.y=t.pageY,n};else if(typeof t.clientX=="number")e.getMousePosition=function(t){var n=new e.Point;return n.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,n};else throw new Error("Unknown event mouse position, no known technique.");return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},n=document.body||{};if(typeof window.pageXOffset=="number")e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(n.scrollLeft||n.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else if(t.scrollLeft||t.scrollTop)e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new e.Point(0,0);return e.getPageScroll()},setPageScroll:function(t){if(typeof window.scrollTo!="undefined")e.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var s,n=e.getPageScroll();if(n.x===t.x&&n.y===t.y)return;if(document.body.scrollLeft=t.x,document.body.scrollTop=t.y,s=e.getPageScroll(),s.x!==n.x&&s.y!==n.y){e.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y};return}if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,s=e.getPageScroll(),s.x!==n.x&&s.y!==n.y){e.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y};return}e.setPageScroll=function(){}}e.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},n=document.body||{};if(typeof window.innerWidth=="number")e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(n.clientWidth||n.clientHeight)e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return e.getWindowSize()},makeCenteredNode:function(t){t=e.getElement(t);var n=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(n[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(n[1].style,{display:"table-row"}),e.extend(n[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),n[0].appendChild(n[1]),n[1].appendChild(n[2]),n[2].appendChild(t),n[0]},makeNeutralElement:function(e){var n=document.createElement(e),t=n.style;return t.background="transparent none",t.border="none",t.margin="0px",t.padding="0px",t.position="static",n},now:function(){return Date.now?e.now=Date.now:e.now=function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(t){var n=e.makeNeutralElement("img");return n.src=t,n},setElementOpacity:function(t,n,s){var o,i;t=e.getElement(t),s&&!e.Browser.alpha&&(n=Math.round(n)),e.Browser.opacity?t.style.opacity=n<1?n:"":n<1?(o=Math.round(100*n),i="alpha(opacity="+o+")",t.style.filter=i):t.style.filter=""},setElementTouchActionNone:function(t){t=e.getElement(t),typeof t.style.touchAction!="undefined"?t.style.touchAction="none":typeof t.style.msTouchAction!="undefined"&&(t.style.msTouchAction="none")},setElementPointerEvents:function(t,n){t=e.getElement(t),typeof t.style!="undefined"&&typeof t.style.pointerEvents!="undefined"&&(t.style.pointerEvents=n)},setElementPointerEventsNone:function(t){e.setElementPointerEvents(t,"none")},addClass:function(t,n){t=e.getElement(t),t.className?(" "+t.className+" ").indexOf(" "+n+" ")===-1&&(t.className+=" "+n):t.className=n},indexOf:function(e,t,n){return Array.prototype.indexOf?this.indexOf=function(e,t,n){return e.indexOf(t,n)}:this.indexOf=function(e,t,n){var s,i,o=n||0;if(!e)throw new TypeError;if(i=e.length,i===0||o>=i)return-1;o<0&&(o=i-Math.abs(o));for(s=o;s<i;s++)if(e[s]===t)return s;return-1},this.indexOf(e,t,n)},removeClass:function(t,n){var s,o,i=[];t=e.getElement(t),o=t.className.split(/\s+/);for(s=0;s<o.length;s++)o[s]&&o[s]!==n&&i.push(o[s]);t.className=i.join(" ")},normalizeEventListenerOptions:function(t){var n;return typeof t!="undefined"?typeof t=="boolean"?n=e.supportsEventListenerOptions?{capture:t}:t:n=e.supportsEventListenerOptions?t:typeof t.capture!="undefined"&&t.capture:n=!!e.supportsEventListenerOptions&&{capture:!1},n},addEvent:function(){if(e.supportsAddEventListener)return function(t,n,s,o){o=e.normalizeEventListenerOptions(o),t=e.getElement(t),t.addEventListener(n,s,o)};if(document.documentElement.attachEvent&&document.attachEvent)return function(t,n,s){t=e.getElement(t),t.attachEvent("on"+n,s)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(t,n,s,o){o=e.normalizeEventListenerOptions(o),t=e.getElement(t),t.removeEventListener(n,s,o)};if(document.documentElement.detachEvent&&document.detachEvent)return function(t,n,s){t=e.getElement(t),t.detachEvent("on"+n,s)};throw new Error("No known event model.")}(),cancelEvent:function(e){e.preventDefault()},eventIsCanceled:function(e){return e.defaultPrevented},stopEvent:function(e){e.stopPropagation()},createCallback:function(e,t){console.error("The createCallback function is deprecated and will be removed in future versions. Please use alternativeFunction instead.");var n,s=[];for(n=2;n<arguments.length;n++)s.push(arguments[n]);return function(){var n,o=s.concat([]);for(n=0;n<arguments.length;n++)o.push(arguments[n]);return t.apply(e,o)}},getUrlParameter:function(e){var t=i[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return t===null?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(){if(window.XMLHttpRequest)return e.createAjaxRequest=function(){return new XMLHttpRequest},new XMLHttpRequest;throw new Error("Browser doesn't support XMLHttpRequest.")},makeAjaxRequest:function(t,n,s){e.isPlainObject(t)&&(n=t.success,s=t.error,l=t.withCredentials,i=t.headers,r=t.responseType||null,c=t.postData||null,t=t.url);var i,a,r,c,l,u,d=e.getUrlProtocol(t),o=e.createAjaxRequest();if(!e.isFunction(n))throw new Error("makeAjaxRequest requires a success callback");o.onreadystatechange=function(){o.readyState===4&&(o.onreadystatechange=function(){},o.status>=200&&o.status<300||o.status===0&&d!=="http:"&&d!=="https:"?n(o):e.isFunction(s)?s(o):e.console.error("AJAX request returned %d: %s",o.status,t))},u=c?"POST":"GET";try{if(o.open(u,t,!0),r&&(o.responseType=r),i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&o.setRequestHeader(a,i[a]);l&&(o.withCredentials=!0),o.send(c)}catch(t){e.console.error("%s while making AJAX request: %s",t.name,t.message),o.onreadystatechange=function(){},e.isFunction(s)&&s(o,t)}return o},jsonp:function(t){var n,o=t.url,i=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=t.callbackName||"openseadragon"+e.now(),r=window[s],c="$1"+s+"$2",l=t.param||"callback",a=t.callback,o=o.replace(/(=)\?(&|$)|\?\?/i,c);o+=(/\?/.test(o)?"&":"?")+l+"="+s,window[s]=function(t){if(r)window[s]=r;else try{delete window[s]}catch{}a&&e.isFunction(a)&&a(t)},n=document.createElement("script"),(0[0]!==t.async||!1!==t.async)&&(n.async="async"),t.scriptCharset&&(n.charset=t.scriptCharset),n.src=o,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,i&&n.parentNode&&i.removeChild(n),n=0[0])},i.insertBefore(n,i.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)e.parseXml=function(e){var t=null,n=new DOMParser,t=n.parseFromString(e,"text/xml");return t};else throw new Error("Browser doesn't support XML DOM.");return e.parseXml(t)},parseJSON:function(t){return e.parseJSON=window.JSON.parse,e.parseJSON(t)},imageFormatSupported:function(e){return e=e||"",!!o[e.toLowerCase()]},setImageFormatsSupported:function(t){e.extend(o,t)}}),t=function(){},e.console=window.console||{log:t,debug:t,info:t,warn:t,error:t,assert:t},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var t,s,o={avif:!0,bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1,webp:!0},i={};(function(){var n,s,o,a,r,c,l,d,u=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":!!window.attachEvent&&!!window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(t.substring(t.indexOf("Edge")+5))):t.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(t.substring(t.indexOf("Edg")+4))):t.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?(e.Browser.vendor=t.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):(l=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),l.exec(t)!==null&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(u);break}d=window.location.search.substring(1),a=d.split("&");for(o=0;o<a.length;o++)if(n=a[o],s=n.indexOf("="),s>0){r=n.substring(0,s),c=n.substring(s+1);try{i[r]=decodeURIComponent(c)}catch{e.console.error("Ignoring malformed URL parameter: %s=%s",r,c)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.console.error("Internet Explorer is not supported by OpenSeadragon")})(),function(t){if(i=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,a=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame,i&&a)e.requestAnimationFrame=function(){return i.apply(t,arguments)},e.cancelAnimationFrame=function(){return a.apply(t,arguments)};else{var o,i,a,n=[],s=[],r=0;e.requestAnimationFrame=function(t){return n.push([++r,t]),o||(o=setInterval(function(){if(n.length){var t=e.now(),i=s;for(s=n,n=i;s.length;)s.shift()[1](t)}else clearInterval(o),o=0[0]},1e3/50)),r},e.cancelAnimationFrame=function(e){var t,o;for(t=0,o=n.length;t<o;t+=1)if(n[t][0]===e){n.splice(t,1);return}for(t=0,o=s.length;t<o;t+=1)if(s[t][0]===e){s.splice(t,1);return}}}}(window);function a(e,t){return t&&e!==document.body?document.body:e.offsetParent}}(n),function(e,n){typeof define=="function"&&define.amd?define([],n):typeof t=="object"&&t.exports?t.exports=n():e.OpenSeadragon=n()}(e,function(){return n}),function(e){class t{constructor(e){e||(e=[0,0,0,0,0,0,0,0,0]),this.values=e}static makeIdentity(){return new t([1,0,0,0,1,0,0,0,1])}static makeTranslation(e,n){return new t([1,0,0,0,1,0,e,n,1])}static makeRotation(e){var n=Math.cos(e),s=Math.sin(e);return new t([n,-s,0,s,n,0,0,0,1])}static makeScaling(e,n){return new t([e,0,0,0,n,0,0,0,1])}multiply(e){let n=this.values,s=e.values;var o=n[0*3+0],i=n[0*3+1],a=n[0*3+2],r=n[1*3+0],c=n[1*3+1],l=n[1*3+2],d=n[2*3+0],u=n[2*3+1],h=n[2*3+2],m=s[0*3+0],f=s[0*3+1],p=s[0*3+2],g=s[1*3+0],v=s[1*3+1],b=s[1*3+2],j=s[2*3+0],y=s[2*3+1],_=s[2*3+2];return new t([m*o+f*r+p*d,m*i+f*c+p*u,m*a+f*l+p*h,g*o+v*r+b*d,g*i+v*c+b*u,g*a+v*l+b*h,j*o+y*r+_*d,j*i+y*c+_*u,j*a+y*l+_*h])}}e.Mat3=t}(n),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(t){return t.requestFullscreen().catch(function(t){e.console.error("Fullscreen request failed: ",t)})},t.exitFullScreen=function(){document.exitFullscreen().catch(function(t){e.console.error("Error while exiting fullscreen: ",t)})},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return t.getFullScreenElement()!==null},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(n),function(e){e.EventSource=function(){this.events={},this._rejectedEventList={}},e.EventSource.prototype={addOnceHandler:function(e,t,n,s,o){var i,a,r=this;return s=s||1,i=0,a=function(n){return i++,i===s&&r.removeHandler(e,a),t(n)},this.addHandler(e,a,n,o)},addHandler:function(t,n,s,o){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,t))return e.console.error(`Error adding handler for ${t}. ${this._rejectedEventList[t]}`),!1;if(i=this.events[t],i||(this.events[t]=i=[]),n&&e.isFunction(n)){var i,a=i.length,r={handler:n,userData:s||null,priority:o||0};for(i[a]=r;a>0&&i[a-1].priority<i[a].priority;)i[a]=i[a-1],i[a-1]=r,a--}return!0},removeHandler:function(t,n){var o,s=this.events[t],i=[];if(!s)return;if(e.isArray(s)){for(o=0;o<s.length;o++)s[o].handler!==n&&i.push(s[o]);this.events[t]=i}},numberOfHandlers:function(e){var t=this.events[e];return t?t.length:0},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return!t||!t.length?null:(t=t.length===1?[t[0]]:Array.apply(null,t),function(e,n){var s,o=t.length;for(s=0;s<o;s++)t[s]&&(n.eventSource=e,n.userData=t[s].userData,t[s].handler(n))})},raiseEvent:function(t,n){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,t))return e.console.error(`Error adding handler for ${t}. ${this._rejectedEventList[t]}`),!1;var s=this.getHandler(t);return s&&s(this,n||{}),!0},rejectEventHandler(e,t=""){this._rejectedEventList[e]=t},allowEventHandler(e){delete this._rejectedEventList[e]}}}(n),function(e){var f,d=[],o={};e.MouseTracker=function(t){d.push(this);var n,s=arguments;e.isPlainObject(t)||(t={element:s[0],clickTimeThreshold:s[1],clickDistThreshold:s[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.preProcessEventHandler=t.preProcessEventHandler||null,this.contextMenuHandler=t.contextMenuHandler||null,this.enterHandler=t.enterHandler||null,this.leaveHandler=t.leaveHandler||null,this.exitHandler=t.exitHandler||null,this.overHandler=t.overHandler||null,this.outHandler=t.outHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null,n=this,o[this.hash]={click:function(e){ce(n,e)},dblclick:function(e){P(n,e)},keydown:function(e){ae(n,e)},keyup:function(e){ie(n,e)},keypress:function(e){ne(n,e)},focus:function(e){te(n,e)},blur:function(e){ee(n,e)},contextmenu:function(e){J(n,e)},wheel:function(e){re(n,e)},mousewheel:function(e){h(n,e)},DOMMouseScroll:function(e){h(n,e)},MozMousePixelScroll:function(e){h(n,e)},losecapture:function(e){K(n,e)},mouseenter:function(e){L(n,e)},mouseleave:function(e){N(n,e)},mouseover:function(e){g(n,e)},mouseout:function(e){z(n,e)},mousedown:function(e){T(n,e)},mouseup:function(e){F(n,e)},mousemove:function(e){p(n,e)},touchstart:function(e){U(n,e)},touchend:function(e){$(n,e)},touchmove:function(e){V(n,e)},touchcancel:function(e){B(n,e)},gesturestart:function(e){I(n,e)},gesturechange:function(e){H(n,e)},gotpointercapture:function(e){G(n,e)},lostpointercapture:function(e){X(n,e)},pointerenter:function(e){L(n,e)},pointerleave:function(e){N(n,e)},pointerover:function(e){g(n,e)},pointerout:function(e){z(n,e)},pointerdown:function(e){T(n,e)},pointerup:function(e){F(n,e)},pointermove:function(e){p(n,e)},pointercancel:function(e){R(n,e)},pointerupcaptured:function(e){W(n,e)},pointermovecaptured:function(e){q(n,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;E(this),this.element=null;for(e=0;e<d.length;e++)if(d[e]===this){d.splice(e,1);break}o[this.hash]=null,delete o[this.hash]},isTracking:function(){return o[this.hash].tracking},setTracking:function(e){return e?Y(this):E(this),this},getActivePointersListByType:function(t){var s,i,n=o[this.hash],a=n?n.activePointersLists.length:0;for(s=0;s<a;s++)if(n.activePointersLists[s].type===t)return n.activePointersLists[s];return i=new e.MouseTracker.GesturePointList(t),n&&n.activePointersLists.push(i),i},getActivePointerCount:function(){var e,t=o[this.hash],s=t.activePointersLists.length,n=0;for(e=0;e<s;e++)n+=t.activePointersLists[e].getLength();return n},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},f=function(){try{return window.self!==window.top}catch{return!0}}();function x(e){try{return e.addEventListener&&e.removeEventListener}catch{return!1}}e.MouseTracker.gesturePointVelocityTracker=function(){var t=[],s=0,n=0,o=function(e,t){return e.hash.toString()+t.type+t.id.toString()},i=function(){var s,o,i,r,c,l=t.length,a=e.now(),d=a-n;n=a;for(i=0;i<l;i++)o=t[i],s=o.gPoint,s.direction=Math.atan2(s.currentPos.y-o.lastPos.y,s.currentPos.x-o.lastPos.x),r=o.lastPos.distanceTo(s.currentPos),o.lastPos=s.currentPos,c=1e3*r/(d+1),s.speed=.75*c+.25*s.speed},a=function(a,r){var c=o(a,r);t.push({guid:c,gPoint:r,lastPos:r.currentPos}),t.length===1&&(n=e.now(),s=window.setInterval(i,50))},r=function(e,n){var i,r=o(e,n),a=t.length;for(i=0;i<a;i++)if(t[i].guid===r){t.splice(i,1),a--,a===0&&window.clearInterval(s);break}};return{addPoint:a,removePoint:r}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==0[0]?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],e.MouseTracker.wheelEventName==="DOMMouseScroll"&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=function(){var t=document.createElement("div");return e.isFunction(t.setPointerCapture)&&e.isFunction(t.releasePointerCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var t=document.createElement("div");return e.isFunction(t.setCapture)&&e.isFunction(t.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function C(e){var t,n,i,a,r,s=o[e.hash],c=s.activePointersLists.length;for(n=0;n<c;n++)if(i=s.activePointersLists[n],i.getLength()>0){a=[],r=i.asArray();for(t=0;t<r.length;t++)a.push(r[t]);for(t=0;t<a.length;t++)u(e,i,a[t])}for(n=0;n<c;n++)s.activePointersLists.pop();s.sentDragEvent=!1}function Y(t){var n,s,i=o[t.hash];if(!i.tracking){for(s=0;s<e.MouseTracker.subscribeEvents.length;s++)n=e.MouseTracker.subscribeEvents[s],e.addEvent(t.element,n,i[n],n===e.MouseTracker.wheelEventName&&{passive:!1,capture:!1});C(t),i.tracking=!0}}function E(t){var n,i,s=o[t.hash];if(s.tracking){for(n=0;n<e.MouseTracker.subscribeEvents.length;n++)i=e.MouseTracker.subscribeEvents[n],e.removeEvent(t.element,i,s[i],!1);C(t),s.tracking=!1}}function S(e,t){var n=o[e.hash];if(t==="pointerevent")return{upName:"pointerup",upHandler:n.pointerupcaptured,moveName:"pointermove",moveHandler:n.pointermovecaptured};if(t==="mouse")return{upName:"pointerup",upHandler:n.pointerupcaptured,moveName:"pointermove",moveHandler:n.pointermovecaptured};if(t==="touch")return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function Q(t,n){var s;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{t.element.setPointerCapture(n.id)}catch{e.console.warn("setPointerCapture() called on invalid pointer ID");return}else t.element.setCapture(!0);else s=S(t,e.MouseTracker.havePointerEvents?"pointerevent":n.type),f&&x(window.top)&&e.addEvent(window.top,s.upName,s.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,s.upName,s.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,s.moveName,s.moveHandler,!0);a(t,n,!0)}function v(t,n){var s,o,i;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(i=t.getActivePointersListByType(n.type),o=i.getById(n.id),!o||!o.captured)return;try{t.element.releasePointerCapture(n.id)}catch{}}else t.element.releaseCapture();else s=S(t,e.MouseTracker.havePointerEvents?"pointerevent":n.type),f&&x(window.top)&&e.removeEvent(window.top,s.upName,s.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,s.moveName,s.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,s.upName,s.upHandler,!0);a(t,n,!1)}function c(t){return e.MouseTracker.havePointerEvents?t.pointerId:e.MouseTracker.mousePointerId}function s(t){return e.MouseTracker.havePointerEvents&&t.pointerType?t.pointerType:"mouse"}function r(t){return!e.MouseTracker.havePointerEvents||t.isPrimary}function i(t){return e.getMousePosition(t)}function D(e,t){return n(i(e),t)}function n(t,n){var s=e.getElementOffset(n);return t.minus(s)}function l(t,n){return new e.Point((t.x+n.x)/2,(t.y+n.y)/2)}function ce(n,s){var o={originalEvent:s,eventType:"click",pointerType:"mouse",isEmulated:!1};t(n,o),o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function P(n,s){var o={originalEvent:s,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};t(n,o),o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function ae(n,s){var i=null,o={originalEvent:s,eventType:"keydown",pointerType:"",isEmulated:!1};t(n,o),n.keyDownHandler&&!o.preventGesture&&!o.defaultPrevented&&(i={eventSource:n,keyCode:s.keyCode?s.keyCode:s.charCode,ctrl:s.ctrlKey,shift:s.shiftKey,alt:s.altKey,meta:s.metaKey,originalEvent:s,preventDefault:o.preventDefault||o.defaultPrevented,userData:n.userData},n.keyDownHandler(i)),(i&&i.preventDefault||o.preventDefault&&!o.defaultPrevented)&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function ie(n,s){var i=null,o={originalEvent:s,eventType:"keyup",pointerType:"",isEmulated:!1};t(n,o),n.keyUpHandler&&!o.preventGesture&&!o.defaultPrevented&&(i={eventSource:n,keyCode:s.keyCode?s.keyCode:s.charCode,ctrl:s.ctrlKey,shift:s.shiftKey,alt:s.altKey,meta:s.metaKey,originalEvent:s,preventDefault:o.preventDefault||o.defaultPrevented,userData:n.userData},n.keyUpHandler(i)),(i&&i.preventDefault||o.preventDefault&&!o.defaultPrevented)&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function ne(n,s){var i=null,o={originalEvent:s,eventType:"keypress",pointerType:"",isEmulated:!1};t(n,o),n.keyHandler&&!o.preventGesture&&!o.defaultPrevented&&(i={eventSource:n,keyCode:s.keyCode?s.keyCode:s.charCode,ctrl:s.ctrlKey,shift:s.shiftKey,alt:s.altKey,meta:s.metaKey,originalEvent:s,preventDefault:o.preventDefault||o.defaultPrevented,userData:n.userData},n.keyHandler(i)),(i&&i.preventDefault||o.preventDefault&&!o.defaultPrevented)&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function te(e,n){var s={originalEvent:n,eventType:"focus",pointerType:"",isEmulated:!1};t(e,s),e.focusHandler&&!s.preventGesture&&e.focusHandler({eventSource:e,originalEvent:n,userData:e.userData})}function ee(e,n){var s={originalEvent:n,eventType:"blur",pointerType:"",isEmulated:!1};t(e,s),e.blurHandler&&!s.preventGesture&&e.blurHandler({eventSource:e,originalEvent:n,userData:e.userData})}function J(s,o){var r=null,a={originalEvent:o,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};t(s,a),s.contextMenuHandler&&!a.preventGesture&&!a.defaultPrevented&&(r={eventSource:s,position:n(i(o),s.element),originalEvent:a.originalEvent,preventDefault:a.preventDefault||a.defaultPrevented,userData:s.userData},s.contextMenuHandler(r)),(r&&r.preventDefault||a.preventDefault&&!a.defaultPrevented)&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function re(e,t){A(e,t,t)}function h(t,n){var s={target:n.target||n.srcElement,type:"wheel",shiftKey:n.shiftKey||!1,clientX:n.clientX,clientY:n.clientY,pageX:n.pageX?n.pageX:n.clientX,pageY:n.pageY?n.pageY:n.clientY,deltaMode:n.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};e.MouseTracker.wheelEventName==="mousewheel"?s.deltaY=-n.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:s.deltaY=n.detail,A(t,s,n)}function A(n,s,o){var r=0,a=null,r=s.deltaY?s.deltaY<0?1:-1:0,i={originalEvent:s,eventType:"wheel",pointerType:"mouse",isEmulated:s!==o};t(n,i),n.scrollHandler&&!i.preventGesture&&!i.defaultPrevented&&(a={eventSource:n,pointerType:"mouse",position:D(s,n.element),scroll:r,shift:s.shiftKey,isTouchEvent:!1,originalEvent:o,preventDefault:i.preventDefault||i.defaultPrevented,userData:n.userData},n.scrollHandler(a)),i.stopPropagation&&e.stopEvent(o),(a&&a.preventDefault||i.preventDefault&&!i.defaultPrevented)&&e.cancelEvent(o)}function K(n,s){var i={id:e.MouseTracker.mousePointerId,type:"mouse"},o={originalEvent:s,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};t(n,o),s.target===n.element&&a(n,i,!1),o.stopPropagation&&e.stopEvent(s)}function U(n,s){var o,r,c,l=s.changedTouches.length,d=n.getActivePointersListByType("touch"),u=e.now();d.getLength()>s.touches.length-l&&e.console.warn("Tracked touch contact count doesn't match event.touches.length"),o={originalEvent:s,eventType:"pointerdown",pointerType:"touch",isEmulated:!1},t(n,o);for(r=0;r<l;r++)c={id:s.changedTouches[r].identifier,type:"touch",isPrimary:d.getLength()===0,currentPos:i(s.changedTouches[r]),currentTime:u},O(n,o,c),_(n,o,c,0),a(n,c,!0);o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function $(n,s){var r,c,d=s.changedTouches.length,l=e.now(),o={originalEvent:s,eventType:"pointerup",pointerType:"touch",isEmulated:!1};t(n,o);for(r=0;r<d;r++)c={id:s.changedTouches[r].identifier,type:"touch",currentPos:i(s.changedTouches[r]),currentTime:l},y(n,o,c,0),a(n,c,!1),w(n,o,c);o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(s),o.stopPropagation&&e.stopEvent(s)}function V(n,s){var o,r,l=s.changedTouches.length,c=e.now(),a={originalEvent:s,eventType:"pointermove",pointerType:"touch",isEmulated:!1};t(n,a);for(o=0;o<l;o++)r={id:s.changedTouches[o].identifier,type:"touch",currentPos:i(s.changedTouches[o]),currentTime:c},j(n,a,r);a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(s),a.stopPropagation&&e.stopEvent(s)}function B(n,s){var o,a,r=s.changedTouches.length,i={originalEvent:s,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};t(n,i);for(o=0;o<r;o++)a={id:s.changedTouches[o].identifier,type:"touch"},b(n,i,a);i.stopPropagation&&e.stopEvent(s)}function I(t,n){return e.eventIsCanceled(n)||n.preventDefault(),!1}function H(t,n){return e.eventIsCanceled(n)||n.preventDefault(),!1}function G(n,o){var i={originalEvent:o,eventType:"gotpointercapture",pointerType:s(o),isEmulated:!1};t(n,i),o.target===n.element&&a(n,{id:o.pointerId,type:s(o)},!0),i.stopPropagation&&e.stopEvent(o)}function X(n,o){var i={originalEvent:o,eventType:"lostpointercapture",pointerType:s(o),isEmulated:!1};t(n,i),o.target===n.element&&a(n,{id:o.pointerId,type:s(o)},!1),i.stopPropagation&&e.stopEvent(o)}function L(n,o){var a={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},l={originalEvent:o,eventType:"pointerenter",pointerType:a.type,isEmulated:!1};t(n,l),O(n,l,a)}function N(n,o){var a={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},l={originalEvent:o,eventType:"pointerleave",pointerType:a.type,isEmulated:!1};t(n,l),w(n,l,a)}function g(n,o){var l={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},a={originalEvent:o,eventType:"pointerover",pointerType:l.type,isEmulated:!1};t(n,a),se(n,a,l),a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function z(n,o){var l={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},a={originalEvent:o,eventType:"pointerout",pointerType:l.type,isEmulated:!1};t(n,a),oe(n,a,l),a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function T(n,o){var d={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},u=e.MouseTracker.havePointerEvents&&d.type==="touch",l={originalEvent:o,eventType:"pointerdown",pointerType:d.type,isEmulated:!1};t(n,l),_(n,l,d,o.button),l.preventDefault&&!l.defaultPrevented&&e.cancelEvent(o),l.stopPropagation&&e.stopEvent(o),l.shouldCapture&&(u?a(n,d,!0):Q(n,d))}function F(e,t){M(e,t)}function W(t,n){var o=t.getActivePointersListByType(s(n));o.getById(n.pointerId)&&M(t,n),e.stopEvent(n)}function M(n,o){var d={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},l={originalEvent:o,eventType:"pointerup",pointerType:d.type,isEmulated:!1};t(n,l),y(n,l,d,o.button),l.preventDefault&&!l.defaultPrevented&&e.cancelEvent(o),l.stopPropagation&&e.stopEvent(o),l.shouldReleaseCapture&&(o.target===n.element?v(n,d):a(n,d,!1))}function p(e,t){k(e,t)}function q(t,n){var o=t.getActivePointersListByType(s(n));o.getById(n.pointerId)&&k(t,n),e.stopEvent(n)}function k(n,o){var l={id:c(o),type:s(o),isPrimary:r(o),currentPos:i(o),currentTime:e.now()},a={originalEvent:o,eventType:"pointermove",pointerType:l.type,isEmulated:!1};t(n,a),j(n,a,l),a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(o),a.stopPropagation&&e.stopEvent(o)}function R(n,o){var a={id:o.pointerId,type:s(o)},i={originalEvent:o,eventType:"pointercancel",pointerType:a.type,isEmulated:!1};t(n,i),b(n,i,a),i.stopPropagation&&e.stopEvent(o)}function m(e,t){return t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function u(t,n,s){var o,i=n.getById(s.id);return i?(i.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),v(t,i)),n.removeContact(),o=n.removeById(s.id)):o=n.getLength(),o}function Z(e,t){switch(t.eventType){case"pointermove":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break;case"pointerdown":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"pointerup":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"wheel":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasScrollHandler,t.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":t.isStoppable=!0,t.isCancelable=!1,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break;case"click":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!!e.clickHandler,t.preventGesture=!1,t.stopPropagation=!1;break;case"dblclick":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!!e.dblClickHandler,t.preventGesture=!1,t.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:t.isStoppable=!1,t.isCancelable=!1,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break}}function t(t,n){n.eventSource=t,n.eventPhase=n.originalEvent?typeof n.originalEvent.eventPhase!="undefined"?n.originalEvent.eventPhase:0:0,n.defaultPrevented=e.eventIsCanceled(n.originalEvent),n.shouldCapture=!1,n.shouldReleaseCapture=!1,n.userData=t.userData,Z(t,n),t.preProcessEventHandler&&t.preProcessEventHandler(n)}function a(t,n,s){var o=t.getActivePointersListByType(n.type),i=o.getById(n.id);i?s&&!i.captured?(i.captured=!0,o.captureCount++):!s&&i.captured&&(i.captured=!1,o.captureCount--,o.captureCount<0&&(o.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function O(e,t,s){var i=e.getActivePointersListByType(s.type),o=i.getById(s.id);o?(o.insideElement=!0,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime,s=o):(s.captured=!1,s.insideElementPressed=!1,s.insideElement=!0,m(i,s)),e.enterHandler&&e.enterHandler({eventSource:e,pointerType:s.type,position:n(s.currentPos,e.element),buttons:i.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:i.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData})}function w(e,t,s){var a,i=e.getActivePointersListByType(s.type),o=i.getById(s.id);o?(o.captured?(o.insideElement=!1,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime):u(e,i,o),s=o):(s.captured=!1,s.insideElementPressed=!1),(e.leaveHandler||e.exitHandler)&&(a={eventSource:e,pointerType:s.type,position:s.currentPos&&n(s.currentPos,e.element),buttons:i.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:i.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData},e.leaveHandler&&e.leaveHandler(a),e.exitHandler&&e.exitHandler(a))}function se(e,t,s){var o=e.getActivePointersListByType(s.type),i=o.getById(s.id);i?s=i:(s.captured=!1,s.insideElementPressed=!1),e.overHandler&&e.overHandler({eventSource:e,pointerType:s.type,position:n(s.currentPos,e.element),buttons:o.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:o.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData})}function oe(e,t,s){var o=e.getActivePointersListByType(s.type),i=o.getById(s.id);i?s=i:(s.captured=!1,s.insideElementPressed=!1),e.outHandler&&e.outHandler({eventSource:e,pointerType:s.type,position:s.currentPos&&n(s.currentPos,e.element),buttons:o.buttons,pointers:e.getActivePointerCount(),insideElementPressed:s.insideElementPressed,buttonDownAny:o.buttons!==0,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData})}function _(t,s,i,a){var c,d=o[t.hash],r=t.getActivePointersListByType(i.type);if(typeof s.originalEvent.buttons!="undefined"?r.buttons=s.originalEvent.buttons:a===0?r.buttons|=1:a===1?r.buttons|=4:a===2?r.buttons|=2:a===3?r.buttons|=8:a===4?r.buttons|=16:a===5&&(r.buttons|=32),a!==0){s.shouldCapture=!1,s.shouldReleaseCapture=!1,t.nonPrimaryPressHandler&&!s.preventGesture&&!s.defaultPrevented&&(s.preventDefault=!0,t.nonPrimaryPressHandler({eventSource:t,pointerType:i.type,position:n(i.currentPos,t.element),button:a,buttons:r.buttons,isTouchEvent:i.type==="touch",originalEvent:s.originalEvent,userData:t.userData}));return}c=r.getById(i.id),c?(c.insideElementPressed=!0,c.insideElement=!0,c.originalTarget=s.originalEvent.target,c.contactPos=i.currentPos,c.contactTime=i.currentTime,c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=i.currentPos,c.currentTime=i.currentTime,i=c):(i.captured=!1,i.insideElementPressed=!0,i.insideElement=!0,i.originalTarget=s.originalEvent.target,m(r,i)),r.addContact(),!s.preventGesture&&!s.defaultPrevented?(s.shouldCapture=!0,s.shouldReleaseCapture=!1,s.preventDefault=!0,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,i),r.contacts===1?t.pressHandler&&!s.preventGesture&&t.pressHandler({eventSource:t,pointerType:i.type,position:n(i.contactPos,t.element),buttons:r.buttons,isTouchEvent:i.type==="touch",originalEvent:s.originalEvent,userData:t.userData}):r.contacts===2&&t.pinchHandler&&i.type==="touch"&&(d.pinchGPoints=r.asArray(),d.lastPinchDist=d.currentPinchDist=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos),d.lastPinchCenter=d.currentPinchCenter=l(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos))):(s.shouldCapture=!1,s.shouldReleaseCapture=!1)}function y(t,s,i,a){var r,h,f,p,d=o[t.hash],c=t.getActivePointersListByType(i.type),g=!1;if(typeof s.originalEvent.buttons!="undefined"?c.buttons=s.originalEvent.buttons:a===0?c.buttons^=~1:a===1?c.buttons^=~4:a===2?c.buttons^=~2:a===3?c.buttons^=~8:a===4?c.buttons^=~16:a===5&&(c.buttons^=~32),s.shouldCapture=!1,a!==0){s.shouldReleaseCapture=!1,t.nonPrimaryReleaseHandler&&!s.preventGesture&&!s.defaultPrevented&&(s.preventDefault=!0,t.nonPrimaryReleaseHandler({eventSource:t,pointerType:i.type,position:n(i.currentPos,t.element),button:a,buttons:c.buttons,isTouchEvent:i.type==="touch",originalEvent:s.originalEvent,userData:t.userData}));return}r=c.getById(i.id),r?(c.removeContact(),r.captured&&(g=!0),r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=i.currentPos,r.currentTime=i.currentTime,r.insideElement||u(t,c,r),h=r.currentPos,p=r.currentTime):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,m(c,i),r=i),!s.preventGesture&&!s.defaultPrevented&&(g?(s.shouldReleaseCapture=!0,s.preventDefault=!0,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,r),c.contacts===0?(t.releaseHandler&&h&&t.releaseHandler({eventSource:t,pointerType:r.type,position:n(h,t.element),buttons:c.buttons,insideElementPressed:r.insideElementPressed,insideElementReleased:r.insideElement,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),t.dragEndHandler&&d.sentDragEvent&&t.dragEndHandler({eventSource:t,pointerType:r.type,position:n(r.currentPos,t.element),speed:r.speed,direction:r.direction,shift:s.originalEvent.shiftKey,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),d.sentDragEvent=!1,(t.clickHandler||t.dblClickHandler)&&r.insideElement&&(f=p-r.contactTime<=t.clickTimeThreshold&&r.contactPos.distanceTo(h)<=t.clickDistThreshold,t.clickHandler&&t.clickHandler({eventSource:t,pointerType:r.type,position:n(r.currentPos,t.element),quick:f,shift:s.originalEvent.shiftKey,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,originalTarget:r.originalTarget,userData:t.userData}),t.dblClickHandler&&f&&(c.clicks++,c.clicks===1?(d.lastClickPos=h,d.dblClickTimeOut=setTimeout(function(){c.clicks=0},t.dblClickTimeThreshold)):c.clicks===2&&(clearTimeout(d.dblClickTimeOut),c.clicks=0,d.lastClickPos.distanceTo(h)<=t.dblClickDistThreshold&&t.dblClickHandler({eventSource:t,pointerType:r.type,position:n(r.currentPos,t.element),shift:s.originalEvent.shiftKey,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),d.lastClickPos=null)))):c.contacts===2&&t.pinchHandler&&r.type==="touch"&&(d.pinchGPoints=c.asArray(),d.lastPinchDist=d.currentPinchDist=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos),d.lastPinchCenter=d.currentPinchCenter=l(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos))):(s.shouldReleaseCapture=!1,t.releaseHandler&&h&&(t.releaseHandler({eventSource:t,pointerType:r.type,position:n(h,t.element),buttons:c.buttons,insideElementPressed:r.insideElementPressed,insideElementReleased:r.insideElement,isTouchEvent:r.type==="touch",originalEvent:s.originalEvent,userData:t.userData}),s.preventDefault=!0)))}function j(e,t,s){var i,c,d,a=o[e.hash],r=e.getActivePointersListByType(s.type);if(typeof t.originalEvent.buttons!="undefined"&&(r.buttons=t.originalEvent.buttons),i=r.getById(s.id),i)i.lastPos=i.currentPos,i.lastTime=i.currentTime,i.currentPos=s.currentPos,i.currentTime=s.currentTime;else return;t.shouldCapture=!1,t.shouldReleaseCapture=!1,e.stopHandler&&s.type==="mouse"&&(clearTimeout(e.stopTimeOut),e.stopTimeOut=setTimeout(function(){le(e,t.originalEvent,s.type)},e.stopDelay)),r.contacts===0?e.moveHandler&&e.moveHandler({eventSource:e,pointerType:s.type,position:n(s.currentPos,e.element),buttons:r.buttons,isTouchEvent:s.type==="touch",originalEvent:t.originalEvent,userData:e.userData}):r.contacts===1?(e.moveHandler&&(i=r.asArray()[0],e.moveHandler({eventSource:e,pointerType:i.type,position:n(i.currentPos,e.element),buttons:r.buttons,isTouchEvent:i.type==="touch",originalEvent:t.originalEvent,userData:e.userData})),e.dragHandler&&!t.preventGesture&&!t.defaultPrevented&&(i=r.asArray()[0],d=i.currentPos.minus(i.lastPos),e.dragHandler({eventSource:e,pointerType:i.type,position:n(i.currentPos,e.element),buttons:r.buttons,delta:d,speed:i.speed,direction:i.direction,shift:t.originalEvent.shiftKey,isTouchEvent:i.type==="touch",originalEvent:t.originalEvent,userData:e.userData}),t.preventDefault=!0,a.sentDragEvent=!0)):r.contacts===2&&(e.moveHandler&&(c=r.asArray(),e.moveHandler({eventSource:e,pointerType:c[0].type,position:n(l(c[0].currentPos,c[1].currentPos),e.element),buttons:r.buttons,isTouchEvent:c[0].type==="touch",originalEvent:t.originalEvent,userData:e.userData})),e.pinchHandler&&s.type==="touch"&&!t.preventGesture&&!t.defaultPrevented&&(d=a.pinchGPoints[0].currentPos.distanceTo(a.pinchGPoints[1].currentPos),d!==a.currentPinchDist&&(a.lastPinchDist=a.currentPinchDist,a.currentPinchDist=d,a.lastPinchCenter=a.currentPinchCenter,a.currentPinchCenter=l(a.pinchGPoints[0].currentPos,a.pinchGPoints[1].currentPos),e.pinchHandler({eventSource:e,pointerType:"touch",gesturePoints:a.pinchGPoints,lastCenter:n(a.lastPinchCenter,e.element),center:n(a.currentPinchCenter,e.element),lastDistance:a.lastPinchDist,distance:a.currentPinchDist,shift:t.originalEvent.shiftKey,originalEvent:t.originalEvent,userData:e.userData}),t.preventDefault=!0)))}function b(e,t,n){var s=e.getActivePointersListByType(n.type),o=s.getById(n.id);o&&u(e,s,o)}function le(e,t,n){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:n,position:D(t,e.element),buttons:e.getActivePointersListByType(n).buttons,isTouchEvent:n==="touch",originalEvent:t,userData:e.userData})}}(n),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,n,s){var o=t.parentNode;typeof n=="number"&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=typeof n.attachToViewer=="undefined"||n.attachToViewer,this.autoFade=typeof n.autoFade=="undefined"||n.autoFade,this.element=t,this.anchor=n.anchor,this.container=s,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof n.top=="number"?n.top+"px":n.top,this.wrapper.style.left=typeof n.left=="number"?n.left+"px":n.left,this.wrapper.style.height=typeof n.height=="number"?n.height+"px":n.height,this.wrapper.style.width=typeof n.width=="number"?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(t){this.wrapper.style.display=t?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){e.setElementOpacity(this.wrapper,t,!0)}}}(n),function(e){e.ControlDock=function(t){var n,s,o=["topleft","topright","bottomright","bottomleft"];e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(Math.random()*1e6),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),e.getElementStyle(this.element).position==="static"&&(this.element.style.position="relative"),this.container.style.width="100%",this.container.style.height="100%");for(s=0;s<o.length;s++)n=o[s],this.controls[n]=e.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,s){n=e.getElement(n);var o=null;if(t(this,n)>=0)return;switch(s.anchor){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:o=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:o=this.container,n.style.margin="0px",n.style.padding="0px";break}this.controls.push(new e.Control(n,s,o)),n.style.display="inline-block"},removeControl:function(n){n=e.getElement(n);var s=t(this,n);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}};function t(e,t){var n,s=e.controls;for(n=s.length-1;n>=0;n--)if(s[n].element===t)return n;return-1}}(n),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(n),function(e){var t={},V=1;e.Viewer=function(n){var a,i=arguments,s=this;e.isPlainObject(n)||(n={id:i[0],xmlPath:i.length>1?i[1]:0[0],prefixUrl:i.length>2?i[2]:0[0],controls:i.length>3?i[3]:0[0],overlays:i.length>4?i[4]:0[0]}),n.config&&(e.extend(!0,n,n.config),delete n.config);let d=["useCanvas"];if(n.drawerOptions=Object.assign({},d.reduce((e,t)=>(e[t]=n[t],delete n[t],e),{}),n.drawerOptions),e.extend(!0,this,{id:n.id,hash:n.hash||V++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},e.DEFAULT_SETTINGS,n),typeof this.hash=="undefined")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");typeof t[this.hash]!="undefined"&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(t){var n=e.getString("Errors.OpenFailed",t.eventSource,t.message);s._showMessage(n)}),e.ControlDock.call(this,n),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),e.setElementTouchActionNone(this.canvas),n.tabIndex!==""&&(this.canvas.tabIndex=n.tabIndex===0[0]?0:n.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,z),keyDownHandler:e.delegate(this,T),keyHandler:e.delegate(this,E),clickHandler:e.delegate(this,D),dblClickHandler:e.delegate(this,j),dragHandler:e.delegate(this,y),dragEndHandler:e.delegate(this,_),enterHandler:e.delegate(this,w),leaveHandler:e.delegate(this,O),pressHandler:e.delegate(this,x),releaseHandler:e.delegate(this,C),nonPrimaryPressHandler:e.delegate(this,v),nonPrimaryReleaseHandler:e.delegate(this,k),scrollHandler:e.delegate(this,F),pinchHandler:e.delegate(this,A),focusHandler:e.delegate(this,S),blurHandler:e.delegate(this,M)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,g),leaveHandler:e.delegate(this,p)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=c(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){t[s.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(){s.source=s.world.getItemAt(0).source,t[s.hash].forceRedraw=!0,s._updateRequestId||(s._updateRequestId=l(s,u))}),this.world.addHandler("remove-item",function(){s.world.getItemCount()?s.source=s.world.getItemAt(0).source:s.source=null,t[s.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(){s.viewport&&s.viewport._setContentBounds(s.world.getHomeBounds(),s.world.getContentFactor())}),this.world.addHandler("item-index-change",function(){s.source=s.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,overlayPreserveContentDirection:this.overlayPreserveContentDirection,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:n.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),Object.prototype.hasOwnProperty.call(this.drawerOptions,"useCanvas")&&(e.console.error('useCanvas is deprecated, use the "drawer" option to indicate preferred drawer(s)'),this.drawerOptions.useCanvas||(this.drawer=e.HTMLDrawer),delete this.drawerOptions.useCanvas);let r=Array.isArray(this.drawer)?this.drawer:[this.drawer];r.length===0&&(r=[e.DEFAULT_SETTINGS.drawer].flat(),e.console.warn("No valid drawers were selected. Using the default value.")),this.drawer=null;for(const e of r){let t=this.requestDrawer(e,{mainDrawer:!0,redrawImmediately:!1});if(t)break}if(!this.drawer)throw e.console.error("No drawer could be created!"),"Error with creating the selected drawer(s)";this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(a=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(a,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(a=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(a,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime,drawer:this.drawer.getType(),loadTilesWithAjax:this.loadTilesWithAjax,ajaxHeaders:this.ajaxHeaders,ajaxWithCredentials:this.ajaxWithCredentials})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources);for(a=0;a<this.customControls.length;a++)this.addControl(this.customControls[a].id,{anchor:this.customControls[a].anchor});e.requestAnimationFrame(function(){o(s)}),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},get buttons(){return e.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(t,n){var o,i,a,r,c,l,d,s=this;if(this.close(),!t)return this;if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof n!="undefined"&&!isNaN(n)&&(this.initialPage=n),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(t)||(t=[t]),!t.length)return this;this._opening=!0;for(l=t.length,o=0,a=0,c=function(){if(o+a===l)if(o){(s._firstOpen||!s.preserveViewport)&&(s.viewport.goHome(!0),s.viewport.update()),s._firstOpen=!1;var e,n=t[0];if(n.tileSource&&(n=n.tileSource),s.overlays&&!s.preserveOverlays)for(e=0;e<s.overlays.length;e++)s.currentOverlays[e]=h(s,s.overlays[e]);s._drawOverlays(),s._opening=!1,s.raiseEvent("open",{source:n})}else s._opening=!1,s.raiseEvent("open-failed",r)},d=function(t){(!e.isPlainObject(t)||!t.tileSource)&&(t={tileSource:t}),t.index!==0[0]&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),t.collectionImmediately===0[0]&&(t.collectionImmediately=!0);var n,i=t.success;t.success=function(e){if(o++,t.tileSource.overlays)for(var n=0;n<t.tileSource.overlays.length;n++)s.addOverlay(t.tileSource.overlays[n]);i&&i(e),c()},n=t.error,t.error=function(e){a++,r||(r=e),n&&n(e),c()},s.addTiledImage(t)},i=0;i<t.length;i++)d(t[i]);return this},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(!t[this.hash])return;if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),t[this.navigator.hash]=null,delete t[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()},requestDrawer(t,n){const a={mainDrawer:!0,redrawImmediately:!0,drawerOptions:null};n=e.extend(!0,a,n);const o=n.mainDrawer,r=n.redrawImmediately,c=n.drawerOptions,i=this.drawer;let s=null;if(t&&t.prototype instanceof e.DrawerBase?(s=t,t="custom"):typeof t=="string"&&(s=e.determineDrawer(t)),s||e.console.warn("Unsupported drawer! Drawer must be an existing string type, or a class that extends OpenSeadragon.DrawerBase."),s&&s.isSupported()){i&&o&&i.destroy();const e=new s({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor,options:c||this.drawerOptions[t]});return o&&(this.drawer=e,r&&this.forceRedraw()),e}return!1},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?i(this):o(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},setAjaxHeaders:function(t,n){if(t===null&&(t={}),!e.isPlainObject(t)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(n===0[0]&&(n=!0),this.ajaxHeaders=t,n){for(var o,s=0;s<this.world.getItemCount();s++)this.world.getItemAt(s)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(o in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[o].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(e){this.buttonGroup.addButton(e)},isFullPage:function(){return t[this.hash]&&t[this.hash].fullPage},setFullPage:function(n){var a,r,l,d,u,i=document.body,s=i.style,o=document.documentElement.style,c=this;if(n===this.isFullPage())return this;if(l={fullPage:n,preventDefaultAction:!1},this.raiseEvent("pre-full-page",l),l.preventDefaultAction)return this;if(n&&this.element){this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=s.margin,this.docMargin=o.margin,s.margin="0",o.margin="0",this.bodyPadding=s.padding,this.docPadding=o.padding,s.padding="0",o.padding="0",this.bodyWidth=s.width,this.docWidth=o.width,s.width="100%",o.width="100%",this.bodyHeight=s.height,this.docHeight=o.height,s.height="100%",o.height="100%",this.bodyDisplay=s.display,s.display="block",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,r=i.childNodes.length;for(a=0;a<r;a++)this.previousBody.push(i.childNodes[0]),i.removeChild(i.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,i.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),i.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,g)({})}else{this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,s.margin=this.bodyMargin,o.margin=this.docMargin,s.padding=this.bodyPadding,o.padding=this.docPadding,s.width=this.bodyWidth,o.width=this.docWidth,s.height=this.bodyHeight,o.height=this.docHeight,s.display=this.bodyDisplay,i.removeChild(this.element),r=this.previousBody.length;for(a=0;a<r;a++)i.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(i.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight,d=0,u=function(){e.setPageScroll(c.pageScroll);var t=e.getPageScroll();d++,d<10&&(t.x!==c.pageScroll.x||t.y!==c.pageScroll.y)&&e.requestAnimationFrame(u)},e.requestAnimationFrame(u),t[this.hash].fullPage=!1,e.delegate(this,p)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:n}),this},setFullScreen:function(t){var s,o,n=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;if(o={fullScreen:t,preventDefaultAction:!1},this.raiseEvent("pre-full-screen",o),o.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%",s=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,s),e.removeEvent(document,e.fullScreenErrorEventName,s),n.setFullPage(!1),n.isFullPage()&&(n.element.style.width=n.fullPageStyleWidth,n.element.style.height=n.fullPageStyleHeight)),n.navigator&&n.viewport&&setTimeout(function(){n.navigator.update(n.viewport)}),n.raiseEvent("full-screen",{fullScreen:t})},e.addEvent(document,e.fullScreenEventName,s),e.addEvent(document,e.fullScreenErrorEventName,s),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return e.isFullScreen()&&this.isFullPage()},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var s,n=this;t.replace&&(t.replaceItem=n.world.getItemAt(t.index)),this._hideMessage(),t.placeholderFillStyle===0[0]&&(t.placeholderFillStyle=this.placeholderFillStyle),t.opacity===0[0]&&(t.opacity=this.opacity),t.preload===0[0]&&(t.preload=this.preload),t.compositeOperation===0[0]&&(t.compositeOperation=this.compositeOperation),t.crossOriginPolicy===0[0]&&(t.crossOriginPolicy=t.tileSource.crossOriginPolicy!==0[0]?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),t.ajaxWithCredentials===0[0]&&(t.ajaxWithCredentials=this.ajaxWithCredentials),t.loadTilesWithAjax===0[0]&&(t.loadTilesWithAjax=this.loadTilesWithAjax),e.isPlainObject(t.ajaxHeaders)||(t.ajaxHeaders={}),s={options:t};function o(e){for(var o=0;o<n._loadQueue.length;o++)if(n._loadQueue[o]===s){n._loadQueue.splice(o,1);break}n._loadQueue.length===0&&i(s),n.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function i(e){n.collectionMode&&(n.world.arrange({immediately:e.options.collectionImmediately,rows:n.collectionRows,columns:n.collectionColumns,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileMargin:n.collectionTileMargin}),n.world.setAutoRefigureSizes(!0))}if(e.isArray(t.tileSource)){setTimeout(function(){o({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})});return}this._loadQueue.push(s);function a(){for(;n._loadQueue.length;){if(t=n._loadQueue[0],!t.tileSource)break;if(n._loadQueue.splice(0,1),t.options.replace){var t,s,o,a=n.world.getIndexOfItem(t.options.replaceItem);a!==-1&&(t.options.index=a),n.world.removeItem(t.options.replaceItem)}s=new e.TiledImage({viewer:n,source:t.tileSource,viewport:n.viewport,drawer:n.drawer,tileCache:n.tileCache,imageLoader:n.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,flipped:t.options.flipped,compositeOperation:t.options.compositeOperation,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,maxTilesPerFrame:n.maxTilesPerFrame,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.minPixelRatio,smoothTileEdgesMinZoom:n.smoothTileEdgesMinZoom,iOSDevice:n.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:n.debugMode,subPixelRoundingForTransparency:n.subPixelRoundingForTransparency}),n.collectionMode&&n.world.setAutoRefigureSizes(!1),n.navigator&&(o=e.extend({},t.options,{replace:!1,originalTiledImage:s,tileSource:t.tileSource}),n.navigator.addTiledImage(o)),n.world.addItem(s,{index:t.options.index}),n._loadQueue.length===0&&i(t),n.world.getItemCount()===1&&!n.preserveViewport&&n.viewport.goHome(!0),t.options.success&&t.options.success({item:s})}}P(this,t.tileSource,t,function(e){s.tileSource=e,a()},function(e){e.options=t,o(e),a()})},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var n=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete n.url,this.addTiledImage(n)},addLayer:function(t){var s,n=this;return e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead."),s=e.extend({},t,{success:function(e){n.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){n.raiseEvent("add-layer-failed",e)}}),this.addTiledImage(s),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,n){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,n)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},forceResize:function(){t[this.hash].needsResize=!0,t[this.hash].forceResize=!0},bindSequenceControls:function(){var n=e.delegate(this,m),o=e.delegate(this,f),a=e.delegate(this,this.goToNextPage),r=e.delegate(this,this.goToPreviousPage),t=this.navImages,i=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(i=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:s(this.prefixUrl,t.previous.REST),srcGroup:s(this.prefixUrl,t.previous.GROUP),srcHover:s(this.prefixUrl,t.previous.HOVER),srcDown:s(this.prefixUrl,t.previous.DOWN),onRelease:r,onFocus:n,onBlur:o}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:s(this.prefixUrl,t.next.REST),srcGroup:s(this.prefixUrl,t.next.GROUP),srcHover:s(this.prefixUrl,t.next.HOVER),srcDown:s(this.prefixUrl,t.next.DOWN),onRelease:a,onFocus:n,onBlur:o}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),i&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var l=e.delegate(this,H),a=e.delegate(this,B),b=e.delegate(this,W),c=e.delegate(this,I),v=e.delegate(this,U),g=e.delegate(this,q),d=e.delegate(this,Y),p=e.delegate(this,G),h=e.delegate(this,X),u=e.delegate(this,Q),o=e.delegate(this,m),i=e.delegate(this,f),t=this.navImages,n=[],r=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(r=!1),this.showZoomControl&&(n.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:s(this.prefixUrl,t.zoomIn.REST),srcGroup:s(this.prefixUrl,t.zoomIn.GROUP),srcHover:s(this.prefixUrl,t.zoomIn.HOVER),srcDown:s(this.prefixUrl,t.zoomIn.DOWN),onPress:l,onRelease:a,onClick:b,onEnter:l,onExit:a,onFocus:o,onBlur:i})),n.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:s(this.prefixUrl,t.zoomOut.REST),srcGroup:s(this.prefixUrl,t.zoomOut.GROUP),srcHover:s(this.prefixUrl,t.zoomOut.HOVER),srcDown:s(this.prefixUrl,t.zoomOut.DOWN),onPress:c,onRelease:a,onClick:v,onEnter:c,onExit:a,onFocus:o,onBlur:i}))),this.showHomeControl&&n.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:s(this.prefixUrl,t.home.REST),srcGroup:s(this.prefixUrl,t.home.GROUP),srcHover:s(this.prefixUrl,t.home.HOVER),srcDown:s(this.prefixUrl,t.home.DOWN),onRelease:g,onFocus:o,onBlur:i})),this.showFullPageControl&&n.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:s(this.prefixUrl,t.fullpage.REST),srcGroup:s(this.prefixUrl,t.fullpage.GROUP),srcHover:s(this.prefixUrl,t.fullpage.HOVER),srcDown:s(this.prefixUrl,t.fullpage.DOWN),onRelease:d,onFocus:o,onBlur:i})),this.showRotationControl&&(n.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:s(this.prefixUrl,t.rotateleft.REST),srcGroup:s(this.prefixUrl,t.rotateleft.GROUP),srcHover:s(this.prefixUrl,t.rotateleft.HOVER),srcDown:s(this.prefixUrl,t.rotateleft.DOWN),onRelease:p,onFocus:o,onBlur:i})),n.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:s(this.prefixUrl,t.rotateright.REST),srcGroup:s(this.prefixUrl,t.rotateright.GROUP),srcHover:s(this.prefixUrl,t.rotateright.HOVER),srcDown:s(this.prefixUrl,t.rotateright.DOWN),onRelease:h,onFocus:o,onBlur:i}))),this.showFlipControl&&n.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:s(this.prefixUrl,t.flip.REST),srcGroup:s(this.prefixUrl,t.flip.GROUP),srcHover:s(this.prefixUrl,t.flip.HOVER),srcDown:s(this.prefixUrl,t.flip.DOWN),onRelease:u,onFocus:o,onBlur:i})),r?(this.buttonGroup=new e.ButtonGroup({buttons:n,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,K)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=n),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,n,s,o){if(e.isPlainObject(t)?i=t:i={element:t,location:n,placement:s,onDraw:o},t=e.getElement(i.element),a(this.currentOverlays,t)>=0)return this;var i,r=h(this,i);return this.currentOverlays.push(r),r.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:i.location,placement:i.placement}),this},updateOverlay:function(n,s,o){var i;return n=e.getElement(n),i=a(this.currentOverlays,n),i>=0&&(this.currentOverlays[i].update(s,o),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:n,location:s,placement:o})),this},removeOverlay:function(n){var s;return n=e.getElement(n),s=a(this.currentOverlays,n),s>=0&&(this.currentOverlays[s].destroy(),this.currentOverlays.splice(s,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:n})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var n;return t=e.getElement(t),n=a(this.currentOverlays,t),n>=0?this.currentOverlays[n]:null},_updateSequenceButtons:function(e){this.nextButton&&(!this.tileSources||this.tileSources.length-1===e?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var n=e.makeNeutralElement("div");n.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(n),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var n=e.pixelDensityRatio,t=e.getCurrentPixelDensityRatio();n!==t&&(e.pixelDensityRatio=t,this.forceResize())},goToPreviousPage:function(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)},goToNextPage:function(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)},isAnimating:function(){return t[this.hash].animating}});function c(t){return t=e.getElement(t),new e.Point(t.clientWidth===0?1:t.clientWidth,t.clientHeight===0?1:t.clientHeight)}function P(t,n,s,o,i){var r,a=t;if(e.type(n)==="string")if(n.match(/^\s*<.*>\s*$/))n=e.parseXml(n);else if(n.match(/^\s*[{[].*[}\]]\s*$/))try{r=e.parseJSON(n),n=r}catch{}function c(e,t){e.ready?o(e):(e.addHandler("ready",function(){o(e)}),e.addHandler("open-failed",function(e){i({message:e.message,source:t})}))}setTimeout(function(){if(e.type(n)==="string")n=new e.TileSource({url:n,crossOriginPolicy:s.crossOriginPolicy!==0[0]?s.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:s.ajaxHeaders?s.ajaxHeaders:t.ajaxHeaders,splitHashDataForPost:t.splitHashDataForPost,success:function(e){o(e.tileSource)}}),n.addHandler("open-failed",function(e){i(e)});else if(e.isPlainObject(n)||n.nodeType)if(n.crossOriginPolicy===0[0]&&(s.crossOriginPolicy!==0[0]||t.crossOriginPolicy!==0[0])&&(n.crossOriginPolicy=s.crossOriginPolicy!==0[0]?s.crossOriginPolicy:t.crossOriginPolicy),n.ajaxWithCredentials===0[0]&&(n.ajaxWithCredentials=t.ajaxWithCredentials),e.isFunction(n.getTileUrl)){var r,d,l=new e.TileSource(n);l.getTileUrl=n.getTileUrl,o(l)}else{if(r=e.TileSource.determineType(a,n),!r){i({message:"Unable to load TileSource",source:n});return}d=r.prototype.configure.apply(a,[n]),c(new r(d),n)}else c(n,n)})}function h(t,n){if(n instanceof e.Overlay)return n;var o,i,a,r,c,l,d,u,s=null;return n.element?s=e.getElement(n.element):(l=n.id?n.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7),s=e.getElement(n.id),s||(s=document.createElement("a"),s.href="#/overlay/"+l),s.id=l,e.addClass(s,n.className?n.className:"openseadragon-overlay")),c=n.location,o=n.width,i=n.height,c||(d=n.x,u=n.y,n.px!==0[0]&&(a=t.viewport.imageToViewportRectangle(new e.Rect(n.px,n.py,o||0,i||0)),d=a.x,u=a.y,o=o!==0[0]?a.width:0[0],i=i!==0[0]?a.height:0[0]),c=new e.Point(d,u)),r=n.placement,r&&e.type(r)==="string"&&(r=e.Placement[n.placement.toUpperCase()]),new e.Overlay({element:s,location:c,placement:r,onDraw:n.onDraw,checkResize:n.checkResize,width:o,height:i,rotationMode:n.rotationMode})}function a(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n].element===t)return n;return-1}function l(t,n){return e.requestAnimationFrame(function(){n(t)})}function d(t){e.requestAnimationFrame(function(){b(t)})}function o(t){if(!t.autoHideControls)return;t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout(function(){d(t)},t.controlsFadeDelay)}function b(t){var n,s,o,i;if(t.controlsShouldFade){o=e.now(),i=o-t.controlsFadeBeginTime,n=1-i/t.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n);for(s=t.controls.length-1;s>=0;s--)t.controls[s].autoFade&&t.controls[s].setOpacity(n);n>0&&d(t)}}function i(e){var t;e.controlsShouldFade=!1;for(t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function m(){i(this)}function f(){o(this)}function z(e){var t={tracker:e.eventSource,position:e.position,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.raiseEvent("canvas-contextmenu",t),e.preventDefault=t.preventDefault}function T(t){var n={originalEvent:t.originalEvent,preventDefaultAction:!1,preventVerticalPan:t.preventVerticalPan||!this.panVertical,preventHorizontalPan:t.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",n),!n.preventDefaultAction&&!t.ctrl&&!t.alt&&!t.meta)switch(t.keyCode){case 38:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 40:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 37:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 39:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 87:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 83:n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 65:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 68:n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 82:t.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),t.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:t.preventDefault=!1;break}else t.preventDefault=!1}function E(e){var t={originalEvent:e.originalEvent};this.raiseEvent("canvas-key-press",t)}function D(n){var s,o,i=document.activeElement===this.canvas;i||this.canvas.focus(),this.viewport.flipped&&(n.position.x=this.viewport.getContainerSize().x-n.position.x),o={tracker:n.eventSource,position:n.position,quick:n.quick,shift:n.shift,originalEvent:n.originalEvent,originalTarget:n.originalTarget,preventDefaultAction:!1},this.raiseEvent("canvas-click",o),!o.preventDefaultAction&&this.viewport&&n.quick&&(s=this.gestureSettingsByDeviceType(n.pointerType),s.clickToZoom===!0&&(this.viewport.zoomBy(n.shift?1/this.zoomPerClick:this.zoomPerClick,s.zoomToRefPoint?this.viewport.pointFromPixel(n.position,!0):null),this.viewport.applyConstraints()),s.dblClickDragToZoom&&(t[this.hash].draggingToZoom===!0?(t[this.hash].lastClickTime=null,t[this.hash].draggingToZoom=!1):t[this.hash].lastClickTime=e.now()))}function j(e){var t,n={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",n),!n.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints()))}function y(e){var n,s,o,a,i={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag",i),s=this.gestureSettingsByDeviceType(e.pointerType),!i.preventDefaultAction&&this.viewport&&(s.dblClickDragToZoom&&t[this.hash].draggingToZoom?(a=this.zoomPerDblClickDrag**(e.delta.y/50),this.viewport.zoomBy(a)):s.dragToPan&&!t[this.hash].draggingToZoom&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan&&(n=this.viewport.deltaPointsFromPixels(e.delta.negate()),this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y,o=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,o.xConstrained&&(e.delta.x=0),o.yConstrained&&(e.delta.y=0)),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),s.flickEnabled&&!this.constrainDuringPan)))}function _(n){var s,o,i,a,c,r={tracker:n.eventSource,pointerType:n.pointerType,position:n.position,speed:n.speed,direction:n.direction,shift:n.shift,originalEvent:n.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-drag-end",r),s=this.gestureSettingsByDeviceType(n.pointerType),!r.preventDefaultAction&&this.viewport&&(!t[this.hash].draggingToZoom&&s.dragToPan&&s.flickEnabled&&n.speed>=s.flickMinSpeed&&(o=0,this.panHorizontal&&(o=s.flickMomentum*n.speed*Math.cos(n.direction)),i=0,this.panVertical&&(i=s.flickMomentum*n.speed*Math.sin(n.direction)),a=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),c=this.viewport.pointFromPixel(new e.Point(a.x-o,a.y-i)),this.viewport.panTo(c,!1)),this.viewport.applyConstraints()),s.dblClickDragToZoom&&t[this.hash].draggingToZoom===!0&&(t[this.hash].draggingToZoom=!1)}function w(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function O(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function x(n){if(this.raiseEvent("canvas-press",{tracker:n.eventSource,pointerType:n.pointerType,position:n.position,insideElementPressed:n.insideElementPressed,insideElementReleased:n.insideElementReleased,originalEvent:n.originalEvent}),s=this.gestureSettingsByDeviceType(n.pointerType),s.dblClickDragToZoom){var s,o=t[this.hash].lastClickTime,i=e.now();if(o===null)return;i-o<this.dblClickTimeThreshold&&(t[this.hash].draggingToZoom=!0),t[this.hash].lastClickTime=null}}function C(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function v(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function k(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function A(e){var n,s,o,i,a,r,t={tracker:e.eventSource,pointerType:e.pointerType,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};this.raiseEvent("canvas-pinch",t),this.viewport&&(s=this.gestureSettingsByDeviceType(e.pointerType),s.pinchToZoom&&(!t.preventDefaultPanAction||!t.preventDefaultZoomAction)&&(n=this.viewport.pointFromPixel(e.center,!0),s.zoomToRefPoint&&!t.preventDefaultPanAction&&(i=this.viewport.pointFromPixel(e.lastCenter,!0),o=i.minus(n),this.panHorizontal||(o.x=0),this.panVertical||(o.y=0),this.viewport.panBy(o,!0)),t.preventDefaultZoomAction||this.viewport.zoomBy(e.distance/e.lastDistance,n,!0),this.viewport.applyConstraints()),s.pinchRotate&&!t.preventDefaultRotateAction&&(a=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),r=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x),n=this.viewport.pointFromPixel(e.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(a-r)*(180/Math.PI),n,!0)))}function S(e){this.raiseEvent("canvas-focus",{tracker:e.eventSource,originalEvent:e.originalEvent})}function M(e){this.raiseEvent("canvas-blur",{tracker:e.eventSource,originalEvent:e.originalEvent})}function F(t){var n,s,o,i=e.now(),a=i-this._lastScrollTime;a>this.minScrollDeltaTime?(this._lastScrollTime=i,n={tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",n),!n.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),s=this.gestureSettingsByDeviceType(t.pointerType),s.scrollToZoom&&(o=this.zoomPerScroll**t.scroll,this.viewport.zoomBy(o,s.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints())),t.preventDefault=n.preventDefault):t.preventDefault=!0}function g(e){t[this.hash].mouseInside=!0,i(this),this.raiseEvent("container-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function p(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||o(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function u(e){L(e),e.isOpen()?e._updateRequestId=l(e,u):e._updateRequestId=!1}function N(n,s){var i,a,r,c,o=n.viewport,l=o.getZoom(),d=o.getCenter();o.resize(s,n.preserveImageSizeOnResize),o.panTo(d,!0),n.preserveImageSizeOnResize?i=t[n.hash].prevContainerSize.x/s.x:(a=new e.Point(0,0),r=new e.Point(t[n.hash].prevContainerSize.x,t[n.hash].prevContainerSize.y).distanceTo(a),c=new e.Point(s.x,s.y).distanceTo(a),i=c/r*t[n.hash].prevContainerSize.x/s.x),o.zoomTo(l*i,null,!0),t[n.hash].prevContainerSize=s,t[n.hash].forceRedraw=!0,t[n.hash].needsResize=!1,t[n.hash].forceResize=!1}function L(e){if(e._opening||!t[e.hash])return;if(e.autoResize||t[e.hash].forceResize){if(e._autoResizePolling){r=c(e.container);var n,s,a,r,l,d=t[e.hash].prevContainerSize;r.equals(d)||(t[e.hash].needsResize=!0)}t[e.hash].needsResize&&N(e,r||c(e.container))}s=e.viewport.update(),n=e.world.update(s)||s,s&&e.raiseEvent("viewport-change"),e.referenceStrip&&(n=e.referenceStrip.update(e.viewport)||n),l=t[e.hash].animating,!l&&n&&(e.raiseEvent("animation-start"),i(e)),a=l&&!n,a&&(t[e.hash].animating=!1),(n||a||t[e.hash].forceRedraw||e.world.needsDraw())&&(R(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,n&&e.raiseEvent("animation")),a&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||o(e)),t[e.hash].animating=n}function R(e){e.imageLoader.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}function s(e,t){return e?e+t:t}function H(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,r(this)}function I(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,r(this)}function B(){t[this.hash].zooming=!1}function r(t){e.requestAnimationFrame(e.delegate(t,$))}function $(){var n,s,o;t[this.hash].zooming&&this.viewport&&(n=e.now(),s=n-t[this.hash].lastZoomTime,o=t[this.hash].zoomFactor**(s/1e3),this.viewport.zoomBy(o),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=n,r(this))}function W(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function U(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function K(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function q(){this.viewport&&this.viewport.goHome()}function Y(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function G(){if(this.viewport){var e=this.viewport.getRotation();this.viewport.flipped?e+=this.rotationIncrement:e-=this.rotationIncrement,this.viewport.setRotation(e)}}function X(){if(this.viewport){var e=this.viewport.getRotation();this.viewport.flipped?e-=this.rotationIncrement:e+=this.rotationIncrement,this.viewport.setRotation(e)}}function Q(){this.viewport.toggleFlip()}e.determineDrawer=function(t){for(let i in n){const o=n[i],s=o.prototype;if(s&&s instanceof n.DrawerBase&&e.isFunction(s.getType)&&s.getType.call(o)===t)return o}return null}}(n),function(e){e.Navigator=function(n){var l,d,h,c=n.viewer,r=this;n.element||n.id?(n.element?(n.id&&e.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),n.element.id?n.id=n.element.id:n.id="navigator-"+e.now(),this.element=n.element):this.element=document.getElementById(n.id),n.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(n.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),n.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:n.autoFade},n.position&&("BOTTOM_RIGHT"===n.position?n.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===n.position?n.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===n.position?n.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===n.position?n.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===n.position&&(n.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,n.controlOptions.top=n.top,n.controlOptions.left=n.left,n.controlOptions.height=n.height,n.controlOptions.width=n.width))),this.element.id=n.id,this.element.className+=" navigator",n=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},n,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:n.animationTime,autoResize:!1,minZoomImageRatio:1,background:n.background,opacity:n.opacity,borderColor:n.borderColor,displayRegionColor:n.displayRegionColor}),n.minPixelRatio=this.minPixelRatio=c.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),n.controlOptions.anchor!==e.ControlAnchor.NONE&&function(e,t){e.margin="0px",e.border=t+"px solid "+n.borderColor,e.padding="0px",e.background=n.background,e.opacity=n.opacity,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+n.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.zIndex=999999999,e.cursor="default",e.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,n.controlOptions),this._resizeWithViewer=n.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&n.controlOptions.anchor!==e.ControlAnchor.NONE,n.width&&n.height?(this.setWidth(n.width),this.setHeight(n.height)):this._resizeWithViewer&&(l=e.getElementSize(c.element),this.element.style.height=Math.round(l.y*n.sizeRatio)+"px",this.element.style.width=Math.round(l.x*n.sizeRatio)+"px",this.oldViewerSize=l,d=e.getElementSize(this.element),this.elementArea=d.x*d.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[n]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function u(e,n){t(r.displayRegionContainer,e),t(r.displayRegion,-e),r.viewport.setRotation(e,n)}n.navigatorRotate&&(h=n.viewer.viewport?n.viewer.viewport.getRotation():n.viewer.degrees||0,u(h,!0),n.viewer.addHandler("rotate",function(e){u(e.degrees,e.immediately)})),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,o),clickHandler:e.delegate(this,s),releaseHandler:e.delegate(this,i),scrollHandler:e.delegate(this,a),preProcessEventHandler:function(e){e.eventType==="wheel"&&(e.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){r.viewport&&r.viewport.goHome(!0)}),c.world.addHandler("item-index-change",function(e){window.setTimeout(function(){var t=r.world.getItemAt(e.previousIndex);r.world.setItemIndex(t,e.newIndex)},1)}),c.world.addHandler("remove-item",function(e){var n=e.item,t=r._getMatchingItem(n);t&&r.world.removeItem(t)}),this.update(c.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.world.update(),this.world.draw(),this.update(this.viewer.viewport))}},setWidth:function(e){this.width=e,this.element.style.width=typeof e=="number"?e+"px":e,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(e){this.height=e,this.element.style.height=typeof e=="number"?e+"px":e,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){n(this.canvas,e),n(this.element,e)},update:function(n){if(n||(n=this.viewer.viewport),s=e.getElementSize(this.viewer.element),this._resizeWithViewer&&s.x&&s.y&&!s.equals(this.oldViewerSize)&&(this.oldViewerSize=s,this.maintainSizeRatio||!this.elementArea?(i=s.x*this.sizeRatio,r=s.y*this.sizeRatio):(i=(this.elementArea*(s.x/s.y))**.5,r=this.elementArea/i),this.element.style.width=Math.round(i)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=i*r),this.updateSize()),n&&this.viewport){if(c=n.getBoundsNoRotate(!0),a=this.viewport.pixelFromPointNoRotate(c.getTopLeft(),!1),l=this.viewport.pixelFromPointNoRotate(c.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var s,o,i,a,r,c,l,d,u,h=n.getRotation(!0);t(this.displayRegion,-h)}o=this.displayRegion.style,o.display=this.world.getItemCount()?"block":"none",o.top=a.y.toFixed(2)+"px",o.left=a.x.toFixed(2)+"px",d=l.x-a.x,u=l.y-a.y,o.width=Math.round(Math.max(d,0))+"px",o.height=Math.round(Math.max(u,0))+"px"}},addTiledImage:function(t){var o,s=this,n=t.originalTiledImage;return delete t.original,o=e.extend({},t,{success:function(e){var t=e.item;t._originalForNavigator=n,s._matchBounds(t,n,!0),s._matchOpacity(t,n),s._matchCompositeOperation(t,n);function o(){s._matchBounds(t,n)}function i(){s._matchOpacity(t,n)}function a(){s._matchCompositeOperation(t,n)}n.addHandler("bounds-change",o),n.addHandler("clip-change",o),n.addHandler("opacity-change",i),n.addHandler("composite-operation-change",a)}}),e.Viewer.prototype.addTiledImage.apply(this,[o])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(e){for(var t,s=this.world.getItemCount(),n=0;n<s;n++)if(t=this.world.getItemAt(n),t._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,n){var s=t.getBoundsNoRotate();e.setPosition(s.getTopLeft(),n),e.setWidth(s.width,n),e.setRotation(t.getRotation(),n),e.setClip(t.getClip()),e.setFlip(t.getFlip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}});function s(e){var t,n={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",n),!n.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x),t=this.viewport.pointFromPixel(e.position),this.panVertical?this.panHorizontal||(t.x=this.viewer.viewport.getCenter(!0).x):t.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(t),this.viewer.viewport.applyConstraints())}function o(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function i(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(e){var t={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.viewer.raiseEvent("navigator-scroll",t),e.preventDefault=t.preventDefault}function t(e,t){n(e,"rotate("+t+"deg)")}function n(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}}(n),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var s,i=n.split("."),o=null,r=arguments,a=t;for(s=0;s<i.length-1;s++)a=a[i[s]]||{};return o=a[i[s]],typeof o!="string"&&(e.console.error("Untranslated source string:",n),o=""),o.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<r.length?r[t]:""})},setString:function(e,n){var s,o=e.split("."),i=t;for(s=0;s<o.length-1;s++)i[o[s]]||(i[o[s]]={}),i=i[o[s]];i[o[s]]=n}})}(n),function(e){e.Point=function(e,t){this.x=typeof e=="number"?e:0,this.y=typeof t=="number"?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return((this.x-e.x)**2+(this.y-e.y)**2)**.5},squaredDistanceTo:function(e){return(this.x-e.x)**2+(this.y-e.y)**2},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,n){if(n=n||new e.Point(0,0),t%90===0){var s,o,i,a,r,c=e.positiveModulo(t,360);switch(c){case 0:s=1,o=0;break;case 90:s=0,o=1;break;case 180:s=-1,o=0;break;case 270:s=0,o=-1;break}}else i=t*Math.PI/180,s=Math.cos(i),o=Math.sin(i);return a=s*(this.x-n.x)-o*(this.y-n.y)+n.x,r=o*(this.x-n.x)+s*(this.y-n.y)+n.y,new e.Point(a,r)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(n),function(e){e.TileSource=function(t){var r,l,d=this,c=arguments;if(e.isPlainObject(t)?r=t:r={width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},e.EventSource.call(this),e.extend(!0,this,r),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",function(e){d.success(e)}),"string"===e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=r.width&&r.height?r.width/r.height:1,this.dimensions=new e.Point(r.width,r.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=r.tileOverlap?r.tileOverlap:0,this.minLevel=r.minLevel?r.minLevel:0,this.maxLevel=0[0]!==r.maxLevel&&null!==r.maxLevel?r.maxLevel:r.width&&r.height?Math.ceil(Math.log(Math.max(r.width,r.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},setMaxLevel:function(e){this.maxLevel=e,this._memoizeLevelScale()},getLevelScale:function(e){return this._memoizeLevelScale(),this.getLevelScale(e)},_memoizeLevelScale:function(){var e,t={};for(e=0;e<=this.maxLevel;e++)t[e]=1/2**(this.maxLevel-e);this.getLevelScale=function(e){return t[e]}},getNumTiles:function(t){var n=this.getLevelScale(t),s=Math.ceil(n*this.dimensions.x/this.getTileWidth(t)),o=Math.ceil(n*this.dimensions.y/this.getTileHeight(t));return new e.Point(s,o)},getPixelRatio:function(t){var n=this.dimensions.times(this.getLevelScale(t)),s=1/n.x*e.pixelDensityRatio,o=1/n.y*e.pixelDensityRatio;return new e.Point(s,o)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel;e++)if(t=this.getNumTiles(e),t.x>1||t.y>1)break;return e-1},getTileAtPoint:function(t,n){var s,o,i,a,r,c,l=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;return e.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point."),s=this.dimensions.x*this.getLevelScale(t),a=n.x*s,r=n.y*s,o=Math.floor(a/this.getTileWidth(t)),i=Math.floor(r/this.getTileHeight(t)),n.x>=1&&(o=this.getNumTiles(t).x-1),c=1e-15,n.y>=1/this.aspectRatio-c&&(i=this.getNumTiles(t).y-1),new e.Point(o,i)},getTileBounds:function(t,n,s,o){var c=this.dimensions.times(this.getLevelScale(t)),l=this.getTileWidth(t),d=this.getTileHeight(t),u=n===0?0:l*n-this.tileOverlap,h=s===0?0:d*s-this.tileOverlap,i=l+(n===0?1:2)*this.tileOverlap,a=d+(s===0?1:2)*this.tileOverlap,r=1/c.x,i=Math.min(i,c.x-u),a=Math.min(a,c.y-h);return o?new e.Rect(0,0,i,a):new e.Rect(u*r,h*r,i*r,a*r)},getImageInfo:function(n){var o,i,a,r,c,l,d,u,h,s=this;n&&(o=n.split("/"),l=o[o.length-1],d=l.lastIndexOf("."),d>-1&&(o[o.length-1]=l.slice(0,d))),i=null,this.splitHashDataForPost&&(r=n.indexOf("#"),r!==-1&&(i=n.substring(r+1),n=n.substr(0,r))),c=function(t){typeof t=="string"&&(t=e.parseXml(t));var o=e.TileSource.determineType(s,t,n);if(!o){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n});return}a=o.prototype.configure.apply(s,[t,n,i]),a.ajaxWithCredentials===0[0]&&(a.ajaxWithCredentials=s.ajaxWithCredentials),h=new o(a),s.ready=!0,s.raiseEvent("ready",{tileSource:h})},n.match(/\.js$/)?(u=n.split("/").pop().replace(".js",""),e.jsonp({url:n,async:!1,callbackName:u,callback:c})):e.makeAjaxRequest({url:n,postData:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(e){var n=t(e);c(n)},error:function(t,o){var a,r;try{a="HTTP "+t.status+" attempting to load TileSource: "+n}catch{typeof o=="undefined"||!o.toString?r="Unknown error":r=o.toString(),a=r+" attempting to load TileSource: "+n}e.console.error(a),s.raiseEvent("open-failed",{message:a,source:n,postData:i})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},getTilePostData:function(){return null},getTileAjaxHeaders:function(){return{}},getTileHashKey:function(e,t,n,s,o){function a(e){return o?e+"+"+JSON.stringify(o):e}return a(typeof s!="string"?e+"/"+t+"_"+n:s)},tileExists:function(e,t,n){var s=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&n>=0&&t<s.x&&n<s.y},hasTransparency:function(e,t){return!!e||t.match(".png")},downloadTileStart:function(t){var o,s=t.userData,n=new Image;s.image=n,s.request=null,o=function(e){if(!n){t.finish(null,s.request,"Image load failed: undefined Image instance.");return}n.onload=n.onerror=n.onabort=null,t.finish(e?null:n,s.request,e)},n.onload=function(){o()},n.onabort=n.onerror=function(){o("Image load aborted.")},t.loadWithAjax?s.request=e.makeAjaxRequest({url:t.src,withCredentials:t.ajaxWithCredentials,headers:t.ajaxHeaders,responseType:"arraybuffer",postData:t.postData,success:function(e){try{t=new window.Blob([e.response])}catch(n){var t,s,i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;n.name==="TypeError"&&i&&(s=new i,s.append(e.response),t=s.getBlob())}t.size===0?o("Empty image response."):n.src=(window.URL||window.webkitURL).createObjectURL(t)},error:function(){o("Image load aborted - XHR error")}}):(t.crossOriginPolicy!==!1&&(n.crossOrigin=t.crossOriginPolicy),n.src=t.src)},downloadTileAbort:function(e){e.userData.request&&e.userData.request.abort();var t=e.userData.image;e.userData.image&&(t.onload=t.onerror=t.onabort=null)},createTileCache:function(e,t){e._data=t},destroyTileCache:function(e){e._data=null,e._renderedContext=null},getTileCacheData:function(e){return e._data},getTileCacheDataAsImage:function(e){return e._data},getTileCacheDataAsContext2D:function(e){if(!e._renderedContext){var t=document.createElement("canvas");t.width=e._data.width,t.height=e._data.height,e._renderedContext=t.getContext("2d"),e._renderedContext.drawImage(e._data,0,0),e._data=null}return e._renderedContext}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype);function t(t){var s,i,n=t.responseText,o=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(t.status!==200&&t.status!==0)throw o=t.status,i=o===404?"Not Found":t.statusText,new Error(e.getString("Errors.Status",o,i));if(n.match(/^\s*<.*/))try{s=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(n)}catch{s=t.responseText}else if(n.match(/\s*[{[].*/))try{s=e.parseJSON(n)}catch{s=n}else s=n;return s}e.TileSource.determineType=function(t,s,o){var i;for(i in n)if(i.match(/.+TileSource$/)&&e.isFunction(n[i])&&e.isFunction(n[i].prototype.supports)&&n[i].prototype.supports.call(t,s,o))return n[i];return e.console.error("No TileSource was able to open %s %s",o,s),null}}(n),function(e){e.DziTileSource=function(t){var d,u,h,m;if(e.isPlainObject(t)?u=t:u={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=u.tilesUrl,this.fileFormat=u.fileFormat,this.displayRects=u.displayRects,this.displayRects)for(h=this.displayRects.length-1;h>=0;h--){m=this.displayRects[h];for(d=m.minLevel;d<=m.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(m)}e.TileSource.apply(this,[u])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e){var n;return e.Image?n=e.Image.xmlns:e.documentElement&&("Image"===e.documentElement.localName||"Image"===e.documentElement.tagName)&&(n=e.documentElement.namespaceURI),n=(n||"").toLowerCase(),n.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||n.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,o){var a;return e.isPlainObject(s)?a=t(this,s):a=n(this,s),o&&!a.tilesUrl&&(a.tilesUrl=o.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),o.search(/\.(dzi|xml|js)\?/)!==-1?a.queryParams=o.match(/\?.*/):a.queryParams=""),a},getTileUrl:function(e,t,n){return[this.tilesUrl,e,"/",t,"_",n,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,n){var s,o,i,a,c,l,d,r=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!r||!r.length)return!0;for(d=r.length-1;d>=0;d--){if(s=r[d],e<s.minLevel||e>s.maxLevel)continue;if(o=this.getLevelScale(e),i=s.x*o,a=s.y*o,c=i+s.width*o,l=a+s.height*o,i=Math.floor(i/this._tileWidth),a=Math.floor(a/this._tileWidth),c=Math.ceil(c/this._tileWidth),l=Math.ceil(l/this._tileWidth),i<=t&&t<c&&a<=n&&n<l)return!0}return!1}});function n(n,s){if(!s||!s.documentElement)throw new Error(e.getString("Errors.Xml"));var i,r,c,l,d,f,p,o=s.documentElement,u=o.localName||o.tagName,h=s.documentElement.namespaceURI,a=null,m=[];if(u==="Image")try{if(l=o.getElementsByTagName("Size")[0],l===0[0]&&(l=o.getElementsByTagNameNS(h,"Size")[0]),a={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(l.getAttribute("Height"),10),Width:parseInt(l.getAttribute("Width"),10)}}},!e.imageFormatSupported(a.Image.Format))throw new Error(e.getString("Errors.ImageFormat",a.Image.Format.toUpperCase()));r=o.getElementsByTagName("DisplayRect"),r===0[0]&&(r=o.getElementsByTagNameNS(h,"DisplayRect")[0]);for(d=0;d<r.length;d++)c=r[d],i=c.getElementsByTagName("Rect")[0],i===0[0]&&(i=c.getElementsByTagNameNS(h,"Rect")[0]),m.push({Rect:{X:parseInt(i.getAttribute("X"),10),Y:parseInt(i.getAttribute("Y"),10),Width:parseInt(i.getAttribute("Width"),10),Height:parseInt(i.getAttribute("Height"),10),MinLevel:parseInt(c.getAttribute("MinLevel"),10),MaxLevel:parseInt(c.getAttribute("MaxLevel"),10)}});return m.length&&(a.Image.DisplayRect=m),t(n,a)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else if(u==="Collection")throw new Error(e.getString("Errors.Dzc"));else if(u==="Error")throw f=o.getElementsByTagName("Message")[0],p=f.firstChild.nodeValue,new Error(p);throw new Error(e.getString("Errors.Dzi"))}function t(t,n){var s,i,o=n.Image,l=o.Url,d=o.Format,a=o.Size,r=o.DisplayRect||[],u=parseInt(a.Width,10),h=parseInt(a.Height,10),m=parseInt(o.TileSize,10),f=parseInt(o.Overlap,10),c=[];for(i=0;i<r.length;i++)s=r[i].Rect,c.push(new e.DisplayRect(parseInt(s.X,10),parseInt(s.Y,10),parseInt(s.Width,10),parseInt(s.Height,10),parseInt(s.MinLevel,10),parseInt(s.MaxLevel,10)));return e.extend(!0,{width:u,height:h,tileSize:m,tileOverlap:f,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:d,displayRects:c},n)}}(n),function(e){e.IIIFTileSource=function(n){if(e.extend(!0,this,n),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(n.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=n.version,this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(o=0;o<this.tiles.length;o++)for(i=0;i<this.tiles[o].scaleFactors.length;i++)c=this.tiles[o].scaleFactors[i],this.scale_factors.push(c),n.tileSizePerScaleFactor[c]={width:this.tiles[o].width,height:this.tiles[o].height||this.tiles[o].width}}else if(t(n)){for(var o,i,r,c,h,u=Math.min(this.height,this.width),l=[256,512,1024],d=[],a=0;a<l.length;a++)l[a]<=u&&d.push(l[a]);d.length>0?n.tileSize=Math.max.apply(null,d):n.tileSize=u}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,n.levels=s(this),e.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):e.console.error("Nothing in the info.json to construct image pyramids from");!n.maxLevel&&!this.emulateLegacyImagePyramid&&(this.scale_factors?(h=Math.max.apply(null,this.scale_factors),n.maxLevel=Math.round(Math.log(h)*Math.LOG2E)):n.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)))),this.sizes&&(r=this.sizes.length,(r===n.maxLevel||r===n.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort((e,t)=>e.width-t.width),r===n.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))),e.TileSource.apply(this,[n])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e){return!!(e.protocol&&e.protocol==="http://iiif.io/api/image")||!!(e["@context"]&&(e["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||e["@context"]==="http://iiif.io/api/image/1/context.json"))||!!(e.profile&&e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0)||!!(e.identifier&&e.width&&e.height)||!!(e.documentElement&&"info"===e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"===e.documentElement.namespaceURI)},configure:function(t,s){if(e.isPlainObject(t)){if(t["@context"]){if(a=t["@context"],Array.isArray(a))for(r=0;r<a.length;r++)if(typeof a[r]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(a[r])||a[r]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){a=a[r];break}switch(a){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":t.version=1;break;case"http://iiif.io/api/image/2/context.json":t.version=2;break;case"http://iiif.io/api/image/3/context.json":t.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else t["@context"]="http://iiif.io/api/image/1.0/context.json",t["@id"]=s.replace("/info.json",""),t.version=1;if(t.preferredFormats)for(c=0;c<t.preferredFormats.length;c++)if(n.imageFormatSupported(t.preferredFormats[c])){t.tileFormat=t.preferredFormats[c];break}return t}var a,r,c,l=i(t);return l["@context"]="http://iiif.io/api/image/1.0/context.json",l["@id"]=s.replace("/info.xml",""),l.version=1,l},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var n=2**(this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var n=2**(this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var n=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].width/this.levels[this.maxLevel].width),n}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){if(this.emulateLegacyImagePyramid)return n=this.getLevelScale(t),n?new e.Point(1,1):new e.Point(0,0);if(this.levelSizes){var n,s=this.levelSizes[t],o=Math.ceil(s.width/this.getTileWidth(t)),i=Math.ceil(s.height/this.getTileHeight(t));return new e.Point(o,i)}return e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,n){if(this.emulateLegacyImagePyramid)return new e.Point(0,0);if(this.levelSizes){var s,o,i,a,r,c,l=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;return e.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point."),s=this.levelSizes[t].width,a=n.x*s,r=n.y*s,o=Math.floor(a/this.getTileWidth(t)),i=Math.floor(r/this.getTileHeight(t)),n.x>=1&&(o=this.getNumTiles(t).x-1),c=1e-15,n.y>=1/this.aspectRatio-c&&(i=this.getNumTiles(t).y-1),new e.Point(o,i)}return e.TileSource.prototype.getTileAtPoint.call(this,t,n)},getTileUrl:function(e,t,n){if(this.emulateLegacyImagePyramid)return h=null,this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(h=this.levels[e].url),h;var s,o,i,a,r,c,l,u,h,m,f,p,g,v,b,j,y,_="0",d=.5**(this.maxLevel-e);return this.levelSizes?(o=this.levelSizes[e].width,i=this.levelSizes[e].height):(o=Math.ceil(this.width*d),i=Math.ceil(this.height*d)),r=this.getTileWidth(e),c=this.getTileHeight(e),v=Math.round(r/d),u=Math.round(c/d),this.version===1?j="native."+this.tileFormat:j="default."+this.tileFormat,o<r&&i<c?(this.version===2&&o===this.width?s="full":this.version===3&&o===this.width&&i===this.height?s="max":this.version===3?s=o+","+i:s=o+",",l="full"):(m=t*v,f=n*u,p=Math.min(v,this.width-m),g=Math.min(u,this.height-f),t===0&&n===0&&p===this.width&&g===this.height?l="full":l=[m,f,p,g].join(","),a=Math.min(r,o-t*r),b=Math.min(c,i-n*c),this.version===2&&a===this.width?s="full":this.version===3&&a===this.width&&b===this.height?s="max":this.version===3?s=a+","+b:s=a+","),y=[this._id,l,s,_,j].join("/"),y},__testonly__:{canBeTiled:t,constructLevels:s}});function t(e){var n=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],s=Array.isArray(e.profile)?e.profile[0]:e.profile,o=n.indexOf(s)!==-1,t=!1;return e.version===2&&e.profile.length>1&&e.profile[1].supports&&(t=e.profile[1].supports.indexOf("sizeByW")!==-1),e.version===3&&e.extraFeatures&&(t=e.extraFeatures.indexOf("sizeByWh")!==-1),!o||t}function s(e){for(var n=[],t=0;t<e.sizes.length;t++)n.push({url:e._id+"/full/"+e.sizes[t].width+","+(e.version===3?e.sizes[t].height:"")+"/0/default."+e.tileFormat,width:e.sizes[t].width,height:e.sizes[t].height});return n.sort(function(e,t){return e.width-t.width})}function i(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var s=t.documentElement,i=s.tagName,n=null;if(i==="info")try{return n={},o(s,n),n}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function o(t,n,s){var i,a;if(t.nodeType===3&&s)i=t.nodeValue.trim(),i.match(/^\d*$/)&&(i=Number(i)),n[s]?(e.isArray(n[s])||(n[s]=[n[s]]),n[s].push(i)):n[s]=i;else if(t.nodeType===1)for(a=0;a<t.childNodes.length;a++)o(t.childNodes[a],n,t.nodeName)}}(n),function(e){e.OsmTileSource=function(t){var a;e.isPlainObject(t)?a=t:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!a.width||!a.height)&&(a.width=65572864,a.height=65572864),a.tileSize||(a.tileSize=256,a.tileOverlap=0),a.tilesUrl||(a.tilesUrl="http://tile.openstreetmap.org/"),a.minLevel=8,e.TileSource.apply(this,[a])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"===e.type},configure:function(e){return e},getTileUrl:function(e,t,n){return this.tilesUrl+(e-8)+"/"+t+"/"+n+".png"}})}(n),function(e){e.TmsTileSource=function(t){e.isPlainObject(t)?a=t:a={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l,r=Math.ceil(a.width/256)*256,c=Math.ceil(a.height/256)*256;r>c?l=r/256:l=c/256,a.maxLevel=Math.ceil(Math.log(l)/Math.log(2))-1,a.tileSize=256,a.width=r,a.height=c,e.TileSource.apply(this,[a])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"===e.type},configure:function(e){return e},getTileUrl:function(e,t,n){var s=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(s-n)+".png"}})}(n),function(e){e.ZoomifyTileSource=function(e){typeof e.tileSize=="undefined"&&(e.tileSize=256),typeof e.fileFormat=="undefined"&&(e.fileFormat="jpg",this.fileFormat=e.fileFormat);var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,n.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,n){return{x:Math.ceil(e/n),y:Math.ceil(t/n)}},_calculateAbsoluteTileNumber:function(e,t,n){for(var o=0,s={},i=0;i<e;i++)s=this.gridSize[i],o+=s.x*s.y;return s=this.gridSize[e],o+=s.x*n+t,o},supports:function(e){return e.type&&"zoomifytileservice"===e.type},configure:function(e){return e},getTileUrl:function(e,t,n){var s=0,o=this._calculateAbsoluteTileNumber(e,t,n),s=Math.floor(o/256);return this.tilesUrl+"TileGroup"+s+"/"+e+"-"+t+"-"+n+"."+this.fileFormat}})}(n),function(e){e.LegacyTileSource=function(t){var s,o,i;e.isArray(t)&&(s={type:"legacy-image-pyramid",levels:t}),s.levels=n(s.levels),s.levels.length>0?(o=s.levels[s.levels.length-1].width,i=s.levels[s.levels.length-1].height):(o=0,i=0,e.console.error("No supported image formats found")),e.extend(!0,s,{width:o,height:i,tileSize:Math.max(i,o),tileOverlap:0,minLevel:0,maxLevel:s.levels.length>0?s.levels.length-1:0}),e.TileSource.apply(this,[s]),this.levels=s.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"===e.type||e.documentElement&&"legacy-image-pyramid"===e.documentElement.getAttribute("type")},configure:function(n){var a;return e.isPlainObject(n)?a=t(this,n):a=s(this,n),a},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var n=this.getLevelScale(t);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e){var s=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].url),s}});function n(t){var n,s,o=[];for(s=0;s<t.length;s++)n=t[s],n.height&&n.width&&n.url?o.push({url:n.url,width:Number(n.width),height:Number(n.height)}):e.console.error("Unsupported image format: %s",n.url?n.url:"<no URL>");return o.sort(function(e,t){return e.height-t.height})}function s(n,s){if(!s||!s.documentElement)throw new Error(e.getString("Errors.Xml"));var i,a,r=s.documentElement,o=r.tagName,c=null,l=[];if(o==="image")try{c={type:r.getAttribute("type"),levels:[]},l=r.getElementsByTagName("level");for(a=0;a<l.length;a++)i=l[a],c.levels.push({url:i.getAttribute("url"),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10)});return t(n,c)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else if(o==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");else if(o==="error")throw new Error("Error: "+s);throw new Error("Unknown element "+o)}function t(e,t){return t.levels}}(n),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&e.type==="image"},configure:function(e){return e},getImageInfo:function(t){var s=this._image=new Image,n=this;this.crossOriginPolicy&&(s.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(s.useCredentials=this.ajaxWithCredentials),e.addEvent(s,"load",function(){n.width=s.naturalWidth,n.height=s.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),e.addEvent(s,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),s.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var n=this.getLevelScale(t);return n?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].url),s},getContext2D:function(e){var s=null;return e>=this.minLevel&&e<=this.maxLevel&&(s=this.levels[e].context2D),s},destroy:function(e){this._freeupCanvasMemory(e)},_buildLevels:function(){var t,n,s,i,a,r,o=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas)return delete this._image,o;if(t=this._image.naturalWidth,n=this._image.naturalHeight,s=document.createElement("canvas"),a=s.getContext("2d"),s.width=t,s.height=n,a.drawImage(this._image,0,0,t,n),o[0].context2D=a,delete this._image,e.isCanvasTainted(s))return o;for(;t>=2&&n>=2;)t=Math.floor(t/2),n=Math.floor(n/2),i=document.createElement("canvas"),r=i.getContext("2d"),i.width=t,i.height=n,r.drawImage(s,0,0,t,n),o.splice(0,0,{context2D:r,width:t,height:n}),s=i,a=r;return o},_freeupCanvasMemory:function(e){for(var t=0;t<this.levels.length;t++)this.levels[t].context2D&&(this.levels[t].context2D.canvas.height=0,this.levels[t].context2D.canvas.width=0,e&&e.raiseEvent("image-unloaded",{context2D:this.levels[t].context2D}))}})}(n),function(e){e.TileSourceCollection=function(){e.console.error("TileSourceCollection is deprecated; use World instead")}}(n),function(e){e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(s){var o=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},s),this.element=s.element||e.makeNeutralElement("div"),s.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(n){n.insideElementPressed?(t(o,e.ButtonState.DOWN),o.raiseEvent("enter",{originalEvent:n.originalEvent})):n.buttonDownAny||t(o,e.ButtonState.HOVER)},focusHandler:function(e){o.tracker.enterHandler(e),o.raiseEvent("focus",{originalEvent:e.originalEvent})},leaveHandler:function(t){n(o,e.ButtonState.GROUP),t.insideElementPressed&&o.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){o.tracker.leaveHandler(e),o.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(n){t(o,e.ButtonState.DOWN),o.raiseEvent("press",{originalEvent:n.originalEvent})},releaseHandler:function(s){s.insideElementPressed&&s.insideElementReleased?(n(o,e.ButtonState.HOVER),o.raiseEvent("release",{originalEvent:s.originalEvent})):s.insideElementPressed?n(o,e.ButtonState.GROUP):t(o,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&o.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){13===e.keyCode?(o.raiseEvent("click",{originalEvent:e.originalEvent}),o.raiseEvent("release",{originalEvent:e.originalEvent}),e.preventDefault=!0):e.preventDefault=!1}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){t(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function s(t){e.requestAnimationFrame(function(){o(t)})}function o(t){var n,o,i;t.shouldFade&&(o=e.now(),i=o-t.fadeBeginTime,n=1-i/t.fadeLength,n=Math.min(1,n),n=Math.max(0,n),t.imgGroup&&e.setElementOpacity(t.imgGroup,n,!0),n>0&&s(t))}function i(t){t.shouldFade=!0,t.fadeBeginTime=e.now()+t.fadeDelay,window.setTimeout(function(){s(t)},t.fadeDelay)}function a(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function t(t,n){if(t.element.disabled)return;n>=e.ButtonState.GROUP&&t.currentState===e.ButtonState.REST&&(a(t),t.currentState=e.ButtonState.GROUP),n>=e.ButtonState.HOVER&&t.currentState===e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),n>=e.ButtonState.DOWN&&t.currentState===e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN)}function n(t,n){if(t.element.disabled)return;n<=e.ButtonState.HOVER&&t.currentState===e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&t.currentState===e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&t.currentState===e.ButtonState.GROUP&&(i(t),t.currentState=e.ButtonState.REST)}}(n),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var s,o=this.buttons.concat([]),n=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group){this.element.style.display="inline-block";for(s=0;s<o.length;s++)this.element.appendChild(o[s].element)}e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var t;for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupEnter()},leaveHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={addButton:function(e){this.buttons.push(e),this.element.appendChild(e.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var e=this.buttons.pop();this.element.removeChild(e.element),e.destroy()}this.tracker.destroy(),this.element=null}}}(n),function(e){e.Rect=function(t,n,s,o,i){this.x=typeof t=="number"?t:0,this.y=typeof n=="number"?n:0,this.width=typeof s=="number"?s:0,this.height=typeof o=="number"?o:0,this.degrees=typeof i=="number"?i:0,this.degrees=e.positiveModulo(this.degrees,360);var a,r;this.degrees>=270?(a=this.getTopRight(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=270):this.degrees>=180?(a=this.getBottomRight(),this.x=a.x,this.y=a.y,this.degrees-=180):this.degrees>=90&&(a=this.getBottomLeft(),this.x=a.x,this.y=a.y,r=this.height,this.height=this.width,this.width=r,this.degrees-=90)},e.Rect.fromSummits=function(t,n,s){var a=t.distanceTo(n),r=t.distanceTo(s),o=n.minus(t),i=Math.atan(o.y/o.x);return o.x<0?i+=Math.PI:o.y<0&&(i+=2*Math.PI),new e.Rect(t.x,t.y,a,r,i/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var n=this.getBoundingBox(),s=t.getBoundingBox(),o=Math.min(n.x,s.x),i=Math.min(n.y,s.y),a=Math.max(n.x+n.width,s.x+s.width),r=Math.max(n.y+n.height,s.y+s.height);return new e.Rect(o,i,a-o,r-i)},intersection:function(t){var o,i,a,r,c,l,d,u,h,m,f,p,g,v,b,j,y,_,w,O,s=1e-10,n=[],x=this.getTopLeft();t.containsPoint(x,s)&&n.push(x),m=this.getTopRight(),t.containsPoint(m,s)&&n.push(m),y=this.getBottomLeft(),t.containsPoint(y,s)&&n.push(y),f=this.getBottomRight(),t.containsPoint(f,s)&&n.push(f),g=t.getTopLeft(),this.containsPoint(g,s)&&n.push(g),j=t.getTopRight(),this.containsPoint(j,s)&&n.push(j),O=t.getBottomLeft(),this.containsPoint(O,s)&&n.push(O),_=t.getBottomRight(),this.containsPoint(_,s)&&n.push(_);for(h=this._getSegments(),w=t._getSegments(),r=0;r<h.length;r++)for(p=h[r],c=0;c<w.length;c++)v=w[c],b=C(p[0],p[1],v[0],v[1]),b&&n.push(b);function C(t,n,o,i){var r,d,a=n.minus(t),c=i.minus(o),l=-c.x*a.y+a.x*c.y;return l===0?null:(d=(a.x*(t.y-o.y)-a.y*(t.x-o.x))/l,r=(c.x*(t.y-o.y)-c.y*(t.x-o.x))/l,-s<=d&&d<=1-s&&-s<=r&&r<=1-s?new e.Point(t.x+r*a.x,t.y+r*a.y):null)}if(n.length===0)return null;for(a=n[0].x,u=n[0].x,i=n[0].y,d=n[0].y,l=1;l<n.length;l++)o=n[l],o.x<a&&(a=o.x),o.x>u&&(u=o.x),o.y<i&&(i=o.y),o.y>d&&(d=o.y);return new e.Rect(a,i,u-a,d-i)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight();return[[e,t],[t,s],[s,n],[n,e]]},rotate:function(t,n){if(t=e.positiveModulo(t,360),t===0)return this.clone();n=n||this.getCenter();var o=this.getTopLeft().rotate(t,n),a=this.getTopRight().rotate(t,n),s=a.minus(o),s=s.apply(function(e){var t=1e-15;return(e<0?-e:e)<t?0:e}),i=Math.atan(s.y/s.x);return s.x<0?i+=Math.PI:s.y<0&&(i+=2*Math.PI),new e.Rect(o.x,o.y,this.width,this.height,i/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var t=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight(),i=Math.min(t.x,n.x,s.x,o.x),r=Math.max(t.x,n.x,s.x,o.x),a=Math.min(t.y,n.y,s.y,o.y),c=Math.max(t.y,n.y,s.y,o.y);return new e.Rect(i,a,r-i,c-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),n=Math.floor(t.x),s=Math.floor(t.y),o=Math.ceil(t.width+t.x-n),i=Math.ceil(t.height+t.y-s);return new e.Rect(n,s,o,i)},containsPoint:function(e,t){t=t||0;var n=this.getTopLeft(),i=this.getTopRight(),a=this.getBottomLeft(),s=i.minus(n),o=a.minus(n);return(e.x-n.x)*s.x+(e.y-n.y)*s.y>=-t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y<=t&&(e.x-n.x)*o.x+(e.y-n.y)*o.y>=-t&&(e.x-a.x)*o.x+(e.y-a.y)*o.y<=t},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(n),function(e){var s={};e.ReferenceStrip=function(d){var u,m,p,g=this,h=d.viewer,f=e.getElementSize(h.element);d.id||(d.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),e.extend(this,d),s[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,m=this.element.style,m.marginTop="0px",m.marginRight="0px",m.marginBottom="0px",m.marginLeft="0px",m.left="0px",m.bottom="0px",m.border="0px",m.background="#000",m.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=h,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,i),dragHandler:e.delegate(this,a),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,o),leaveHandler:e.delegate(this,r),keyDownHandler:e.delegate(this,c),keyHandler:e.delegate(this,l),preProcessEventHandler:function(e){e.eventType==="wheel"&&(e.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",h.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"===d.scroll?(this.element.style.width=f.x*d.sizeRatio*h.tileSources.length+12*h.tileSources.length+"px",this.element.style.height=f.y*d.sizeRatio+"px",h.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=f.y*d.sizeRatio*h.tileSources.length+12*h.tileSources.length+"px",this.element.style.width=f.x*d.sizeRatio+"px",h.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=f.x*this.sizeRatio+8,this.panelHeight=f.y*this.sizeRatio+8,this.panels=[],this.miniViewers={};for(p=0;p<h.tileSources.length;p++)u=e.makeNeutralElement("div"),u.id=this.element.id+"-"+p,u.style.width=g.panelWidth+"px",u.style.height=g.panelHeight+"px",u.style.display="inline",u.style.float="left",u.style.cssFloat="left",u.style.padding="2px",e.setElementTouchActionNone(u),e.setElementPointerEventsNone(u),this.element.appendChild(u),u.activePanel=!1,this.panels.push(u);t(this,this.scroll==="vertical"?f.y:f.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(n){var s,a=this.element.querySelector("#"+this.element.id+"-"+n),i=e.getElementSize(this.viewer.canvas),l=Number(this.element.style.width.replace("px","")),d=Number(this.element.style.height.replace("px","")),r=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==a&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=a,this.currentSelected.style.background="#999","horizontal"===this.scroll?(s=Number(n)*(this.panelWidth+3),s>r+i.x-this.panelWidth?(s=Math.min(s,l-i.x),this.element.style.marginLeft=-s+"px",t(this,i.x,-s)):s<r&&(s=Math.max(0,s-i.x/2),this.element.style.marginLeft=-s+"px",t(this,i.x,-s))):(s=Number(n)*(this.panelHeight+3),s>c+i.y-this.panelHeight?(s=Math.min(s,d-i.y),this.element.style.marginTop=-s+"px",t(this,i.y,-s)):s<c&&(s=Math.max(0,s-i.y/2),this.element.style.marginTop=-s+"px",t(this,i.y,-s))),this.currentPage=n,o.call(this,{eventSource:this.tracker}))},update:function(){return!!s[this.id].animating},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function i(e){if(e.quick){var t;"horizontal"===this.scroll?t=Math.floor(e.position.x/(this.panelWidth+4)):t=Math.floor(e.position.y/this.panelHeight),this.viewer.goToPage(t)}this.element.focus()}function a(n){if(this.dragging=!0,this.element){var s=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),a=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),i=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?-n.delta.x>0?s>-(a-i.x)&&(this.element.style.marginLeft=s+n.delta.x*2+"px",t(this,i.x,s+n.delta.x*2)):-n.delta.x<0&&s<0&&(this.element.style.marginLeft=s+n.delta.x*2+"px",t(this,i.x,s+n.delta.x*2)):-n.delta.y>0?o>-(r-i.y)&&(this.element.style.marginTop=o+n.delta.y*2+"px",t(this,i.y,o+n.delta.y*2)):-n.delta.y<0&&o<0&&(this.element.style.marginTop=o+n.delta.y*2+"px",t(this,i.y,o+n.delta.y*2))}}function n(n){if(this.element){var s=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),a=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),i=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?n.scroll>0?s>-(a-i.x)&&(this.element.style.marginLeft=s-n.scroll*60+"px",t(this,i.x,s-n.scroll*60)):n.scroll<0&&s<0&&(this.element.style.marginLeft=s-n.scroll*60+"px",t(this,i.x,s-n.scroll*60)):n.scroll<0?o>i.y-r&&(this.element.style.marginTop=o+n.scroll*60+"px",t(this,i.y,o+n.scroll*60)):n.scroll>0&&o<0&&(this.element.style.marginTop=o+n.scroll*60+"px",t(this,i.y,o+n.scroll*60)),n.preventDefault=!0}}function t(t,n,s){"horizontal"===t.scroll?c=t.panelWidth:c=t.panelHeight,o=Math.ceil(n/c)+5,l=Math.ceil((Math.abs(s)+n)/c)+1,o=l-o,o=o<0?0:o;for(a=o;a<l&&a<t.panels.length;a++)if(r=t.panels[a],!r.activePanel){var o,i,a,r,c,l,d,u=t.viewer.tileSources[a];u.referenceStripThumbnailUrl?d={type:"image",url:u.referenceStripThumbnailUrl}:d=u,i=new e.Viewer({id:r.id,tileSources:[d],element:r,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,drawer:"canvas"}),e.setElementPointerEventsNone(i.canvas),e.setElementPointerEventsNone(i.container),i.innerTracker.setTracking(!1),i.outerTracker.setTracking(!1),t.miniViewers[r.id]=i,r.activePanel=!0}}function o(e){var t=e.eventSource.element;"horizontal"===this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px"}function r(t){var n=t.eventSource.element;"horizontal"===this.scroll?n.style.marginBottom="-"+e.getElementSize(n).y/2+"px":n.style.marginLeft="-"+e.getElementSize(n).x/2+"px"}function c(e){if(!e.ctrl&&!e.alt&&!e.meta)switch(e.keyCode){case 38:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 40:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 37:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 39:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1;break}else e.preventDefault=!1}function l(e){if(!e.ctrl&&!e.alt&&!e.meta)switch(e.keyCode){case 61:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 45:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 48:case 119:case 87:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 115:case 83:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 97:n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 100:n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1;break}else e.preventDefault=!1}}(n),function(e){e.DisplayRect=function(t,n,s,o,i,a){e.Rect.apply(this,[t,n,s,o]),this.minLevel=i,this.maxLevel=a},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(n),function(e){e.Spring=function(t){var n=arguments;typeof t!="object"&&(t={initial:n.length&&typeof n[0]=="number"?n[0]:0[0],springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.console.assert(typeof t.springStiffness=="number"&&t.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert(typeof t.animationTime=="number"&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||t!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||t!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=e.now();let n,s;if(this._exponential?(n=this.start._logValue,s=this.target._logValue):(n=this.start.value,s=this.target.value),this.current.time>=this.target.time)this.current.value=this.target.value;else{let e=n+(s-n)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));this._exponential?this.current.value=Math.exp(e):this.current.value=e}return this.current.value!==this.target.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}}(n),function(e){e.ImageJob=function(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},t),this.data=null,this.userData={},this.errorMsg=null},e.ImageJob.prototype={start:function(){this.tries++;var e=this,t=this.abort;this.jobId=window.setTimeout(function(){e.finish(null,null,"Image load exceeded timeout ("+e.timeout+" ms)")},this.timeout),this.abort=function(){e.source.downloadTileAbort(e),typeof t=="function"&&t()},this.source.downloadTileStart(this)},finish:function(e,t,n){this.data=e,this.request=t,this.errorMsg=n,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(n){n.source||(e.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource."),s=e.TileSource.prototype,n.source={downloadTileStart:s.downloadTileStart,downloadTileAbort:s.downloadTileAbort});var s,i=this,a=function(e){t(i,e,n.callback)},r={src:n.src,tile:n.tile||{},source:n.source,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,postData:n.postData,callback:a,abort:n.abort,timeout:this.timeout},o=new e.ImageJob(r);!this.jobLimit||this.jobsInProgress<this.jobLimit?(o.start(),this.jobsInProgress++):this.jobQueue.push(o)},clear:function(){for(var t,e=0;e<this.jobQueue.length;e++)t=this.jobQueue[e],typeof t.abort=="function"&&t.abort();this.jobQueue=[]}};function t(e,t,n){t.errorMsg!==""&&(t.data===null||t.data===0[0])&&t.tries<1+e.tileRetryMax&&e.failedTiles.push(t);var s;e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(s=e.jobQueue.shift(),s.start(),e.jobsInProgress++),e.tileRetryMax>0&&e.jobQueue.length===0&&(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.failedTiles.length>0&&(s=e.failedTiles.shift(),setTimeout(function(){s.start()},e.tileRetryDelay),e.jobsInProgress++),n(t.data,t.errorMsg,t.request)}}(n),function(e){e.Tile=function(t,s,o,i,a,r,c,l,d,u,h,m){this.level=t,this.x=s,this.y=o,this.bounds=i,this.positionedBounds=new n.Rect(i.x,i.y,i.width,i.height),this.sourceBounds=u,this.exists=a,this._url=r,this.postData=h,this.context2D=c,this.loadWithAjax=l,this.ajaxHeaders=d,m===0[0]&&(e.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),m=e.TileSource.prototype.getTileHashKey(t,s,o,r,d,h)),this.cacheKey=m,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},get image(){return e.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return e.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord&&this.cacheImageRecord.getRenderedContext()},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else if(this.context2D)t=this.context2D;else return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,n,s){var o=Math.max(1,Math.ceil((s.x-n.x)/2)),i=Math.max(1,Math.ceil((s.y-n.y)/2));return new e.Point(o,i).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(n),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,n,s){var o;e.isPlainObject(t)?o=t:o={element:t,location:n,placement:s},this.elementWrapper=document.createElement("div"),this.element=o.element,this.elementWrapper.appendChild(this.element),this.element.id?this.elementWrapper.id="overlay-wrapper-"+this.element.id:this.elementWrapper.id="overlay-wrapper",this.style=this.elementWrapper.style,this._init(o)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=t.placement===0[0]?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=t.checkResize===0[0]||t.checkResize,this.width=t.width===0[0]?null:t.width,this.height=t.height===0[0]?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,n){var s=e.Placement.properties[this.placement];if(!s)return;s.isHorizontallyCentered?t.x-=n.x/2:s.isRight&&(t.x-=n.x),s.isVerticallyCentered?t.y-=n.y/2:s.isBottom&&(t.y-=n.y)},destroy:function(){var s,o,n=this.elementWrapper,t=this.style;n.parentNode&&(n.parentNode.removeChild(n),n.prevElementParent&&(t.display="none",document.body.appendChild(n))),this.onDraw=null,t.top="",t.left="",t.position="",this.width!==null&&(t.width=""),this.height!==null&&(t.height=""),s=e.getCssPropertyWithVendorPrefix("transformOrigin"),o=e.getCssPropertyWithVendorPrefix("transform"),s&&o&&(t[s]="",t[o]="")},drawHTML:function(t,n){var s,o,i,r,c,l,d,u,h,m,a=this.elementWrapper;a.parentNode!==t&&(a.prevElementParent=a.parentNode,a.prevNextSibling=a.nextSibling,t.appendChild(a),this.style.position="absolute",this.size=e.getElementSize(this.elementWrapper)),l=this._getOverlayPositionAndSize(n),d=l.position,u=this.size=l.size,h="",n.overlayPreserveContentDirection&&(h=n.flipped?" scaleX(-1)":" scaleX(1)"),r=n.flipped?-l.rotate:l.rotate,m=n.flipped?" scaleX(-1)":"",this.onDraw?this.onDraw(d,u,this.element):(s=this.style,i=this.element.style,i.display="block",s.left=d.x+"px",s.top=d.y+"px",this.width!==null&&(i.width=u.x+"px"),this.height!==null&&(i.height=u.y+"px"),c=e.getCssPropertyWithVendorPrefix("transformOrigin"),o=e.getCssPropertyWithVendorPrefix("transform"),c&&o&&(r&&!n.flipped?(i[o]="",s[c]=this._getTransformOrigin(),s[o]="rotate("+r+"deg)"):!r&&n.flipped?(i[o]=h,s[c]=this._getTransformOrigin(),s[o]=m):r&&n.flipped?(i[o]=h,s[c]=this._getTransformOrigin(),s[o]="rotate("+r+"deg)"+m):(i[o]="",s[c]="",s[o]="")),s.display="flex")},_getOverlayPositionAndSize:function(t){var o,i,a,n=t.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(t);return this.adjust(n,s),o=0,t.getRotation(!0)&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION&&(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null?(a=new e.Rect(n.x,n.y,s.x,s.y),i=this._getBoundingBox(a,t.getRotation(!0)),n=i.getTopLeft(),s=i.getSize()):o=t.getRotation(!0)),t.flipped&&(n.x=t.getContainerSize().x-n.x),{position:n,size:s,rotate:o}},_getSizeInPixels:function(t){var o,i,n=this.size.x,s=this.size.y;return(this.width!==null||this.height!==null)&&(o=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0),this.width!==null&&(n=o.x),this.height!==null&&(s=o.y)),this.checkResize&&(this.width===null||this.height===null)&&(i=this.size=e.getElementSize(this.elementWrapper),this.width===null&&(n=i.x),this.height===null&&(s=i.y)),new e.Point(n,s)},_getBoundingBox:function(e,t){var n=this._getPlacementPoint(e);return e.rotate(t,n).getBoundingBox()},_getPlacementPoint:function(t){var n=new e.Point(t.x,t.y),s=e.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?n.x+=t.width/2:s.isRight&&(n.x+=t.width),s.isVerticallyCentered?n.y+=t.height/2:s.isBottom&&(n.y+=t.height)),n},_getTransformOrigin:function(){var t="",n=e.Placement.properties[this.placement];return n?(n.isLeft?t="left":n.isRight&&(t="right"),n.isTop?t+=" top":n.isBottom&&(t+=" bottom"),t):t},update:function(t,n){var s=e.isPlainObject(t)?t:{location:t,placement:n};this._init({location:s.location||this.location,placement:s.placement!==0[0]?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==0[0]?s.width:this.width,height:s.height!==0[0]?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var o,i,n=this.width,s=this.height;return(n===null||s===null)&&(i=t.deltaPointsFromPixelsNoRotate(this.size,!0),n===null&&(n=i.x),s===null&&(s=i.y)),o=this.location.clone(),this.adjust(o,new e.Point(n,s)),this._adjustBoundsForRotation(t,new e.Rect(o.x,o.y,n,s))},_adjustBoundsForRotation:function(t,n){if(!t||t.getRotation(!0)===0||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return n;var s=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return n.rotate(-t.getRotation(!0),this._getPlacementPoint(n))}}}(n),function(e){const t=e;t.DrawerBase=class DrawerBase{constructor(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required"),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor=typeof t.debugGridColor=="string"?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,this.options=t.options||{},this.container=e.getElement(t.element),this._renderingTarget=this._createDrawingElement(),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.canvas.style.left="0",e.setElementOpacity(this.canvas,this.viewer.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._checkForAPIOverrides()}get canvas(){return this._renderingTarget}get element(){return e.console.error("Drawer.element is deprecated. Use Drawer.container instead."),this.container}getType(){e.console.error("Drawer.getType must be implemented by child class")}static isSupported(){e.console.error("Drawer.isSupported must be implemented by child class")}_createDrawingElement(){return e.console.error("Drawer._createDrawingElement must be implemented by child class"),null}draw(){e.console.error("Drawer.draw must be implemented by child class")}canRotate(){e.console.error("Drawer.canRotate must be implemented by child class")}destroy(){e.console.error("Drawer.destroy must be implemented by child class")}minimumOverlapRequired(){return!1}setImageSmoothingEnabled(){e.console.error("Drawer.setImageSmoothingEnabled must be implemented by child class")}drawDebuggingRect(){e.console.warn("[drawer].drawDebuggingRect is not implemented by this drawer")}clear(){e.console.warn("[drawer].clear() is deprecated. The drawer is responsible for clearing itself as needed before drawing tiles.")}_checkForAPIOverrides(){if(this._createDrawingElement===e.DrawerBase.prototype._createDrawingElement)throw new Error("[drawer]._createDrawingElement must be implemented by child class");if(this.draw===e.DrawerBase.prototype.draw)throw new Error("[drawer].draw must be implemented by child class");if(this.canRotate===e.DrawerBase.prototype.canRotate)throw new Error("[drawer].canRotate must be implemented by child class");if(this.destroy===e.DrawerBase.prototype.destroy)throw new Error("[drawer].destroy must be implemented by child class");if(this.setImageSmoothingEnabled===e.DrawerBase.prototype.setImageSmoothingEnabled)throw new Error("[drawer].setImageSmoothingEnabled must be implemented by child class")}viewportToDrawerRectangle(t){var n=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,s.x*e.pixelDensityRatio,s.y*e.pixelDensityRatio)}viewportCoordToDrawerCoord(t){var n=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)}_calculateCanvasSize(){var n=e.pixelDensityRatio,s=this.viewport.getContainerSize();return new t.Point(Math.round(s.x*n),Math.round(s.y*n))}_raiseTiledImageDrawnEvent(e,t){if(!this.viewer)return;this.viewer.raiseEvent("tiled-image-drawn",{tiledImage:e,tiles:t})}_raiseDrawerErrorEvent(e,t){if(!this.viewer)return;this.viewer.raiseEvent("drawer-error",{tiledImage:e,drawer:this,error:t})}}}(n),function(e){const t=e;class n extends t.DrawerBase{constructor(e){super(e),this.viewer.rejectEventHandler("tile-drawing","The HTMLDrawer does not raise the tile-drawing event"),this.viewer.allowEventHandler("tile-drawn")}static isSupported(){return!0}getType(){return"html"}minimumOverlapRequired(){return!0}_createDrawingElement(){let t=e.makeNeutralElement("div");return t}draw(e){var t=this;this._prepareNewFrame(),e.forEach(function(e){e.opacity!==0&&t._drawTiles(e)})}canRotate(){return!1}destroy(){this.container.removeChild(this.canvas)}setImageSmoothingEnabled(){}_prepareNewFrame(){this.canvas.innerHTML=""}_drawTiles(e){var t,s,n=e.getTilesToDraw().map(e=>e.tile);if(e.opacity===0||n.length===0&&!e.placeholderFillStyle)return;for(t=n.length-1;t>=0;t--)s=n[t],this._drawTile(s),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:e,tile:s})}_drawTile(t){e.console.assert(t,"[Drawer._drawTile] tile is required");let n=this.canvas;if(!t.cacheImageRecord){e.console.warn("[Drawer._drawTileToHTML] attempting to draw tile %s when it's not cached",t.toString());return}if(!t.loaded){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",t.toString());return}if(!t.element){var s=t.getImage();if(!s)return;t.element=e.makeNeutralElement("div"),t.imgElement=s.cloneNode(),t.imgElement.style.msInterpolationMode="nearest-neighbor",t.imgElement.style.width="100%",t.imgElement.style.height="100%",t.style=t.element.style,t.style.position="absolute"}t.element.parentNode!==n&&n.appendChild(t.element),t.imgElement.parentNode!==t.element&&t.element.appendChild(t.imgElement),t.style.top=t.position.y+"px",t.style.left=t.position.x+"px",t.style.height=t.size.y+"px",t.style.width=t.size.x+"px",t.flipped&&(t.style.transform="scaleX(-1)"),e.setElementOpacity(t.element,t.opacity)}}e.HTMLDrawer=n}(n),function(e){const o=e;class i extends o.DrawerBase{constructor(e){super(e),this.context=this.canvas.getContext("2d"),this.sketchCanvas=null,this.sketchContext=null,this._imageSmoothingEnabled=!0,this.viewer.allowEventHandler("tile-drawn"),this.viewer.allowEventHandler("tile-drawing")}static isSupported(){return e.supportsCanvas}getType(){return"canvas"}_createDrawingElement(){let t=e.makeNeutralElement("canvas"),n=this._calculateCanvasSize();return t.width=n.x,t.height=n.y,t}draw(e){this._prepareNewFrame(),this.viewer.viewport.getFlip()!==this._viewportFlipped&&this._flip();for(const t of e)t.opacity!==0&&this._drawTiles(t)}canRotate(){return!0}destroy(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null,this.container.removeChild(this.canvas)}minimumOverlapRequired(){return!0}setImageSmoothingEnabled(e){this._imageSmoothingEnabled=!!e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw()}drawDebuggingRect(t){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),n.restore()}get _viewportFlipped(){return this.context.getTransform().a<0}_raiseTileDrawingEvent(e,t,n,s){this.viewer.raiseEvent("tile-drawing",{tiledImage:e,context:t,tile:n,rendered:s})}_prepareNewFrame(){var t,e=this._calculateCanvasSize();(this.canvas.width!==e.x||this.canvas.height!==e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null&&(t=this._calculateSketchCanvasSize(),this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear()}_clear(e,t){var s,n=this._getContext(e);t?n.clearRect(t.x,t.y,t.width,t.height):(s=n.canvas,n.clearRect(0,0,s.width,s.height))}_drawTiles(t){var n,s,o,i,c,l,d,u,h,m,f,p,g,v,b,j,r=t.getTilesToDraw().map(e=>e.tile);if(t.opacity===0||r.length===0&&!t.placeholderFillStyle)return;if(o=r[0],o&&(s=t.opacity<1||t.compositeOperation&&t.compositeOperation!=="source-over"||!t._isBottomItem()&&t.source.hasTransparency(o.context2D,o.getUrl(),o.ajaxHeaders,o.postData)),g=this.viewport.getZoom(!0),p=t.viewportToImageZoom(g),r.length>1&&p>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360===0&&(s=!0,n=o.getScaleForEdgeSmoothing(),i=o.getTranslationForEdgeSmoothing(n,this._getCanvasSize(!1),this._getCanvasSize(!0))),s&&(n||(d=this.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),d=d.times(e.pixelDensityRatio)),this._clear(!0,d)),n||this._setRotations(t,s),l=!1,t._clip&&(this._saveContext(s),u=t.imageToViewportRectangle(t._clip,!0),u=u.rotate(-t.getRotation(!0),t._getRotationPoint(!0)),c=this.viewportToDrawerRectangle(u),n&&(c=c.times(n)),i&&(c=c.translate(i)),this._setClip(c,s),l=!0),t._croppingPolygons){v=this,l||this._saveContext(s);try{b=t._croppingPolygons.map(function(e){return e.map(function(e){var o=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),s=v.viewportCoordToDrawerCoord(o);return n&&(s=s.times(n)),i&&(s=s.plus(i)),s})}),this._clipWithPolygons(b,s)}catch(t){e.console.error(t)}l=!0}if(t._hasOpaqueTile=!1,t.placeholderFillStyle&&t._hasOpaqueTile===!1){let e=this.viewportToDrawerRectangle(t.getBoundsNoRotate(!0));n&&(e=e.times(n)),i&&(e=e.translate(i));let o=null;typeof t.placeholderFillStyle=="function"?o=t.placeholderFillStyle(t,this.context):o=t.placeholderFillStyle,this._drawRectangle(e,o,s)}f=a(t.subPixelRoundingForTransparency),h=!1,f===e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?h=!0:f===e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(j=this.viewer&&this.viewer.isAnimating(),h=!j);for(m=0;m<r.length;m++)o=r[m],this._drawTile(o,t,s,n,i,h,t.source),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:o});l&&this._restoreContext(s),n||(t.getRotation(!0)%360!==0&&this._restoreRotationChanges(s),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(s)),s&&(n&&this._setRotations(t),this.blendSketch({opacity:t.opacity,scale:n,translate:i,compositeOperation:t.compositeOperation,bounds:d}),n&&(t.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1))),this._drawDebugInfo(t,r),this._raiseTiledImageDrawnEvent(t,r)}_drawDebugInfo(t,n){if(t.debugMode)for(var o,s=n.length-1;s>=0;s--){o=n[s];try{this._drawDebugInfoOnTile(o,n.length,s,t)}catch(t){e.console.error(t)}}}_clipWithPolygons(e,t){var n=this._getContext(t);n.beginPath();for(const t of e)for(const[s,e]of t.entries())n[s===0?"moveTo":"lineTo"](e.x,e.y);n.clip()}_drawTile(t,n,s,o,i,a,r){e.console.assert(t,"[Drawer._drawTile] tile is required"),e.console.assert(n,"[Drawer._drawTile] drawingHandler is required");var c=this._getContext(s);o=o||1,this._drawTileToCanvas(t,c,n,o,i,a,r)}_drawTileToCanvas(t,n,s,o,i,a){var d,u,h,c=t.position.times(e.pixelDensityRatio),l=t.size.times(e.pixelDensityRatio);if(!t.context2D&&!t.cacheImageRecord){e.console.warn("[Drawer._drawTileToCanvas] attempting to draw tile %s when it's not cached",t.toString());return}if(d=t.getCanvasContext(),!t.loaded||!d){e.console.warn("Attempting to draw tile %s when it's not yet loaded.",t.toString());return}n.save(),typeof o=="number"&&o!==1&&(c=c.times(o),l=l.times(o)),i instanceof e.Point&&(c=c.plus(i)),n.globalAlpha===1&&t.hasTransparency&&(a&&(c.x=Math.round(c.x),c.y=Math.round(c.y),l.x=Math.round(l.x),l.y=Math.round(l.y)),n.clearRect(c.x,c.y,l.x,l.y)),this._raiseTileDrawingEvent(s,n,t,d),t.sourceBounds?(u=Math.min(t.sourceBounds.width,d.canvas.width),h=Math.min(t.sourceBounds.height,d.canvas.height)):(u=d.canvas.width,h=d.canvas.height),n.translate(c.x+l.x/2,0),t.flipped&&n.scale(-1,1),n.drawImage(d.canvas,0,0,u,h,-l.x/2,c.y,l.x,l.y),n.restore()}_getContext(e){var t,n,s=this.context;return e&&(this.sketchCanvas===null&&(this.sketchCanvas=document.createElement("canvas"),n=this._calculateSketchCanvasSize(),this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0&&(t=this,this.viewer.addHandler("rotate",function e(){if(t.viewport.getRotation()===0)return;t.viewer.removeHandler("rotate",e);var n=t._calculateSketchCanvasSize();t.sketchCanvas.width=n.x,t.sketchCanvas.height=n.y})),this._updateImageSmoothingEnabled(this.sketchContext)),s=this.sketchContext),s}_saveContext(e){this._getContext(e).save()}_restoreContext(e){this._getContext(e).restore()}_setClip(e,t){var n=this._getContext(t);n.beginPath(),n.rect(e.x,e.y,e.width,e.height),n.clip()}_drawRectangle(e,t,n){var s=this._getContext(n);s.save(),s.fillStyle=t,s.fillRect(e.x,e.y,e.width,e.height),s.restore()}blendSketch(t,n,s,o){var i,r,c,l,d,u,a=t;e.isPlainObject(a)||(a={opacity:t,scale:n,translate:s,compositeOperation:o}),t=a.opacity,o=a.compositeOperation,i=a.bounds,this.context.save(),this.context.globalAlpha=t,o&&(this.context.globalCompositeOperation=o),i?(i.x<0&&(i.width+=i.x,i.x=0),i.x+i.width>this.canvas.width&&(i.width=this.canvas.width-i.x),i.y<0&&(i.height+=i.y,i.y=0),i.y+i.height>this.canvas.height&&(i.height=this.canvas.height-i.y),this.context.drawImage(this.sketchCanvas,i.x,i.y,i.width,i.height,i.x,i.y,i.width,i.height)):(n=a.scale||1,s=a.translate,l=s instanceof e.Point?s:new e.Point(0,0),r=0,c=0,s&&(d=this.sketchCanvas.width-this.canvas.width,u=this.sketchCanvas.height-this.canvas.height,r=Math.round(d/2),c=Math.round(u/2)),this.context.drawImage(this.sketchCanvas,l.x-r*n,l.y-c*n,(this.canvas.width+2*r)*n,(this.canvas.height+2*c)*n,-r,-c,this.canvas.width+2*r,this.canvas.height+2*c)),this.context.restore()}_drawDebugInfoOnTile(t,n,s,o){var a,r,c=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",i.strokeStyle=this.debugGridColor[c],i.fillStyle=this.debugGridColor[c],this._setRotations(o),this._viewportFlipped&&this._flip({point:t.position.plus(t.size.divide(2))}),i.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio),a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,r=(t.position.y+t.size.y/2)*e.pixelDensityRatio,i.translate(a,r);const l=this.viewport.getRotation(!0);i.rotate(Math.PI/180*-l),i.translate(-a,-r),t.x===0&&t.y===0&&(i.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),i.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),i.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),i.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),i.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),i.fillText("Order: "+s+" of "+n,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),i.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),i.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.getRotation(!0)%360!==0&&this._restoreRotationChanges(),i.restore()}_updateImageSmoothingEnabled(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled}_getCanvasSize(t){var n=this._getContext(t).canvas;return new e.Point(n.width,n.height)}_getCanvasCenter(){return new e.Point(this.canvas.width/2,this.canvas.height/2)}_setRotations(e,t=!1){var n=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:t,saveContext:n}),n=!1),e.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:e.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:t,saveContext:n})}_offsetForRotation(t){var n=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),s=this._getContext(t.useSketch);s.save(),s.translate(n.x,n.y),s.rotate(Math.PI/180*t.degrees),s.translate(-n.x,-n.y)}_flip(t){t=t||{};var s=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(s.x,0),n.scale(-1,1),n.translate(-s.x,0)}_restoreRotationChanges(e){var t=this._getContext(e);t.restore()}_calculateCanvasSize(){var t=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*t),y:Math.round(n.y*t)}}_calculateSketchCanvasSize(){var t,e=this._calculateCanvasSize();return this.viewport.getRotation()===0?e:(t=Math.ceil((e.x*e.x+e.y*e.y)**.5),{x:t,y:t})}}e.CanvasDrawer=i;var t=e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function n(t){return t!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&t!==e.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&t!==e.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(e){return n(e)?t:e}function a(o){if(typeof o=="number")return s(o);if(!o||!e.Browser)return t;var i=o[e.Browser.vendor];return n(i)&&(i=o["*"]),s(i)}}(n),function(e){const t=e;t.WebGLDrawer=class WebGLDrawer extends t.DrawerBase{constructor(e){super(e),this._destroyed=!1,this._TextureMap=new Map,this._TileMap=new Map,this._gl=null,this._firstPass=null,this._secondPass=null,this._glFrameBuffer=null,this._renderToTexture=null,this._glFramebufferToCanvasTransform=null,this._outputCanvas=null,this._outputContext=null,this._clippingCanvas=null,this._clippingContext=null,this._renderingCanvas=null,this._backupCanvasDrawer=null,this._imageSmoothingEnabled=!0,this._boundToTileReady=e=>this._tileReadyHandler(e),this._boundToImageUnloaded=e=>this._imageUnloadedHandler(e),this.viewer.addHandler("tile-ready",this._boundToTileReady),this.viewer.addHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.rejectEventHandler("tile-drawn","The WebGLDrawer does not raise the tile-drawn event"),this.viewer.rejectEventHandler("tile-drawing","The WebGLDrawer does not raise the tile-drawing event"),this._setupCanvases(),this._setupRenderer(),this.context=this._outputContext}destroy(){if(this._destroyed)return;let e=this._gl;var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<n;++t)e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this._unloadTextures(),e.deleteBuffer(this._secondPass.bufferOutputPosition),e.deleteFramebuffer(this._glFrameBuffer),this._renderingCanvas.width=this._renderingCanvas.height=1,this._clippingCanvas.width=this._clippingCanvas.height=1,this._outputCanvas.width=this._outputCanvas.height=1,this._renderingCanvas=null,this._clippingCanvas=this._clippingContext=null,this._outputCanvas=this._outputContext=null;let t=e.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.viewer.removeHandler("tile-ready",this._boundToTileReady),this.viewer.removeHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.removeHandler("resize",this._resizeHandler),this._gl=null,this._backupCanvasDrawer&&(this._backupCanvasDrawer.destroy(),this._backupCanvasDrawer=null),this.container.removeChild(this.canvas),this.viewer.drawer===this&&(this.viewer.drawer=null),this._destroyed=!0}canRotate(){return!0}static isSupported(){let n=document.createElement("canvas"),t=e.isFunction(n.getContext)&&n.getContext("webgl"),s=t&&t.getExtension("WEBGL_lose_context");return s&&s.loseContext(),!!t}getType(){return"webgl"}minimumOverlapRequired(e){return e.isTainted()}_createDrawingElement(){let t=e.makeNeutralElement("canvas"),n=this._calculateCanvasSize();return t.width=n.x,t.height=n.y,t}_getBackupCanvasDrawer(){return this._backupCanvasDrawer||(this._backupCanvasDrawer=this.viewer.requestDrawer("canvas",{mainDrawer:!1}),this._backupCanvasDrawer.canvas.style.setProperty("visibility","hidden")),this._backupCanvasDrawer}draw(n){let s=this._gl;const i=this.viewport.getBoundsNoRotateWithMargins(!0);let a={bounds:i,center:new t.Point(i.x+i.width/2,i.y+i.height/2),rotation:this.viewport.getRotation(!0)*Math.PI/180},c=this.viewport.flipped?-1:1,l=e.Mat3.makeTranslation(-a.center.x,-a.center.y),d=e.Mat3.makeScaling(2/a.bounds.width*c,-2/a.bounds.height),u=e.Mat3.makeRotation(-a.rotation),r=d.multiply(u).multiply(l);s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT),this._outputContext.clearRect(0,0,this._outputCanvas.width,this._outputCanvas.height);let o=!1;n.forEach((t,n)=>{if(t.isTainted()){o&&(this._outputContext.drawImage(this._renderingCanvas,0,0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT),o=!1);const e=this._getBackupCanvasDrawer();e.draw([t]),this._outputContext.drawImage(e.canvas,0,0)}else{let a=t.getTilesToDraw();if(t.placeholderFillStyle&&t._hasOpaqueTile===!1&&this._drawPlaceholder(t),a.length===0||t.getOpacity()===0)return;let g=a[0],c=t.compositeOperation||this.viewer.compositeOperation||t._clip||t._croppingPolygons||t.debugMode,l=c||t.opacity<1||g.hasTransparency;c&&(o&&this._outputContext.drawImage(this._renderingCanvas,0,0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT)),s.useProgram(this._firstPass.shaderProgram),l?(s.bindFramebuffer(s.FRAMEBUFFER,this._glFrameBuffer),s.clear(s.COLOR_BUFFER_BIT)):s.bindFramebuffer(s.FRAMEBUFFER,null);let d=r,u=t.getRotation(!0);if(u%360!==0){let s=e.Mat3.makeRotation(-u*Math.PI/180),n=t.getBoundsNoRotate(!0).getCenter(),o=e.Mat3.makeTranslation(n.x,n.y),i=e.Mat3.makeTranslation(-n.x,-n.y),a=o.multiply(s).multiply(i);d=r.multiply(a)}let i=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);if(i<=0)throw new Error(`WegGL error: bad value for gl parameter MAX_TEXTURE_IMAGE_UNITS (${i}). This could happen
                        if too many contexts have been created and not released, or there is another problem with the graphics card.`);let h=new Float32Array(i*12),m=new Array(i),f=new Array(i),p=new Array(i);for(let e=0;e<a.length;e++){let r=a[e].tile,l=e%i,c=l+1,n=r.getCanvasContext(),o=n?this._TextureMap.get(n.canvas):null;if(o||(this._tileReadyHandler({tile:r,tiledImage:t}),o=n?this._TextureMap.get(n.canvas):null),o&&this._getTileData(r,t,o,d,l,h,m,f,p),c===i||e===a.length-1){for(let e=0;e<=c;e++)s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,m[e]);s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),s.bufferData(s.ARRAY_BUFFER,h,s.DYNAMIC_DRAW),f.forEach((e,t)=>{s.uniformMatrix3fv(this._firstPass.uTransformMatrices[t],!1,e)}),s.uniform1fv(this._firstPass.uOpacities,new Float32Array(p)),s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),s.vertexAttribPointer(this._firstPass.aOutputPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),s.vertexAttribPointer(this._firstPass.aTexturePosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._firstPass.bufferIndex),s.vertexAttribPointer(this._firstPass.aIndex,1,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLES,0,6*c)}}l&&(s.useProgram(this._secondPass.shaderProgram),s.bindFramebuffer(s.FRAMEBUFFER,null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this._renderToTexture),this._gl.uniform1f(this._secondPass.uOpacityMultiplier,t.opacity),s.bindBuffer(s.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),s.vertexAttribPointer(this._secondPass.aTexturePosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),s.vertexAttribPointer(this._secondPass.aOutputPosition,2,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLES,0,6)),o=!0,c&&(this._applyContext2dPipeline(t,a,n),o=!1,s.bindFramebuffer(s.FRAMEBUFFER,null),s.clear(s.COLOR_BUFFER_BIT)),n===0&&this._raiseTiledImageDrawnEvent(t,a.map(e=>e.tile))}}),o&&this._outputContext.drawImage(this._renderingCanvas,0,0)}setImageSmoothingEnabled(e){this._imageSmoothingEnabled!==e&&(this._imageSmoothingEnabled=e,this._unloadTextures(),this.viewer.world.draw())}drawDebuggingRect(t){let n=this._outputContext;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),n.restore()}_getTextureDataFromTile(e){return e.getCanvasContext().canvas}_applyContext2dPipeline(e,t,n){if(this._outputContext.save(),this._outputContext.globalCompositeOperation=n===0?null:e.compositeOperation||this.viewer.compositeOperation,e._croppingPolygons||e._clip?(this._renderToClippingCanvas(e),this._outputContext.drawImage(this._clippingCanvas,0,0)):this._outputContext.drawImage(this._renderingCanvas,0,0),this._outputContext.restore(),e.debugMode){const n=this.viewer.viewport.getFlip();n&&this._flip(),this._drawDebugInfo(t,e,n),n&&this._flip()}}_getTileData(t,n,s,o,i,a,r,c,l){let g=s.texture,_=s.position;a.set(_,i*12);let h=this._calculateOverlapFraction(t,n),m=t.positionedBounds.width*h.x,f=t.positionedBounds.height*h.y,p=t.positionedBounds.x+(t.x===0?0:m),u=t.positionedBounds.y+(t.y===0?0:f),v=t.positionedBounds.x+t.positionedBounds.width-(t.isRightMost?0:m),b=t.positionedBounds.y+t.positionedBounds.height-(t.isBottomMost?0:f),j=v-p,y=b-u,d=new e.Mat3([j,0,0,0,y,0,p,u,1]);if(t.flipped){let t=e.Mat3.makeTranslation(.5,0),n=e.Mat3.makeTranslation(-.5,0),s=t.multiply(e.Mat3.makeScaling(-1,1)).multiply(n);d=d.multiply(s)}let w=o.multiply(d);l[i]=t.opacity,r[i]=g,c[i]=w.values}_textureFilter(){return this._imageSmoothingEnabled?this._gl.LINEAR:this._gl.NEAREST}_setupRenderer(){let t=this._gl;t||e.console.error("_setupCanvases must be called before _setupRenderer"),this._unitQuad=this._makeQuadVertexBuffer(0,1,0,1),this._makeFirstPassShaderProgram(),this._makeSecondPassShaderProgram(),this._renderToTexture=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._renderToTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._renderingCanvas.width,this._renderingCanvas.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._textureFilter()),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._glFrameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._glFrameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._renderToTexture,0),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}_makeFirstPassShaderProgram(){let t=this._glNumTextures=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),o=()=>[...Array(t).keys()].map(e=>`uniform mat3 u_matrix_${e};`).join(`
`),i=()=>[...Array(t).keys()].map(e=>`${e>0?"else ":""}if(int(a_index) == ${e}) { transform_matrix = u_matrix_${e}; }`).join(`
`);const a=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;
            attribute float a_index;

            ${o()} // create a uniform mat3 for each potential tile to draw

            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {

                mat3 transform_matrix; // value will be set by the if/elses in makeConditional()

                ${i()}

                gl_Position = vec4(transform_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
                v_image_index = a_index;
            }
            `,r=`
            precision mediump float;

            // our textures
            uniform sampler2D u_images[${t}];
            // our opacities
            uniform float u_opacities[${t}];

            // the varyings passed in from the vertex shader.
            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {
                // can't index directly with a variable, need to use a loop iterator hack
                for(int i = 0; i < ${t}; ++i){
                    if(i == int(v_image_index)){
                        gl_FragColor = texture2D(u_images[i], v_texture_position) * u_opacities[i];
                    }
                }
            }
            `;let e=this._gl,n=this.constructor.initShaderProgram(e,a,r);e.useProgram(n),this._firstPass={shaderProgram:n,aOutputPosition:e.getAttribLocation(n,"a_output_position"),aTexturePosition:e.getAttribLocation(n,"a_texture_position"),aIndex:e.getAttribLocation(n,"a_index"),uTransformMatrices:[...Array(this._glNumTextures).keys()].map(t=>e.getUniformLocation(n,`u_matrix_${t}`)),uImages:e.getUniformLocation(n,"u_images"),uOpacities:e.getUniformLocation(n,"u_opacities"),bufferOutputPosition:e.createBuffer(),bufferTexturePosition:e.createBuffer(),bufferIndex:e.createBuffer()},e.uniform1iv(this._firstPass.uImages,[...Array(t).keys()]);let s=new Float32Array(t*12);for(let e=0;e<t;++e)s.set(Float32Array.from(this._unitQuad),e*12);e.bindBuffer(e.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),e.enableVertexAttribArray(this._firstPass.aOutputPosition),e.bindBuffer(e.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),e.enableVertexAttribArray(this._firstPass.aTexturePosition),e.bindBuffer(e.ARRAY_BUFFER,this._firstPass.bufferIndex);let c=[...Array(this._glNumTextures).keys()].map(e=>Array(6).fill(e)).flat();e.bufferData(e.ARRAY_BUFFER,new Float32Array(c),e.STATIC_DRAW),e.enableVertexAttribArray(this._firstPass.aIndex)}_makeSecondPassShaderProgram(){const s=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;

            uniform mat3 u_matrix;

            varying vec2 v_texture_position;

            void main() {
                gl_Position = vec4(u_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
            }
            `,o=`
            precision mediump float;

            // our texture
            uniform sampler2D u_image;

            // the texCoords passed in from the vertex shader.
            varying vec2 v_texture_position;

            // the opacity multiplier for the image
            uniform float u_opacity_multiplier;

            void main() {
                gl_FragColor = texture2D(u_image, v_texture_position);
                gl_FragColor *= u_opacity_multiplier;
            }
            `;let t=this._gl,n=this.constructor.initShaderProgram(t,s,o);t.useProgram(n),this._secondPass={shaderProgram:n,aOutputPosition:t.getAttribLocation(n,"a_output_position"),aTexturePosition:t.getAttribLocation(n,"a_texture_position"),uMatrix:t.getUniformLocation(n,"u_matrix"),uImage:t.getUniformLocation(n,"u_image"),uOpacityMultiplier:t.getUniformLocation(n,"u_opacity_multiplier"),bufferOutputPosition:t.createBuffer(),bufferTexturePosition:t.createBuffer()},t.bindBuffer(t.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),t.bufferData(t.ARRAY_BUFFER,this._unitQuad,t.STATIC_DRAW),t.enableVertexAttribArray(this._secondPass.aOutputPosition),t.bindBuffer(t.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),t.bufferData(t.ARRAY_BUFFER,this._unitQuad,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this._secondPass.aTexturePosition);let i=e.Mat3.makeScaling(2,2).multiply(e.Mat3.makeTranslation(-.5,-.5));t.uniformMatrix3fv(this._secondPass.uMatrix,!1,i.values)}_resizeRenderer(){let e=this._gl,t=this._renderingCanvas.width,n=this._renderingCanvas.height;e.viewport(0,0,t,n),e.deleteTexture(this._renderToTexture),this._renderToTexture=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._renderToTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._textureFilter()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this._glFrameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._renderToTexture,0)}_setupCanvases(){let e=this;this._outputCanvas=this.canvas,this._outputContext=this._outputCanvas.getContext("2d"),this._renderingCanvas=document.createElement("canvas"),this._clippingCanvas=document.createElement("canvas"),this._clippingContext=this._clippingCanvas.getContext("2d"),this._renderingCanvas.width=this._clippingCanvas.width=this._outputCanvas.width,this._renderingCanvas.height=this._clippingCanvas.height=this._outputCanvas.height,this._gl=this._renderingCanvas.getContext("webgl"),this._resizeHandler=function(){e._outputCanvas!==e.viewer.drawer.canvas&&(e._outputCanvas.style.width=e.viewer.drawer.canvas.clientWidth+"px",e._outputCanvas.style.height=e.viewer.drawer.canvas.clientHeight+"px");let t=e._calculateCanvasSize();(e._outputCanvas.width!==t.x||e._outputCanvas.height!==t.y)&&(e._outputCanvas.width=t.x,e._outputCanvas.height=t.y),e._renderingCanvas.style.width=e._outputCanvas.clientWidth+"px",e._renderingCanvas.style.height=e._outputCanvas.clientHeight+"px",e._renderingCanvas.width=e._clippingCanvas.width=e._outputCanvas.width,e._renderingCanvas.height=e._clippingCanvas.height=e._outputCanvas.height,e._resizeRenderer()},this.viewer.addHandler("resize",this._resizeHandler)}_makeQuadVertexBuffer(e,t,n,s){return new Float32Array([e,s,t,s,e,n,e,n,t,s,t,n])}_tileReadyHandler(t){let n=t.tile,o=t.tiledImage;if(o.isTainted())return;let i=n.getCanvasContext(),s=i&&i.canvas;if(!s||e.isCanvasTainted(s)){const t=o.isTainted();t||(o.setTainted(!0),e.console.warn("WebGL cannot be used to draw this TiledImage because it has tainted data. Does crossOriginPolicy need to be set?"),this._raiseDrawerErrorEvent(o,"Tainted data cannot be used by the WebGLDrawer. Falling back to CanvasDrawer for this TiledImage."));return}let a=this._TextureMap.get(s);if(!a){let e=this._gl,c=e.createTexture(),r,l=o.source.tileOverlap,t,a;if(n.sourceBounds?(t=Math.min(n.sourceBounds.width,s.width)/s.width,a=Math.min(n.sourceBounds.height,s.height)/s.height):(t=1,a=1),l>0){let e=this._calculateOverlapFraction(n,o),s=(n.x===0?0:e.x)*t,i=(n.y===0?0:e.y)*a,c=(n.isRightMost?1:1-e.x)*t,l=(n.isBottomMost?1:1-e.y)*a;r=this._makeQuadVertexBuffer(s,c,i,l)}else t===1&&a===1?r=this._unitQuad:r=this._makeQuadVertexBuffer(0,t,0,a);let d={texture:c,position:r};this._TextureMap.set(s,d),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._textureFilter()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._textureFilter()),this._uploadImageData(i)}}_calculateOverlapFraction(e,t){let n=t.source.tileOverlap,s=e.sourceBounds.width,o=e.sourceBounds.height,i=(e.x===0?0:n)+(e.isRightMost?0:n),a=(e.y===0?0:n)+(e.isBottomMost?0:n),r=n/(s+i),c=n/(o+a);return{x:r,y:c}}_unloadTextures(){let e=Array.from(this._TextureMap.keys());e.forEach(e=>{this._cleanupImageData(e)})}_uploadImageData(t){let n=this._gl,s=t.canvas;try{if(!s)throw"Tile context does not have a canvas",t;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,s)}catch(t){e.console.error("Error uploading image data to WebGL",t)}}_imageUnloadedHandler(e){let t=e.context2D.canvas;this._cleanupImageData(t)}_cleanupImageData(e){let t=this._TextureMap.get(e);this._TextureMap.delete(e),t&&this._gl.deleteTexture(t.texture)}_setClip(){}_renderToClippingCanvas(t){if(this._clippingContext.clearRect(0,0,this._clippingCanvas.width,this._clippingCanvas.height),this._clippingContext.save(),this.viewer.viewport.getFlip()){const t=new e.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(t.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-t.x,0)}if(t._clip){const e=[{x:t._clip.x,y:t._clip.y},{x:t._clip.x+t._clip.width,y:t._clip.y},{x:t._clip.x+t._clip.width,y:t._clip.y+t._clip.height},{x:t._clip.x,y:t._clip.y+t._clip.height}];let n=e.map(e=>{let n=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0)),s=this.viewportCoordToDrawerCoord(n);return s});this._clippingContext.beginPath(),n.forEach((e,t)=>{this._clippingContext[t===0?"moveTo":"lineTo"](e.x,e.y)}),this._clippingContext.clip(),this._setClip()}if(t._croppingPolygons){let e=t._croppingPolygons.map(e=>e.map(e=>{let n=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0)),s=this.viewportCoordToDrawerCoord(n);return s}));this._clippingContext.beginPath(),e.forEach(e=>{e.forEach((e,t)=>{this._clippingContext[t===0?"moveTo":"lineTo"](e.x,e.y)})}),this._clippingContext.clip()}if(this.viewer.viewport.getFlip()){const t=new e.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(t.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-t.x,0)}this._clippingContext.drawImage(this._renderingCanvas,0,0),this._clippingContext.restore()}_setRotations(e){var t=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),saveContext:t}),t=!1),e.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:e.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),saveContext:t})}_offsetForRotation(t){var n=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),s=this._outputContext;s.save(),s.translate(n.x,n.y),s.rotate(Math.PI/180*t.degrees),s.translate(-n.x,-n.y)}_flip(t){t=t||{};var s=t.point?t.point.times(e.pixelDensityRatio):this._getCanvasCenter(),n=this._outputContext;n.translate(s.x,0),n.scale(-1,1),n.translate(-s.x,0)}_drawDebugInfo(t,n,s){for(var i,o=t.length-1;o>=0;o--){i=t[o].tile;try{this._drawDebugInfoOnTile(i,t.length,o,n,s)}catch(t){e.console.error(t)}}}_drawDebugInfoOnTile(t,n,s,o,i){var r,c,l=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,a=this.context;a.save(),a.lineWidth=2*e.pixelDensityRatio,a.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor[l],a.fillStyle=this.debugGridColor[l],this._setRotations(o),i&&this._flip({point:t.position.plus(t.size.divide(2))}),a.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio),r=(t.position.x+t.size.x/2)*e.pixelDensityRatio,c=(t.position.y+t.size.y/2)*e.pixelDensityRatio,a.translate(r,c);const d=this.viewport.getRotation(!0);a.rotate(Math.PI/180*-d),a.translate(-r,-c),t.x===0&&t.y===0&&(a.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),a.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),a.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),a.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),a.fillText("Order: "+s+" of "+n,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),a.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),a.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.restore()}_drawPlaceholder(e){const o=e.getBounds(!0),t=this.viewportToDrawerRectangle(e.getBounds(!0)),n=this._outputContext;let s;typeof e.placeholderFillStyle=="function"?s=e.placeholderFillStyle(e,n):s=e.placeholderFillStyle,this._offsetForRotation({degrees:this.viewer.viewport.getRotation(!0)}),n.fillStyle=s,n.translate(t.x,t.y),n.rotate(Math.PI/180*o.degrees),n.translate(-t.x,-t.y),n.fillRect(t.x,t.y,t.width,t.height),this._restoreRotationChanges()}_getCanvasCenter(){return new e.Point(this.canvas.width/2,this.canvas.height/2)}_restoreRotationChanges(){var e=this._outputContext;e.restore()}static initShaderProgram(t,n,s){function i(t,n,s){const o=t.createShader(n);return t.shaderSource(o,s),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(e.console.error(`An error occurred compiling the shaders: ${t.getShaderInfoLog(o)}`),t.deleteShader(o),null)}const a=i(t,t.VERTEX_SHADER,n),r=i(t,t.FRAGMENT_SHADER,s),o=t.createProgram();return t.attachShader(o,a),t.attachShader(o,r),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(e.console.error(`Unable to initialize the shader program: ${t.getProgramInfoLog(o)}`),null)}}}(n),function(e){e.Viewport=function(t){var n=arguments;n.length&&n[0]instanceof e.Point&&(t={containerSize:n[0],contentSize:n[1],config:n[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,t.initialDegrees=t.degrees,delete t.degrees,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:e.DEFAULT_SETTINGS.silenceMultiImageWarnings},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new e.Spring({initial:t.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={get degrees(){return e.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(t){e.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(t)},resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,n)},_setContentBounds:function(t,n){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=t.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var t,e=this._contentAspectRatio/this.getAspectRatio();return this.homeFillsViewer?t=e>=1?e:1:t=e>=1?1:e,t/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var n=this._contentBounds.getCenter(),t=1/this.getHomeZoom(),s=t/this.getAspectRatio();return new e.Rect(n.x-t/2,n.y-s/2,t,s)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return t},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert(e.type(t)==="object","[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation(e))},getBoundsNoRotate:function(t){var s=this.getCenter(t),n=1/this.getZoom(t),o=n/this.getAspectRatio();return new e.Rect(s.x-n/2,s.y-o/2,n,o)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(e),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),n=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/n,t.y-=this._margins.top/n,t.width+=(this._margins.left+this._margins.right)/n,t.height+=(this._margins.top+this._margins.bottom)/n,t},getCenter:function(t){var n,o,i,r,c,l,d,u,s=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),a=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?s:this.zoomPoint?(r=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),n=1/o,i=n/this.getAspectRatio(),c=new e.Rect(s.x-n/2,s.y-i/2,n,i),l=this._pixelFromPoint(this.zoomPoint,c),d=l.minus(r).rotate(-this.getRotation(!0)),u=d.divide(this._containerInnerSize.x*o),a.plus(u)):a},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var s,a,r,c,l,d,u,h,m,f,p,g,t=this.viewportToViewerElementRectangle(e).getBoundingBox(),n=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),o=!1,i=!1;return this.wrapHorizontal||(g=t.x+t.width,p=n.x+n.width,t.width>n.width?r=this.visibilityRatio*n.width:r=this.visibilityRatio*t.width,d=n.x-g+r,l=p-t.x-r,r>n.width?(t.x+=(d+l)/2,o=!0):l<0?(t.x+=l,o=!0):d>0&&(t.x+=d,o=!0)),this.wrapVertical||(m=t.y+t.height,f=n.y+n.height,t.height>n.height?s=this.visibilityRatio*n.height:s=this.visibilityRatio*t.height,c=n.y-m+s,u=f-t.y-s,s>n.height?(t.y+=(c+u)/2,i=!0):u<0?(t.y+=u,i=!0):c>0&&(t.y+=c,i=!0)),h=o||i,a=h?this.viewerElementToViewportRectangle(t):e.clone(),a.xConstrained=o,a.yConstrained=i,a.constraintApplied=h,a},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t,n=this.getZoom(),s=this._applyZoomConstraints(n);return n!==s&&this.zoomTo(s,this.zoomPoint,e),t=this.getConstrainedBounds(!1),t.constraintApplied&&(this.fitBounds(t,e),this._raiseConstraintsEvent(e)),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,n){n=n||{};var o,i,l,d,h,m,f,p,u=n.immediately||!1,c=n.constraints||!1,r=this.getAspectRatio(),a=t.getCenter(),s=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();return s.getAspectRatio()>=r?s.height=s.width/r:s.width=s.height*r,s.x=a.x-s.width/2,s.y=a.y-s.height/2,o=1/s.width,u?(this.panTo(a,!0),this.zoomTo(o,null,!0),c&&this.applyConstraints(!0),this):(l=this.getCenter(!0),d=this.getZoom(!0),this.panTo(l,!0),this.zoomTo(d,null,!0),h=this.getBounds(),i=this.getZoom(),i===0||Math.abs(o/i-1)<1e-8?(this.zoomTo(o,null,!0),this.panTo(a,u),c&&this.applyConstraints(!1),this):(c?(this.panTo(a,!1),o=this._applyZoomConstraints(o),this.zoomTo(o,null,!1),m=this.getConstrainedBounds(),this.panTo(l,!0),this.zoomTo(d,null,!0),this.fitBounds(m)):(f=s.rotate(-this.getRotation()),p=f.getTopLeft().times(o).minus(h.getTopLeft().times(i)).divide(o-i),this.zoomTo(o,p,u)),this))},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,t)},fitHorizontally:function(t){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,t)},getConstrainedBounds:function(e){var t=this.getBounds(e),n=this._applyBoundaryConstraints(t);return n},panBy:function(t,n){var s=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(t),n)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,n){return this.zoomTo(this.zoomSpring.target.value*e,t,n)},zoomTo:function(t,n,s){var o=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s?this._adjustCenterSpringsForZoomPoint(function(){o.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:n,immediately:s}),this},setRotation:function(e,t){return this.rotateTo(e,null,t)},getRotation:function(e){return e?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(e,t,n){return this.rotateTo(e,t,n)},rotateTo:function(t,n,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===t&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,s)if(this.rotationPivot){var o,i,a,r,c=t-this._oldDegrees;if(!c)return this.rotationPivot=null,this;this._rotateAboutPivot(t)}else this.degreesSpring.resetTo(t);else i=e.positiveModulo(this.degreesSpring.current.value,360),o=e.positiveModulo(t,360),a=o-i,a>180?o-=360:a<-180&&(o+=360),r=i-o,this.degreesSpring.resetTo(t+r),this.degreesSpring.springTo(t);return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(e,t,n){return this.rotateTo(this.degreesSpring.target.value+e,t,n)},resize:function(e,t){var o,i,s=this.getBoundsNoRotate(),n=s;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(o=e.x/this.containerSize.x,n.width=s.width*o,n.height=n.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),i=this.fitBounds(n,!0),this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:e,maintain:t}),i},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e,t,n=this;return this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update(),e=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees,this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,t=e||!this.zoomSpring.isAtTargetValue()||!this.centerSpringX.isAtTargetValue()||!this.centerSpringY.isAtTargetValue()||!this.degreesSpring.isAtTargetValue(),t},_rotateAboutPivot:function(e){var n,s,o=e===!0,t=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(t.x),this.centerSpringY.shiftBy(t.y),o?this.degreesSpring.update():this.degreesSpring.resetTo(e),s=this.degreesSpring.current.value-this._oldDegrees,n=t.rotate(s*-1).times(-1),this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y)},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t,n,s,o=this.pixelFromPoint(this.zoomPoint,!0);e(),n=this.pixelFromPoint(this.zoomPoint,!0),s=n.minus(o),t=this.deltaPointsFromPixels(s,!0),this.centerSpringX.shiftBy(t.x),this.centerSpringY.shiftBy(t.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation(t)),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation(t))},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,n){return t.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(!0),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,n){var s=this.getBoundsNoRotate(n);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(t),this.getCenter(t))},_viewportToImageDelta:function(t,n){var s=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/s,n*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(t,n){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var o,s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1)return o=this.viewer.world.getItemAt(0),o.viewportToImageCoordinates(t,n,!0)}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,n){var s=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*s,n/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(t,n){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var s,i,o=this.viewer.world.getItemCount();if(o>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(o===1)return i=this.viewer.world.getItemAt(0),i.imageToViewportCoordinates(t,n,!0)}return s=this._imageToViewportDelta(t,n),s.x+=this._contentBoundsNoRotate.x,s.y+=this._contentBoundsNoRotate.y,s},imageToViewportRectangle:function(t,n,s,o){var a,r,c,l,i=t;if(i instanceof e.Rect||(i=new e.Rect(t,n,s,o)),this.viewer)if(a=this.viewer.world.getItemCount(),a>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(a===1)return l=this.viewer.world.getItemAt(0),l.imageToViewportRectangle(t,n,s,o,!0);return r=this.imageToViewportCoordinates(i.x,i.y),c=this._imageToViewportDelta(i.width,i.height),new e.Rect(r.x,r.y,c.x,c.y,i.degrees)},viewportToImageRectangle:function(t,n,s,o){var a,r,c,l,i=t;if(i instanceof e.Rect||(i=new e.Rect(t,n,s,o)),this.viewer)if(a=this.viewer.world.getItemCount(),a>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(a===1)return l=this.viewer.world.getItemAt(0),l.viewportToImageRectangle(t,n,s,o,!0);return r=this.viewportToImageCoordinates(i.x,i.y),c=this._viewportToImageDelta(i.width,i.height),new e.Rect(r.x,r.y,c.x,c.y,i.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var n=this.imageToViewerElementCoordinates(t);return n.plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var n=this.viewportToViewerElementCoordinates(t);return n.plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var s,o,i,a,r,n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(n===1)return s=this.viewer.world.getItemAt(0),s.viewportToImageZoom(t)}return o=this._contentSizeNoRotate.x,i=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=i/o*a,t*r},imageToViewportZoom:function(t){if(this.viewer){var s,o,i,a,r,n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image. Instead, use [TiledImage.imageToViewportZoom] for the specific image of interest");else if(n===1)return s=this.viewer.world.getItemAt(0),s.imageToViewportZoom(t)}return o=this._contentSizeNoRotate.x,i=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width,r=o/i/a,t*r},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e?this:(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e}),this)},getMaxZoomPixelRatio:function(){return this.maxZoomPixelRatio},setMaxZoomPixelRatio:function(t,n=!0,s=!1){if(e.console.assert(!isNaN(t),"[Viewport.setMaxZoomPixelRatio] ratio must be a number"),isNaN(t))return;this.maxZoomPixelRatio=t,n&&this.getZoom()>this.getMaxZoom()&&this.applyConstraints(s)}}}(n),function(e){e.TiledImage=function(t){this._initialized=!1,e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var s,o,i,a,r,c,l=t.x||0;delete t.x,i=t.y||0,delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y,s=1,t.width?(s=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(s=t.height/this.normHeight,delete t.height),o=t.fitBounds,delete t.fitBounds,a=t.fitBoundsPlacement||n.Placement.CENTER,delete t.fitBoundsPlacement,r=t.degrees||0,delete t.degrees,c=t.ajaxHeaders,delete t.ajaxHeaders,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_needsDraw:!0,_needsUpdate:!0,_hasOpaqueTile:!1,_tilesLoading:0,_tilesToDraw:[],_lastDrawn:[],_isBlending:!1,_wasBlending:!1,_isTainted:!1,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:e.DEFAULT_SETTINGS.subPixelRoundingForTransparency,maxTilesPerFrame:e.DEFAULT_SETTINGS.maxTilesPerFrame},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),o&&this.fitBounds(o,a,!0),this._ownAjaxHeaders={},this.setAjaxHeaders(c,!1),this._initialized=!0},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},redraw:function(){this._needsDraw=!0},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){if(e===this._fullyLoaded)return;this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded})},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(e){let n=this._xSpring.update(),s=this._ySpring.update(),o=this._scaleSpring.update(),i=this._degreesSpring.update(),t=n||s||o||i||this._needsUpdate;if(t||e||!this._fullyLoaded){let e=this._updateLevelsForViewport();this._setFullyLoaded(e)}return this._needsUpdate=!1,!!t&&(this._updateForScale(),this._raiseBoundsChange(),this._needsDraw=!0,!0)},setDrawn:function(){return this._needsDraw=this._isBlending||this._wasBlending,this._needsDraw},setTainted(e){this._isTainted=e},isTainted(){return this._isTainted},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy(this.viewer)},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var n,o,i,s=this.getBoundsNoRotate(t);return this._clip&&(o=t?this._worldWidthCurrent:this._worldWidthTarget,i=o/this.source.dimensions.x,n=this._clip.times(i),s=new e.Rect(s.x+n.x,s.y+n.y,n.width,n.height)),s.rotate(this.getRotation(t),this._getRotationPoint(t))},getTileBounds:function(e,t,n){var s=this.source.getNumTiles(e),i=(s.x+t%s.x)%s.x,a=(s.y+n%s.y)%s.y,o=this.source.getTileBounds(e,i,a);return this.getFlip()&&(o.x=Math.max(0,1-o.x-o.width)),o.x+=(t-i)/s.x,o.y+=this._worldHeightCurrent/this._worldWidthCurrent*((n-a)/s.y),o},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var t=this.imageToWindowCoordinates(new e.Point(0,0)),n=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(n.x-t.x,n.y-t.y)},_viewportToImageDelta:function(t,n,s){var o=s?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/o),n*(this.source.dimensions.y*this.contentAspectX/o))},viewportToImageCoordinates:function(t,n,s){var o;return t instanceof e.Point?(s=n,o=t):o=new e.Point(t,n),o=o.rotate(-this.getRotation(s),this._getRotationPoint(s)),s?this._viewportToImageDelta(o.x-this._xSpring.current.value,o.y-this._ySpring.current.value):this._viewportToImageDelta(o.x-this._xSpring.target.value,o.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,n,s){var o=s?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*o,n/this.source.dimensions.y/this.contentAspectX*o)},imageToViewportCoordinates:function(t,n,s){t instanceof e.Point&&(s=n,n=t.y,t=t.x);var o=this._imageToViewportDelta(t,n,s);return s?(o.x+=this._xSpring.current.value,o.y+=this._ySpring.current.value):(o.x+=this._xSpring.target.value,o.y+=this._ySpring.target.value),o.rotate(this.getRotation(s),this._getRotationPoint(s))},imageToViewportRectangle:function(t,n,s,o,i){var r,c,a=t;return a instanceof e.Rect?i=n:a=new e.Rect(t,n,s,o),r=this.imageToViewportCoordinates(a.getTopLeft(),i),c=this._imageToViewportDelta(a.width,a.height,i),new e.Rect(r.x,r.y,c.x,c.y,a.degrees+this.getRotation(i))},viewportToImageRectangle:function(t,n,s,o,i){var r,c,a=t;return t instanceof e.Rect?i=n:a=new e.Rect(t,n,s,o),r=this.viewportToImageCoordinates(a.getTopLeft(),i),c=this._viewportToImageDelta(a.width,a.height,i),new e.Rect(r.x,r.y,c.x,c.y,a.degrees-this.getRotation(i))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(n.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){var t=this.imageToViewerElementCoordinates(e);return t.plus(n.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var n=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/n,(t.y-this._ySpring.current.value)/n,t.width/n,t.height/n,t.degrees)},viewportToImageZoom:function(e){var t=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return t*e},imageToViewportZoom:function(e){var t=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return e/t},setPosition:function(e,t){var n=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(n&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){var n=function(t){return t instanceof e.Point||typeof t.x=="number"&&typeof t.y=="number"},s=function(e){return e.map(function(e){try{if(n(e))return{x:e.x,y:e.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map(function(e){return s(e)}),this._needsDraw=!0}catch(t){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(t),this.resetCroppingPolygons()}},resetCroppingPolygons:function(){this._croppingPolygons=null,this._needsDraw=!0},fitBounds:function(t,n,s){n=n||e.Placement.CENTER;var c,l,h,m,i=e.Placement.properties[n],o=this.contentAspectX,a=0,r=0,d=1,u=1;this._clip&&(o=this._clip.getAspectRatio(),d=this._clip.width/this.source.dimensions.x,u=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>o?(a=this._clip.x/this._clip.height*t.height,r=this._clip.y/this._clip.height*t.height):(a=this._clip.x/this._clip.width*t.width,r=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>o?(h=t.height/u,c=0,i.isHorizontallyCentered?c=(t.width-t.height*o)/2:i.isRight&&(c=t.width-t.height*o),this.setPosition(new e.Point(t.x-a+c,t.y-r),s),this.setHeight(h,s)):(m=t.width/d,l=0,i.isVerticallyCentered?l=(t.height-t.width/o)/2:i.isBottom&&(l=t.height-t.width/o),this.setPosition(new e.Point(t.x-a,t.y-r+l),s),this.setWidth(m,s))},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsUpdate=!0,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return this.flipped},setFlip:function(e){this.flipped=e},get flipped(){return this._flipped},set flipped(e){let t=this._flipped!==!!e;this._flipped=!!e,t&&(this.update(!0),this._needsDraw=!0,this._raiseBoundsChange())},get wrapHorizontal(){return this._wrapHorizontal},set wrapHorizontal(e){let t=this._wrapHorizontal!==!!e;this._wrapHorizontal=!!e,this._initialized&&t&&(this.update(!0),this._needsDraw=!0)},get wrapVertical(){return this._wrapVertical},set wrapVertical(e){let t=this._wrapVertical!==!!e;this._wrapVertical=!!e,this._initialized&&t&&(this.update(!0),this._needsDraw=!0)},get debugMode(){return this._debugMode},set debugMode(e){this._debugMode=!!e,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(e){this.opacity=e},get opacity(){return this._opacity},set opacity(e){if(e===this.opacity)return;this._opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity})},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){if(this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue())return;t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._needsUpdate=!0,this._raiseBoundsChange()},getDrawArea:function(){if(this._opacity===0&&!this._preload)return!1;var t,e=this._viewportToTiledImageRectangle(this.viewport.getBoundsWithMargins(!0));return!this.wrapHorizontal&&!this.wrapVertical&&(t=this._viewportToTiledImageRectangle(this.getClippedBounds(!0)),e=e.intersection(t)),e},getTilesToDraw:function(){let e=this._tilesToDraw.flat();return this._updateTilesInViewport(e),e=this._tilesToDraw.flat(),e.forEach(e=>{e.tile.beingDrawn=!0}),this._lastDrawn=e,e},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},get compositeOperation(){return this._compositeOperation},set compositeOperation(e){if(e===this._compositeOperation)return;this._compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this._compositeOperation})},getCompositeOperation:function(){return this._compositeOperation},setCompositeOperation:function(e){this.compositeOperation=e},setAjaxHeaders:function(t,n){if(t===null&&(t={}),!e.isPlainObject(t)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=t,this._updateAjaxHeaders(n)},_updateAjaxHeaders:function(t){if(t===0[0]&&(t=!0),e.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=e.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,t){for(i in this.tilesMatrix){n=this.source.getNumTiles(i);for(r in this.tilesMatrix[i]){c=(n.x+r%n.x)%n.x;for(d in this.tilesMatrix[i][r])if(l=(n.y+d%n.y)%n.y,o=this.tilesMatrix[i][r][d],o.loadWithAjax=this.loadTilesWithAjax,o.loadWithAjax){var n,s,o,i,a,r,c,l,d,u=this.source.getTileAjaxHeaders(i,c,l);o.ajaxHeaders=e.extend({},this.ajaxHeaders,u)}else o.ajaxHeaders=null}}for(a=0;a<this._imageLoader.jobQueue.length;a++)s=this._imageLoader.jobQueue[a],s.loadWithAjax=s.tile.loadWithAjax,s.ajaxHeaders=s.tile.loadWithAjax?s.tile.ajaxHeaders:null}},_setScale:function(e,t){var n=this._scaleSpring.target.value===e;if(t){if(n&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var t=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),n=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,e=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(n/this.minPixelRatio)/Math.log(2)))),e=Math.max(e,this.source.minLevel||0),t=Math.min(t,e);return{lowestLevel:t,highestLevel:e}},_updateLevelsForViewport:function(){var t,s,o,i,r,l,u,h,p,v,b,f=this._getLevelsInterval(),g=f.lowestLevel,a=f.highestLevel,n=[],d=this.getDrawArea(),c=e.now();if(this._lastDrawn.forEach(e=>{e.tile.beingDrawn=!1}),this._tilesToDraw=[],this._tilesLoading=0,this.loadingCoverage={},!d)return this._needsDraw=!1,this._fullyLoaded;t=new Array(a-g+1);for(let n=0,e=a;e>=g;e--,n++)t[n]=e;for(let e=a+1;e<=this.source.maxLevel;e++)if(s=this.tilesMatrix[e]&&this.tilesMatrix[e][0]&&this.tilesMatrix[e][0][0],s&&s.isBottomMost&&s.isRightMost&&s.loaded){t.push(e);break}let m=!1;for(let s=0;s<t.length;s++){let e=t[s];if(o=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(e),!0).x*this._scaleSpring.current.value,s===t.length-1||o>=this.minPixelRatio)m=!0;else if(!m)continue;if(u=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(e),!1).x*this._scaleSpring.current.value,h=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,l=this.immediateRender?1:h,r=Math.min(1,(o-.5)/.5),p=l/Math.abs(l-u),i=this._updateLevel(e,r,p,d,c,n),n=i.bestTiles,v=i.updatedTiles.filter(e=>e.loaded),b=function(e,t,n){return function(s){return{tile:s,level:e,levelOpacity:t,currentTime:n}}}(e,r,c),this._tilesToDraw[e]=v.map(b),this._providesCoverage(this.coverage,e))break}return n&&n.length>0?(n.forEach(function(e){e&&!e.context2D&&this._loadTile(e,c)},this),this._needsDraw=!0,!1):this._tilesLoading===0},_updateTilesInViewport:function(t){let o=e.now(),n=this;this._tilesLoading=0,this._wasBlending=this._isBlending,this._isBlending=!1,this.loadingCoverage={};let i=t.length?t[0].level:0,a=this.getDrawArea();if(!a)return;function r(e){let t=e.tile;if(t&&t.loaded){let s=n._blendTile(t,t.x,t.y,e.level,e.levelOpacity,o,i);n._isBlending=n._isBlending||s,n._needsDraw=n._needsDraw||s||n._wasBlending}}let s=0;for(let e=0;e<t.length;e++){let n=t[e];r(n),this._providesCoverage(this.coverage,n.level)&&(s=Math.max(s,n.level))}if(s>0)for(let e in this._tilesToDraw)e<s&&delete this._tilesToDraw[e]},_blendTile:function(e,t,n,s,o,i,a){let c=1e3*this.blendTime,l,r;return e.blendStart||(e.blendStart=i),l=i-e.blendStart,r=c?Math.min(1,l/c):1,s===a&&(r=1,l=c),this.alwaysBlend&&(r*=o),e.opacity=r,r===1&&(this._setCoverage(this.coverage,s,t,n,!0),this._hasOpaqueTile=!0),l<c},_updateLevel:function(e,t,n,s,o,i){var a,r,c,l,d,u,h,m,f,p,g,v,j,b=s.getBoundingBox().getTopLeft(),y=s.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:!0,level:e,opacity:t,visibility:n,drawArea:s,topleft:b,bottomright:y,currenttime:o,best:i}),this._resetCoverage(this.coverage,e),this._resetCoverage(this.loadingCoverage,e),f=this._getCornerTiles(e,b,y),d=f.topLeft,a=f.bottomRight,r=this.source.getNumTiles(e),j=this.viewport.pixelFromPoint(this.viewport.getCenter()),this.getFlip()&&(a.x+=1,this.wrapHorizontal||(a.x=Math.min(a.x,r.x-1)));for(v=Math.max(0,(a.x-d.x)*(a.y-d.y)),m=new Array(v),h=0,c=d.x;c<=a.x;c++)for(l=d.y;l<=a.y;l++){if(this.getFlip()?(p=(r.x+c%r.x)%r.x,u=c+r.x-p-p-1):u=c,s.intersection(this.getTileBounds(e,u,l))===null)continue;g=this._updateTile(u,l,e,n,j,r,o,i),i=g.bestTiles,m[h]=g.tile,h+=1}return{bestTiles:i,updatedTiles:m}},_positionTile:function(t,n,s,o,i){a=t.bounds.getTopLeft(),a.x*=this._scaleSpring.current.value,a.y*=this._scaleSpring.current.value,a.x+=this._xSpring.current.value,a.y+=this._ySpring.current.value,r=t.bounds.getSize(),r.x*=this._scaleSpring.current.value,r.y*=this._scaleSpring.current.value,t.positionedBounds.x=a.x,t.positionedBounds.y=a.y,t.positionedBounds.width=r.x,t.positionedBounds.height=r.y;var a,r,l=s.pixelFromPointNoRotate(a,!0),d=s.pixelFromPointNoRotate(a,!1),c=s.deltaPixelsFromPointsNoRotate(r,!0),u=s.deltaPixelsFromPointsNoRotate(r,!1),h=d.plus(u.divide(2)),m=o.squaredDistanceTo(h);this.viewer.drawer.minimumOverlapRequired(this)&&(n||(c=c.plus(new e.Point(1,1))),t.isRightMost&&this.wrapHorizontal&&(c.x+=.75),t.isBottomMost&&this.wrapVertical&&(c.y+=.75)),t.position=l,t.size=c,t.squaredDistance=m,t.visibility=i},_updateTile:function(e,t,n,s,o,i,a,r){var l,d,c=this._getTile(e,t,n,a,i);return this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:c}),this._setCoverage(this.coverage,n,e,t,!1),l=c.loaded||c.loading||this._isCovered(this.loadingCoverage,n,e,t),this._setCoverage(this.loadingCoverage,n,e,t,l),c.exists?(c.loaded&&c.opacity===1&&this._setCoverage(this.coverage,n,e,t,!0),this._positionTile(c,this.source.tileOverlap,this.viewport,o,s),c.loaded||(c.context2D?this._setTileLoaded(c):(d=this._tileCache.getImageRecord(c.cacheKey),d&&this._setTileLoaded(c,d.getData()))),c.loading?this._tilesLoading++:l||(r=this._compareTiles(r,c,this.maxTilesPerFrame)),{bestTiles:r,tile:c}):{bestTiles:r,tile:c}},_getCornerTiles:function(t,n,s){this.wrapHorizontal?(c=e.positiveModulo(n.x,1),l=e.positiveModulo(s.x,1)):(c=Math.max(0,n.x),l=Math.min(1,s.x));var i,a,r,c,l,d,u,o=1/this.source.aspectRatio;return this.wrapVertical?(d=e.positiveModulo(n.y,o),u=e.positiveModulo(s.y,o)):(d=Math.max(0,n.y),u=Math.min(o,s.y)),a=this.source.getTileAtPoint(t,new e.Point(c,d)),r=this.source.getTileAtPoint(t,new e.Point(l,u)),i=this.source.getNumTiles(t),this.wrapHorizontal&&(a.x+=i.x*Math.floor(n.x),r.x+=i.x*Math.floor(s.x)),this.wrapVertical&&(a.y+=i.y*Math.floor(n.y/o),r.y+=i.y*Math.floor(s.y/o)),{topLeft:a,bottomRight:r}},_getTile:function(t,n,s,o,i){var a,r,c,u,h,m,f,p,g,v,l=this.tilesMatrix,d=this.source;return l[s]||(l[s]={}),l[s][t]||(l[s][t]={}),(!l[s][t][n]||!l[s][t][n].flipped!==!this.flipped)&&(a=(i.x+t%i.x)%i.x,r=(i.y+n%i.y)%i.y,f=this.getTileBounds(s,t,n),p=d.getTileBounds(s,a,r,!0),g=d.tileExists(s,a,r),h=d.getTileUrl(s,a,r),m=d.getTilePostData(s,a,r),this.loadTilesWithAjax?(u=d.getTileAjaxHeaders(s,a,r),e.isPlainObject(this.ajaxHeaders)&&(u=e.extend({},this.ajaxHeaders,u))):u=null,v=d.getContext2D?d.getContext2D(s,a,r):0[0],c=new e.Tile(s,t,n,f,g,h,v,this.loadTilesWithAjax,u,p,m,d.getTileHashKey(s,a,r,h,u,m)),this.getFlip()?a===0&&(c.isRightMost=!0):a===i.x-1&&(c.isRightMost=!0),r===i.y-1&&(c.isBottomMost=!0),c.flipped=this.flipped,l[s][t][n]=c),c=l[s][t][n],c.lastTouchTime=o,c},_loadTile:function(e,t){var n=this;e.loading=!0,this._imageLoader.addJob({src:e.getUrl(),tile:e,source:this.source,postData:e.postData,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(s,o,i){n._onTileLoad(e,t,s,o,i)},abort:function(){e.loading=!1}})},_onTileLoad:function(t,n,s,o,i){if(!s){e.console.error("Tile %s failed to load: %s - error: %s",t,t.getUrl(),o),this.viewer.raiseEvent("tile-load-failed",{tile:t,tiledImage:this,time:n,message:o,tileRequest:i}),t.loading=!1,t.exists=!1;return}if(t.exists=!0,n<this.lastResetTime){e.console.warn("Ignoring tile %s loaded before reset: %s",t,t.getUrl()),t.loading=!1;return}var a=this,r=function(){var e=a.source,n=e.getClosestLevel();a._setTileLoaded(t,s,n,i)};r()},_setTileLoaded:function(t,n,s,o){var l,a=0,r=!1,i=this;function c(){return r&&e.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),a++,d}function d(){a--,a===0&&(t.loading=!1,t.loaded=!0,t.hasTransparency=i.source.hasTransparency(t.context2D,t.getUrl(),t.ajaxHeaders,t.postData),t.context2D||i._tileCache.cacheTile({data:n,tile:t,cutoff:s,tiledImage:i}),i.viewer.raiseEvent("tile-ready",{tile:t,tiledImage:i,tileRequest:o}),i._needsDraw=!0)}l=c(),this.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:this,tileRequest:o,get image(){return e.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),n},data:n,getCompletionCallback:c}),r=!0,l()},_compareTiles:function(e,t,n){return e?(e.push(t),this._sortTiles(e),e.length>n&&e.pop(),e):[t]},_sortTiles:function(e){e.sort(function(e,t){return e===null?1:t===null?-1:e.visibility===t.visibility?e.squaredDistance-t.squaredDistance:t.visibility-e.visibility})},_providesCoverage:function(e,t,n,s){var o,i,a,r;if(!e[t])return!1;if(n===0[0]||s===0[0]){o=e[t];for(a in o)if(Object.prototype.hasOwnProperty.call(o,a)){i=o[a];for(r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&!i[r])return!1}return!0}return e[t][n]===0[0]||e[t][n][s]===0[0]||e[t][n][s]===!0},_isCovered:function(e,t,n,s){return n===0[0]||s===0[0]?this._providesCoverage(e,t+1):this._providesCoverage(e,t+1,2*n,2*s)&&this._providesCoverage(e,t+1,2*n,2*s+1)&&this._providesCoverage(e,t+1,2*n+1,2*s)&&this._providesCoverage(e,t+1,2*n+1,2*s+1)},_setCoverage:function(t,n,s,o,i){if(!t[n]){e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n);return}t[n][s]||(t[n][s]={}),t[n][s][o]=i},_resetCoverage:function(e,t){e[t]={}}})}(n),function(e){var n=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},t=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.data,"[ImageRecord] options.data is required"),this._tiles=[],t.create.apply(null,[this,t.data,t.ownerTile]),this._destroyImplementation=t.destroy.bind(null,this),this.getImage=t.getImage.bind(null,this),this.getData=t.getData.bind(null,this),this.getRenderedContext=t.getRenderedContext.bind(null,this)};t.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var n=0;n<this._tiles.length;n++)if(this._tiles[n]===t){this._tiles.splice(n,1);return}e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){e.console.assert(s,"[TileCache.cacheTile] options is required"),e.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var o,i,a,r,l,d,u,h,f,p,g=s.cutoff||0,m=this._tilesLoaded.length,c=this._imagesLoaded[s.tile.cacheKey];if(c||(s.data||(e.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),e.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),c=this._imagesLoaded[s.tile.cacheKey]=new t({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),c.addTile(s.tile),s.tile.cacheImageRecord=c,this._imagesLoadedCount>this._maxImageCacheCount){for(i=null,r=-1,l=null,a=this._tilesLoaded.length-1;a>=0;a--){if(d=this._tilesLoaded[a],o=d.tile,o.level<=g||o.beingDrawn)continue;if(!i){i=o,r=a,l=d;continue}h=o.lastTouchTime,u=i.lastTouchTime,p=o.level,f=i.level,(h<u||h===u&&p>f)&&(i=o,r=a,l=d)}i&&r>=0&&(this._unloadTile(l),m=r)}this._tilesLoaded[m]=new n({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(t){e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var s,n=0;n<this._tilesLoaded.length;++n)s=this._tilesLoaded[n],s.tiledImage===t&&(this._unloadTile(s),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var s,n=t.tile,i=t.tiledImage;let o=n.getCanvasContext&&n.getCanvasContext();if(n.unload(),n.cacheImageRecord=null,s=this._imagesLoaded[n.cacheKey],!s)return;s.removeTile(n),s.getTileCount()||(s.destroy(),delete this._imagesLoaded[n.cacheKey],this._imagesLoadedCount--,o&&(o.canvas.width=0,o.canvas.height=0,i.viewer.raiseEvent("image-unloaded",{context2D:o,tile:n}))),i.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:i})}}}(n),function(e){e.World=function(t){var n=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,n){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),n=n||{},n.index!==0[0]){var s=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(s,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(t!==0[0],"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,n){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(n!==0[0],"[World.setItemIndex] index is required");var s=this.getIndexOfItem(t);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");if(n===s||s===-1)return;this._items.splice(s,1),this._items.splice(n,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:s,newIndex:n})},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var n=e.indexOf(this._items,t);if(n===-1)return;t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t)},removeAll:function(){this.viewer._cancelPendingImages();for(e=0;e<this._items.length;e++)t=this._items[e],t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy();var e,t,n=this._items;this._items=[],this._figureSizes(),this._needsDraw=!0;for(e=0;e<n.length;e++)t=n[e],this._raiseRemoveItem(t)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(e){for(var t=!1,n=0;n<this._items.length;n++)t=this._items[n].update(e)||t;return t},draw:function(){this.viewer.drawer.draw(this._items),this._needsDraw=!1,this._items.forEach(e=>{this._needsDraw=e.setDrawn()||this._needsDraw})},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){t=t||{};var n,s,o,i,r,l,d,m,f,u=t.immediately||!1,p=t.layout||e.DEFAULT_SETTINGS.collectionLayout,v=t.rows||e.DEFAULT_SETTINGS.collectionRows,h=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,g=t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin,c=a+g;!t.rows&&h?d=h:d=Math.ceil(this._items.length/v),o=0,r=0,this.setAutoRefigureSizes(!1);for(s=0;s<this._items.length;s++)s&&s%d===0&&(p==="horizontal"?(r+=c,o=0):(o+=c,r=0)),l=this._items[s],n=l.getBounds(),n.width>n.height?i=a:i=a*(n.width/n.height),m=i*(n.height/n.width),f=new e.Point(o+(a-i)/2,r+(a-m)/2),l.setPosition(f,u),l.setWidth(i,u),p==="horizontal"?o+=c:r+=c;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t,n,s,o,i,a,r,c,l=this._homeBounds?this._homeBounds.clone():null,d=this._contentSize?this._contentSize.clone():null,u=this._contentFactor||0;if(this._items.length){n=this._items[0],i=n.getBounds(),this._contentFactor=n.getContentSize().x/i.width;for(t=n.getClippedBounds().getBoundingBox(),s=t.x,o=t.y,a=t.x+t.width,r=t.y+t.height,c=1;c<this._items.length;c++)n=this._items[c],i=n.getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/i.width),t=n.getClippedBounds().getBoundingBox(),s=Math.min(s,t.x),o=Math.min(o,t.y),a=Math.max(a,t.x+t.width),r=Math.max(r,t.y+t.height);this._homeBounds=new e.Rect(s,o,a-s,r-o),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;(this._contentFactor!==u||!this._homeBounds.equals(l)||!this._contentSize.equals(d))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(n)}}),C0=lu({"node_modules/manifesto.js/dist-umd/manifesto.js"(e,t){!function(n,s){"object"==typeof e&&"object"==typeof t?t.exports=s():"function"==typeof define&&define.amd?define("manifesto",[],s):"object"==typeof e?e.manifesto=s():n.manifesto=s()}("undefined"!=typeof self?self:e,()=>(()=>{var n={41:function(e,t,n){"use strict";a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(o,i){function r(e){try{a(s.next(e))}catch(e){i(e)}}function c(e){try{a(s.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,c)}a((s=s.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=r(0),i.throw=r(1),i.return=r(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(r){return function(c){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,r[0]&&(s=0)),s;)try{if(a=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:0[0],done:!0}}([r,c])}}},Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=0[0];var a,r,c,i=n(4799),s=n(3957),o=n(7019);n(916),c=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_LEVEL_1||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_LEVEL_2||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var s,o,i,n=0;n<e.length;n++)if(s=e[n],t===s["@language"])return s["@value"];i=t.substr(0,t.indexOf("-"));for(n=0;n<e.length;n++)if(o=e[n],o["@language"]===i)return o["@value"];return null},e.generateTreeNodeIds=function(t,n){0[0]===n&&(n=0),o=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=o;for(var o,i,s=0;s<t.nodes.length;s++)i=t.nodes[s],e.generateTreeNodeIds(i,s)},e.normaliseType=function(e){return-1!==(e=(e||"").toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isImageServiceType=function(e){return null!==e&&e.toLowerCase()===s.ServiceType.IMAGE_SERVICE_2.toLowerCase()||e===s.ServiceType.IMAGE_SERVICE_3.toLowerCase()},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return i.Deserialiser.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise(function(n,s){fetch(t).then(e.checkStatus).then(function(e){return e.json()}).then(function(e){n(e)}).catch(function(){s()})})},e.loadExternalResourcesAuth1=function(t,n,s,o,i,a,r,c){return new Promise(function(l,d){var u=t.map(function(t){return e.loadExternalResourceAuth1(t,n,s,o,i,a,r,c)});Promise.all(u).then(function(){l(t)}).catch(function(e){d(e)})})},e.loadExternalResourceAuth1=function(t,n,s,i,c,l,d,u){return a(this,0[0],0[0],function(){var a;return r(this,function(r){switch(r.label){case 0:return[4,i(t)];case 1:return(a=r.sent())?[4,t.getData(a)]:[3,6];case 2:return r.sent(),t.status!==o.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,s,c,l,d,u)];case 4:r.sent(),r.label=5;case 5:if(t.status===o.OK||t.status===o.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return r.sent(),t.status!==o.MOVED_TEMPORARILY&&t.status!==o.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,s,c,l,d,u)];case 8:r.sent(),r.label=9;case 9:if(t.status===o.OK||t.status===o.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,s,i,c,l,d){return a(this,0[0],0[0],function(){var a,u,h,m,f,p,g,v;return r(this,function(r){switch(r.label){case 0:return t.isAccessControlled()?((m=t.externalService)&&(m.options=t.options),(f=t.kioskService)&&(f.options=t.options),(p=t.clickThroughService)&&(p.options=t.options),(g=t.loginService)&&(g.options=t.options),t.isResponseHandled||t.status!==o.MOVED_TEMPORARILY?[3,2]:[4,l(t)]):[2,t];case 1:case 3:case 6:case 10:case 14:return r.sent(),[2,t];case 2:return a=null,u=null,(a=m)?(u=a,[4,e.attemptResourceWithToken(t,s,a)]):[3,4];case 4:return(a=f)?(u=a,(v=n(a))?[4,i(v)]:[3,7]):[3,7];case 5:case 9:case 13:return r.sent(),[4,e.attemptResourceWithToken(t,s,a)];case 7:return(a=p)?(u=a,[4,c(t,a)]):[3,11];case 8:return(h=r.sent())?[4,i(h)]:[3,11];case 11:return(a=g)?(u=a,[4,c(t,a)]):[3,15];case 12:return(h=r.sent())?[4,i(h)]:[3,15];case 15:return u&&d(t,u),[2]}})})},e.attemptResourceWithToken=function(e,t,n){return a(this,0[0],0[0],function(){var o,i;return r(this,function(a){switch(a.label){case 0:return(i=n.getService(s.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,i)]:[3,3];case 1:return(o=a.sent())&&o.accessToken?[4,e.getData(o)]:[3,3];case 2:return a.sent(),[2,e];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,s,o,i,a,r,c,l,d){return new Promise(function(u,h){var m=t.map(function(t){return e.loadExternalResourceAuth09(t,n,s,o,i,a,r,c,l,d)});Promise.all(m).then(function(){u(t)}).catch(function(e){h(e)})})},e.loadExternalResourceAuth09=function(t,n,s,i,a,r,c,l,d,u){return new Promise(function(h,m){u&&u.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(h(s(t)),h(i(t))):a(t).then(function(){r(t,!0).then(function(n){t.getData(n).then(function(){h(d(t))}).catch(function(t){m(e.createInternalServerError(t))})}).catch(function(t){m(e.createInternalServerError(t))})}).catch(function(t){m(e.createInternalServerError(t))}):h(t)}).catch(function(t){m(e.createInternalServerError(t))}):l(t,n).then(function(u){u?t.getData(u).then(function(){t.status===o.OK?h(d(t)):e.authorize(t,n,s,i,a,r,c,l).then(function(){h(d(t))}).catch(function(){m(e.createAuthorizationFailedError())})}).catch(function(){m(e.createAuthorizationFailedError())}):e.authorize(t,n,s,i,a,r,c,l).then(function(){h(d(t))}).catch(function(){m(e.createAuthorizationFailedError())})}).catch(function(){m(e.createAuthorizationFailedError())})})},e.createError=function(e,t){var n=new Error;return n.message=t,n.name=String(e),n},e.createAuthorizationFailedError=function(){return e.createError(i.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(i.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(i.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,s,i,a,r,c,l){return new Promise(function(d,u){t.getData().then(function(){t.isAccessControlled()?l(t,n).then(function(l){l?t.getData(l).then(function(){t.status===o.OK?d(t):e.showAuthInteraction(t,n,s,i,a,r,c,d,u)}).catch(function(t){u(e.createInternalServerError(t))}):r(t,!1).then(function(l){l?c(t,l,n).then(function(){t.getData(l).then(function(){t.status===o.OK?d(t):e.showAuthInteraction(t,n,s,i,a,r,c,d,u)}).catch(function(t){u(e.createInternalServerError(t))})}).catch(function(t){u(e.createInternalServerError(t))}):e.showAuthInteraction(t,n,s,i,a,r,c,d,u)})}).catch(function(t){u(e.createInternalServerError(t))}):d(t)})})},e.showAuthInteraction=function(t,n,s,i,a,r,c,l,d){t.status!==o.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?s(t).then(function(){r(t,!0).then(function(s){c(t,s,n).then(function(){t.getData(s).then(function(){l(t)}).catch(function(t){d(e.createInternalServerError(t))})}).catch(function(t){d(e.createInternalServerError(t))})}).catch(function(t){d(e.createInternalServerError(t))})}):a(t).then(function(){r(t,!0).then(function(s){c(t,s,n).then(function(){t.getData(s).then(function(){l(t)}).catch(function(t){d(e.createInternalServerError(t))})}).catch(function(t){d(e.createInternalServerError(t))})}).catch(function(t){d(e.createInternalServerError(t))})}):l(t)},e.getService=function(e,t){for(var s,o=this.getServices(e),n=0;n<o.length;n++)if(s=o[n],s.getProfile()===t)return s;return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,s){if(t.hasOwnProperty(n)&&t[n]===s)return t;for(var i,o=0;o<Object.keys(t).length;o++)if("object"==typeof t[Object.keys(t)[o]]&&(i=e.traverseAndFind(t[Object.keys(t)[o]],n,s),i!=null))return i},e.getServices=function(t,n){var s,a,r,c,l=0[0]===n?{}:n,d=l.onlyService,m=0[0]!==d&&d,u=l.onlyServices,f=0[0]!==u&&u,h=l.skipParentResources,o=[];if((0[0]===h||!h)&&t&&t.options&&t.options.resource&&t.options.resource!==t&&o.push.apply(o,e.getServices(t.options.resource,{onlyServices:!0})),s=f?[]:(t.__jsonld||t).service||[],Array.isArray(s)||(s=[s]),m||s.push.apply(s,(t.__jsonld||t).services||[]),0===s.length)return o;for(a=0;a<s.length;a++)r=s[a],"string"==typeof r?(c=this.getResourceById(t.options.resource,r),c&&o.push(new i.Service(c.__jsonld||c,t.options))):o.push(new i.Service(r,t.options));return o},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n},e}(),t.Utils=c},72:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},107:function(e,t,n){"use strict";a=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.IIIFResource=0[0];var o,a,s=n(4799),i=n(3957),r=function(e){function t(t,n){var o,s=e.call(this,t,n)||this;return s.index=-1,s.isLoaded=!1,o={defaultLabel:"-",locale:"en-GB",resource:s,pessimisticAccessControl:!1},s.options=Object.assign(o,n),s}return a(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?s.PropertyValue.parse(e,this.options.locale):new s.PropertyValue([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?s.PropertyValue.parse(e,this.options.locale):new s.PropertyValue([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return s.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var t,n,e=this.getProperty("logo");if(!e){if(n=this.getProperty("provider"),!n)return null;t=n.find(function(e){return 0[0]!==e.logo}),e=t&&0[0]!==t.logo?t.logo:null}return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e?.id):null},t.prototype.getLicense=function(){return s.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getRights=function(){var e=this.getProperty("rights");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(i.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new s.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e,t=null,n=this.getProperty("requiredStatement");return n?(t=new s.LabelValuePair(this.options.locale)).parse(n):(e=this.getAttribution(),e&&e.length&&((t=new s.LabelValuePair(this.options.locale)).value=e)),t},t.prototype.isCollection=function(){return this.getIIIFResourceType()===i.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===i.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(t){if(e.isLoaded)t(e);else{var o,n=e.options;n.navDate=e.getNavDate(),o=e.__jsonld.id,o||(o=e.__jsonld["@id"]),s.Utils.loadManifest(o).then(function(o){e.parentLabel=e.getLabel().getValue(n.locale);var i=s.Deserialiser.parse(o,n);(e=Object.assign(e,i)).index=n.index,t(e)})}})},t}(s.ManifestResource);t.IIIFResource=r},212:function(e,t){"use strict";var n,s,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)});Object.defineProperty(t,"__esModule",{value:!0}),t.LanguageMap=0[0],s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.getValue=function(e,t){return e.getValue(t,"<br/>")},t.getValues=function(e,t){return e.getValues(t)},t}(Array),t.LanguageMap=s},258:function(e,t,n){"use strict";i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=0[0];var s,i,o=n(4799),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){if(e=[],!this.__jsonld.resources)return e;for(t=0;t<this.__jsonld.resources.length;t++){var e,t,n=this.__jsonld.resources[t],s=new o.Annotation(n,this.options);e.push(s)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?o.Utils.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(o.ManifestResource);t.Resource=a},346:e=>{e.exports=function(e){return e!=null&&"object"==typeof e}},659:(e,t,n)=>{var o=n(1873),i=Object.prototype,a=i.hasOwnProperty,r=i.toString,s=o?o.toStringTag:0[0];e.exports=function(e){var t,n,o=a.call(e,s),i=e[s];try{e[s]=0[0],t=!0}catch{}return n=r.call(e),t&&(o?e[s]=i:delete e[s]),n}},672:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},916:(e,t,n)=>{e.exports=self.fetch||(self.fetch=n(6782).default||n(6782))},1858:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Duration=0[0];var n=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}();t.Duration=n},1873:(e,t,n)=>{var s=n(9325).Symbol;e.exports=s},2006:function(e,t,n){"use strict";i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyValue=t.LocalizedValue=0[0];var o,i,r,a=n(41),s=function(){function e(e,t,n){0[0]===n&&(n="none"),Array.isArray(e)&&1===e.length?this._value=e[0]:this._value=e,"none"!==t&&"@none"!==t||(t=0[0]),this._locale=t,this._defaultLocale=n}return e.parseV2Value=function(t,n){return"string"==typeof t?new e(t,0[0],n):t["@value"]?new e(t["@value"],t["@language"],n):null},Object.defineProperty(e.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return 0[0]===this._locale?this._defaultLocale:this._locale},enumerable:!1,configurable:!0}),e.prototype.addValue=function(e){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(e)?this._value=this._value.concat(e):this._value.push(e)},e}();t.LocalizedValue=s,r=function(e){function t(n,s){0[0]===n&&(n=[]);var o=e.apply(this,n)||this;return o.__proto__=t.prototype,o._defaultLocale=s,o}return i(t,e),t.parse=function(e,n){if(!e)return new t([],n);if(Array.isArray(e)){var o,i=(o=e.map(function(e){return s.parseV2Value(e,n)}).filter(function(e){return null!==e})).reduce(function(e,t){var n=t._locale;return n||(n="none"),e[n]?e[n].addValue(t._value):e[n]=t,e},{});return new t(Object.values(i),n)}return"string"==typeof e?new t([new s(e,0[0],n)],n):e["@language"]||e["@value"]?new t(null!==(o=s.parseV2Value(e))?[o]:[],n):new t(Object.keys(e).map(function(t){var o=e[t];if(!Array.isArray(o))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new s(o,t,n)}),n)},t.prototype.getSuitableLocale=function(e){for(var n,o,i=Array.from(this.values()).map(function(e){return e._locale}).filter(function(e){return 0[0]!==e}),l=function(e){var t=i.find(function(t){return t===e});if(t)return{value:t}},t=0,r=e;t<r.length;t++)if(n=l(r[t]),"object"==typeof n)return n.value;for(var d=function(e){var t=i.find(function(t){return a.Utils.getInexactLocale(t)===a.Utils.getInexactLocale(e)});if(t)return{value:t}},s=0,c=e;s<c.length;s++)if(o=d(c[s]),"object"==typeof o)return o.value},t.prototype.setValue=function(e,t){var o,n=0[0];t?(o=this.getSuitableLocale([t]),o&&(n=this.find(function(e){return e._locale===o}))):n=this.find(function(e){return 0[0]===e._locale}),n?n._value=e:this.push(new s(e,t,this._defaultLocale))},t.prototype.getValue=function(e,t){var n=this.getValues(e);return 0===n.length?null:t?n.join(t):n[0]},t.prototype.getValues=function(e){if(!this.length)return[];if(o=e?Array.isArray(e)?e:[e]:[],1===this.length&&0[0]===this[0]._locale){var n,s,o,i,t=this[0]._value;return Array.isArray(t)?t:[t]}return s=this.getSuitableLocale(o),s?(t=this.find(function(e){return e._locale===s})._value,Array.isArray(t)?t:[t]):(i=!this.find(function(e){return 0[0]===e._locale}),i?(t=this[0]._value,Array.isArray(t)?t:[t]):(n=this.find(function(e){return 0[0]===e._locale}),n?Array.isArray(n._value)?n._value:[n._value]:[]))},t}(Array),t.PropertyValue=r},2184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2315:function(e,t,n){"use strict";a=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.ManifestResource=0[0];var i,a,s=n(4799),o=n(3957),r=function(e){function t(t,n){var s=e.call(this,t)||this;return s.options=n,s}return a(t,e),t.prototype.getIIIFResourceType=function(){return s.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?s.PropertyValue.parse(e,this.options.locale):new s.PropertyValue([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e,o,i,t=this.getProperty("metadata"),n=[];if(!t)return n;for(e=0;e<t.length;e++)i=t[e],o=new s.LabelValuePair(this.options.locale),o.parse(i),n.push(o);return n},t.prototype.getRendering=function(e){for(var n,s=this.getRenderings(),t=0;t<s.length;t++)if(n=s[t],n.getFormat()===e)return n;return null},t.prototype.getRenderings=function(){var e,t,o,n=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return n;Array.isArray(e)||(e=[e]);for(t=0;t<e.length;t++)o=e[t],n.push(new s.Rendering(o,this.options));return n},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");return t&&(e=new s.LabelValuePair(this.options.locale)).parse(t),e},t.prototype.getService=function(e){return s.Utils.getService(this,e)},t.prototype.getServices=function(){return s.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new s.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===o.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===o.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===o.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===o.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===o.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===o.IIIFResourceType.SEQUENCE},t}(s.JSONLDResource);t.ManifestResource=r},2339:function(e,t,n){"use strict";i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationBody=0[0];var s,i,o=n(4799),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?o.Utils.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?o.Utils.normaliseType(this.getProperty("type")):null},t.prototype.getValue=function(){return this.getProperty("value")},t.prototype.getLanguage=function(){return this.getProperty("language")},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(o.ManifestResource);t.AnnotationBody=a},2428:(e,t,n)=>{var s=n(7534),i=n(346),o=Object.prototype,a=o.hasOwnProperty,r=o.propertyIsEnumerable,c=s(function(){return arguments}())?s:function(e){return i(e)&&a.call(e,"callee")&&!r.call(e,"callee")};e.exports=c},2552:(e,t,n)=>{var s=n(1873),i=n(659),a=n(9350),o=s?s.toStringTag:0[0];e.exports=function(e){return e==null?0[0]===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?i(e):a(e)}},2639:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Size=0[0],t.Size=function(e,t){this.width=e,this.height=t}},2712:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2817:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelValuePair=0[0];var s=n(4799),o=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=s.PropertyValue.parse(this.resource.label,this.defaultLocale),this.value=s.PropertyValue.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(e){return null===this.label?null:(Array.isArray(e)&&!e.length&&(e=0[0]),this.label.getValue(e||this.defaultLocale))},e.prototype.setLabel=function(e){null===this.label&&(this.label=new s.PropertyValue([])),this.label.setValue(e,this.defaultLocale)},e.prototype.getValue=function(e,t){return 0[0]===t&&(t="<br/>"),null===this.value?null:(Array.isArray(e)&&!e.length&&(e=0[0]),this.value.getValue(e||this.defaultLocale,t))},e.prototype.getValues=function(e){return null===this.value?[]:(Array.isArray(e)&&!e.length&&(e=0[0]),this.value.getValues(e||this.defaultLocale))},e.prototype.setValue=function(e){null===this.value&&(this.value=new s.PropertyValue([])),this.value.setValue(e,this.defaultLocale)},e}();t.LabelValuePair=o},3039:function(e,t,n){"use strict";i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Annotation=0[0];var o,i,s=n(4799),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getBody=function(){var t,n,i,a,o=[],e=this.getProperty("body");if(e)if(Array.isArray(e))for(t=0;t<e.length;t++)if((n=e[t]).items)for(i=0;i<n.items.length;i++)a=n.items[i],o.push(new s.AnnotationBody(a,this.options));else o.push(new s.AnnotationBody(n,this.options));else if(e.items)for(t=0;t<e.items.length;t++)n=e.items[t],o.push(new s.AnnotationBody(n,this.options));else o.push(new s.AnnotationBody(e,this.options));return o},t.prototype.getMotivation=function(){return this.getProperty("motivation")||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new s.Resource(this.getProperty("resource"),this.options)},t}(s.ManifestResource);t.Annotation=a},3043:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ManifestType=0[0],function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(n||(t.ManifestType=n={}))},3120:(e,t,n)=>{var s=n(4528),o=n(5891);e.exports=function e(t,n,i,a,r){var c,l=-1,d=t.length;for(i||(i=o),r||(r=[]);++l<d;)c=t[l],n>0&&i(c)?n>1?e(c,n-1,i,a,r):s(r,c):a||(r[r.length]=c);return r}},3167:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3176:(e,t,n)=>{var s=n(3120),o=1/0;e.exports=function(e){return e!=null&&e.length?s(e,o):[]}},3435:function(e,t,n){"use strict";i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationList=0[0];var s,i,o=n(4799),a=function(e){function t(t,n,s){var o=e.call(this,n)||this;return o.label=t,o.options=s,o}return i(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new o.Annotation(t,e.options)})},t.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var s=e.__jsonld.id;s||(s=e.__jsonld["@id"]),o.Utils.loadManifest(s).then(function(n){e.__jsonld=n,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)}).catch(n)}})},t}(o.JSONLDResource);t.AnnotationList=a},3556:function(e,t,n){"use strict";o=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationPage=0[0];var s,o,i=n(4799),a=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t.prototype.getAnnotations=function(){var t,s,n=[],e=this.getProperty("items");if(!e||!Array.isArray(e))return n;for(t=0;t<e.length;t++)s=new i.Annotation(e[t],this.options),n.push(s);return n},t}(i.ManifestResource);t.AnnotationPage=a},3845:function(e,t,n){"use strict";i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Range=0[0];var o,i,s=n(4799),a=n(3957),r=function(e){function t(t,n){var s=e.call(this,t,n)||this;return s._ranges=null,s.canvases=null,s.items=[],s}return i(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){{for(var e,o,i,a,r,c,l,d,u,t=[],n=[],m=0,f=this.canvases;m<f.length;m++)if(r=f[m]){var h=r.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[0[0],r],v=h[1],g=h[2],p=h[3];v&&(t.push(parseFloat(g)),n.push(parseFloat(p)))}if(t.length&&n.length)return new s.Duration(Math.min.apply(Math,t),Math.max.apply(Math,n))}}else{t=[],n=[];for(c=0,u=i=this.getRanges();c<u.length;c++)(o=u[c].getDuration())&&(t.push(o.start),n.push(o.end));if(t.length&&n.length)return new s.Duration(Math.min.apply(Math,t),Math.max.apply(Math,n))}if(this.canvases&&this.canvases.length)for(e=0;e<this.canvases.length;e++)r=this.canvases[e],a=s.Utils.getTemporalComponent(r),a&&a.length>1&&(0===e&&(l=Number(a[0])),e===this.canvases.length-1&&(d=Number(a[1])));else{i=this.getRanges();for(e=0;e<i.length;e++)(o=i[e].getDuration())&&(0===e&&(l=o.start),e===i.length-1&&(d=o.end))}if(0[0]!==l&&0[0]!==d)return new s.Duration(l,d)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){var e=this.getProperty("viewingHint");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getTree=function(e){if(e.data=this,this.treeNode=e,t=this.getRanges(),t&&t.length)for(n=0;n<t.length;n++){var t,n,i=t[n],o=new s.TreeNode;e.addNode(o),this._parseTreeNode(o,i)}return s.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=t.getLabel().getValue(this.options.locale),e.data=t,e.data.type=s.Utils.normaliseType(s.TreeNodeType.RANGE),t.treeNode=e;var o,i,r,n=t.getRanges();if(n&&n.length)for(o=0;o<n.length;o++)i=n[o],i.getBehavior()!==a.Behavior.NO_NAV&&(r=new s.TreeNode,e.addNode(r),this._parseTreeNode(r,i))},t}(s.ManifestResource);t.Range=r},3957:(e,t)=>{"use strict";var n,s,o,i,a,r,c,l,d,u;Object.defineProperty(t,"__esModule",{value:!0}),t.ViewingHint=t.ViewingDirection=t.ServiceType=t.ServiceProfile=t.RenderingFormat=t.MediaType=t.IIIFResourceType=t.ExternalResourceType=t.Behavior=t.AnnotationMotivation=0[0],function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(n||(t.AnnotationMotivation=n={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(s||(t.Behavior=s={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(o||(t.ExternalResourceType=o={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(i||(t.IIIFResourceType=i={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GIRDER="image/vnd.kitware.girder",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG="audio/mpeg",e.MPEG_DASH="application/dash+xml",e.OBJ="model/obj",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WAV="audio/wav",e.WEBM="video/webm"}(a||(t.MediaType=a={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.ODT="application/vnd.oasis.opendocument.text",e.PDF="application/pdf"}(r||(t.RenderingFormat=r={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.DOWNLOAD_EXTENSIONS="http://universalviewer.io/download-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(c||(t.ServiceProfile=c={})),function(e){e.IMAGE_SERVICE_2="ImageService2",e.IMAGE_SERVICE_3="ImageService3"}(l||(t.ServiceType=l={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(d||(t.ViewingDirection=d={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(u||(t.ViewingHint=u={}))},4029:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deserialiser=0[0];var s=n(4799),o=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var n;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":n=this.parseCollection(e,t);break;case"Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},e.parseCollection=function(e,t){var n=new s.Collection(e,t);return t?(n.index=t.index||0,t.resource&&(n.parentCollection=t.resource.parentCollection)):n.index=0,this.parseCollections(n,t),this.parseManifests(n,t),this.parseItems(n,t),n},e.parseCollections=function(e,t){if(e.__jsonld.collections?n=e.__jsonld.collections:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"collection"===e.type.toLowerCase()})),n)for(var n,o,s=0;s<n.length;s++)t&&(t.index=s),o=this.parseCollection(n[s],t),o.index=s,o.parentCollection=e,e.items.push(o)},e.parseManifest=function(e,t){return new s.Manifest(e,t)},e.parseManifests=function(e,t){if(e.__jsonld.manifests?n=e.__jsonld.manifests:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"manifest"===e.type.toLowerCase()})),n)for(var n,o,s=0;s<n.length;s++)o=this.parseManifest(n[s],t),o.index=s,o.parentCollection=e,e.items.push(o)},e.parseItem=function(e,t){if(e["@type"]){{if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){if(n=e.__jsonld.members||e.__jsonld.items,n)for(var n,o,i=function(s){t&&(t.index=s);var o=a.parseItem(n[s],t);return o?e.items.filter(function(e){return e.id===o.id})[0]?"continue":(o.index=s,o.parentCollection=e,void e.items.push(o)):{value:0[0]}},a=this,s=0;s<n.length;s++)if(o=i(s),"object"==typeof o)return o.value},e}();t.Deserialiser=o},4204:function(e,t,n){"use strict";var s,o,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Thumbnail=0[0],o=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t}(n(4799).Resource),t.Thumbnail=o},4528:e=>{e.exports=function(e,t){for(var n=-1,s=t.length,o=e.length;++n<s;)e[o+n]=t[n];return e}},4531:function(e,t,n){"use strict";a=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Manifest=0[0];var o,a,i=n(3957),s=n(4799),r=function(e){function t(t,n){if(s=e.call(this,t,n)||this,s.index=0,s._allRanges=null,s.items=[],s._topRanges=[],s.__jsonld.structures&&s.__jsonld.structures.length)for(var s,a,i=s._getTopRanges(),o=0;o<i.length;o++)a=i[o],s._parseRanges(a,String(o));return s}return a(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new s.Canvas(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new s.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var t,n,s,e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(t=0;t<this.__jsonld.structures.length;t++)n=this.__jsonld.structures[t],n.viewingHint===i.ViewingHint.TOP&&e.push(n);e.length||(s={},s.ranges=this.__jsonld.structures,e.push(s))}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t,n=0;n<this.__jsonld.structures.length;n++)if(t=this.__jsonld.structures[n],t["@id"]===e||t.id===e)return t;return null},t.prototype._parseRanges=function(e,t,n){var o,i,a,r,l,c=null;if("string"==typeof e&&(c=e,e=this._getRangeById(c)),e){if(i=new s.Range(e,this.options),i.parentRange=n,i.path=t,n?n.items.push(i):this._topRanges.push(i),r=e.items||e.members,r)for(a=0;a<r.length;a++)o=r[a],o["@type"]&&"sc:range"===o["@type"].toLowerCase()||o.type&&"range"===o.type.toLowerCase()?this._parseRanges(o,t+"/"+a,i):(o["@type"]&&"sc:canvas"===o["@type"].toLowerCase()||o.type&&"canvas"===o.type.toLowerCase())&&(i.canvases||(i.canvases=[]),l=o.id||o["@id"],i.canvases.push(l));else if(e.ranges)for(a=0;a<e.ranges.length;a++)this._parseRanges(e.ranges[a],t+"/"+a,i)}else console.warn("Range:",c,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var n=this.getTopRanges(),s=function(t){s=n[t],s.id&&e._allRanges.push(s);var s,o=function(e,t){e.add(t);var n=t.getRanges();return n.length?n.reduce(o,e):e},i=Array.from(s.getRanges().reduce(o,new Set));e._allRanges=e._allRanges.concat(i)},e=this,t=0;t<n.length;t++)s(t);return this._allRanges},t.prototype.getRangeById=function(e){for(var n,s=this.getAllRanges(),t=0;t<s.length;t++)if(n=s[t],n.id===e)return n;return null},t.prototype.getRangeByPath=function(e){for(var n,s=this.getAllRanges(),t=0;t<s.length;t++)if(n=s[t],n.path===e)return n;return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;if(e=this.__jsonld.mediaSequences||this.__jsonld.sequences,e)for(t=0;t<e.length;t++){var e,t,o=e[t],n=new s.Sequence(o,this.options);this.items.push(n)}else this.__jsonld.items&&(n=new s.Sequence(this.__jsonld.items,this.options),this.items.push(n));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(i.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):s.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e,t=this.getViewingHint();return t?t===i.ViewingHint.PAGED:(e=this.getBehavior(),!!e&&e===i.Behavior.PAGED)},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){var e=this.getProperty("viewingHint");return Array.isArray(e)&&(e=e[0]),e||null},t}(s.IIIFResource);t.Manifest=r},4591:function(e,t,n){"use strict";a=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Sequence=0[0];var o,a,i=n(3957),s=n(4799),r=function(e){function t(t,n){var s=e.call(this,t,n)||this;return s.items=[],s._thumbnails=null,s}return a(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e,t,n,o=this.__jsonld.canvases||this.__jsonld.elements;if(o)for(e=0;e<o.length;e++)t=o[e],(n=new s.Canvas(t,this.options)).index=e,this.items.push(n);else if(this.__jsonld)for(e=0;e<this.__jsonld.length;e++)t=this.__jsonld[e],(n=new s.Canvas(t,this.options)).index=e,this.items.push(n);return this.items},t.prototype.getCanvasById=function(e){for(t=0;t<this.getTotalCanvases();t++){var t,n=this.getCanvasByIndex(t),o=s.Utils.normaliseUrl(n.id);if(s.Utils.normaliseUrl(e)===o)return n}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var s,o,i,a,r=/(\d*)\D+(\d*)/,n=0;n<this.getTotalCanvases();n++){if(o=this.getCanvasByIndex(n),o.getLabel().getValue(this.options.locale)===e)return n;if((s=r.exec(e))&&(i=s[1],(a=s[2])&&new RegExp("^"+i+"\\D+"+a+"$").test(o.getLabel().toString())))return n}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t,n=this.getTotalCanvases()-1;n>=0;n--)if(t=this.getCanvasByIndex(n).getLabel().getValue(this.options.locale),e){if(/^[a-zA-Z0-9]*$/.test(t))return t}else if(t)return t;return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){if(t){var n,s=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===i.ViewingDirection.RIGHT_TO_LEFT?s[0]+1:s[s.length-1]+1}else n=e+1;return n>this.getLastPageIndex()?-1:n},t.prototype.getPagedIndices=function(e,t){var s,n=[];return t?(n=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e],s=this.getViewingDirection(),s&&s===i.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())):n.push(e),n},t.prototype.getPrevPageIndex=function(e,t){if(t){var n,s=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===i.ViewingDirection.RIGHT_TO_LEFT?s[s.length-1]-1:s[0]-1}else n=e-1;return n},t.prototype.getStartCanvasIndex=function(){var e,t=this.getStartCanvas();if(t)for(e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return 0},t.prototype.getThumbs=function(e){for(var i,a,o=[],r=this.getTotalCanvases(),n=0;n<r;n++)i=this.getCanvasByIndex(n),a=new s.Thumb(e,i),o.push(a);return o},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var t,n=this.getCanvases(),e=0;e<n.length;e++)t=n[e].getThumbnail(),t&&this._thumbnails.push(t);return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){var e=this.getProperty("viewingHint");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===i.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(s.ManifestResource);t.Sequence=r},4799:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,s){0[0]===s&&(s=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,o)}:function(e,t,n,s){0[0]===s&&(s=n),e[s]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(7436),t),s(n(2315),t),s(n(258),t),s(n(107),t),s(n(3039),t),s(n(2339),t),s(n(3435),t),s(n(3556),t),s(n(8098),t),s(n(8214),t),s(n(1858),t),s(n(2712),t),s(n(3167),t),s(n(672),t),s(n(7376),t),s(n(2184),t),s(n(6739),t),s(n(2817),t),s(n(72),t),s(n(212),t),s(n(2006),t),s(n(4531),t),s(n(3043),t),s(n(3845),t),s(n(6940),t),s(n(4591),t),s(n(4029),t),s(n(9579),t),s(n(2639),t),s(n(5633),t),s(n(9692),t),s(n(4204),t),s(n(8570),t),s(n(6386),t),s(n(41),t)},4840:(e,t,n)=>{var s="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=s},5633:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=0[0],function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(n||(t.StatusCode=n={}))},5891:(e,t,n)=>{var s=n(1873),i=n(2428),a=n(6449),o=s?s.isConcatSpreadable:0[0];e.exports=function(e){return a(e)||i(e)||!!(o&&e&&e[o])}},5970:(e,t,n)=>{var s=n(3120);e.exports=function(e){return e!=null&&e.length?s(e,1):[]}},6386:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNodeType=0[0],function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(n||(t.TreeNodeType=n={}))},6449:e=>{var t=Array.isArray;e.exports=t},6739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6782:(e,t,n)=>{"use strict";function s(e,t){return t=t||{},new Promise(function(n,s){var l,o=new XMLHttpRequest,a=[],r=[],i={},c=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:c,headers:{keys:function(){return a},entries:function(){return r},get:function(e){return i[e.toLowerCase()]},has:function(e){return e.toLowerCase()in i}}}};for(l in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){a.push(t=t.toLowerCase()),r.push([t,n]),i[t]=i[t]?i[t]+","+n:n}),n(c())},o.onerror=s,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(l,t.headers[l]);o.send(t.body||null)})}n.r(t),n.d(t,{default:()=>s})},6940:function(e,t,n){"use strict";var s,o,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Rendering=0[0],o=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(n(4799).ManifestResource),t.Rendering=o},7019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511},7376:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7436:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSONLDResource=0[0];var n=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}();t.JSONLDResource=n},7534:(e,t,n)=>{var s=n(2552),o=n(346);e.exports=function(e){return o(e)&&"[object Arguments]"==s(e)}},8098:function(e,t,n){"use strict";r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=0[0];var o,i,r,c=n(3957),s=n(4799),a=i(n(5970)),l=i(n(3176)),d=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.getCanonicalImageUri=function(e){var o,i,a,r,c,l,t=null,d="default",n=e,u=n+",";if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])t=this.externalResource.data["@id"],n||(n=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(d="native");else{if(i=0[0],(i=this.getImages())&&i.length)if(c=i[0].getResource(),a=c.getServices(),n||(n=c.getWidth()),r=a?a.find(function(e){return s.Utils.isImageProfile(e.getProfile())||s.Utils.isImageServiceType(e.getIIIFResourceType())}):null)t=r.id,d=s.Utils.getImageQuality(r.getProfile());else if(n===c.getWidth())return c.id;if((i=this.getContent())&&i.length)if(l=i[0].getBody()[0],a=l.getServices(),n||(n=l.getWidth()),r=a?a.find(function(e){return s.Utils.isImageServiceType(e.getIIIFResourceType())}):null)t=r.id,d=s.Utils.getImageQuality(r.getProfile());else if(n===l.getWidth())return l.id;if(!t&&(o=this.getProperty("thumbnail"),o)){if("string"==typeof o)return o;if(o["@id"])return o["@id"];if(o.length)return o[0].id}}return t&&t.endsWith("/")&&(t=t.substr(0,t.length-1)),[t,"full",u,0,d+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(e){var t;return null!==(t=e.maxWidth)&&0[0]!==t?t:e.maxwidth})[0])&&(t=new s.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var t,n,i,a,e=[],o=this.__jsonld.items||this.__jsonld.content;if(!o)return e;if(t=null,o.length&&(t=new s.AnnotationPage(o[0],this.options)),!t)return e;for(i=t.getAnnotations(),n=0;n<i.length;n++)a=i[n],e.push(a);return e},t.prototype.getAnnotations=function(){var t,o,n=[],e=this.__jsonld.annotations;if(!e||!Array.isArray(e))return n;for(t=0;t<e.length;t++)o=new s.AnnotationPage(e[t],this.options),n.push(o);return n},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){if(e=[],!this.__jsonld.images)return e;for(t=0;t<this.__jsonld.images.length;t++){var e,t,n=this.__jsonld.images[t],o=new s.Annotation(n,this.options);e.push(o)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(e){return e&&"string"==typeof(t=e["@type"])&&t.toLowerCase()==t.toLowerCase();var t}).map(function(t,n){return new s.AnnotationList(t.label||"Annotation list ".concat(n),t,e.options)}).map(function(e){return e.load()});return Promise.all(t)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){var e=this.getProperty("viewingHint");return Array.isArray(e)&&(e=e[0]),e||null},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,n=(0,l.default)([this.getImages().map(function(e){return e.getResource()}),this.getContent().map(function(e){return e.getBody()})]);return(0,a.default)(n.map(function(n){switch(n.getProperty("type").toLowerCase()){case c.ExternalResourceType.CHOICE:case c.ExternalResourceType.OA_CHOICE:return new t({images:(0,a.default)([n.getProperty("default"),n.getProperty("item")]).map(function(e){return{resource:e}})},e.options).getImages().map(function(e){return e.getResource()});default:return n}}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return(0,l.default)([this.getImages(),this.getContent()])},enumerable:!1,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find(function(t){return t.getResource().id===e||(0,a.default)(new Array(t.getBody())).some(function(t){return t.id===e})})},t.prototype.onFragment=function(e){if(t=this.resourceAnnotation(e),t){var t,n,s=t.getProperty("on"),o=t.getProperty("target");if(s&&o&&(n=(s||o).match(/xywh=(.*)$/),n))return n[1].split(",").map(function(e){return parseInt(e,10)})}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter(function(e){return e&&e.getServices()[0]&&e.getServices()[0].id})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map(function(e){return e.getServices()[0].id})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!1,configurable:!0}),t}(s.Resource);t.Canvas=d},8156:function(e,t,n){"use strict";var s,o=this&&this.__createBinding||(Object.create?function(e,t,n,s){0[0]===s&&(s=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,o)}:function(e,t,n,s){0[0]===s&&(s=n),e[s]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.parseManifest=t.loadManifest=0[0],i(n(4799),t),s=n(41),t.loadManifest=function(e){return s.Utils.loadManifest(e)},t.parseManifest=function(e,t){return s.Utils.parseManifest(e,t)}},8214:function(e,t,n){"use strict";i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Collection=0[0];var o,i,a=n(3957),s=n(4799),r=function(e){function t(t,n){var s=e.call(this,t,n)||this;return s.items=[],s._collections=null,s._manifests=null,t.__collection=s,s}return i(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var t,s,o=this.getCollections(),n=0;n<o.length;n++)s=o[n],s.index===e&&(t=s);if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,s,o=this.getManifests(),n=0;n<o.length;n++)s=o[n],s.index===e&&(t=s);if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):a.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){var e=this.getProperty("viewingHint");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(t=0;t<e.getManifests().length;t++){var t,n=e.getManifests()[t],o=n.getDefaultTree();o.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"manifest "+(t+1),o.navDate=n.getNavDate(),o.data.id=n.id,o.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),e.defaultTree.addNode(o)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(t=0;t<e.getCollections().length;t++){var t,n=e.getCollections()[t],o=n.getDefaultTree();o.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"collection "+(t+1),o.navDate=n.getNavDate(),o.data.id=n.id,o.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),e.defaultTree.addNode(o)}},t}(s.IIIFResource);t.Collection=r},8570:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNode=0[0];var s=n(4799),o=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===s.Utils.normaliseType(s.TreeNodeType.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===s.Utils.normaliseType(s.TreeNodeType.MANIFEST)},e.prototype.isRange=function(){return this.data.type===s.Utils.normaliseType(s.TreeNodeType.RANGE)},e}();t.TreeNode=o},9325:(e,t,n)=>{var s=n(4840),o="object"==typeof self&&self&&self.Object===Object&&self,i=s||o||Function("return this")();e.exports=i},9350:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},9579:function(e,t,n){"use strict";i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Object.defineProperty(t,"__esModule",{value:!0}),t.Service=0[0];var o,i,s=n(4799),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return s.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return s.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return s.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return s.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return s.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return s.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},t}(s.ManifestResource);t.Service=a},9692:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Thumb=0[0],t.Thumb=function(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();this.height=n?Math.floor(this.width*n):e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel().getValue(),this.viewingHint=t.getViewingHint()}}},t={};function e(s){var o,i=t[s];return 0[0]!==i?i.exports:(o=t[s]={exports:{}},n[s].call(o.exports,o,o.exports,e),o.exports)}return e.d=(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch{if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e(8156)})())}}),q0=Uo(iu()),tn=Uo(iu(),1),G0=Object.defineProperty,w2=(e,t,n)=>t in e?G0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Kd=(e,t,n)=>w2(e,typeof t!="symbol"?t+"":t,n),Wd=Object.prototype.hasOwnProperty;function hn(e,t){if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((s=e.length)===t.length)for(var n,s;s--&&hn(e[s],t[s]););return s===-1}if(!n||typeof e=="object"){s=0;for(n in e)if(Wd.call(e,n)&&++s&&!Wd.call(t,n)||!(n in t)||!hn(e[n],t[n]))return!1;return Object.keys(t).length===s}}return e!==e&&t!==t}$d=(e=>(e.EDIT="EDIT",e.SELECT="SELECT",e.NONE="NONE",e))($d||{}),O2=[];for(let e=0;e<256;++e)O2.push((e+256).toString(16).slice(1));e7=new Uint8Array(16),X5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ti=e=>{const t=e=>{const t={...e};return e.created&&typeof e.created=="string"&&(t.created=new Date(e.created)),e.updated&&typeof e.updated=="string"&&(t.updated=new Date(e.updated)),t};return{...e,bodies:(e.bodies||[]).map(t),target:t(e.target)}},R2=(e,t)=>{const n=new Set(e.bodies.map(e=>e.id));return t.bodies.filter(e=>!n.has(e.id))},q2=(e,t)=>{const n=new Set(t.bodies.map(e=>e.id));return e.bodies.filter(e=>!n.has(e.id))},Y2=(e,t)=>t.bodies.map(t=>{const n=e.bodies.find(e=>e.id===t.id);return{newBody:t,oldBody:n&&!hn(n,t)?n:0[0]}}).filter(({oldBody:e})=>e).map(({oldBody:e,newBody:t})=>({oldBody:e,newBody:t})),G2=(e,t)=>!hn(e.target,t.target),Q2=(e,t)=>{const n=R2(e,t),s=q2(e,t),o=Y2(e,t);return{oldValue:e,newValue:t,bodiesCreated:n.length>0?n:0[0],bodiesDeleted:s.length>0?s:0[0],bodiesUpdated:o.length>0?o:0[0],targetUpdated:G2(e,t)?{oldTarget:e.target,newTarget:t.target}:0[0]}},Ge=(e=>(e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.SILENT="SILENT",e))(Ge||{}),h3=(e,t)=>{const n=new Set((e.created||[]).map(e=>e.id)),i=new Set((e.updated||[]).map(({newValue:e})=>e.id)),a=new Set((t.created||[]).map(e=>e.id)),s=new Set((t.deleted||[]).map(e=>e.id)),o=new Set((t.updated||[]).map(({oldValue:e})=>e.id)),r=new Set((t.updated||[]).filter(({oldValue:e})=>n.has(e.id)||i.has(e.id)).map(({oldValue:e})=>e.id)),c=[...(e.created||[]).filter(e=>!s.has(e.id)).map(e=>o.has(e.id)?t.updated.find(({oldValue:t})=>t.id===e.id).newValue:e),...t.created||[]],l=[...(e.deleted||[]).filter(e=>!a.has(e.id)),...(t.deleted||[]).filter(e=>!n.has(e.id))],d=[...(e.updated||[]).filter(({newValue:e})=>!s.has(e.id)).map(e=>{const{oldValue:s,newValue:n}=e;if(o.has(n.id)){const e=t.updated.find(e=>e.oldValue.id===n.id).newValue;return Q2(s,e)}return e}),...(t.updated||[]).filter(({oldValue:e})=>!r.has(e.id))];return{created:c,deleted:l,updated:d}},p3=()=>({emit(e,...t){for(let s=this.events[e]||[],n=0,o=s.length;n<o;n++)s[n](...t)},events:{},on(e,t){var n;return((n=this.events)[e]||(n[e]=[])).push(t),()=>{var n;this.events[e]=(n=this.events[e])==null?0[0]:n.filter(e=>t!==e)}}}),g3=250,O3=(e,t)=>{const i=p3(),n=t?.changes||[];let s=t?t.pointer:-1,o=!1,a=0;const r=e=>{if(!o){const{changes:t}=e,o=performance.now();if(o-a>g3)n.splice(s+1),n.push(t),s=n.length-1;else{const e=n.length-1;n[e]=h3(n[e],t)}a=o}o=!1};e.observe(r,{origin:Ge.LOCAL});const c=t=>t&&t.length>0&&e.bulkDeleteAnnotations(t),l=t=>t&&t.length>0&&e.bulkAddAnnotations(t,!1),d=t=>t&&t.length>0&&e.bulkUpdateAnnotations(t.map(({oldValue:e})=>e)),u=t=>t&&t.length>0&&e.bulkUpdateAnnotations(t.map(({newValue:e})=>e)),h=t=>t&&t.length>0&&e.bulkAddAnnotations(t,!1),m=t=>t&&t.length>0&&e.bulkDeleteAnnotations(t);return{canRedo:()=>n.length-1>s,canUndo:()=>s>-1,destroy:()=>e.unobserve(r),getHistory:()=>({changes:[...n],pointer:s}),on:(e,t)=>i.on(e,t),redo:()=>{if(n.length-1>s){o=!0;const{created:e,updated:t,deleted:a}=n[s+1];l(e),u(t),m(a),i.emit("redo",n[s+1]),s+=1}},undo:()=>{if(s>-1){o=!0;const{created:e,updated:t,deleted:a}=n[s];c(e),d(t),h(a),i.emit("undo",n[s]),s-=1}}}},C3=(e,t,n,s)=>{const{hover:m,selection:u,store:a,viewport:d}=e,c=new Map;let o=[],r,l;const f=(e,t)=>{c.has(e)?c.get(e).push(t):c.set(e,[t])},p=(e,t)=>{const n=c.get(e);if(n){const e=n.indexOf(t);e!==-1&&n.splice(e,1)}},i=(e,t,s)=>{c.has(e)&&setTimeout(()=>{c.get(e).forEach(e=>{if(n){const o=Array.isArray(t)?t.map(e=>n.serialize(e)):n.serialize(t),i=s?s instanceof PointerEvent?s:n.serialize(s):0[0];e(o,i)}else e(t,s)})},1)},g=()=>{const{selected:t}=u,e=(t||[]).map(({id:e})=>a.getAnnotation(e));e.forEach(e=>{const t=o.find(t=>t.id===e.id);(!t||!hn(t,e))&&i("updateAnnotation",e,t)}),o=o.map(t=>e.find(({id:e})=>e===t.id)||t)};u.subscribe(({selected:e})=>{if(o.length!==0||e.length!==0){if(o.length===0&&e.length>0)o=e.map(({id:e})=>a.getAnnotation(e));else if(o.length>0&&e.length===0)o.forEach(e=>{const t=a.getAnnotation(e.id);t&&!hn(t,e)&&i("updateAnnotation",t,e)}),o=[];else{const n=new Set(o.map(e=>e.id)),t=new Set(e.map(({id:e})=>e));o.filter(e=>!t.has(e.id)).forEach(e=>{const t=a.getAnnotation(e.id);t&&!hn(t,e)&&i("updateAnnotation",t,e)}),o=[...o.filter(e=>t.has(e.id)),...e.filter(({id:e})=>!n.has(e)).map(({id:e})=>a.getAnnotation(e))]}i("selectionChanged",o)}}),m.subscribe(e=>{!r&&e?i("mouseEnterAnnotation",a.getAnnotation(e)):r&&!e?i("mouseLeaveAnnotation",a.getAnnotation(r)):r&&e&&(i("mouseLeaveAnnotation",a.getAnnotation(r)),i("mouseEnterAnnotation",a.getAnnotation(e))),r=e}),d==null||d.subscribe(e=>i("viewportIntersect",e.map(e=>a.getAnnotation(e)))),a.observe(e=>{s&&(l&&clearTimeout(l),l=setTimeout(g,1e3));const{created:t,deleted:n}=e.changes;(t||[]).forEach(e=>i("createAnnotation",e)),(n||[]).forEach(e=>i("deleteAnnotation",e)),(e.changes.updated||[]).filter(e=>[...e.bodiesCreated||[],...e.bodiesDeleted||[],...e.bodiesUpdated||[]].length>0).forEach(({oldValue:e,newValue:t})=>{const n=o.find(t=>t.id===e.id)||e;o=o.map(n=>n.id===e.id?t:n),i("updateAnnotation",t,n)})},{origin:Ge.LOCAL}),a.observe(e=>{if(o){const n=new Set(o.map(e=>e.id)),t=(e.changes.updated||[]).filter(({newValue:e})=>n.has(e.id)).map(({newValue:e})=>e);t.length>0&&(o=o.map(e=>t.find(t=>t.id===e.id)||e))}},{origin:Ge.REMOTE});const h=e=>t=>{const{updated:n}=t;e?(n||[]).forEach(e=>i("updateAnnotation",e.oldValue,e.newValue)):(n||[]).forEach(e=>i("updateAnnotation",e.newValue,e.oldValue))};return t.on("undo",h(!0)),t.on("redo",h(!1)),{on:f,off:p,emit:i}},P3=e=>t=>t.reduce((t,n)=>{const{parsed:s,error:o}=e.parse(n);return o?{parsed:t.parsed,failed:[...t.failed,n]}:s?{parsed:[...t.parsed,s],failed:t.failed}:{...t}},{parsed:[],failed:[]}),U3=(e,t,n)=>{const{store:s,selection:o}=e,m=e=>{if(n){const{parsed:t,error:o}=n.parse(e);t?s.addAnnotation(t,Ge.REMOTE):console.error(o)}else s.addAnnotation(ti(e),Ge.REMOTE)},l=()=>o.clear(),r=()=>s.clear(),c=e=>{const t=s.getAnnotation(e);return n&&t?n.serialize(t):t},a=()=>n?s.all().map(n.serialize):s.all(),d=()=>{var e;const t=(((e=o.selected)==null?0[0]:e.map(e=>e.id))||[]).map(e=>s.getAnnotation(e)).filter(Boolean);return n?t.map(n.serialize):t},u=(e,t=!0)=>fetch(e).then(e=>e.json()).then(e=>(i(e,t),e)),h=e=>{if(typeof e=="string"){{const t=s.getAnnotation(e);if(s.deleteAnnotation(e),t)return n?n.serialize(t):t}}else{const t=n?n.parse(e).parsed:e;if(t)return s.deleteAnnotation(t),e}},i=(e,t=!0)=>{if(n){const i=n.parseAll||P3(n),{parsed:a,failed:o}=i(e);o.length>0&&console.warn(`Discarded ${o.length} invalid annotations`,o),s.bulkAddAnnotations(a,t,Ge.REMOTE)}else s.bulkAddAnnotations(e.map(ti),t,Ge.REMOTE)},f=(e,t)=>{e?o.setSelected(e,t):o.clear()},p=e=>{o.setUserSelectAction(e)},g=e=>{if(n){const t=n.parse(e).parsed,o=n.serialize(s.getAnnotation(t.id));return s.updateAnnotation(t),o}const t=s.getAnnotation(e.id);return s.updateAnnotation(ti(e)),t};return{addAnnotation:m,cancelSelected:l,canRedo:t.canRedo,canUndo:t.canUndo,clearAnnotations:r,getAnnotationById:c,getAnnotations:a,getHistory:t.getHistory,getSelected:d,loadAnnotations:u,redo:t.redo,removeAnnotation:h,setAnnotations:i,setSelected:f,setUserSelectAction:p,undo:t.undo,updateAnnotation:g}},J3="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",oh=e=>crypto.getRandomValues(new Uint8Array(e)),ah=(e,t,n)=>{let s=(2<<Math.log2(e.length-1))-1,o=-~(1.6*s*t/e.length);return(i=t)=>{let a="";for(;;){let r=n(o),t=o|0;for(;t--;)if(a+=e[r[t]&s]||"",a.length>=i)return a}}},rh=(e,t=21)=>ah(e,t|0,oh),dh=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=J3[n[e]&63];return t},uh=()=>({isGuest:!0,id:rh("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()}),dh(),hh=Object.defineProperty,_h=(e,t,n)=>t in e?hh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,td=(e,t,n)=>_h(e,typeof t!="symbol"?t+"":t,n);function Ae(){}function Yl(e,t){for(const n in t)e[n]=t[n];return e}function wh(e){return e()}function xh(){return Object.create(null)}function _e(e){e.forEach(wh)}function H(e){return typeof e=="function"}function zt(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function s5(e){return Object.keys(e).length===0}function t5(e,t,n,s){if(e){const o=Mh(e,t,n,s);return e[0](o)}}function Mh(e,t,n,s){return e[1]&&s?Yl(n.ctx.slice(),e[1](s(t))):n.ctx}function qg(e,t,n,s){if(e[2]&&s){const o=e[2](s(n));if(t.dirty===0[0])return o;if(typeof o=="object"){const e=[],n=Math.max(t.dirty.length,o.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|o[s];return e}return t.dirty|o}return t.dirty}function Kg(e,t,n,s,o,i){if(o){const a=Mh(t,n,s,i);e.p(a,o)}}function Rg(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function Kh(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function Zh(e){return e??""}function x(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function l(e){e.parentNode&&e.parentNode.removeChild(e)}function Ei(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function r(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Jh(e){return document.createTextNode(e)}function ie(){return Jh(" ")}function Qn(){return Jh("")}function _(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function e(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Fg(e){return Array.from(e.childNodes)}function tm(e,t,n){e.classList.toggle(t,!!n)}function Ag(e,t,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:s})}function co(e){lo=e}function dm(){if(!lo)throw new Error("Function called outside component initialization");return lo}function Ti(e){dm().$$.on_mount.push(e)}function ro(){const e=dm();return(t,n,{cancelable:s=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=Ag(t,n,{cancelable:s});return o.slice().forEach(t=>{t.call(e,i)}),!i.defaultPrevented}return!0}}function Y(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(e=>e.call(this,t))}gn=[],il=[],Bt=[],el=[],Jc=Promise.resolve(),Pi=!1;function fm(){Pi||(Pi=!0,Jc.then(gm))}function pm(){return fm(),Jc}function Yc(e){Bt.push(e)}Ii=new Set,un=0;function gm(){if(un!==0)return;const e=lo;do{try{for(;un<gn.length;){const e=gn[un];un++,co(e),_g(e.$$)}}catch(e){throw gn.length=0,un=0,e}for(co(null),gn.length=0,un=0;il.length;)il.pop()();for(let e=0;e<Bt.length;e+=1){const t=Bt[e];Ii.has(t)||(Ii.add(t),t())}Bt.length=0}while(gn.length)for(;el.length;)el.pop()();Pi=!1,Ii.clear(),co(e)}function _g(e){if(e.fragment!==null){e.update(),_e(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Yc)}}function yg(e){const t=[],n=[];Bt.forEach(s=>e.indexOf(s)===-1?t.push(s):n.push(s)),n.forEach(e=>e()),Bt=t}eo=new Set;function _n(){vn={r:0,c:[],p:vn}}function bn(){vn.r||_e(vn.c),vn=vn.p}function w(e,t){e&&e.i&&(eo.delete(e),e.i(t))}function E(e,t,n,s){if(e&&e.o){if(eo.has(e))return;eo.add(e),vn.c.push(()=>{eo.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}else s&&s()}function kt(e){return e?.length!==0[0]?e:Array.from(e)}function ze(e){e&&e.c()}function me(e,t,n){const{fragment:s,after_update:o}=e.$$;s&&s.m(t,n),Yc(()=>{const t=e.$$.on_mount.map(wh).filter(H);e.$$.on_destroy?e.$$.on_destroy.push(...t):_e(t),e.$$.on_mount=[]}),o.forEach(Yc)}function fe(e,t){const n=e.$$;n.fragment!==null&&(yg(n.after_update),_e(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function gg(e,t){e.$$.dirty[0]===-1&&(gn.push(e),fm(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Mt(e,t,n,s,o,i,a=null,r=[-1]){const d=lo;co(e);const c=e.$$={fragment:null,ctx:[],props:i,update:Ae,not_equal:o,bound:xh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:xh(),dirty:r,skip_bound:!1,root:t.target||d.$$.root};a&&a(c.root);let u=!1;if(c.ctx=n?n(e,t.props||{},(t,n,...s)=>{const i=s.length?s[0]:n;return c.ctx&&o(c.ctx[t],c.ctx[t]=i)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](i),u&&gg(e,t)),n}):[],c.update(),u=!0,_e(c.before_update),c.fragment=!!s&&s(c.ctx),t.target){if(t.hydrate){const e=Fg(t.target);c.fragment&&c.fragment.l(e),e.forEach(l)}else c.fragment&&c.fragment.c();t.intro&&w(e.$$.fragment),me(e,t.target,t.anchor),gm()}co(d)}Je=class{constructor(){td(this,"$$"),td(this,"$$set")}$destroy(){fe(this,1),this.$destroy=Ae}$on(e,t){if(!H(t))return Ae;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);e!==-1&&n.splice(e,1)}}$set(e){this.$$set&&!s5(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}},Em="4",typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Em),f=(e=>(e.ELLIPSE="ELLIPSE",e.MULTIPOLYGON="MULTIPOLYGON",e.POLYGON="POLYGON",e.POLYLINE="POLYLINE",e.RECTANGLE="RECTANGLE",e.LINE="LINE",e))(f||{}),Am={exports:{}},function(e){(function(){function s(e,t){var n=e.x-t.x,s=e.y-t.y;return n*n+s*s}function o(e,t,n){var r,i=t.x,a=t.y,s=n.x-i,o=n.y-a;return(s!==0||o!==0)&&(r=((e.x-i)*s+(e.y-a)*o)/(s*s+o*o),r>1?(i=n.x,a=n.y):r>0&&(i+=s*r,a+=o*r)),s=e.x-i,o=e.y-a,s*s+o*o}function i(e,t){for(var n,o=e[0],i=[o],a=1,r=e.length;a<r;a++)n=e[a],s(n,o)>t&&(i.push(n),o=n);return o!==n&&i.push(n),i}function t(e,n,s,i,a){for(var r,d,l=i,c=n+1;c<s;c++)d=o(e[c],e[n],e[s]),d>l&&(r=c,l=d);l>i&&(r-n>1&&t(e,n,r,i,a),a.push(e[r]),s-r>1&&t(e,r,s,i,a))}function a(e,n){var o=e.length-1,s=[e[0]];return t(e,0,o,n,s),s.push(e[o]),s}function n(e,t,n){if(e.length<=2)return e;var s=t!==0[0]?t*t:1;return e=n?e:i(e,s),e=a(e,s),e}e.exports=n,e.exports.default=n})()}(Am),qi={},$t=(e,t)=>qi[e]=t,Zi=e=>qi[e.type].area(e),Im=(e,t,n,s)=>qi[e.type].intersects(e,t,n,s),ne=e=>{let t=1/0,n=1/0,s=-1/0,o=-1/0;return e.forEach(([e,i])=>{t=Math.min(t,e),n=Math.min(n,i),s=Math.max(s,e),o=Math.max(o,i)}),{minX:t,minY:n,maxX:s,maxY:o}},Xs=e=>{let n=0,t=e.length-1;for(let s=0;s<e.length;s++)n+=(e[t][0]+e[s][0])*(e[t][1]-e[s][1]),t=s;return Math.abs(.5*n)},Ys=(e,t,n)=>{let s=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const r=e[o][0],a=e[o][1],l=e[i][0],c=e[i][1];a>n!=c>n&&t<(l-r)*(n-a)/(c-a)+r&&(s=!s)}return s},Wm=(e,t=!0)=>{let n="M ";return e.forEach(([e,t],s)=>{s===0?n+=`${e},${t}`:n+=` L ${e},${t}`}),t&&(n+=" Z"),n},Ks=(e,t)=>{const n=Math.abs(t[0]-e[0]),s=Math.abs(t[1]-e[1]);return(n**2+s**2)**.5},qm={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:h,cy:m,rx:s,ry:o}=e.geometry,i=0,a=Math.cos(i),r=Math.sin(i),c=t-h,l=n-m,d=a*c+r*l,u=r*c-a*l;return d*d/(s*s)+u*u/(o*o)<=1}},$t(f.ELLIPSE,qm),Ym={area:e=>0,intersects:(e,t,n,s=2)=>{const[[o,i],[a,r]]=e.geometry.points,c=Math.abs((r-i)*t-(a-o)*n+a*i-r*o),l=Ks([o,i],[a,r]);return c/l<=s}},$t(f.LINE,Ym),p8={area:e=>{const{polygons:t}=e.geometry;return t.reduce((e,t)=>{const[n,...s]=t.rings,o=Xs(n.points),i=s.reduce((e,t)=>e+Xs(t.points),0);return e+o-i},0)},intersects:(e,t,n)=>{const{polygons:s}=e.geometry;for(const e of s){const[o,...i]=e.rings;if(Ys(o.points,t,n)){let e=!1;for(const s of i)if(Ys(s.points,t,n)){e=!0;break}if(!e)return!0}}return!1}},ma=e=>{const t=e.reduce((e,t)=>[...e,...t.rings[0].points],[]);return ne(t)},Ie=e=>e.rings.map(e=>Wm(e.points)).join(" "),_8=e=>e.polygons.reduce((e,t)=>[...e,...t.rings.reduce((e,t)=>[...e,...t.points],[])],[]),$t(f.MULTIPOLYGON,p8),k8={area:e=>{const t=e.geometry.points;return Xs(t)},intersects:(e,t,n)=>{const s=e.geometry.points;return Ys(s,t,n)}},$t(f.POLYGON,k8),A8={area:e=>{const t=e.geometry;if(!t.closed||t.points.length<3)return 0;const n=_a(t.points,t.closed);return Xs(n)},intersects:(e,t,n,s=2)=>{const o=e.geometry;if(o.closed){const e=_a(o.points,o.closed);return Ys(e,t,n)}return S8(o,[t,n],s)}},_a=(e,t=!1)=>{const n=[];for(let o=0;o<e.length;o++){const s=e[o],i=e[(o+1)%e.length];if(n.push(s.point),(o<e.length-1||t)&&(s.type==="CURVE"||i.type=="CURVE")){const e=Ka(s.point,s.type==="CURVE"&&s.outHandle||s.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,10);n.push(...e.slice(1))}}return n},Ka=(e,t,n,s,o=10)=>{const i=[];for(let r=0;r<=o;r++){const a=r/o,c=(1-a)**3*e[0]+3*(1-a)**2*a*t[0]+3*(1-a)*a**2*n[0]+a**3*s[0],l=(1-a)**3*e[1]+3*(1-a)**2*a*t[1]+3*(1-a)*a**2*n[1]+a**3*s[1];i.push([c,l])}return i},S8=(e,t,n)=>{for(let i=0;i<e.points.length-1;i++){const s=e.points[i],o=e.points[i+1];if(s.type==="CURVE"||o.type==="CURVE"){{const e=Ka(s.point,s.type==="CURVE"&&s.outHandle||s.point,o.type==="CURVE"&&o.inHandle||o.point,o.point,20);for(let s=0;s<e.length-1;s++)if(nc(t,e[s],e[s+1])<=n)return!0}}else if(nc(t,s.point,o.point)<=n)return!0}return!1},nc=(e,t,n)=>{const[s,o]=e,[i,a]=t,[r,c]=n,d=r-i,u=c-a,l=(d*d+u*u)**.5;if(l===0)return((s-i)*(s-i)+(o-a)*(o-a))**.5;const h=((s-i)*d+(o-a)*u)/(l*l);return h<=0?((s-i)*(s-i)+(o-a)*(o-a))**.5:h>=1?((s-r)*(s-r)+(o-c)*(o-c))**.5:Math.abs((c-a)*s-(r-i)*o+r*a-c*i)/l},tc=e=>{if(!e.points||e.points.length===0)return"";const t=[],n=e.points[0];t.push(`M ${n.point[0]} ${n.point[1]}`);for(let s=1;s<e.points.length;s++){const n=e.points[s],o=e.points[s-1];if(n.type==="CURVE"||o.type==="CURVE"){const e=o.type==="CURVE"&&o.outHandle||o.point,s=n.type==="CURVE"&&n.inHandle||n.point,i=n.point;t.push(`C ${e[0]} ${e[1]} ${s[0]} ${s[1]} ${i[0]} ${i[1]}`)}else t.push(`L ${n.point[0]} ${n.point[1]}`)}if(e.closed){const s=e.points[e.points.length-1],n=e.points[0];if(s.type==="CURVE"||n.type==="CURVE"){const e=s.outHandle||s.point,o=n.inHandle||n.point,i=n.point;t.push(`C ${e[0]} ${e[1]} ${o[0]} ${o[1]} ${i[0]} ${i[1]}`)}t.push("Z")}return t.join(" ")},$t(f.POLYLINE,A8),H8={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h},$t(f.RECTANGLE,H8),ct=e=>Ns(e.target),Ns=e=>{var t,n;return e?.annotation!==0[0]&&((n=(t=e?.selector)==null?0[0]:t.geometry)==null?0[0]:n.bounds)!==0[0]},B8=(e,t=!1)=>{const a=typeof e=="string"?e:e.value,p=/(xywh)=(pixel|percent)?:?(.+?),(.+?),(.+?),(.+)*/g,m=[...a.matchAll(p)][0],[g,h,i,u,l,d,c]=m;if(h!=="xywh")throw new Error("Unsupported MediaFragment: "+a);if(i&&i!=="pixel")throw new Error(`Unsupported MediaFragment unit: ${i}`);const[o,n,r,s]=[u,l,d,c].map(parseFloat);return{type:f.RECTANGLE,geometry:{x:o,y:n,w:r,h:s,bounds:{minX:o,minY:t?n-s:n,maxX:o+r,maxY:t?n:n+s}}}},sf=e=>{const{x:t,y:n,w:s,h:o}=e;return{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=pixel:${t},${n},${s},${o}`}},Yr="http://www.w3.org/2000/svg",Kr=e=>{const t=e=>{Array.from(e.attributes).forEach(t=>{t.name.startsWith("on")&&e.removeAttribute(t.name)})},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach(e=>e.parentNode.removeChild(e)),Array.from(e.querySelectorAll("*")).forEach(t),e},pf=e=>{const t=(new XMLSerializer).serializeToString(e.documentElement).replace("<svg>",`<svg xmlns="${Yr}">`);return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement},Ts=e=>{const t=(new DOMParser).parseFromString(e,"image/svg+xml"),n=t.lookupPrefix(Yr),s=t.lookupNamespaceURI(null);return n||s?Kr(t).firstChild:Kr(pf(t)).firstChild},gf=e=>{const o=Wr(e),s=[];let n=[],t=[0,0];for(const e of o)switch(e.type.toUpperCase()){case"M":n.length>0&&(s.push({points:n}),n=[]),t=[e.args[0],e.args[1]],n.push([...t]);break;case"L":t=[e.args[0],e.args[1]],n.push([...t]);break;case"H":t=[e.args[0],t[1]],n.push([...t]);break;case"V":t=[t[0],e.args[0]],n.push([...t]);break;case"C":t=[e.args[4],e.args[5]],n.push([...t]);break;case"Z":break;default:console.warn(`Unsupported SVG path command: ${e.type}`);break}if(n.length>2&&s.push({points:n}),s.length>0){const e=ne(s[0].points);return{rings:s,bounds:e}}},_f=e=>{const{point:t,inHandle:n,outHandle:s}=e;if(!n||!s)return!1;const o=n[0]-t[0],i=n[1]-t[1],a=s[0]-t[0],r=s[1]-t[1],c=o*r-i*a;return(c<0?-c:c)<.01},xf=e=>{const o=Wr(e);let t=[],n=[0,0],s=!1;for(let i=0;i<o.length;i++){const e=o[i];switch(e.type.toUpperCase()){case"M":n=[e.args[0],e.args[1]],t.push({type:"CORNER",point:[...n]});break;case"L":n=[e.args[0],e.args[1]],t.push({type:"CORNER",point:[...n]});break;case"C":const i=[e.args[0],e.args[1]],a=[e.args[2],e.args[3]],o=[e.args[4],e.args[5]];if(t.length>0){const e=t[t.length-1];(i[0]!==e.point[0]||i[1]!==e.point[1])&&(e.type="CURVE",e.outHandle=i)}const r={type:a[0]!==o[0]||a[1]!==o[1]?"CURVE":"CORNER",point:o};r.type==="CURVE"&&(r.inHandle=a),t.push(r),n=o;break;case"Z":s=!0;break;default:console.warn(`Unsupported SVG path command: ${e.type}`);break}}t=t.map(e=>_f(e)?{...e,locked:!0}:e);const i=ne(_a(t,s));return{points:t,closed:s,bounds:i}},Wr=e=>{const t=[],s=e.replace(/,/g," ").trim(),o=/([MmLlHhVvCcZz])\s*([^MmLlHhVvCcZz]*)/g;let n;for(;(n=o.exec(s))!==null;){const[,i,e]=n,a=e.trim()===""?[]:e.trim().split(/\s+/).map(Number).filter(e=>!isNaN(e));t.push({type:i,args:a})}return t},o6=e=>{const[s,o,n]=e.match(/(<polygon points=["|'])([^("|')]*)/)||[],t=n.split(" ").map(e=>e.split(",").map(parseFloat));return{type:f.POLYGON,geometry:{points:t,bounds:ne(t)}}},g6=e=>{const t=Ts(e),n=parseFloat(t.getAttribute("cx")),s=parseFloat(t.getAttribute("cy")),o=parseFloat(t.getAttribute("rx")),i=parseFloat(t.getAttribute("ry")),a={minX:n-o,minY:s-i,maxX:n+o,maxY:s+i};return{type:f.ELLIPSE,geometry:{cx:n,cy:s,rx:o,ry:i,bounds:a}}},S6=e=>{const t=Ts(e),n=parseFloat(t.getAttribute("x1")),s=parseFloat(t.getAttribute("x2")),o=parseFloat(t.getAttribute("y1")),i=parseFloat(t.getAttribute("y2")),a={minX:Math.min(n,s),minY:Math.min(o,i),maxX:Math.max(n,s),maxY:Math.max(o,i)};return{type:f.LINE,geometry:{points:[[n,o],[s,i]],bounds:a}}},U6=e=>{const t=Ts(e),n=t.nodeName==="path"?t:Array.from(t.querySelectorAll("path"))[0],s=n?.getAttribute("d");if(!s)throw new Error("Could not parse SVG path");const o=xf(s);if(!o)throw new Error("Could not parse SVG path");return{type:f.POLYLINE,geometry:o}},wp=e=>{const n=Ts(e),t=(n.nodeName==="path"?[n]:Array.from(n.querySelectorAll("path"))).map(e=>e.getAttribute("d")||"").map(e=>gf(e)).filter(Boolean),s=t.reduce((e,t)=>[...e,...t.rings[0].points],[]),o=ne(s);return t.length===1&&t[0].rings.length===1?{type:f.POLYGON,geometry:{points:s,bounds:o}}:{type:f.MULTIPOLYGON,geometry:{polygons:t,bounds:o}}},_p=e=>{const t=typeof e=="string"?e:e.value;if(t.includes("<polygon points="))return o6(t);if(t.includes("<path ")&&(t.includes(" C ")||!t.includes("Z")))return U6(t);if(t.includes("<path "))return wp(t);if(t.includes("<ellipse "))return g6(t);if(t.includes("<line "))return S6(t);throw"Unsupported SVG shape: "+t},yp=e=>`<g>${e.polygons.map(e=>`<path fill-rule="evenodd" d="${Ie(e)}" />`).join("")}</g>`,bp=e=>{let t;switch(e.type){case f.POLYGON:{const n=e.geometry,{points:s}=n;t=`<svg><polygon points="${s.map(e=>e.join(",")).join(" ")}" /></svg>`;break}case f.ELLIPSE:{const n=e.geometry;t=`<svg><ellipse cx="${n.cx}" cy="${n.cy}" rx="${n.rx}" ry="${n.ry}" /></svg>`;break}case f.MULTIPOLYGON:{const n=e.geometry;t=`<svg>${yp(n)}</svg>`;break}case f.LINE:{const n=e.geometry,[[s,o],[i,a]]=n.points;t=`<svg><line x1="${s}" y1="${o}" x2="${i}" y2="${a}" /></svg>`;break}case f.POLYLINE:t=`<svg><path d="${tc(e.geometry)}" /></svg>`}if(t)return{type:"SvgSelector",value:t};throw`Unsupported shape type: ${e.type}`},W=[];for(let e=0;e<256;++e)W.push((e+256).toString(16).slice(1));function Sp(e,t=0){return(W[e[t+0]]+W[e[t+1]]+W[e[t+2]]+W[e[t+3]]+"-"+W[e[t+4]]+W[e[t+5]]+"-"+W[e[t+6]]+W[e[t+7]]+"-"+W[e[t+8]]+W[e[t+9]]+"-"+W[e[t+10]]+W[e[t+11]]+W[e[t+12]]+W[e[t+13]]+W[e[t+14]]+W[e[t+15]]).toLowerCase()}tp=new Uint8Array(16);function Mp(){if(!Nr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Nr=crypto.getRandomValues.bind(crypto)}return Nr(tp)}Q6=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Er={randomUUID:Q6};function Fp(e){var o;e=e||{};const s=e.random??((o=e.rng)==null?0[0]:o.call(e))??Mp();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Sp(s)}function Tp(e){return Er.randomUUID&&!e?Er.randomUUID():Fp(e)}gr=Object.prototype.hasOwnProperty;function ws(e,t){if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((s=e.length)===t.length)for(var n,s;s--&&ws(e[s],t[s]););return s===-1}if(!n||typeof e=="object"){s=0;for(n in e)if(gr.call(e,n)&&++s&&!gr.call(t,n)||!(n in t)||!ws(e[n],t[n]))return!1;return Object.keys(t).length===s}}return e!==e&&t!==t}function pr(){}function zp(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}rn=[];function fr(e,t=pr){let n;const s=new Set;function o(t){if(zp(e,t)&&(e=t,n)){const t=!rn.length;for(const t of s)t[1](),rn.push(t,e);if(t){for(let e=0;e<rn.length;e+=2)rn[e][0](rn[e+1]);rn.length=0}}}function i(t){o(t(e))}function a(a,r=pr){const c=[a,r];return s.add(c),s.size===1&&(n=t(o,i)||pr),a(e),()=>{s.delete(c),s.size===0&&n&&(n(),n=null)}}return{set:o,update:i,subscribe:a}}W6=e=>{const{subscribe:s,set:n}=fr();let t;return s(e=>t=e),e.observe(({changes:e})=>{if(t){(e.deleted||[]).some(e=>e.id===t)&&n(0[0]);const s=(e.updated||[]).find(({oldValue:e})=>e.id===t);s&&n(s.newValue.id)}}),{get current(){return t},subscribe:s,set:n}},_s={selected:[]},$6=(e,t,n)=>{const{subscribe:c,set:o}=fr(_s);let i=t,s=_s;c(e=>s=e);const d=()=>{ws(s,_s)||o(_s)},a=()=>{var e;return((e=s.selected)==null?0[0]:e.length)===0},u=e=>{if(a())return!1;const t=typeof e=="string"?e:e.id;return s.selected.some(e=>e.id===t)},h=(t,n)=>{let s;if(Array.isArray(t)){if(s=t.map(t=>e.getAnnotation(t)).filter(Boolean),s.length<t.length){console.warn("Invalid selection: "+t.filter(e=>!s.some(t=>t.id===e)));return}}else{const n=e.getAnnotation(t);if(!n){console.warn("Invalid selection: "+t);return}s=[n]}const i=s.reduce((e,t)=>{const n=r(t);return n==="EDIT"?[...e,{id:t.id,editable:!0}]:n==="SELECT"?[...e,{id:t.id}]:e},[]);o({selected:i,event:n})},l=(t,n)=>{const s=Array.isArray(t)?t:[t],i=s.map(t=>e.getAnnotation(t)).filter(e=>!!e);o({selected:i.map(e=>{const t=n===0[0]?r(e)==="EDIT":n;return{id:e.id,editable:t}})}),i.length!==s.length&&console.warn("Invalid selection",t)},m=e=>{if(a())return!1;const{selected:t}=s;t.some(({id:t})=>e.includes(t))&&o({selected:t.filter(({id:t})=>!e.includes(t))})},f=e=>{i=e,l(s.selected.map(({id:e})=>e))},r=e=>V6(e,i,n);return e.observe(({changes:e})=>m((e.deleted||[]).map(e=>e.id))),{get event(){return s?s.event:null},get selected(){return s?[...s.selected]:null},get userSelectAction(){return i},clear:d,evalSelectAction:r,isEmpty:a,isSelected:u,setSelected:l,setUserSelectAction:f,subscribe:c,userSelect:h}},V6=(e,t,n)=>{const s=n?n.serialize(e):e;return typeof t=="function"?t(s):t||"EDIT"},K=[];for(let e=0;e<256;++e)K.push((e+256).toString(16).slice(1));function Dp(e,t=0){return(K[e[t+0]]+K[e[t+1]]+K[e[t+2]]+K[e[t+3]]+"-"+K[e[t+4]]+K[e[t+5]]+"-"+K[e[t+6]]+K[e[t+7]]+"-"+K[e[t+8]]+K[e[t+9]]+"-"+K[e[t+10]]+K[e[t+11]]+K[e[t+12]]+K[e[t+13]]+K[e[t+14]]+K[e[t+15]]).toLowerCase()}D6=new Uint8Array(16);function Np(){if(!ur){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ur=crypto.getRandomValues.bind(crypto)}return ur(D6)}y6=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lr={randomUUID:y6};function Rp(e){var o;e=e||{};const s=e.random??((o=e.rng)==null?0[0]:o.call(e))??Np();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Dp(s)}function Pp(e){return lr.randomUUID&&!e?lr.randomUUID():Rp(e)}m6=(e,t)=>{const n=new Set(e.bodies.map(e=>e.id));return t.bodies.filter(e=>!n.has(e.id))},h6=(e,t)=>{const n=new Set(t.bodies.map(e=>e.id));return e.bodies.filter(e=>!n.has(e.id))},u6=(e,t)=>t.bodies.map(t=>{const n=e.bodies.find(e=>e.id===t.id);return{newBody:t,oldBody:n&&!ws(n,t)?n:0[0]}}).filter(({oldBody:e})=>e).map(({oldBody:e,newBody:t})=>({oldBody:e,newBody:t})),d6=(e,t)=>!ws(e.target,t.target),c6=(e,t)=>{const n=m6(e,t),s=h6(e,t),o=u6(e,t);return{oldValue:e,newValue:t,bodiesCreated:n.length>0?n:0[0],bodiesDeleted:s.length>0?s:0[0],bodiesUpdated:o.length>0?o:0[0],targetUpdated:d6(e,t)?{oldTarget:e.target,newTarget:t.target}:0[0]}},V=(e=>(e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.SILENT="SILENT",e))(V||{}),r6=(e,t)=>{var s,o;const{changes:n,origin:i}=t;if(!(e.options.origin?e.options.origin===i:i!=="SILENT"))return!1;if(e.options.ignore){const{ignore:i}=e.options,t=e=>e&&e.length>0;if(!t(n.created)&&!t(n.deleted)){const e=(s=n.updated)==null?0[0]:s.some(e=>t(e.bodiesCreated)||t(e.bodiesDeleted)||t(e.bodiesUpdated)),a=(o=n.updated)==null?0[0]:o.some(e=>e.targetUpdated);if(i==="BODY_ONLY"&&e&&!a||i==="TARGET_ONLY"&&a&&!e)return!1}}if(e.options.annotations){const t=new Set([...(n.created||[]).map(e=>e.id),...(n.deleted||[]).map(e=>e.id),...(n.updated||[]).map(({oldValue:e})=>e.id)]);return!!(Array.isArray(e.options.annotations)?e.options.annotations:[e.options.annotations]).find(e=>t.has(e))}return!0},ds=e=>{const t=e.id===0[0]?Pp():e.id;return{...e,id:t,bodies:e.bodies===0[0]?[]:e.bodies.map(e=>({...e,annotation:t})),target:{...e.target,annotation:t}}},Uf=e=>e.id!==0[0],$f=()=>{const e=new Map,n=new Map,s=[],k=(e,t={})=>{s.push({onChange:e,options:t})},x=e=>{const t=s.findIndex(t=>t.onChange==e);t>-1&&s.splice(t,1)},t=(t,n)=>{const o={origin:t,changes:{created:n.created||[],updated:n.updated||[],deleted:n.deleted||[]},state:[...e.values()]};s.forEach(e=>{r6(e,o)&&e.onChange(o)})},r=(s,o=V.LOCAL)=>{if(s.id&&e.get(s.id))throw Error(`Cannot add annotation ${s.id} - exists already`);{const i=ds(s);e.set(i.id,i),i.bodies.forEach(e=>n.set(e.id,i.id)),t(o,{created:[i]})}},o=(t,s)=>{const o=ds(typeof t=="string"?s:t),i=typeof t=="string"?t:t.id,a=i&&e.get(i);if(a){const t=c6(a,o);return i===o.id?e.set(i,o):(e.delete(i),e.set(o.id,o)),a.bodies.forEach(e=>n.delete(e.id)),o.bodies.forEach(e=>n.set(e.id,o.id)),t}console.warn(`Cannot update annotation ${i} - does not exist`)},c=(e,n=V.LOCAL,s=V.LOCAL)=>{const a=Uf(n)?s:n,i=o(e,n);i&&t(a,{updated:[i]})},w=(t,n=V.LOCAL)=>{e.get(t.id)?c(t,n):r(t,n)},m=(e,n=V.LOCAL)=>{const s=e.reduce((e,t)=>{const n=o(t);return n?[...e,n]:e},[]);s.length>0&&t(n,{updated:s})},g=(s,i=V.LOCAL)=>{const r=s.map(ds),{toAdd:a,toUpdate:c}=r.reduce((t,n)=>e.get(n.id)?{...t,toUpdate:[...t.toUpdate,n]}:{...t,toAdd:[...t.toAdd,n]},{toAdd:[],toUpdate:[]}),l=c.map(e=>o(e,i)).filter(Boolean);a.forEach(t=>{e.set(t.id,t),t.bodies.forEach(e=>n.set(e.id,t.id))}),t(i,{created:a,updated:l})},f=(s,o=V.LOCAL)=>{const i=e.get(s.annotation);if(i){const a={...i,bodies:[...i.bodies,s]};e.set(i.id,a),n.set(s.id,a.id),t(o,{updated:[{oldValue:i,newValue:a,bodiesCreated:[s]}]})}else console.warn(`Attempt to add body to missing annotation: ${s.annotation}`)},j=()=>[...e.values()],h=(s=V.LOCAL)=>{const o=[...e.values()];e.clear(),n.clear(),t(s,{deleted:o})},p=(s,o=!0,i=V.LOCAL)=>{const a=s.map(ds);if(o){const s=[...e.values()];e.clear(),n.clear(),a.forEach(t=>{e.set(t.id,t),t.bodies.forEach(e=>n.set(e.id,t.id))}),t(i,{created:a,deleted:s})}else{const o=s.reduce((t,n)=>{const s=n.id&&e.get(n.id);return s?[...t,s]:t},[]);if(o.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${o.map(e=>e.id).join(", ")}`);a.forEach(t=>{e.set(t.id,t),t.bodies.forEach(e=>n.set(e.id,t.id))}),t(i,{created:a})}},u=t=>{const s=typeof t=="string"?t:t.id,o=e.get(s);if(o)return e.delete(s),o.bodies.forEach(e=>n.delete(e.id)),o;console.warn(`Attempt to delete missing annotation: ${s}`)},v=(e,n=V.LOCAL)=>{const s=u(e);s&&t(n,{deleted:[s]})},b=(e,n=V.LOCAL)=>{const s=e.reduce((e,t)=>{const n=u(t);return n?[...e,n]:e},[]);s.length>0&&t(n,{deleted:s})},d=t=>{const s=e.get(t.annotation);if(s){const o=s.bodies.find(e=>e.id===t.id);if(o){n.delete(o.id);const i={...s,bodies:s.bodies.filter(e=>e.id!==t.id)};return e.set(s.id,i),{oldValue:s,newValue:i,bodiesDeleted:[o]}}console.warn(`Attempt to delete missing body ${t.id} from annotation ${t.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${t.annotation}`)},y=(e,n=V.LOCAL)=>{const s=d(e);s&&t(n,{updated:[s]})},_=(e,n=V.LOCAL)=>{const s=e.map(e=>d(e)).filter(Boolean);s.length>0&&t(n,{updated:s})},l=t=>{const n=e.get(t);return n?{...n}:0[0]},O=e=>{const t=n.get(e);if(t){const n=l(t).bodies.find(t=>t.id===e);if(n)return n;console.error(`Store integrity error: body ${e} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${e}`)},a=(t,s)=>{if(t.annotation!==s.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const o=e.get(t.annotation);if(o){const i=o.bodies.find(e=>e.id===t.id),a={...o,bodies:o.bodies.map(e=>e.id===i.id?s:e)};return e.set(o.id,a),i.id!==s.id&&(n.delete(i.id),n.set(s.id,a.id)),{oldValue:o,newValue:a,bodiesUpdated:[{oldBody:i,newBody:s}]}}console.warn(`Attempt to add body to missing annotation ${t.annotation}`)},C=(e,n,s=V.LOCAL)=>{const o=a(e,n);o&&t(s,{updated:[o]})},E=(e,n=V.LOCAL)=>{const s=e.map(e=>a({id:e.id,annotation:e.annotation},e)).filter(Boolean);t(n,{updated:s})},i=t=>{const n=e.get(t.annotation);if(n){const s={...n,target:{...n.target,...t}};return e.set(n.id,s),{oldValue:n,newValue:s,targetUpdated:{oldTarget:n.target,newTarget:t}}}console.warn(`Attempt to update target on missing annotation: ${t.annotation}`)};return{addAnnotation:r,addBody:f,all:j,bulkAddAnnotations:p,bulkDeleteAnnotations:b,bulkDeleteBodies:_,bulkUpdateAnnotations:m,bulkUpdateBodies:E,bulkUpdateTargets:(e,n=V.LOCAL)=>{const s=e.map(e=>i(e)).filter(Boolean);s.length>0&&t(n,{updated:s})},bulkUpsertAnnotations:g,clear:h,deleteAnnotation:v,deleteBody:y,getAnnotation:l,getBody:O,observe:k,unobserve:x,updateAnnotation:c,updateBody:C,updateTarget:(e,n=V.LOCAL)=>{const s=i(e);s&&t(n,{updated:[s]})},upsertAnnotation:w}},Bf=()=>{const{subscribe:e,set:t}=fr([]);return{subscribe:e,set:t}},Pf="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Rf=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Pf[n[e]&63];return t},Lf=e=>{const n=JSON.stringify(e);let t=0;for(let e=0,s=n.length;e<s;e++){let o=n.charCodeAt(e);t=(t<<5)-t+o,t|=0}return`${t}`},nr=e=>e?typeof e=="object"?{...e}:e:0[0],Nf=(e,t)=>(Array.isArray(e)?e:[e]).map(e=>{const{id:o,type:i,purpose:a,value:r,created:n,modified:s,creator:c,...l}=e;return{id:o||`temp-${Lf(e)}`,annotation:t,type:i,purpose:a,value:r,creator:nr(c),created:n?new Date(n):0[0],updated:s?new Date(s):0[0],...l}}),zf=e=>e.map(e=>{var n;const{annotation:a,created:s,updated:o,...i}=e,t={...i,created:s?.toISOString(),modified:o?.toISOString()};return(n=t.id)!=null&&n.startsWith("temp-")&&delete t.id,t}),Rf(),Tf=(e,t={strict:!0,invertY:!1})=>({parse:e=>Mf(e,t),serialize:n=>Sf(n,e,t)}),Mf=(e,t={strict:!0,invertY:!1})=>{const i=e.id||Tp(),{creator:d,created:a,modified:r,body:u,...o}=e,h=Nf(u||[],i),s=Array.isArray(e.target)?e.target[0]:e.target,n=typeof s=="string"?s:Array.isArray(s.selector)?s.selector[0]:s.selector,c=typeof n=="string"||n?.type==="FragmentSelector"?B8(n,t.invertY):n?.type==="SvgSelector"?_p(n):0[0],l=Array.isArray(o.target)?o.target[0]:o.targret;return c||!t.strict?{parsed:{...o,id:i,bodies:h,target:{created:a?new Date(a):0[0],creator:nr(d),updated:r?new Date(r):0[0],...typeof l=="string"?{}:l,annotation:i,selector:c||n}}}:{error:Error(`Invalid selector: ${JSON.stringify(n)}`)}},Sf=(e,t,n={strict:!0,invertY:!1})=>{const{selector:s,creator:c,created:a,updated:r,updatedBy:d,...l}=e.target;let i;try{i=s.type==f.RECTANGLE?sf(s.geometry):bp(s)}catch(e){if(n.strict)throw e;i=s}const o={...e,"@context":"http://www.w3.org/ns/anno.jsonld",id:e.id,type:"Annotation",body:zf(e.bodies),created:a?.toISOString(),creator:c,modified:r?.toISOString(),target:{...l,source:t,type:"SpecificResource",selector:i}};return delete o.bodies,"annotation"in o.target&&delete o.target.annotation,o},cs=(e,t=0)=>{const{minX:n,minY:s,maxX:o,maxY:i}=e;return{x:n-t,y:s-t,w:o-n+2*t,h:i-s+2*t}},pe=!(typeof window>"u"||typeof navigator>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),Cf=e=>({}),sr=e=>({grab:e[0]});function Vp(t){let s,o,i,c;const a=t[8].default,n=t5(a,t,t[7],sr);return{c(){s=r("g"),n&&n.c(),e(s,"class","a9s-annotation selected")},m(e,a){u(e,s,a),n&&n.m(s,null),o=!0,i||(c=[_(s,"pointerup",t[2]),_(s,"pointermove",t[1])],i=!0)},p(e,[t]){n&&n.p&&(!o||t&128)&&Kg(n,a,e,e[7],o?qg(a,e[7],t,Cf):Rg(e[7]),sr)},i(e){o||(w(n,e),o=!0)},o(e){E(n,e),o=!1},d(e){e&&l(s),n&&n.d(e),i=!1,_e(c)}}}function $p(e,t,n){let{$$slots:h={},$$scope:u}=t;const c=ro();let{shape:s}=t,{editor:l}=t,{transform:o}=t,{svgEl:i}=t,a,r,d;const m=e=>t=>{if(a=e,i){const{left:e,top:n}=i.getBoundingClientRect(),s=t.clientX-e,a=t.clientY-n;r=o.elementToImage(s,a)}else{const{offsetX:e,offsetY:n}=t;r=o.elementToImage(e,n)}d=s,t.target.setPointerCapture(t.pointerId),c("grab",t)},f=e=>{if(a){const[t,i]=o.elementToImage(e.offsetX,e.offsetY),u=[t-r[0],i-r[1]];n(3,s=l(d,a,u)),c("change",s)}},p=e=>{e.target.releasePointerCapture(e.pointerId),a=0[0],d=s,c("release",e)};return e.$$set=e=>{"shape"in e&&n(3,s=e.shape),"editor"in e&&n(4,l=e.editor),"transform"in e&&n(5,o=e.transform),"svgEl"in e&&n(6,i=e.svgEl),"$$scope"in e&&n(7,u=e.$$scope)},[m,f,p,s,l,o,i,u,h]}Va=class extends Je{constructor(e){super(),Mt(this,e,$p,Vp,zt,{shape:3,editor:4,transform:5,svgEl:6})}};function Wp(t){let i,n,a,o,c,d,h,m,s=t[3]&&uf(t);return{c(){i=r("g"),n=r("circle"),s&&s.c(),o=r("circle"),e(n,"class","a9s-handle-buffer svelte-qtyc7s"),e(n,"cx",t[0]),e(n,"cy",t[1]),e(n,"r",a=t[5]+6/t[2]),e(n,"role","button"),e(n,"tabindex","0"),e(o,"class",c=Zh(`a9s-handle-dot${t[3]?" selected":""}`)+" svelte-qtyc7s"),e(o,"cx",t[0]),e(o,"cy",t[1]),e(o,"r",t[5]),e(i,"class",d=`a9s-handle ${t[8].class||""}`.trim())},m(e,a){u(e,i,a),x(i,n),s&&s.m(i,null),x(i,o),h||(m=[_(n,"dblclick",t[12]),_(n,"pointerenter",t[13]),_(n,"pointerleave",t[14]),_(n,"pointerdown",t[15]),_(n,"pointerdown",t[6]),_(n,"pointerup",t[16]),_(n,"pointerup",t[7])],h=!0)},p(t,r){r&1&&e(n,"cx",t[0]),r&2&&e(n,"cy",t[1]),r&36&&a!==(a=t[5]+6/t[2])&&e(n,"r",a),t[3]?s?s.p(t,r):(s=uf(t),s.c(),s.m(i,o)):s&&(s.d(1),s=null),r&8&&c!==(c=Zh(`a9s-handle-dot${t[3]?" selected":""}`)+" svelte-qtyc7s")&&e(o,"class",c),r&1&&e(o,"cx",t[0]),r&2&&e(o,"cy",t[1]),r&32&&e(o,"r",t[5]),r&256&&d!==(d=`a9s-handle ${t[8].class||""}`.trim())&&e(i,"class",d)},d(e){e&&l(i),s&&s.d(),h=!1,_e(m)}}}function Up(t){let i,s,a,n,c,o,d,h,m;return{c(){i=r("g"),s=r("circle"),n=r("circle"),o=r("circle"),e(s,"cx",t[0]),e(s,"cy",t[1]),e(s,"r",a=t[5]*10),e(s,"class","a9s-touch-halo"),tm(s,"touched",t[4]),e(n,"cx",t[0]),e(n,"cy",t[1]),e(n,"r",c=t[5]+10/t[2]),e(n,"class","a9s-handle-buffer svelte-qtyc7s"),e(n,"role","button"),e(n,"tabindex","0"),e(o,"class","a9s-handle-dot"),e(o,"cx",t[0]),e(o,"cy",t[1]),e(o,"r",d=t[5]+2/t[2]),e(i,"class","a9s-touch-handle")},m(e,a){u(e,i,a),x(i,s),x(i,n),x(i,o),h||(m=[_(n,"dblclick",t[9]),_(n,"pointerdown",t[10]),_(n,"pointerdown",t[6]),_(n,"pointerup",t[11]),_(n,"pointerup",t[7])],h=!0)},p(t,i){i&1&&e(s,"cx",t[0]),i&2&&e(s,"cy",t[1]),i&32&&a!==(a=t[5]*10)&&e(s,"r",a),i&16&&tm(s,"touched",t[4]),i&1&&e(n,"cx",t[0]),i&2&&e(n,"cy",t[1]),i&36&&c!==(c=t[5]+10/t[2])&&e(n,"r",c),i&1&&e(o,"cx",t[0]),i&2&&e(o,"cy",t[1]),i&36&&d!==(d=t[5]+2/t[2])&&e(o,"r",d)},d(e){e&&l(i),h=!1,_e(m)}}}function uf(t){let n,s;return{c(){n=r("circle"),e(n,"class","a9s-handle-selected"),e(n,"cx",t[0]),e(n,"cy",t[1]),e(n,"r",s=t[5]+8/t[2])},m(e,t){u(e,n,t)},p(t,o){o&1&&e(n,"cx",t[0]),o&2&&e(n,"cy",t[1]),o&36&&s!==(s=t[5]+8/t[2])&&e(n,"r",s)},d(e){e&&l(n)}}}function Kp(e){let n;function s(){return pe?Up:Wp}let t=s()(e);return{c(){t.c(),n=Qn()},m(e,s){t.m(e,s),u(e,n,s)},p(e,[n]){t.p(e,n)},i:Ae,o:Ae,d(e){e&&l(n),t.d(e)}}}function qp(e,t,n){let i,{x:a}=t,{y:r}=t,{scale:s}=t,{selected:c=0[0]}=t,o=!1;const u=e=>{e.pointerType==="touch"&&n(4,o=!0)},d=()=>n(4,o=!1);function l(t){Y.call(this,e,t)}function h(t){Y.call(this,e,t)}function m(t){Y.call(this,e,t)}function f(t){Y.call(this,e,t)}function p(t){Y.call(this,e,t)}function g(t){Y.call(this,e,t)}function v(t){Y.call(this,e,t)}function b(t){Y.call(this,e,t)}return e.$$set=e=>{n(8,t=Yl(Yl({},t),Kh(e))),"x"in e&&n(0,a=e.x),"y"in e&&n(1,r=e.y),"scale"in e&&n(2,s=e.scale),"selected"in e&&n(3,c=e.selected)},e.$$.update=()=>{e.$$.dirty&4&&n(5,i=4/s)},t=Kh(t),[a,r,s,c,o,i,u,d,t,l,h,m,f,p,g,v,b]}Ut=class extends Je{constructor(e){super(),Mt(this,e,qp,Kp,zt,{x:0,y:1,scale:2,selected:3})}};function Yp(t){let i,n,a,s,o,c,d;return{c(){i=r("g"),n=r("circle"),s=r("circle"),o=r("circle"),e(n,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),e(n,"cx",t[0]),e(n,"cy",t[1]),e(n,"r",a=1.75*t[2]),e(s,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),e(s,"cx",t[0]),e(s,"cy",t[1]),e(s,"r",t[2]),e(o,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),e(o,"cx",t[0]),e(o,"cy",t[1]),e(o,"r",t[2]),e(i,"class","a9s-polygon-midpoint svelte-12ykj76")},m(e,a){u(e,i,a),x(i,n),x(i,s),x(i,o),c||(d=[_(n,"pointerdown",t[5]),_(n,"pointerdown",t[3])],c=!0)},p(t,i){i&1&&e(n,"cx",t[0]),i&2&&e(n,"cy",t[1]),i&4&&a!==(a=1.75*t[2])&&e(n,"r",a),i&1&&e(s,"cx",t[0]),i&2&&e(s,"cy",t[1]),i&4&&e(s,"r",t[2]),i&1&&e(o,"cx",t[0]),i&2&&e(o,"cy",t[1]),i&4&&e(o,"r",t[2])},d(e){e&&l(i),c=!1,_e(d)}}}function Gp(t){let n;return{c(){n=r("circle"),e(n,"cx",t[0]),e(n,"cy",t[1]),e(n,"r",t[2])},m(e,t){u(e,n,t)},p(t,s){s&1&&e(n,"cx",t[0]),s&2&&e(n,"cy",t[1]),s&4&&e(n,"r",t[2])},d(e){e&&l(n)}}}function Zp(e){let n;function s(){return pe?Gp:Yp}let t=s()(e);return{c(){t.c(),n=Qn()},m(e,s){t.m(e,s),u(e,n,s)},p(e,[n]){t.p(e,n)},i:Ae,o:Ae,d(e){e&&l(n),t.d(e)}}}function Jp(e,t,n){let o,{x:i}=t,{y:a}=t,{scale:s}=t;const r=e=>{e.pointerType};function c(t){Y.call(this,e,t)}return e.$$set=e=>{"x"in e&&n(0,i=e.x),"y"in e&&n(1,a=e.y),"scale"in e&&n(4,s=e.scale)},e.$$.update=()=>{e.$$.dirty&16&&n(2,o=4/s)},[i,a,o,r,s,c]}Zr=class extends Je{constructor(e){super(),Mt(this,e,Jp,Zp,zt,{x:0,y:1,scale:4})}};function ec(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function U8(e,t,n){const s=e.slice();return s[28]=t[n],s[30]=n,s}function ac(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function lc(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function V8(t){let n,s,o,i;return{c(){n=r("circle"),e(n,"cx",s=t[28][0]),e(n,"cy",o=t[28][1]),e(n,"r",i=Kn/t[3]),e(n,"class","svelte-1h2slbm")},m(e,t){u(e,n,t)},p(t,a){a[0]&1088&&s!==(s=t[28][0])&&e(n,"cx",s),a[0]&1088&&o!==(o=t[28][1])&&e(n,"cy",o),a[0]&8&&i!==(i=Kn/t[3])&&e(n,"r",i)},d(e){e&&l(n)}}}function z8(t){let o,n,i,a,c,d,s,h,m,f;return{c(){o=r("mask"),n=r("rect"),s=r("circle"),e(n,"x",i=t[9].x),e(n,"y",a=t[9].y),e(n,"width",c=t[9].w),e(n,"height",d=t[9].h),e(n,"class","svelte-1h2slbm"),e(s,"cx",h=t[28][0]),e(s,"cy",m=t[28][1]),e(s,"r",f=Kn/t[3]),e(s,"class","svelte-1h2slbm"),e(o,"id",`${t[19]}-inner`),e(o,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(e,t){u(e,o,t),x(o,n),x(o,s)},p(t,o){o[0]&512&&i!==(i=t[9].x)&&e(n,"x",i),o[0]&512&&a!==(a=t[9].y)&&e(n,"y",a),o[0]&512&&c!==(c=t[9].w)&&e(n,"width",c),o[0]&512&&d!==(d=t[9].h)&&e(n,"height",d),o[0]&1088&&h!==(h=t[28][0])&&e(s,"cx",h),o[0]&1088&&m!==(m=t[28][1])&&e(s,"cy",m),o[0]&8&&f!==(f=Kn/t[3])&&e(s,"r",f)},d(e){e&&l(o)}}}function T8(e){let t,n;return t=new Ut({props:{class:"a9s-corner-handle",x:e[28][0],y:e[28][1],scale:e[3],selected:e[8].includes(e[30])}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[15]),t.$on("pointerdown",function(){H(e[27](`HANDLE-${e[30]}`))&&e[27](`HANDLE-${e[30]}`).apply(this,arguments)}),t.$on("pointerup",e[16](e[30])),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(n,s){e=n;const o={};s[0]&32&&(o.x=e[28][0]),s[0]&32&&(o.y=e[28][1]),s[0]&8&&(o.scale=e[3]),s[0]&256&&(o.selected=e[8].includes(e[30])),t.$set(o)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}function M8(e){let t,n;return t=new Zr({props:{x:e[28][0],y:e[28][1],scale:e[3]}}),t.$on("pointerdown",function(){H(e[18](e[6]))&&e[18](e[6]).apply(this,arguments)}),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(n,s){e=n;const o={};s[0]&1088&&(o.x=e[28][0]),s[0]&1088&&(o.y=e[28][1]),s[0]&8&&(o.scale=e[3]),t.$set(o)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}function ng(t){let p,m,d,S,A,k,j,g,C,z,h,O,F,c,y,M,v,b,a,T,D,o=t[6]!==0[0]&&!t[7]&&V8(lc(t)),i=t[6]!==0[0]&&!t[7]&&z8(ac(t)),f=kt(t[5].points),n=[];for(let e=0;e<f.length;e+=1)n[e]=T8(U8(t,f,e));const N=e=>E(n[e],1,1,()=>{n[e]=null});let s=t[6]!==0[0]&&!t[7]&&M8(ec(t));return{c(){p=r("defs"),m=r("mask"),d=r("rect"),g=r("polygon"),o&&o.c(),i&&i.c(),z=ie(),h=r("polygon"),F=ie(),c=r("polygon"),M=ie();for(let e=0;e<n.length;e+=1)n[e].c();v=ie(),s&&s.c(),b=Qn(),e(d,"x",S=t[9].x),e(d,"y",A=t[9].y),e(d,"width",k=t[9].w),e(d,"height",j=t[9].h),e(d,"class","svelte-1h2slbm"),e(g,"points",C=t[5].points.map(gc).join(" ")),e(g,"class","svelte-1h2slbm"),e(m,"id",`${t[19]}-outer`),e(m,"class","a9s-polygon-editor-mask svelte-1h2slbm"),e(h,"class","a9s-outer"),e(h,"mask",`url(#${t[19]}-outer)`),e(h,"points",O=t[5].points.map(vc).join(" ")),e(c,"class","a9s-inner a9s-shape-handle"),e(c,"mask",`url(#${t[19]}-inner)`),e(c,"style",t[1]),e(c,"points",y=t[5].points.map(_c).join(" "))},m(e,r){u(e,p,r),x(p,m),x(m,d),x(m,g),o&&o.m(m,null),i&&i.m(p,null),u(e,z,r),u(e,h,r),u(e,F,r),u(e,c,r),u(e,M,r);for(let t=0;t<n.length;t+=1)n[t]&&n[t].m(e,r);u(e,v,r),s&&s.m(e,r),u(e,b,r),a=!0,T||(D=[_(h,"pointerup",t[14]),_(h,"pointerdown",function(){H(t[27]("SHAPE"))&&t[27]("SHAPE").apply(this,arguments)}),_(c,"pointermove",t[13]),_(c,"pointerup",t[14]),_(c,"pointerdown",function(){H(t[27]("SHAPE"))&&t[27]("SHAPE").apply(this,arguments)})],T=!0)},p(r,l){if(t=r,(!a||l[0]&512&&S!==(S=t[9].x))&&e(d,"x",S),(!a||l[0]&512&&A!==(A=t[9].y))&&e(d,"y",A),(!a||l[0]&512&&k!==(k=t[9].w))&&e(d,"width",k),(!a||l[0]&512&&j!==(j=t[9].h))&&e(d,"height",j),(!a||l[0]&32&&C!==(C=t[5].points.map(gc).join(" ")))&&e(g,"points",C),t[6]!==0[0]&&!t[7]?o?o.p(lc(t),l):(o=V8(lc(t)),o.c(),o.m(m,null)):o&&(o.d(1),o=null),t[6]!==0[0]&&!t[7]?i?i.p(ac(t),l):(i=z8(ac(t)),i.c(),i.m(p,null)):i&&(i.d(1),i=null),(!a||l[0]&32&&O!==(O=t[5].points.map(vc).join(" ")))&&e(h,"points",O),(!a||l[0]&2)&&e(c,"style",t[1]),(!a||l[0]&32&&y!==(y=t[5].points.map(_c).join(" ")))&&e(c,"points",y),l[0]&134322472){f=kt(t[5].points);let e;for(e=0;e<f.length;e+=1){const s=U8(t,f,e);n[e]?(n[e].p(s,l),w(n[e],1)):(n[e]=T8(s),n[e].c(),w(n[e],1),n[e].m(v.parentNode,v))}for(_n(),e=f.length;e<n.length;e+=1)N(e);bn()}t[6]!==0[0]&&!t[7]?s?(s.p(ec(t),l),l[0]&192&&w(s,1)):(s=M8(ec(t)),s.c(),w(s,1),s.m(b.parentNode,b)):s&&(_n(),E(s,1,1,()=>{s=null}),bn())},i(){if(!a){for(let e=0;e<f.length;e+=1)w(n[e]);w(s),a=!0}},o(){n=n.filter(Boolean);for(let e=0;e<n.length;e+=1)E(n[e]);E(s),a=!1},d(e){e&&(l(p),l(z),l(h),l(F),l(c),l(M),l(v),l(b)),o&&o.d(),i&&i.d(),Ei(n,e),s&&s.d(e),T=!1,_e(D)}}}function sg(e){let t,n;return t=new Va({props:{shape:e[0],transform:e[2],editor:e[17],svgEl:e[4],$$slots:{default:[ng,({grab:e})=>({27:e}),({grab:e})=>[e?134217728:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,n){const s={};n[0]&1&&(s.shape=e[0]),n[0]&4&&(s.transform=e[2]),n[0]&16&&(s.svgEl=e[4]),n[0]&134219754|n[1]&1&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}x8=250,O8=1e3,w8=12,Kn=4.5,gc=e=>e.join(","),vc=e=>e.join(","),_c=e=>e.join(",");function ig(e,t,n){let o,a,g;const p=ro();let{shape:r}=t,{computedStyle:v}=t,{transform:u}=t,{viewportScale:c=1}=t,{svgEl:i}=t,d,l=!1,m,s=[];const y=()=>n(7,l=!0),j=()=>n(7,l=!1),h=e=>{if(s.length>0||!a.some(e=>e.visible)){n(6,d=0[0]);return}const[l,h]=u.elementToImage(e.offsetX,e.offsetY),t=e=>(e[0]-l)**2+(e[1]-h)**2,m=o.points.reduce((e,n)=>t(n)<t(e)?n:e),i=a.filter(e=>e.visible).reduce((e,n)=>t(n.point)<t(e.point)?n:e),r=(O8/c)**2;t(m)<r||t(i.point)<r?n(6,d=a.indexOf(i)):n(6,d=0[0])},f=()=>{document.activeElement!==i&&i.focus()},b=()=>{n(8,s=[]),f()},_=e=>{n(7,l=!0),e.preventDefault(),e.stopPropagation(),m=performance.now()},w=e=>t=>{if(!m||pe||performance.now()-m>x8)return;const o=s.includes(e);t.metaKey||t.ctrlKey||t.shiftKey?o?n(8,s=s.filter(t=>t!==e)):n(8,s=[...s,e]):o&&s.length>1?n(8,s=[e]):o?n(8,s=[]):n(8,s=[e]),f()},O=(e,t,n)=>{f();let o;const i=e.geometry;s.length>1?o=i.points.map(([e,t],o)=>s.includes(o)?[e+n[0],t+n[1]]:[e,t]):t==="SHAPE"?o=i.points.map(([e,t])=>[e+n[0],t+n[1]]):o=i.points.map(([e,s],o)=>t===`HANDLE-${o}`?[e+n[0],s+n[1]]:[e,s]);const a=ne(o);return{...e,geometry:{points:o,bounds:a}}},x=e=>async t=>{t.stopPropagation();const s=[...o.points.slice(0,e+1),a[e].point,...o.points.slice(e+1)],i=ne(s);p("change",{...r,geometry:{points:s,bounds:i}}),await pm();const n=[...document.querySelectorAll(".a9s-handle")][e+1];if(n!=null&&n.firstChild){const e=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:t.clientX,clientY:t.clientY,pointerId:t.pointerId,pointerType:t.pointerType,isPrimary:t.isPrimary,buttons:t.buttons});n.firstChild.dispatchEvent(e)}},C=()=>{if(o.points.length-s.length<3)return;const e=o.points.filter((e,t)=>!s.includes(t)),t=ne(e);p("change",{...r,geometry:{points:e,bounds:t}}),n(8,s=[])};Ti(()=>{if(pe)return;const e=e=>{(e.key==="Delete"||e.key==="Backspace")&&(e.preventDefault(),C())};return i.addEventListener("pointermove",h),i.addEventListener("keydown",e),()=>{i.removeEventListener("pointermove",h),i.removeEventListener("keydown",e)}});const E=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function k(t){Y.call(this,e,t)}function A(t){Y.call(this,e,t)}function S(t){Y.call(this,e,t)}return e.$$set=e=>{"shape"in e&&n(0,r=e.shape),"computedStyle"in e&&n(1,v=e.computedStyle),"transform"in e&&n(2,u=e.transform),"viewportScale"in e&&n(3,c=e.viewportScale),"svgEl"in e&&n(4,i=e.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=r.geometry),e.$$.dirty[0]&40&&n(10,a=pe?[]:o.points.map((e,t)=>{const n=t===o.points.length-1?o.points[0]:o.points[t+1],s=(e[0]+n[0])/2,i=(e[1]+n[1])/2,a=((n[0]-s)**2+(n[1]-i)**2)**.5>w8/c;return{point:[s,i],visible:a}})),e.$$.dirty[0]&40&&n(9,g=cs(o.bounds,Kn/c))},[r,v,u,c,i,o,d,l,s,g,a,y,j,h,b,_,w,O,x,E,k,A,S]}j8=class extends Je{constructor(e){super(),Mt(this,e,ig,sg,zt,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}};function ag(t){let N,b,m,k,z,D,P,h,y,X,U,I,ae,o,A,W,O,C,le,s,S,M,F,T,ce,d,j,L,R,se,c,B,V,$,te,a,K,q,Y,J,i,Q,Z,G,ee,v,ne,g,oe,p,re,f,n,de,ue;return v=new Ut({props:{class:"a9s-corner-handle-topleft",x:t[5].x,y:t[5].y,scale:t[3]}}),v.$on("pointerdown",function(){H(t[12]("TOP_LEFT"))&&t[12]("TOP_LEFT").apply(this,arguments)}),g=new Ut({props:{class:"a9s-corner-handle-topright",x:t[5].x+t[5].w,y:t[5].y,scale:t[3]}}),g.$on("pointerdown",function(){H(t[12]("TOP_RIGHT"))&&t[12]("TOP_RIGHT").apply(this,arguments)}),p=new Ut({props:{class:"a9s-corner-handle-bottomright",x:t[5].x+t[5].w,y:t[5].y+t[5].h,scale:t[3]}}),p.$on("pointerdown",function(){H(t[12]("BOTTOM_RIGHT"))&&t[12]("BOTTOM_RIGHT").apply(this,arguments)}),f=new Ut({props:{class:"a9s-corner-handle-bottomleft",x:t[5].x,y:t[5].y+t[5].h,scale:t[3]}}),f.$on("pointerdown",function(){H(t[12]("BOTTOM_LEFT"))&&t[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){N=r("defs"),b=r("mask"),m=r("rect"),h=r("rect"),ae=ie(),o=r("rect"),le=ie(),s=r("rect"),ce=ie(),d=r("rect"),se=ie(),c=r("rect"),te=ie(),a=r("rect"),J=ie(),i=r("rect"),ee=ie(),ze(v.$$.fragment),ne=ie(),ze(g.$$.fragment),oe=ie(),ze(p.$$.fragment),re=ie(),ze(f.$$.fragment),e(m,"class","rect-mask-bg svelte-1njczvj"),e(m,"x",k=t[6].x),e(m,"y",z=t[6].y),e(m,"width",D=t[6].w),e(m,"height",P=t[6].h),e(h,"class","rect-mask-fg svelte-1njczvj"),e(h,"x",y=t[5].x),e(h,"y",X=t[5].y),e(h,"width",U=t[5].w),e(h,"height",I=t[5].h),e(b,"id",t[8]),e(b,"class","a9s-rectangle-editor-mask svelte-1njczvj"),e(o,"class","a9s-outer"),e(o,"mask",`url(#${t[8]})`),e(o,"x",A=t[5].x),e(o,"y",W=t[5].y),e(o,"width",O=t[5].w),e(o,"height",C=t[5].h),e(s,"class","a9s-inner a9s-shape-handle"),e(s,"style",t[1]),e(s,"x",S=t[5].x),e(s,"y",M=t[5].y),e(s,"width",F=t[5].w),e(s,"height",T=t[5].h),e(d,"class","a9s-edge-handle a9s-edge-handle-top"),e(d,"x",j=t[5].x),e(d,"y",L=t[5].y),e(d,"height",1),e(d,"width",R=t[5].w),e(c,"class","a9s-edge-handle a9s-edge-handle-right"),e(c,"x",B=t[5].x+t[5].w),e(c,"y",V=t[5].y),e(c,"height",$=t[5].h),e(c,"width",1),e(a,"class","a9s-edge-handle a9s-edge-handle-bottom"),e(a,"x",K=t[5].x),e(a,"y",q=t[5].y+t[5].h),e(a,"height",1),e(a,"width",Y=t[5].w),e(i,"class","a9s-edge-handle a9s-edge-handle-left"),e(i,"x",Q=t[5].x),e(i,"y",Z=t[5].y),e(i,"height",G=t[5].h),e(i,"width",1)},m(e,r){u(e,N,r),x(N,b),x(b,m),x(b,h),u(e,ae,r),u(e,o,r),u(e,le,r),u(e,s,r),u(e,ce,r),u(e,d,r),u(e,se,r),u(e,c,r),u(e,te,r),u(e,a,r),u(e,J,r),u(e,i,r),u(e,ee,r),me(v,e,r),u(e,ne,r),me(g,e,r),u(e,oe,r),me(p,e,r),u(e,re,r),me(f,e,r),n=!0,de||(ue=[_(o,"pointerdown",function(){H(t[12]("SHAPE"))&&t[12]("SHAPE").apply(this,arguments)}),_(s,"pointerdown",function(){H(t[12]("SHAPE"))&&t[12]("SHAPE").apply(this,arguments)}),_(d,"pointerdown",function(){H(t[12]("TOP"))&&t[12]("TOP").apply(this,arguments)}),_(c,"pointerdown",function(){H(t[12]("RIGHT"))&&t[12]("RIGHT").apply(this,arguments)}),_(a,"pointerdown",function(){H(t[12]("BOTTOM"))&&t[12]("BOTTOM").apply(this,arguments)}),_(i,"pointerdown",function(){H(t[12]("LEFT"))&&t[12]("LEFT").apply(this,arguments)})],de=!0)},p(r,l){t=r,(!n||l&64&&k!==(k=t[6].x))&&e(m,"x",k),(!n||l&64&&z!==(z=t[6].y))&&e(m,"y",z),(!n||l&64&&D!==(D=t[6].w))&&e(m,"width",D),(!n||l&64&&P!==(P=t[6].h))&&e(m,"height",P),(!n||l&32&&y!==(y=t[5].x))&&e(h,"x",y),(!n||l&32&&X!==(X=t[5].y))&&e(h,"y",X),(!n||l&32&&U!==(U=t[5].w))&&e(h,"width",U),(!n||l&32&&I!==(I=t[5].h))&&e(h,"height",I),(!n||l&32&&A!==(A=t[5].x))&&e(o,"x",A),(!n||l&32&&W!==(W=t[5].y))&&e(o,"y",W),(!n||l&32&&O!==(O=t[5].w))&&e(o,"width",O),(!n||l&32&&C!==(C=t[5].h))&&e(o,"height",C),(!n||l&2)&&e(s,"style",t[1]),(!n||l&32&&S!==(S=t[5].x))&&e(s,"x",S),(!n||l&32&&M!==(M=t[5].y))&&e(s,"y",M),(!n||l&32&&F!==(F=t[5].w))&&e(s,"width",F),(!n||l&32&&T!==(T=t[5].h))&&e(s,"height",T),(!n||l&32&&j!==(j=t[5].x))&&e(d,"x",j),(!n||l&32&&L!==(L=t[5].y))&&e(d,"y",L),(!n||l&32&&R!==(R=t[5].w))&&e(d,"width",R),(!n||l&32&&B!==(B=t[5].x+t[5].w))&&e(c,"x",B),(!n||l&32&&V!==(V=t[5].y))&&e(c,"y",V),(!n||l&32&&$!==($=t[5].h))&&e(c,"height",$),(!n||l&32&&K!==(K=t[5].x))&&e(a,"x",K),(!n||l&32&&q!==(q=t[5].y+t[5].h))&&e(a,"y",q),(!n||l&32&&Y!==(Y=t[5].w))&&e(a,"width",Y),(!n||l&32&&Q!==(Q=t[5].x))&&e(i,"x",Q),(!n||l&32&&Z!==(Z=t[5].y))&&e(i,"y",Z),(!n||l&32&&G!==(G=t[5].h))&&e(i,"height",G);const u={};l&32&&(u.x=t[5].x),l&32&&(u.y=t[5].y),l&8&&(u.scale=t[3]),v.$set(u);const b={};l&32&&(b.x=t[5].x+t[5].w),l&32&&(b.y=t[5].y),l&8&&(b.scale=t[3]),g.$set(b);const _={};l&32&&(_.x=t[5].x+t[5].w),l&32&&(_.y=t[5].y+t[5].h),l&8&&(_.scale=t[3]),p.$set(_);const w={};l&32&&(w.x=t[5].x),l&32&&(w.y=t[5].y+t[5].h),l&8&&(w.scale=t[3]),f.$set(w)},i(e){n||(w(v.$$.fragment,e),w(g.$$.fragment,e),w(p.$$.fragment,e),w(f.$$.fragment,e),n=!0)},o(e){E(v.$$.fragment,e),E(g.$$.fragment,e),E(p.$$.fragment,e),E(f.$$.fragment,e),n=!1},d(e){e&&(l(N),l(ae),l(o),l(le),l(s),l(ce),l(d),l(se),l(c),l(te),l(a),l(J),l(i),l(ee),l(ne),l(oe),l(re)),fe(v,e),fe(g,e),fe(p,e),fe(f,e),de=!1,_e(ue)}}}function rg(e){let t,n;return t=new Va({props:{shape:e[0],transform:e[2],editor:e[7],svgEl:e[4],$$slots:{default:[ag,({grab:e})=>({12:e}),({grab:e})=>e?4096:0]},$$scope:{ctx:e}}}),t.$on("grab",e[9]),t.$on("change",e[10]),t.$on("release",e[11]),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,[n]){const s={};n&1&&(s.shape=e[0]),n&4&&(s.transform=e[2]),n&16&&(s.svgEl=e[4]),n&12394&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}function cg(e,t,n){let s,a,{shape:o}=t,{computedStyle:r}=t,{transform:c}=t,{viewportScale:i=1}=t,{svgEl:l}=t;const d=(e,t,n)=>{const s=e.geometry.bounds;let[o,i]=[s.minX,s.minY],[a,r]=[s.maxX,s.maxY];const[c,l]=n;if(t==="SHAPE")o+=c,a+=c,i+=l,r+=l;else{switch(t){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{i+=l;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{r+=l;break}}switch(t){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{o+=c;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{a+=c;break}}}const d=Math.min(o,a),u=Math.min(i,r),h=Math.abs(a-o),m=Math.abs(r-i);return{...e,geometry:{x:d,y:u,w:h,h:m,bounds:{minX:d,minY:u,maxX:d+h,maxY:u+m}}}},u=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function h(t){Y.call(this,e,t)}function m(t){Y.call(this,e,t)}function f(t){Y.call(this,e,t)}return e.$$set=e=>{"shape"in e&&n(0,o=e.shape),"computedStyle"in e&&n(1,r=e.computedStyle),"transform"in e&&n(2,c=e.transform),"viewportScale"in e&&n(3,i=e.viewportScale),"svgEl"in e&&n(4,l=e.svgEl)},e.$$.update=()=>{e.$$.dirty&1&&n(5,s=o.geometry),e.$$.dirty&40&&n(6,a=cs(s.bounds,2/i))},[o,r,c,i,l,s,a,d,u,h,m,f]}u8=class extends Je{constructor(e){super(),Mt(this,e,cg,rg,zt,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}},xc=Object.prototype.hasOwnProperty;function Cc(e,t){if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((s=e.length)===t.length)for(var n,s;s--&&Cc(e[s],t[s]););return s===-1}if(!n||typeof e=="object"){s=0;for(n in e)if(xc.call(e,n)&&++s&&!xc.call(t,n)||!(n in t)||!Cc(e[n],t[n]))return!1;return Object.keys(t).length===s}}return e!==e&&t!==t}d8=12,l8=(e,t)=>e.polygons.reduce((e,n,s)=>{const o=n.rings.reduce((e,n,o)=>{const i=n.points.map((e,i)=>{const a=i===n.points.length-1?n.points[0]:n.points[i+1],r=(e[0]+a[0])/2,c=(e[1]+a[1])/2,l=((a[0]-r)**2+(a[1]-c)**2)**.5>d8/t;return{point:[r,c],visible:l,elementIdx:s,ringIdx:o,pointIdx:i}});return[...e,...i]},[]);return[...e,...o]},[]);function Ac(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function c8(e,t,n){const s=e.slice();return s[30]=t[n],s[32]=n,s}function a8(e,t,n){const s=e.slice();return s[33]=t[n],s[35]=n,s}function xu(e,t,n){const s=e.slice();return s[29]=t[n],s[37]=n,s}function Dc(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function Uc(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function e8(t){let n,s,o,i;return{c(){n=r("circle"),e(n,"cx",s=t[29][0]),e(n,"cy",o=t[29][1]),e(n,"r",i=Fn/t[3]),e(n,"class","svelte-1vxo6dc")},m(e,t){u(e,n,t)},p(t,a){a[0]&1088&&s!==(s=t[29][0])&&e(n,"cx",s),a[0]&1088&&o!==(o=t[29][1])&&e(n,"cy",o),a[0]&8&&i!==(i=Fn/t[3])&&e(n,"r",i)},d(e){e&&l(n)}}}function Jm(t){let o,n,i,a,c,d,s,h,m,f;return{c(){o=r("mask"),n=r("rect"),s=r("circle"),e(n,"x",i=t[9].x),e(n,"y",a=t[9].y),e(n,"width",c=t[9].w),e(n,"height",d=t[9].h),e(n,"class","svelte-1vxo6dc"),e(s,"cx",h=t[29][0]),e(s,"cy",m=t[29][1]),e(s,"r",f=Fn/t[3]),e(s,"class","svelte-1vxo6dc"),e(o,"id",`${t[18]}-${t[32]}-inner`),e(o,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(e,t){u(e,o,t),x(o,n),x(o,s)},p(t,o){o[0]&512&&i!==(i=t[9].x)&&e(n,"x",i),o[0]&512&&a!==(a=t[9].y)&&e(n,"y",a),o[0]&512&&c!==(c=t[9].w)&&e(n,"width",c),o[0]&512&&d!==(d=t[9].h)&&e(n,"height",d),o[0]&1088&&h!==(h=t[29][0])&&e(s,"cx",h),o[0]&1088&&m!==(m=t[29][1])&&e(s,"cy",m),o[0]&8&&f!==(f=Fn/t[3])&&e(s,"r",f)},d(e){e&&l(o)}}}function Zm(e){let t,n;function s(...t){return e[19](e[32],e[35],e[37],...t)}return t=new Ut({props:{class:"a9s-corner-handle",x:e[29][0],y:e[29][1],scale:e[3],selected:e[8].some(s)}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[14]),t.$on("pointerdown",function(){H(e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`))&&e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`).apply(this,arguments)}),t.$on("pointerup",e[15](e[32],e[35],e[37])),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(n,o){e=n;const i={};o[0]&32&&(i.x=e[29][0]),o[0]&32&&(i.y=e[29][1]),o[0]&8&&(i.scale=e[3]),o[0]&256&&(i.selected=e[8].some(s)),t.$set(i)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}function Qm(e){let s,o,n=kt(e[33].points),t=[];for(let s=0;s<n.length;s+=1)t[s]=Zm(xu(e,n,s));const i=e=>E(t[e],1,1,()=>{t[e]=null});return{c(){for(let e=0;e<t.length;e+=1)t[e].c();s=Qn()},m(e,n){for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,n);u(e,s,n),o=!0},p(e,o){if(o[0]&268491048){n=kt(e[33].points);let a;for(a=0;a<n.length;a+=1){const i=xu(e,n,a);t[a]?(t[a].p(i,o),w(t[a],1)):(t[a]=Zm(i),t[a].c(),w(t[a],1),t[a].m(s.parentNode,s))}for(_n(),a=n.length;a<t.length;a+=1)i(a);bn()}},i(){if(!o){for(let e=0;e<n.length;e+=1)w(t[e]);o=!0}},o(){t=t.filter(Boolean);for(let e=0;e<t.length;e+=1)E(t[e]);o=!1},d(e){e&&l(s),Ei(t,e)}}}function Xm(t){let m,p,h,c,k,v,C,O,g,y,d,j,a,b,i,A,S,o=t[6]!==0[0]&&!t[7]&&e8(Uc(t)),s=t[6]!==0[0]&&!t[7]&&Jm(Dc(t)),f=kt(t[30].rings),n=[];for(let e=0;e<f.length;e+=1)n[e]=Qm(a8(t,f,e));const M=e=>E(n[e],1,1,()=>{n[e]=null});return{c(){m=r("g"),p=r("defs"),h=r("mask"),c=r("rect"),g=r("path"),o&&o.c(),s&&s.c(),d=r("path"),a=r("path");for(let e=0;e<n.length;e+=1)n[e].c();e(c,"x",k=t[9].x),e(c,"y",v=t[9].y),e(c,"width",C=t[9].w),e(c,"height",O=t[9].h),e(c,"class","svelte-1vxo6dc"),e(g,"d",y=Ie(t[30])),e(g,"class","svelte-1vxo6dc"),e(h,"id",`${t[18]}-${t[32]}-outer`),e(h,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),e(d,"class","a9s-outer"),e(d,"mask",`url(#${t[18]}-${t[32]}-outer)`),e(d,"fill-rule","evenodd"),e(d,"d",j=Ie(t[30])),e(a,"class","a9s-inner"),e(a,"mask",`url(#${t[18]}-${t[32]}-inner)`),e(a,"style",t[1]),e(a,"fill-rule","evenodd"),e(a,"d",b=Ie(t[30]))},m(e,r){u(e,m,r),x(m,p),x(p,h),x(h,c),x(h,g),o&&o.m(h,null),s&&s.m(p,null),x(m,d),x(m,a);for(let e=0;e<n.length;e+=1)n[e]&&n[e].m(m,null);i=!0,A||(S=[_(d,"pointerup",t[13]),_(d,"pointerdown",function(){H(t[28]("SHAPE"))&&t[28]("SHAPE").apply(this,arguments)}),_(a,"pointerup",t[13]),_(a,"pointerdown",function(){H(t[28]("SHAPE"))&&t[28]("SHAPE").apply(this,arguments)})],A=!0)},p(r,l){if(t=r,(!i||l[0]&512&&k!==(k=t[9].x))&&e(c,"x",k),(!i||l[0]&512&&v!==(v=t[9].y))&&e(c,"y",v),(!i||l[0]&512&&C!==(C=t[9].w))&&e(c,"width",C),(!i||l[0]&512&&O!==(O=t[9].h))&&e(c,"height",O),(!i||l[0]&32&&y!==(y=Ie(t[30])))&&e(g,"d",y),t[6]!==0[0]&&!t[7]?o?o.p(Uc(t),l):(o=e8(Uc(t)),o.c(),o.m(h,null)):o&&(o.d(1),o=null),t[6]!==0[0]&&!t[7]?s?s.p(Dc(t),l):(s=Jm(Dc(t)),s.c(),s.m(p,null)):s&&(s.d(1),s=null),(!i||l[0]&32&&j!==(j=Ie(t[30])))&&e(d,"d",j),(!i||l[0]&2)&&e(a,"style",t[1]),(!i||l[0]&32&&b!==(b=Ie(t[30])))&&e(a,"d",b),l[0]&268491048){f=kt(t[30].rings);let e;for(e=0;e<f.length;e+=1){const s=a8(t,f,e);n[e]?(n[e].p(s,l),w(n[e],1)):(n[e]=Qm(s),n[e].c(),w(n[e],1),n[e].m(m,null))}for(_n(),e=f.length;e<n.length;e+=1)M(e);bn()}},i(){if(!i){for(let e=0;e<f.length;e+=1)w(n[e]);i=!0}},o(){n=n.filter(Boolean);for(let e=0;e<n.length;e+=1)E(n[e]);i=!1},d(e){e&&l(m),o&&o.d(),s&&s.d(),Ei(n,e),A=!1,_e(S)}}}function Gm(e){let t,n;return t=new Zr({props:{x:e[29][0],y:e[29][1],scale:e[3]}}),t.$on("pointerdown",function(){H(e[17](e[6]))&&e[17](e[6]).apply(this,arguments)}),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(n,s){e=n;const o={};s[0]&1088&&(o.x=e[29][0]),s[0]&1088&&(o.y=e[29][1]),s[0]&8&&(o.scale=e[3]),t.$set(o)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}function lg(e){let o,i,a,s=kt(e[5].polygons),t=[];for(let n=0;n<s.length;n+=1)t[n]=Xm(c8(e,s,n));const r=e=>E(t[e],1,1,()=>{t[e]=null});let n=e[6]!==0[0]&&!e[7]&&Gm(Ac(e));return{c(){for(let e=0;e<t.length;e+=1)t[e].c();o=ie(),n&&n.c(),i=Qn()},m(e,s){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(e,s);u(e,o,s),n&&n.m(e,s),u(e,i,s),a=!0},p(e,a){if(a[0]&268763114){s=kt(e[5].polygons);let n;for(n=0;n<s.length;n+=1){const i=c8(e,s,n);t[n]?(t[n].p(i,a),w(t[n],1)):(t[n]=Xm(i),t[n].c(),w(t[n],1),t[n].m(o.parentNode,o))}for(_n(),n=s.length;n<t.length;n+=1)r(n);bn()}e[6]!==0[0]&&!e[7]?n?(n.p(Ac(e),a),a[0]&192&&w(n,1)):(n=Gm(Ac(e)),n.c(),w(n,1),n.m(i.parentNode,i)):n&&(_n(),E(n,1,1,()=>{n=null}),bn())},i(){if(!a){for(let e=0;e<s.length;e+=1)w(t[e]);w(n),a=!0}},o(){t=t.filter(Boolean);for(let e=0;e<t.length;e+=1)E(t[e]);E(n),a=!1},d(e){e&&(l(o),l(i)),Ei(t,e),n&&n.d(e)}}}function dg(e){let t,n;return t=new Va({props:{shape:e[0],transform:e[2],editor:e[16],svgEl:e[4],$$slots:{default:[lg,({grab:e})=>({28:e}),({grab:e})=>[e?268435456:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){ze(t.$$.fragment)},m(e,s){me(t,e,s),n=!0},p(e,n){const s={};n[0]&1&&(s.shape=e[0]),n[0]&4&&(s.transform=e[2]),n[0]&16&&(s.svgEl=e[4]),n[0]&268437482|n[1]&128&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(w(t.$$.fragment,e),n=!0)},o(e){E(t.$$.fragment,e),n=!1},d(e){fe(t,e)}}}Km=250,Vm=1e3,Fn=4.5;function mg(e,t,n){let i,a,v;const g=ro();let{shape:r}=t,{computedStyle:p}=t,{transform:u}=t,{viewportScale:c=1}=t,{svgEl:o}=t,d,l=!1,h,s=[];const j=()=>n(7,l=!0),b=()=>n(7,l=!1),f=e=>{if(s.length>0||!a.some(e=>e.visible)){n(6,d=0[0]);return}const[l,h]=u.elementToImage(e.offsetX,e.offsetY),t=e=>(e[0]-l)**2+(e[1]-h)**2,m=_8(i).reduce((e,n)=>t(n)<t(e)?n:e),o=a.filter(e=>e.visible).reduce((e,n)=>t(n.point)<t(e.point)?n:e),r=(Vm/c)**2;t(m)<r||t(o.point)<r?n(6,d=a.indexOf(o)):n(6,d=0[0])},m=()=>{document.activeElement!==o&&o.focus()},y=()=>{n(8,s=[]),m()},_=e=>{n(7,l=!0),e.preventDefault(),e.stopPropagation(),h=performance.now()},w=(e,t,o)=>i=>{if(!h||pe||performance.now()-h>Km)return;const r=n=>n.polygon===e&&n.ring===t&&n.point===o,a=s.some(r);i.metaKey||i.ctrlKey||i.shiftKey?a?n(8,s=s.filter(e=>!r(e))):n(8,s=[...s,{polygon:e,ring:t,point:o}]):a&&s.length>1?n(8,s=[{polygon:e,ring:t,point:o}]):a?n(8,s=[]):n(8,s=[{polygon:e,ring:t,point:o}]),m()},O=(e,t,n)=>{m();const o=e.geometry.polygons;let s;if(t==="SHAPE")s=o.map(e=>{const t=e.rings.map((e)=>({points:e.points.map((e)=>[e[0]+n[0],e[1]+n[1]])})),s=ne(t[0].points);return{rings:t,bounds:s}});else{const[r,e,i,a]=t.split("-").map(e=>parseInt(e));s=o.map((t,s)=>{if(s===e){const e=t.rings.map((e,t)=>t===i?{points:e.points.map((e,t)=>t===a?[e[0]+n[0],e[1]+n[1]]:e)}:e),s=ne(e[0].points);return{rings:e,bounds:s}}return t})}return{...e,geometry:{polygons:s,bounds:ma(s)}}},x=e=>async t=>{t.stopPropagation();const n=a[e],o=i.polygons.map((e,t)=>{if(t===n.elementIdx){const t=e.rings.map((e,t)=>t===n.ringIdx?{points:[...e.points.slice(0,n.pointIdx+1),n.point,...e.points.slice(n.pointIdx+1)]}:e),s=ne(t[0].points);return{rings:t,bounds:s}}return e});g("change",{...r,geometry:{polygons:o,bounds:ma(o)}}),await pm();const s=[...document.querySelectorAll(".a9s-handle")][e+1];if(s!=null&&s.firstChild){const e=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:t.clientX,clientY:t.clientY,pointerId:t.pointerId,pointerType:t.pointerType,isPrimary:t.isPrimary,buttons:t.buttons});s.firstChild.dispatchEvent(e)}},C=()=>{const e=i.polygons.map((e,t)=>{if(s.some(e=>e.polygon===t)){const n=e.rings.map((e,n)=>{const o=s.filter(e=>e.polygon===t&&e.ring===n);return o.length&&e.points.length-o.length>=3?{points:e.points.filter((e,t)=>!o.some(e=>e.point===t))}:e}),o=ne(n[0].points);return{rings:n,bounds:o}}return e});!Cc(i.polygons,e)&&(g("change",{...r,geometry:{polygons:e,bounds:ma(e)}}),n(8,s=[]))};Ti(()=>{if(pe)return;const e=e=>{(e.key==="Delete"||e.key==="Backspace")&&(e.preventDefault(),C())};return o.addEventListener("pointermove",f),o.addEventListener("keydown",e),()=>{o.removeEventListener("pointermove",f),o.removeEventListener("keydown",e)}});const E=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,k=(e,t,n,{polygon:s,ring:o,point:i})=>s===e&&o===t&&i===n;function A(t){Y.call(this,e,t)}function S(t){Y.call(this,e,t)}function M(t){Y.call(this,e,t)}return e.$$set=e=>{"shape"in e&&n(0,r=e.shape),"computedStyle"in e&&n(1,p=e.computedStyle),"transform"in e&&n(2,u=e.transform),"viewportScale"in e&&n(3,c=e.viewportScale),"svgEl"in e&&n(4,o=e.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,i=r.geometry),e.$$.dirty[0]&40&&n(10,a=pe?[]:l8(i,c)),e.$$.dirty[0]&40&&n(9,v=cs(i.bounds,Fn/c))},[r,p,u,c,o,i,d,l,s,v,a,j,b,y,_,w,O,x,E,k,A,S,M]}Hm=class extends Je{constructor(e){super(),Mt(this,e,mg,dg,zt,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}},dl=new Map([[f.RECTANGLE,u8],[f.POLYGON,j8],[f.MULTIPOLYGON,Hm]]),vl=e=>dl.get(e.type),Lm=(e,t)=>dl.set(e,t);function km(t){let c,a,o,d,h,m,f,i,n,s;return{c(){c=r("defs"),a=r("mask"),o=r("rect"),i=r("rect"),n=r("rect"),s=r("rect"),e(o,"class","rect-mask-bg svelte-1a76qe7"),e(o,"x",d=t[1]-t[5]),e(o,"y",h=t[2]-t[5]),e(o,"width",m=t[3]+2*t[5]),e(o,"height",f=t[4]+2*t[5]),e(i,"class","rect-mask-fg svelte-1a76qe7"),e(i,"x",t[1]),e(i,"y",t[2]),e(i,"width",t[3]),e(i,"height",t[4]),e(a,"id",t[6]),e(a,"class","a9s-rubberband-rectangle-mask svelte-1a76qe7"),e(n,"class","a9s-outer"),e(n,"mask",`url(#${t[6]})`),e(n,"x",t[1]),e(n,"y",t[2]),e(n,"width",t[3]),e(n,"height",t[4]),e(s,"class","a9s-inner"),e(s,"x",t[1]),e(s,"y",t[2]),e(s,"width",t[3]),e(s,"height",t[4])},m(e,t){u(e,c,t),x(c,a),x(a,o),x(a,i),u(e,n,t),u(e,s,t)},p(t,a){a&34&&d!==(d=t[1]-t[5])&&e(o,"x",d),a&36&&h!==(h=t[2]-t[5])&&e(o,"y",h),a&40&&m!==(m=t[3]+2*t[5])&&e(o,"width",m),a&48&&f!==(f=t[4]+2*t[5])&&e(o,"height",f),a&2&&e(i,"x",t[1]),a&4&&e(i,"y",t[2]),a&8&&e(i,"width",t[3]),a&16&&e(i,"height",t[4]),a&2&&e(n,"x",t[1]),a&4&&e(n,"y",t[2]),a&8&&e(n,"width",t[3]),a&16&&e(n,"height",t[4]),a&2&&e(s,"x",t[1]),a&4&&e(s,"y",t[2]),a&8&&e(s,"width",t[3]),a&16&&e(s,"height",t[4])},d(e){e&&(l(c),l(n),l(s))}}}function pg(t){let s,n=t[0]&&km(t);return{c(){s=r("g"),n&&n.c(),e(s,"class","a9s-annotation a9s-rubberband")},m(e,t){u(e,s,t),n&&n.m(s,null)},p(e,[t]){e[0]?n?n.p(e,t):(n=km(e),n.c(),n.m(s,null)):n&&(n.d(1),n=null)},i:Ae,o:Ae,d(e){e&&l(s),n&&n.d()}}}function vg(e,t,n){let p;const v=ro();let{addEventListener:d}=t,{drawingMode:u}=t,{transform:l}=t,{viewportScale:h=1}=t,m,s,o,c,r,a,i;const b=e=>{const t=e;m=performance.now(),u==="drag"&&(n(0,s=l.elementToImage(t.offsetX,t.offsetY)),o=s,n(1,c=s[0]),n(2,r=s[1]),n(3,a=1),n(4,i=1))},j=e=>{const t=e;s&&(o=l.elementToImage(t.offsetX,t.offsetY),n(1,c=Math.min(o[0],s[0])),n(2,r=Math.min(o[1],s[1])),n(3,a=Math.abs(o[0]-s[0])),n(4,i=Math.abs(o[1]-s[1])))},y=e=>{const t=e,d=performance.now()-m;if(u==="click"){if(d>300)return;s?g():(n(0,s=l.elementToImage(t.offsetX,t.offsetY)),o=s,n(1,c=s[0]),n(2,r=s[1]),n(3,a=1),n(4,i=1))}else s&&(d>300||a*i>100?(t.stopPropagation(),g()):(n(0,s=0[0]),o=0[0]))},g=()=>{if(a*i>15){const e={type:f.RECTANGLE,geometry:{bounds:{minX:c,minY:r,maxX:c+a,maxY:r+i},x:c,y:r,w:a,h:i}};v("create",e)}n(0,s=0[0]),o=0[0]};Ti(()=>{d("pointerdown",b),d("pointermove",j),d("pointerup",y,!0)});const _=`rect-mask-${Math.random().toString(36).substring(2,12)}`;return e.$$set=e=>{"addEventListener"in e&&n(7,d=e.addEventListener),"drawingMode"in e&&n(8,u=e.drawingMode),"transform"in e&&n(9,l=e.transform),"viewportScale"in e&&n(10,h=e.viewportScale)},e.$$.update=()=>{e.$$.dirty&1024&&n(5,p=2/h)},[s,c,r,a,i,p,_,d,u,l,h]}ym=class extends Je{constructor(e){super(),Mt(this,e,vg,pg,zt,{addEventListener:7,drawingMode:8,transform:9,viewportScale:10})}};function Pl(e){const t=e.slice(),n=t[2].map(e=>e.join(",")).join(" ");return t[19]=n,t}function hm(t){let j,i,s,h,b,g,f,c,m,o,p,a,v,d,n=t[1]&&um(t);return{c(){j=r("defs"),i=r("mask"),s=r("rect"),c=r("polygon"),o=r("polygon"),a=r("polygon"),n&&n.c(),d=Qn(),e(s,"x",h=t[3].x),e(s,"y",b=t[3].y),e(s,"width",g=t[3].w),e(s,"height",f=t[3].h),e(s,"class","svelte-18wrg3t"),e(c,"points",m=t[19]),e(c,"class","svelte-18wrg3t"),e(i,"id",t[5]),e(i,"class","a9s-rubberband-polygon-mask svelte-18wrg3t"),e(o,"class","a9s-outer"),e(o,"mask",`url(#${t[5]})`),e(o,"points",p=t[19]),e(a,"class","a9s-inner"),e(a,"points",v=t[19])},m(e,t){u(e,j,t),x(j,i),x(i,s),x(i,c),u(e,o,t),u(e,a,t),n&&n.m(e,t),u(e,d,t)},p(t,i){i&8&&h!==(h=t[3].x)&&e(s,"x",h),i&8&&b!==(b=t[3].y)&&e(s,"y",b),i&8&&g!==(g=t[3].w)&&e(s,"width",g),i&8&&f!==(f=t[3].h)&&e(s,"height",f),i&4&&m!==(m=t[19])&&e(c,"points",m),i&4&&p!==(p=t[19])&&e(o,"points",p),i&4&&v!==(v=t[19])&&e(a,"points",v),t[1]?n?n.p(t,i):(n=um(t),n.c(),n.m(d.parentNode,d)):n&&(n.d(1),n=null)},d(e){e&&(l(j),l(o),l(a),l(d)),n&&n.d(e)}}}function um(t){let n,s,o;return{c(){n=r("circle"),e(n,"class","a9s-handle svelte-18wrg3t"),e(n,"cx",s=t[0][0][0]),e(n,"cy",o=t[0][0][1]),e(n,"r",t[4])},m(e,t){u(e,n,t)},p(t,i){i&1&&s!==(s=t[0][0][0])&&e(n,"cx",s),i&1&&o!==(o=t[0][0][1])&&e(n,"cy",o),i&16&&e(n,"r",t[4])},d(e){e&&l(n)}}}function kg(t){let s,n=t[3]&&hm(Pl(t));return{c(){s=r("g"),n&&n.c(),e(s,"class","a9s-annotation a9s-rubberband")},m(e,t){u(e,s,t),n&&n.m(s,null)},p(e,[t]){e[3]?n?n.p(Pl(e),t):(n=hm(Pl(e)),n.c(),n.m(s,null)):n&&(n.d(1),n=null)},i:Ae,o:Ae,d(e){e&&l(s),n&&n.d()}}}lm=20,cm=1500;function Sg(e,t,n){let g,d,m;const p=ro();let{addEventListener:i}=t,{drawingMode:h}=t,{transform:l}=t,{viewportScale:r=1}=t,u,s=[],o,c,a=!1;const j=e=>{const t=e,{timeStamp:i,offsetX:a,offsetY:r}=t;if(u={timeStamp:i,offsetX:a,offsetY:r},h==="drag"&&s.length===0){const e=l.elementToImage(t.offsetX,t.offsetY);s.push(e),n(10,o=e)}},y=e=>{const t=e;if(c&&clearTimeout(c),s.length>0){if(n(10,o=l.elementToImage(t.offsetX,t.offsetY)),s.length>2){const e=Ks(o,s[0])*r;n(1,a=e<lm)}t.pointerType==="touch"&&(c=setTimeout(()=>{v()},cm))}},_=e=>{const t=e;if(c&&clearTimeout(c),h==="click"){const e=t.timeStamp-u.timeStamp,i=Ks([u.offsetX,u.offsetY],[t.offsetX,t.offsetY]);if(e>300||i>15)return;if(a)b();else if(s.length===0){const e=l.elementToImage(t.offsetX,t.offsetY);s.push(e),n(10,o=e)}else o&&s.push(o)}else{if(!o)return;if(s.length===1&&Ks(s[0],o)<=4){n(0,s=[]),n(10,o=0[0]);return}t.stopImmediatePropagation(),a?b():s.push(o)}},v=()=>{if(!o)return;const e=s.slice(0,-1);if(e.length<3)return;const t={type:f.POLYGON,geometry:{bounds:ne(s),points:e}};Zi(t)>4&&(n(0,s=[]),n(10,o=0[0]),p("create",t))},b=()=>{const e={type:f.POLYGON,geometry:{bounds:ne(s),points:[...s]}};n(0,s=[]),n(10,o=0[0]),p("create",e)};Ti(()=>{i("pointerdown",j,!0),i("pointermove",y),i("pointerup",_,!0),i("dblclick",v,!0)});const w=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;return e.$$set=e=>{"addEventListener"in e&&n(6,i=e.addEventListener),"drawingMode"in e&&n(7,h=e.drawingMode),"transform"in e&&n(8,l=e.transform),"viewportScale"in e&&n(9,r=e.viewportScale)},e.$$.update=()=>{e.$$.dirty&512&&n(4,g=4/r),e.$$.dirty&1027&&n(2,d=o?a?s:[...s,o]:[]),e.$$.dirty&516&&n(3,m=d.length>0?cs(ne(d),2/r):0[0])},[s,a,d,m,g,w,i,h,l,r,o]}im=class extends Je{constructor(e){super(),Mt(this,e,Sg,kg,zt,{addEventListener:6,drawingMode:7,transform:8,viewportScale:9})}},ui=new Map([["rectangle",{tool:ym}],["polygon",{tool:im}]]),fd=()=>[...ui.keys()],_d=e=>ui.get(e),om=(e,t,n={})=>ui.set(e,{tool:t,opts:n});function nm(e,t,n=0,s=e.length-1,o=Mg){for(;s>n;){if(s-n>600){const i=s-n+1,r=t-n+1,c=Math.log(i),a=.5*Math.exp(2*c/3),l=.5*(c*a*(i-a)/i)**.5*(r-i/2<0?-1:1),d=Math.max(n,Math.floor(t-r*a/i+l)),u=Math.min(s,Math.floor(t+(i-r)*a/i+l));nm(e,t,d,u,o)}const r=e[t];let a=n,i=s;for(Mo(e,n,t),o(e[s],r)>0&&Mo(e,n,s);a<i;){for(Mo(e,a,i),a++,i--;o(e[a],r)<0;)a++;for(;o(e[i],r)>0;)i--}o(e[n],r)===0?Mo(e,n,i):(i++,Mo(e,i,s)),i<=t&&(n=i+1),t<=i&&(s=i-1)}}function Mo(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function Mg(e,t){return e<t?-1:e>t?1:0}em=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!Wo(e,t))return n;const o=this.toBBox,s=[];for(;t;){for(let a=0;a<t.children.length;a++){const i=t.children[a],r=t.leaf?o(i):i;Wo(e,r)&&(t.leaf?n.push(i):fu(e,r)?this._all(i,n):s.push(i))}t=s.pop()}return n}collides(e){let t=this.data;if(!Wo(e,t))return!1;const n=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],i=t.leaf?this.toBBox(o):o;if(Wo(e,i)){if(t.leaf||fu(e,i))return!0;n.push(o)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Mn([]),this}remove(e,t){if(!e)return this;let n=this.data;const c=this.toBBox(e),s=[],r=[];let o,i,a;for(;n||s.length;){if(n||(n=s.pop(),i=s[s.length-1],o=r.pop(),a=!0),n.leaf){const o=Tg(e,n.children,t);if(o!==-1)return n.children.splice(o,1),s.push(n),this._condense(s),this}!a&&!n.leaf&&fu(n,c)?(s.push(n),r.push(o),o=0,i=n,n=n.children[0]):i?(o++,n=i.children[o],a=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,s){const a=n-t+1;let i=this._maxEntries,o;if(a<=i)return o=Mn(e.slice(t,n+1)),Ln(o,this.toBBox),o;s||(s=Math.ceil(Math.log(a)/Math.log(i)),i=Math.ceil(a/i**(s-1))),o=Mn([]),o.leaf=!1,o.height=s;const r=Math.ceil(a/i),c=r*Math.ceil(i**.5);Wh(e,t,n,c,this.compareMinX);for(let i=t;i<=n;i+=c){const a=Math.min(i+c-1,n);Wh(e,i,a,r,this.compareMinY);for(let t=i;t<=a;t+=r){const n=Math.min(t+r-1,a);o.children.push(this._build(e,t,n,s-1))}}return Ln(o,this.toBBox),o}_chooseSubtree(e,t,n,s){for(;s.push(t),!t.leaf&&s.length-1!==n;){let o=1/0,i=1/0,a;for(let r=0;r<t.children.length;r++){const s=t.children[r],n=_u(s),c=Lg(e,s)-n;c<i?(i=c,o=n<o?n:o,a=s):c===i&&n<o&&(o=n,a=s)}t=a||t.children[0]}return t}_insert(e,t,n){const o=n?e:this.toBBox(e),s=[],i=this._chooseSubtree(o,this.data,t,s);for(i.children.push(e),Lo(i,o);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(o,s,t)}_split(e,t){const n=e[t],o=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,o);const a=this._chooseSplitIndex(n,i,o),s=Mn(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,Ln(n,this.toBBox),Ln(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)}_splitRoot(e,t){this.data=Mn([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ln(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let o,i=1/0,s=1/0;for(let a=t;a<=n-t;a++){const l=No(e,0,a,this.toBBox),d=No(e,a,n,this.toBBox),c=Pg(l,d),r=_u(l)+_u(d);c<i?(i=c,o=a,s=r<s?r:s):c===i&&r<s&&(s=r,o=a)}return o||n-t}_chooseSplitAxis(e,t,n){const s=e.leaf?this.compareMinX:Dg,o=e.leaf?this.compareMinY:Ng,i=this._allDistMargin(e,t,n,s),a=this._allDistMargin(e,t,n,o);i<a&&e.children.sort(s)}_allDistMargin(e,t,n,s){e.children.sort(s);const o=this.toBBox,i=No(e,0,t,o),a=No(e,n-t,n,o);let r=Io(i)+Io(a);for(let s=t;s<n-t;s++){const a=e.children[s];Lo(i,e.leaf?o(a):a),r+=Io(i)}for(let s=n-t-1;s>=t;s--){const i=e.children[s];Lo(a,e.leaf?o(i):i),r+=Io(a)}return r}_adjustParentBBoxes(e,t,n){for(let s=n;s>=0;s--)Lo(t[s],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():Ln(e[t],this.toBBox)}};function Tg(e,t,n){if(!n)return t.indexOf(e);for(let s=0;s<t.length;s++)if(n(e,t[s]))return s;return-1}function Ln(e,t){No(e,0,e.children.length,t,e)}function No(e,t,n,s,o){o||(o=Mn(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i=t;i<n;i++){const a=e.children[i];Lo(o,e.leaf?s(a):a)}return o}function Lo(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Dg(e,t){return e.minX-t.minX}function Ng(e,t){return e.minY-t.minY}function _u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Io(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Lg(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function Pg(e,t){const n=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,o-n)*Math.max(0,i-s)}function fu(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Wo(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Mn(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Wh(e,t,n,s,o){const i=[t,n];for(;i.length;){if(n=i.pop(),t=i.pop(),n-t<=s)continue;const a=t+Math.ceil((n-t)/s/2)*s;nm(e,a,t,n,o),i.push(t,a,a,n)}}$h=()=>{const e=new em,t=new Map,i=()=>[...t.values()],n=()=>{e.clear(),t.clear()},s=n=>{if(!Ns(n))return;const{minX:o,minY:i,maxX:a,maxY:r}=n.selector.geometry.bounds,s={minX:o,minY:i,maxX:a,maxY:r,target:n};e.insert(s),t.set(n.annotation,s)},o=n=>{if(!Ns(n))return;const s=t.get(n.annotation);s&&e.remove(s),t.delete(n.annotation)};return{all:i,clear:n,getAt:(t,n,s=0)=>{const o=e.search({minX:t-s,minY:n-s,maxX:t+s,maxY:n+s}).map(e=>e.target).filter(e=>e.selector.type===f.RECTANGLE||Im(e.selector,t,n,s));return o.length>0?(o.sort((e,t)=>Zi(e.selector)-Zi(t.selector)),o):[]},getIntersecting:(t,n,s,o)=>e.search({minX:t,minY:n,maxX:t+s,maxY:n+o}).map(e=>e.target),insert:s,remove:o,set:(s,o=!0)=>{o&&n();const i=s.reduce((e,t)=>{if(Ns(t)){const{minX:n,minY:s,maxX:o,maxY:i}=t.selector.geometry.bounds;return[...e,{minX:n,minY:s,maxX:o,maxY:i,target:t}]}return e},[]);i.forEach(e=>t.set(e.target.annotation,e)),e.load(i)},size:()=>e.all().length,update:(e,t)=>{o(e),s(t)}}},Ih=e=>{const t=$f(),n=$h(),s=$6(t,e.userSelectAction,e.adapter),o=W6(t),i=Bf();return t.observe(({changes:e})=>{n.set((e.created||[]).map(e=>e.target),!1),(e.deleted||[]).forEach(e=>n.remove(e.target)),(e.updated||[]).forEach(({oldValue:e,newValue:t})=>n.update(e.target,t.target))}),{store:{...t,getAt:(e,s,o,i)=>{const a=n.getAt(e,s,i);if(o)return a.map(e=>t.getAnnotation(e.annotation)).filter(Boolean).filter(o)[0];{const e=a[0];return e?t.getAnnotation(e.annotation):0[0]}},getIntersecting:(e,s,o,i)=>n.getIntersecting(e,s,o,i).map(e=>t.getAnnotation(e.annotation)).filter(Boolean)},selection:s,hover:o,viewport:i}},Hh=e=>{let t,n;if(e.nodeName==="CANVAS")t=e,n=t.getContext("2d",{willReadFrequently:!0});else{const s=e;t=document.createElement("canvas"),t.width=s.width,t.height=s.height,n=t.getContext("2d",{willReadFrequently:!0}),n.drawImage(s,0,0,s.width,s.height)}let s=0;for(let e=1;e<10;e++)for(let o=1;o<10;o++){const a=Math.round(o*t.width/10),r=Math.round(e*t.height/10),i=n.getImageData(a,r,1,1).data,c=(.299*i[0]+.587*i[1]+.114*i[2])/255;s+=c}return s/81},Ph=e=>{const t=Hh(e),n=t>.6?"dark":"light";return console.log(`[Annotorious] Image brightness: ${t.toFixed(1)}. Setting ${n} theme.`),n},Lh=(e,t)=>({...e,drawingEnabled:e.drawingEnabled===0[0]?t.drawingEnabled:e.drawingEnabled,drawingMode:e.drawingMode||t.drawingMode,userSelectAction:e.userSelectAction||t.userSelectAction,theme:e.theme||t.theme}),Bd=!(typeof navigator>"u")&&navigator.userAgent.indexOf("Mac OS X")!==-1,Dh=(e,t)=>{const n=t||document,s=t=>{const n=t;n.key==="z"&&n.ctrlKey?e.undo():n.key==="y"&&n.ctrlKey&&e.redo()},o=t=>{const n=t;n.key==="z"&&n.metaKey&&(n.shiftKey?e.redo():e.undo())},i=()=>{Bd?n.removeEventListener("keydown",o):n.removeEventListener("keydown",s)};return Bd?n.addEventListener("keydown",o):n.addEventListener("keydown",s),{destroy:i}};function N(){}function Yg(e,t){for(const n in t)e[n]=t[n];return e}function Th(e){return e()}function Fh(){return Object.create(null)}function Ao(e){e.forEach(Th)}function wd(e){return typeof e=="function"}function U(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Qg(e){return Object.keys(e).length===0}function Zg(t,...n){if(t==null){for(const e of n)e(0[0]);return N}const e=t.subscribe(...n);return e.unsubscribe?()=>e.unsubscribe():e}function Eo(e,t,n){e.$$.on_destroy.push(Zg(t,n))}function Jg(e,t,n,s){if(e){const o=kh(e,t,n,s);return e[0](o)}}function kh(e,t,n,s){return e[1]&&s?Yg(n.ctx.slice(),e[1](s(t))):n.ctx}function e5(e,t,n,s){if(e[2]&&s){const o=e[2](s(n));if(t.dirty===0[0])return o;if(typeof o=="object"){const e=[],n=Math.max(t.dirty.length,o.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|o[s];return e}return t.dirty|o}return t.dirty}function n5(e,t,n,s,o,i){if(o){const a=kh(t,n,s,i);e.p(a,o)}}function o5(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}pi=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Re(e,t){e.appendChild(t)}function S(e,t,n){e.insertBefore(t,n||null)}function C(e){e.parentNode&&e.parentNode.removeChild(e)}function ji(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function F(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Oh(e){return document.createTextNode(e)}function st(){return Oh("")}function i5(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function t(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function a5(e){return Array.from(e.childNodes)}function r5(e,t){t=""+t,e.data!==t&&(e.data=t)}function zn(e,t,n){e.classList.toggle(t,!!n)}function c5(e,t,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:s})}function oo(e){io=e}function al(){if(!io)throw new Error("Function called outside component initialization");return io}function so(e){al().$$.on_mount.push(e)}function l5(e){al().$$.on_destroy.push(e)}function sl(){const e=al();return(t,n,{cancelable:s=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=c5(t,n,{cancelable:s});return o.slice().forEach(t=>{t.call(e,i)}),!i.defaultPrevented}return!0}}Kt=[],Qs=[],cn=[],Kc=[],ph=Promise.resolve(),Vi=!1;function d5(){Vi||(Vi=!0,ph.then(lh))}function zc(e){cn.push(e)}Ki=new Set,Yt=0;function lh(){if(Yt!==0)return;const e=io;do{try{for(;Yt<Kt.length;){const e=Kt[Yt];Yt++,oo(e),m5(e.$$)}}catch(e){throw Kt.length=0,Yt=0,e}for(oo(null),Kt.length=0,Yt=0;Qs.length;)Qs.pop()();for(let e=0;e<cn.length;e+=1){const t=cn[e];Ki.has(t)||(Ki.add(t),t())}cn.length=0}while(Kt.length)for(;Kc.length;)Kc.pop()();Vi=!1,Ki.clear(),oo(e)}function m5(e){if(e.fragment!==null){e.update(),Ao(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(zc)}}function f5(e){const t=[],n=[];cn.forEach(s=>e.indexOf(s)===-1?t.push(s):n.push(s)),n.forEach(e=>e()),cn=t}Bs=new Set;function ye(){qt={r:0,c:[],p:qt}}function je(){qt.r||Ao(qt.c),qt=qt.p}function h(e,t){e&&e.i&&(Bs.delete(e),e.i(t))}function p(e,t,n,s){if(e&&e.o){if(Bs.has(e))return;Bs.add(e),qt.c.push(()=>{Bs.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}else s&&s()}function Dt(e){return e?.length!==0[0]?e:Array.from(e)}function oe(e){e&&e.c()}function Z(e,t,n){const{fragment:s,after_update:o}=e.$$;s&&s.m(t,n),zc(()=>{const t=e.$$.on_mount.map(Th).filter(wd);e.$$.on_destroy?e.$$.on_destroy.push(...t):Ao(t),e.$$.on_mount=[]}),o.forEach(zc)}function ee(e,t){const n=e.$$;n.fragment!==null&&(f5(n.after_update),Ao(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function b5(e,t){e.$$.dirty[0]===-1&&(Kt.push(e),d5(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function te(e,t,n,s,o,i,a=null,r=[-1]){const l=io;oo(e);const c=e.$$={fragment:null,ctx:[],props:i,update:N,not_equal:o,bound:Fh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Fh(),dirty:r,skip_bound:!1,root:t.target||l.$$.root};a&&a(c.root);let d=!1;if(c.ctx=n?n(e,t.props||{},(t,n,...s)=>{const i=s.length?s[0]:n;return c.ctx&&o(c.ctx[t],c.ctx[t]=i)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](i),d&&b5(e,t)),n}):[],c.update(),d=!0,Ao(c.before_update),c.fragment=!!s&&s(c.ctx),t.target){if(t.hydrate){const e=a5(t.target);c.fragment&&c.fragment.l(e),e.forEach(C)}else c.fragment&&c.fragment.c();t.intro&&h(e.$$.fragment),Z(e,t.target,t.anchor),lh()}oo(l)}Q=class{constructor(){Kd(this,"$$"),Kd(this,"$$set")}$destroy(){ee(this,1),this.$destroy=N}$on(e,t){if(!wd(t))return N;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);e!==-1&&n.splice(e,1)}}$set(e){this.$$set&&!Qg(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}},sh="4",typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sh),we=(e=>(e.ELLIPSE="ELLIPSE",e.MULTIPOLYGON="MULTIPOLYGON",e.POLYGON="POLYGON",e.POLYLINE="POLYLINE",e.RECTANGLE="RECTANGLE",e.LINE="LINE",e))(we||{}),En=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function j5(e){if(e.__esModule)return e;var t,n=e.default;return typeof n=="function"?(t=function e(){return this instanceof e?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)},t.prototype=n.prototype):t={},Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),t}uc={exports:{}},function(e){(function(){function s(e,t){var n=e.x-t.x,s=e.y-t.y;return n*n+s*s}function o(e,t,n){var r,i=t.x,a=t.y,s=n.x-i,o=n.y-a;return(s!==0||o!==0)&&(r=((e.x-i)*s+(e.y-a)*o)/(s*s+o*o),r>1?(i=n.x,a=n.y):r>0&&(i+=s*r,a+=o*r)),s=e.x-i,o=e.y-a,s*s+o*o}function i(e,t){for(var n,o=e[0],i=[o],a=1,r=e.length;a<r;a++)n=e[a],s(n,o)>t&&(i.push(n),o=n);return o!==n&&i.push(n),i}function t(e,n,s,i,a){for(var r,d,l=i,c=n+1;c<s;c++)d=o(e[c],e[n],e[s]),d>l&&(r=c,l=d);l>i&&(r-n>1&&t(e,n,r,i,a),a.push(e[r]),s-r>1&&t(e,r,s,i,a))}function a(e,n){var o=e.length-1,s=[e[0]];return t(e,0,o,n,s),s.push(e[o]),s}function n(e,t,n){if(e.length<=2)return e;var s=t!==0[0]?t*t:1;return e=n?e:i(e,s),e=a(e,s),e}e.exports=n,e.exports.default=n})()}(uc),Z3=uc.exports,G3=mc(Z3),Zt=(e,t)=>t,ya=e=>{let t=1/0,n=1/0,s=-1/0,o=-1/0;return e.forEach(([e,i])=>{t=Math.min(t,e),n=Math.min(n,i),s=Math.max(s,e),o=Math.max(o,i)}),{minX:t,minY:n,maxX:s,maxY:o}},fs=e=>{let n=0,t=e.length-1;for(let s=0;s<e.length;s++)n+=(e[t][0]+e[s][0])*(e[t][1]-e[s][1]),t=s;return Math.abs(.5*n)},ms=(e,t,n)=>{let s=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const r=e[o][0],a=e[o][1],l=e[i][0],c=e[i][1];a>n!=c>n&&t<(l-r)*(n-a)/(c-a)+r&&(s=!s)}return s},ic=(e,t=1)=>{const n=e.map(([e,t])=>({x:e,y:t}));return G3(n,t,!0).map(e=>[e.x,e.y])},Y3=(e,t)=>{const n=Math.abs(t[0]-e[0]),s=Math.abs(t[1]-e[1]);return(n**2+s**2)**.5},V3={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:h,cy:m,rx:s,ry:o}=e.geometry,i=0,a=Math.cos(i),r=Math.sin(i),c=t-h,l=n-m,d=a*c+r*l,u=r*c-a*l;return d*d/(s*s)+u*u/(o*o)<=1}},Zt(we.ELLIPSE,V3),I3={area:e=>0,intersects:(e,t,n,s=2)=>{const[[o,i],[a,r]]=e.geometry.points,c=Math.abs((r-i)*t-(a-o)*n+a*i-r*o),l=Y3([o,i],[a,r]);return c/l<=s}},Zt(we.LINE,I3),H3={area:e=>{const{polygons:t}=e.geometry;return t.reduce((e,t)=>{const[n,...s]=t.rings,o=fs(n.points),i=s.reduce((e,t)=>e+fs(t.points),0);return e+o-i},0)},intersects:(e,t,n)=>{const{polygons:s}=e.geometry;for(const e of s){const[o,...i]=e.rings;if(ms(o.points,t,n)){let e=!1;for(const s of i)if(ms(s.points,t,n)){e=!0;break}if(!e)return!0}}return!1}},N3=e=>{const t=e.reduce((e,t)=>[...e,...t.rings[0].points],[]);return ya(t)},z3=(e,t=1)=>{const n=e.geometry.polygons.map(e=>{const n=e.rings.map(e=>{const n=ic(e.points,t);return{...e,points:n}}),s=ya(n[0].points);return{...e,rings:n,bounds:s}}),s=N3(n);return{...e,geometry:{...e.geometry,polygons:n,bounds:s}}},Zt(we.MULTIPOLYGON,H3),S3={area:e=>{const t=e.geometry.points;return fs(t)},intersects:(e,t,n)=>{const s=e.geometry.points;return ms(s,t,n)}},A3=(e,t=1)=>{const n=ic(e.geometry.points,t),s=ya(n);return{...e,geometry:{...e.geometry,bounds:s,points:n}}},Zt(we.POLYGON,S3),k3={area:e=>{const t=e.geometry;if(!t.closed||t.points.length<3)return 0;const n=Rr(t.points,t.closed);return fs(n)},intersects:(e,t,n,s=2)=>{const o=e.geometry;if(o.closed){const e=Rr(o.points,o.closed);return ms(e,t,n)}return E3(o,[t,n],s)}},Rr=(e,t=!1)=>{const n=[];for(let o=0;o<e.length;o++){const s=e[o],i=e[(o+1)%e.length];if(n.push(s.point),(o<e.length-1||t)&&(s.type==="CURVE"||i.type=="CURVE")){const e=Cr(s.point,s.type==="CURVE"&&s.outHandle||s.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,10);n.push(...e.slice(1))}}return n},Cr=(e,t,n,s,o=10)=>{const i=[];for(let r=0;r<=o;r++){const a=r/o,c=(1-a)**3*e[0]+3*(1-a)**2*a*t[0]+3*(1-a)*a**2*n[0]+a**3*s[0],l=(1-a)**3*e[1]+3*(1-a)**2*a*t[1]+3*(1-a)*a**2*n[1]+a**3*s[1];i.push([c,l])}return i},E3=(e,t,n)=>{for(let i=0;i<e.points.length-1;i++){const s=e.points[i],o=e.points[i+1];if(s.type==="CURVE"||o.type==="CURVE"){{const e=Cr(s.point,s.type==="CURVE"&&s.outHandle||s.point,o.type==="CURVE"&&o.inHandle||o.point,o.point,20);for(let s=0;s<e.length-1;s++)if(Or(t,e[s],e[s+1])<=n)return!0}}else if(Or(t,s.point,o.point)<=n)return!0}return!1},Or=(e,t,n)=>{const[s,o]=e,[i,a]=t,[r,c]=n,d=r-i,u=c-a,l=(d*d+u*u)**.5;if(l===0)return((s-i)*(s-i)+(o-a)*(o-a))**.5;const h=((s-i)*d+(o-a)*u)/(l*l);return h<=0?((s-i)*(s-i)+(o-a)*(o-a))**.5:h>=1?((s-r)*(s-r)+(o-c)*(o-c))**.5:Math.abs((c-a)*s-(r-i)*o+r*a-c*i)/l},Zt(we.POLYLINE,k3),x3={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h},Zt(we.RECTANGLE,x3),X=[];for(let e=0;e<256;++e)X.push((e+256).toString(16).slice(1));function k5(e,t=0){return(X[e[t+0]]+X[e[t+1]]+X[e[t+2]]+X[e[t+3]]+"-"+X[e[t+4]]+X[e[t+5]]+"-"+X[e[t+6]]+X[e[t+7]]+"-"+X[e[t+8]]+X[e[t+9]]+"-"+X[e[t+10]]+X[e[t+11]]+X[e[t+12]]+X[e[t+13]]+X[e[t+14]]+X[e[t+15]]).toLowerCase()}w3=new Uint8Array(16);function A5(){if(!br){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");br=crypto.getRandomValues.bind(crypto)}return br(w3)}y3=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),or={randomUUID:y3};function S5(e){var o;e=e||{};const s=e.random??((o=e.rng)==null?0[0]:o.call(e))??A5();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,k5(s)}function xp(e){return or.randomUUID&&!e?or.randomUUID():S5(e)}v3=(e,t)=>{const n=typeof t=="function"?t(e):t;if(n){const{fill:t,fillOpacity:s,stroke:o,strokeWidth:i,strokeOpacity:a}=n;let e="";return t&&(e+=`fill:${t};`),s||s===0?e+=`fill-opacity:${s};`:t&&(e+="fill-opacity:0.25;"),o&&(e+=`stroke:${o};`,e+=`stroke-width:${i||"1"};`,e+=`stroke-opacity:${a||"1"};`),e}},Ov=!(typeof window>"u"||typeof navigator>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),we.RECTANGLE,we.POLYGON,we.MULTIPOLYGON;function fv(e,t,n){let i;const l=sl();let{annotation:o}=t,{editor:d}=t,{style:u}=t,{target:a}=t,{transform:r}=t,{viewportScale:c}=t,s;return so(()=>(n(6,s=new d({target:a,props:{shape:o.target.selector,computedStyle:i,transform:r,viewportScale:c,svgEl:a.closest("svg")}})),s.$on("change",e=>{s.$$set({shape:e.detail}),l("change",e.detail)}),s.$on("grab",e=>l("grab",e.detail)),s.$on("release",e=>l("release",e.detail)),()=>{s.$destroy()})),e.$$set=e=>{"annotation"in e&&n(0,o=e.annotation),"editor"in e&&n(1,d=e.editor),"style"in e&&n(2,u=e.style),"target"in e&&n(3,a=e.target),"transform"in e&&n(4,r=e.transform),"viewportScale"in e&&n(5,c=e.viewportScale)},e.$$.update=()=>{e.$$.dirty&5&&n(7,i=v3(o,u)),e.$$.dirty&65&&o&&(s==null||s.$set({shape:o.target.selector})),e.$$.dirty&80&&s&&s.$set({transform:r}),e.$$.dirty&96&&s&&s.$set({viewportScale:c}),e.$$.dirty&192&&s&&i&&s.$set({computedStyle:i})},[o,d,u,a,r,c,s,i]}f3=class extends Q{constructor(e){super(),te(this,e,fv,null,U,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5})}},!(typeof navigator>"u")&&navigator.userAgent.indexOf("Mac OS X")!==-1,_t=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(_t||{}),Za=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(Za||{}),Po=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(Po||{}),d=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(d||{}),Ce=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Ce||{}),n=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(n||{}),an=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(an||{}),c=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(c||{}),o=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(o||{}),Ve=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(Ve||{}),Ye=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(Ye||{}),ke=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(ke||{}),se=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(se||{}),Se=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Se||{}),$a=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))($a||{}),ce=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(ce||{}),R=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(R||{}),D=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(D||{}),Ee=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(Ee||{}),m3={createCanvas:(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,"text/xml")},i={ADAPTER:m3,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},Ha=/iPhone/i,yr=/iPod/i,_r=/iPad/i,wr=/\biOS-universal(?:.+)Mac\b/i,La=/\bAndroid(?:.+)Mobile\b/i,xr=/Android/i,en=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,xs=/Silk/i,Le=/Windows Phone/i,Ar=/\bWindows(?:.+)ARM\b/i,Sr=/BlackBerry/i,Mr=/BB10/i,Fr=/Opera Mini/i,Tr=/\b(CriOS|Chrome)(?:.+)Mobile/i,zr=/Mobile(?:.+)Firefox\b/i,Dr=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function z5(e){return function(t){return t.test(e)}}function u3(e){s={userAgent:"",platform:"",maxTouchPoints:0},!e&&typeof navigator<"u"?s={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?s.userAgent=e:e&&e.userAgent&&(s={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var t,n,s,o=s.userAgent,i=o.split("[FBAN");return typeof i[1]<"u"&&(o=i[0]),i=o.split("Twitter"),typeof i[1]<"u"&&(o=i[0]),t=z5(o),n={apple:{phone:t(Ha)&&!t(Le),ipod:t(yr),tablet:!t(Ha)&&(t(_r)||Dr(s))&&!t(Le),universal:t(wr),device:(t(Ha)||t(yr)||t(_r)||t(wr)||Dr(s))&&!t(Le)},amazon:{phone:t(en),tablet:!t(en)&&t(xs),device:t(en)||t(xs)},android:{phone:!t(Le)&&t(en)||!t(Le)&&t(La),tablet:!t(Le)&&!t(en)&&!t(La)&&(t(xs)||t(xr)),device:!t(Le)&&(t(en)||t(xs)||t(La)||t(xr))||t(/\bokhttp\b/i)},windows:{phone:t(Le),tablet:t(Ar),device:t(Le)||t(Ar)},other:{blackberry:t(Sr),blackberry10:t(Mr),opera:t(Fr),firefox:t(zr),chrome:t(Tr),device:t(Sr)||t(Mr)||t(Fr)||t(zr)||t(Tr)},any:!1,phone:!1,tablet:!1},n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}d3=u3.default??u3,Be=d3(globalThis.navigator),i.RETINA_PREFIX=/@([0-9.]+)x/,i.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1,Hr={exports:{}},function(e){var a=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1));function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,s,o,i){if(typeof s!="function")throw new TypeError("The listener must be a function");var c=new r(s,o||e,i),a=n?n+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function o(e,t){--e._eventsCount===0?e._events=new s:delete e._events[t]}function t(){this._events=new s,this._eventsCount=0}t.prototype.eventNames=function(){var t,s,e=[];if(this._eventsCount===0)return e;for(t in s=this._events)a.call(s,t)&&e.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(s)):e},t.prototype.listeners=function(e){if(o=n?n+e:e,t=this._events[o],!t)return[];if(t.fn)return[t.fn];for(var t,o,s=0,i=t.length,a=new Array(i);s<i;s++)a[s]=t[s].fn;return a},t.prototype.listenerCount=function(e){var s=n?n+e:e,t=this._events[s];return t?t.fn?1:t.length:0},t.prototype.emit=function(e,t,s,o,i,a){if(h=n?n+e:e,!this._events[h])return!1;var c,l,u,h,m,r=this._events[h],d=arguments.length;if(r.fn){switch(r.once&&this.removeListener(e,r.fn,0[0],!0),d){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,t),!0;case 3:return r.fn.call(r.context,t,s),!0;case 4:return r.fn.call(r.context,t,s,o),!0;case 5:return r.fn.call(r.context,t,s,o,i),!0;case 6:return r.fn.call(r.context,t,s,o,i,a),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];r.fn.apply(r.context,l)}else{m=r.length;for(c=0;c<m;c++)switch(r[c].once&&this.removeListener(e,r[c].fn,0[0],!0),d){case 1:r[c].fn.call(r[c].context);break;case 2:r[c].fn.call(r[c].context,t);break;case 3:r[c].fn.call(r[c].context,t,s);break;case 4:r[c].fn.call(r[c].context,t,s,o);break;default:if(!l)for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];r[c].fn.apply(r[c].context,l)}}return!0},t.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},t.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},t.prototype.removeListener=function(e,t,s,i){if(r=n?n+e:e,!this._events[r])return this;if(!t)return o(this,r),this;if(a=this._events[r],a.fn)a.fn===t&&(!i||a.once)&&(!s||a.context===s)&&o(this,r);else{for(var a,r,c=0,l=[],d=a.length;c<d;c++)(a[c].fn!==t||i&&!a[c].once||s&&a[c].context!==s)&&l.push(a[c]);l.length?this._events[r]=l.length===1?l[0]:l:o(this,r)}return this},t.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},t.prototype.off=t.prototype.removeListener,t.prototype.addListener=t.prototype.on,t.prefixed=n,t.EventEmitter=t,e.exports=t}(Hr),l3=Hr.exports,ns=mc(l3),Sa={exports:{}},Sa.exports=Aa,Sa.exports.default=Aa;function Aa(e,t,n){n=n||2;var o,i,a,r,c,l,d,u,m=t&&t.length,f=m?t[0]*n:e.length,s=a3(e,0,f,n,!0),h=[];if(!s||s.next===s.prev)return h;if(m&&(s=H5(e,t,s,n)),e.length>80*n){o=d=e[0],i=u=e[1];for(l=n;l<f;l+=n)a=e[l],r=e[l+1],a<o&&(o=a),r<i&&(i=r),a>d&&(d=a),r>u&&(u=r);c=Math.max(d-o,u-i),c=c!==0?32767/c:0}return Ds(s,h,n,o,i,c,0),h}function a3(e,t,n,s,o){var i,a;if(o===yc(e,t,n,s)>0)for(i=t;i<n;i+=s)a=N2(i,e[i],e[i+1],a);else for(i=n-s;i>=t;i-=s)a=N2(i,e[i],e[i+1],a);return a&&ja(a,a.next)&&(Ws(a),a=a.next),a}function Wt(e,t){if(!e)return e;t||(t=e);var s,n=e;do if(s=!1,!n.steiner&&(ja(n,n.next)||A(n.prev,n,n.next)===0)){if(Ws(n),n=t=n.prev,n===n.next)break;s=!0}else n=n.next;while(s||n!==t)return t}function Ds(e,t,n,s,o,i,a){if(e){!a&&i&&W5(e,s,o,i);for(var r,l,c=e;e.prev!==e.next;){if(l=e.prev,r=e.next,i?N5(e,s,o,i):D5(e)){t.push(l.i/n|0),t.push(e.i/n|0),t.push(r.i/n|0),Ws(e),e=r.next,c=r.next;continue}if(e=r,e===c){a?a===1?(e=L5(Wt(e),t,n),Ds(e,t,n,s,o,i,2)):a===2&&P5(e,t,n,s,o,i):Ds(Wt(e),t,n,s,o,i,1);break}}}}function D5(e){var c=e.prev,d=e,l=e.next;if(A(c,d,l)>=0)return!1;for(var a=c.x,i=d.x,n=l.x,o=c.y,r=d.y,s=l.y,u=a<i?a<n?a:n:i<n?i:n,h=o<r?o<s?o:s:r<s?r:s,m=a>i?a>n?a:n:i>n?i:n,f=o>r?o>s?o:s:r>s?r:s,t=l.next;t!==c;){if(t.x>=u&&t.x<=m&&t.y>=h&&t.y<=f&&Wn(a,o,i,r,n,s,t.x,t.y)&&A(t.prev,t,t.next)>=0)return!1;t=t.next}return!0}function N5(e,t,n,s){var h=e.prev,b=e,m=e.next;if(A(h,b,m)>=0)return!1;for(var u=h.x,c=b.x,a=m.x,l=h.y,d=b.y,r=m.y,f=u<c?u<a?u:a:c<a?c:a,p=l<d?l<r?l:r:d<r?d:r,g=u>c?u>a?u:a:c>a?c:a,v=l>d?l>r?l:r:d>r?d:r,j=oc(f,p,t,n,s),y=oc(g,v,t,n,s),i=e.prevZ,o=e.nextZ;i&&i.z>=j&&o&&o.z<=y;){if(i.x>=f&&i.x<=g&&i.y>=p&&i.y<=v&&i!==h&&i!==m&&Wn(u,l,c,d,a,r,i.x,i.y)&&A(i.prev,i,i.next)>=0||(i=i.prevZ,o.x>=f&&o.x<=g&&o.y>=p&&o.y<=v&&o!==h&&o!==m&&Wn(u,l,c,d,a,r,o.x,o.y)&&A(o.prev,o,o.next)>=0))return!1;o=o.nextZ}for(;i&&i.z>=j;){if(i.x>=f&&i.x<=g&&i.y>=p&&i.y<=v&&i!==h&&i!==m&&Wn(u,l,c,d,a,r,i.x,i.y)&&A(i.prev,i,i.next)>=0)return!1;i=i.prevZ}for(;o&&o.z<=y;){if(o.x>=f&&o.x<=g&&o.y>=p&&o.y<=v&&o!==h&&o!==m&&Wn(u,l,c,d,a,r,o.x,o.y)&&A(o.prev,o,o.next)>=0)return!1;o=o.nextZ}return!0}function L5(e,t,n){s=e;do{var s,i=s.prev,o=s.next.next;!ja(i,o)&&H2(i,s,s.next,o)&&Is(i,o)&&Is(o,i)&&(t.push(i.i/n|0),t.push(s.i/n|0),t.push(o.i/n|0),Ws(s),Ws(s.next),s=e=o),s=s.next}while(s!==e)return Wt(s)}function P5(e,t,n,s,o,i){var r,c,a=e;do{for(r=a.next.next;r!==a.prev;){if(a.i!==r.i&&q5(a,r)){c=L2(a,r),a=Wt(a,a.next),c=Wt(c,c.next),Ds(a,t,n,s,o,i,0),Ds(c,t,n,s,o,i,0);return}r=r.next}a=a.next}while(a!==e)}function H5(e,t,n,s){var o,i,r,c,l,a=[];for(o=0,r=t.length;o<r;o++)c=t[o]*s,l=o<r-1?t[o+1]*s:e.length,i=a3(e,c,l,s,!1),i===i.next&&(i.steiner=!0),a.push(K5(i));for(a.sort(I5),o=0;o<a.length;o++)n=B5(a[o],n);return n}function I5(e,t){return e.x-t.x}function B5(e,t){var s,n=V5(e,t);return n?(s=L2(n,e),Wt(s,s.next),Wt(n,n.next)):t}function V5(e,t){var s,a,n=t,i=e.x,o=e.y,r=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y&&(a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y),a<=i&&a>r&&(r=a,s=n.x<n.next.x?n:n.next,a===i)))return s;n=n.next}while(n!==t)if(!s)return null;var c,h=s,u=s.x,l=s.y,d=1/0,n=s;do i>=n.x&&n.x>=u&&i!==n.x&&Wn(o<l?i:r,o,u,l,o<l?r:i,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(i-n.x),Is(n,e)&&(c<d||c===d&&(n.x>s.x||n.x===s.x&&$5(s,n)))&&(s=n,d=c)),n=n.next;while(n!==h)return s}function $5(e,t){return A(e.prev,e,t.prev)<0&&A(t.next,e,e.next)<0}function W5(e,t,n,s){var o=e;do o.z===0&&(o.z=oc(o.x,o.y,t,n,s)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e)o.prevZ.nextZ=null,o.prevZ=null,U5(o)}function U5(e){var t,n,s,o,i,a,r,c,l=1;do{for(n=e,e=null,o=null,c=0;n;){for(c++,t=n,i=0,r=0;r<l&&(i++,t=t.nextZ,!!t);r++);for(a=l;i>0||a>0&&t;)i!==0&&(a===0||!t||n.z<=t.z)?(s=n,n=n.nextZ,i--):(s=t,t=t.nextZ,a--),o?o.nextZ=s:e=s,s.prevZ=o,o=s;n=t}o.nextZ=null,l*=2}while(c>1)return e}function oc(e,t,n,s,o){return e=(e-n)*o|0,t=(t-s)*o|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function K5(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e)return n}function Wn(e,t,n,s,o,i,a,r){return(o-a)*(t-r)>=(e-a)*(i-r)&&(e-a)*(s-r)>=(n-a)*(t-r)&&(n-a)*(i-r)>=(o-a)*(s-r)}function q5(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Y5(e,t)&&(Is(e,t)&&Is(t,e)&&G5(e,t)&&(A(e.prev,e,t.prev)||A(e,t.prev,t))||ja(e,t)&&A(e.prev,e,e.next)>0&&A(t.prev,t,t.next)>0)}function A(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ja(e,t){return e.x===t.x&&e.y===t.y}function H2(e,t,n,s){var o=pa(A(e,t,n)),i=pa(A(e,t,s)),a=pa(A(n,s,e)),r=pa(A(n,s,t));return!!(o!==i&&a!==r||o===0&&ga(e,n,t)||i===0&&ga(e,s,t)||a===0&&ga(n,e,s)||r===0&&ga(n,t,s))}function ga(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function pa(e){return e>0?1:e<0?-1:0}function Y5(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&H2(n,n.next,e,t))return!0;n=n.next}while(n!==e)return!1}function Is(e,t){return A(e.prev,e,e.next)<0?A(e,t,e.next)>=0&&A(e,e.prev,t)>=0:A(e,t,e.prev)<0||A(e,e.next,t)<0}function G5(e,t){var n=e,s=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==e)return s}function L2(e,t){var s=new jc(e.i,e.x,e.y),n=new jc(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,s.next=o,o.prev=s,n.next=s,s.prev=n,i.next=n,n.prev=i,n}function N2(e,t,n,s){var o=new jc(e,t,n);return s?(o.next=s.next,o.prev=s,s.next.prev=o,s.next=o):(o.prev=o,o.next=o),o}function Ws(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Aa.deviation=function(e,t,n,s){var o,a,c,d,u,l=t&&t.length,f=l?t[0]*n:e.length,i=Math.abs(yc(e,0,f,n));if(l)for(o=0,c=t.length;o<c;o++)d=t[o]*n,u=o<c-1?t[o+1]*n:e.length,i-=Math.abs(yc(e,d,u,n));a=0;for(o=0;o<s.length;o+=3){var r=s[o]*n,h=s[o+1]*n,m=s[o+2]*n;a+=Math.abs((e[r]-e[m])*(e[h+1]-e[r+1])-(e[r]-e[h])*(e[m+1]-e[r+1]))}return i===0&&a===0?0:Math.abs((a-i)/i)};function yc(e,t,n,s){for(var a=0,o=t,i=n-s;o<n;o+=s)a+=(e[i]-e[o])*(e[o+1]+e[i+1]),i=o;return a}Aa.flatten=function(e){for(var n,s,i=e[0][0].length,o={vertices:[],holes:[],dimensions:i},a=0,t=0;t<e.length;t++){for(n=0;n<e[t].length;n++)for(s=0;s<i;s++)o.vertices.push(e[t][n][s]);t>0&&(a+=e[t-1].length,o.holes.push(a))}return o},D2=Sa.exports,M2=mc(D2),Us={exports:{}},Us.exports,function(e,t){(function(n){var f=t&&!t.nodeType&&t,x=e&&!e.nodeType&&e,a=typeof En=="object"&&En;(a.global===a||a.window===a||a.self===a)&&(n=a);var r,u,c=2147483647,o=36,h=1,l=26,k=38,z=700,g=72,w=128,y="-",T=/^xn--/,F=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=o-h,s=Math.floor,d=String.fromCharCode;function i(e){throw new RangeError(A[e])}function C(e,t){for(var n=e.length,s=[];n--;)s[n]=t(e[n]);return s}function E(e,t){var o,i,n=e.split("@"),s="";return n.length>1&&(s=n[0]+"@",e=n[1]),e=e.replace(M,"."),o=e.split("."),i=C(o,t).join("."),s+i}function O(e){for(var t,o,s=[],n=0,i=e.length;n<i;)t=e.charCodeAt(n++),t>=55296&&t<=56319&&n<i?(o=e.charCodeAt(n++),(o&64512)==56320?s.push(((t&1023)<<10)+(o&1023)+65536):(s.push(t),n--)):s.push(t);return s}function j(e){return C(e,function(e){var t="";return e>65535&&(e-=65536,t+=d(e>>>10&1023|55296),e=56320|e&1023),t+=d(e),t}).join("")}function S(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:o}function b(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function v(e,t,n){var i=0;for(e=n?s(e/z):e>>1,e+=s(e/t);e>m*l>>1;i+=o)e=s(e/m);return s(i+(m+1)*e/(e+k))}function p(e){var n,a,r,d,u,m,p,_,x,C,b=[],E=e.length,t=0,O=w,f=g;for(n=e.lastIndexOf(y),n<0&&(n=0),a=0;a<n;++a)e.charCodeAt(a)>=128&&i("not-basic"),b.push(e.charCodeAt(a));for(p=n>0?n+1:0;p<E;){for(_=t,m=1,d=o;p>=E&&i("invalid-input"),r=S(e.charCodeAt(p++)),(r>=o||r>s((c-t)/m))&&i("overflow"),t+=r*m,x=d<=f?h:d>=f+l?l:d-f,!(r<x);d+=o)C=o-x,m>s(c/C)&&i("overflow"),m*=C;u=b.length+1,f=v(t-_,u,_==0),s(t/u)>c-O&&i("overflow"),O+=s(t/u),t%=u,b.splice(t++,0,O)}return j(b)}function _(e){var t,n,a,r,u,f,p,j,_,x,C,E,k,A,S,m=[];for(e=O(e),C=e.length,r=w,a=0,j=g,t=0;t<C;++t)n=e[t],n<128&&m.push(d(n));for(x=k=m.length,k&&m.push(y);x<C;){for(u=c,t=0;t<C;++t)n=e[t],n>=r&&n<u&&(u=n);for(E=x+1,u-r>s((c-a)/E)&&i("overflow"),a+=(u-r)*E,r=u,t=0;t<C;++t)if(n=e[t],n<r&&++a>c&&i("overflow"),n==r){for(p=a,f=o;_=f<=j?h:f>=j+l?l:f-j,!(p<_);f+=o)S=p-_,A=o-_,m.push(d(b(_+S%A,0))),p=s(S/A);m.push(d(b(p,0))),j=v(a,E,x==k),a=0,++x}++a,++r}return m.join("")}function D(e){return E(e,function(e){return T.test(e)?p(e.slice(4).toLowerCase()):e})}function N(e){return E(e,function(e){return F.test(e)?"xn--"+_(e):e})}if(r={version:"1.4.1",ucs2:{decode:O,encode:j},decode:p,encode:_,toASCII:N,toUnicode:D},f&&x)if(e.exports==f)x.exports=r;else for(u in r)r.hasOwnProperty(u)&&(f[u]=r[u]);else n.punycode=r})(En)}(Us,Us.exports),S2=Us.exports,Nt=TypeError,A2={},k2=Object.freeze(Object.defineProperty({__proto__:null,default:A2},Symbol.toStringTag,{value:"Module"})),E2=j5(k2),Qi=typeof Map=="function"&&Map.prototype,Xi=Object.getOwnPropertyDescriptor&&Qi?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Zs=Qi&&Xi&&typeof Xi.get=="function"?Xi.get:null,Tc=Qi&&Map.prototype.forEach,Wi=typeof Set=="function"&&Set.prototype,$i=Object.getOwnPropertyDescriptor&&Wi?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Js=Wi&&$i&&typeof $i.get=="function"?$i.get:null,Lc=Wi&&Set.prototype.forEach,C2=typeof WeakMap=="function"&&WeakMap.prototype,Nn=C2?WeakMap.prototype.has:null,b2=typeof WeakSet=="function"&&WeakSet.prototype,Jn=b2?WeakSet.prototype.has:null,v2=typeof WeakRef=="function"&&WeakRef.prototype,Vc=v2?WeakRef.prototype.deref:null,g2=Boolean.prototype.valueOf,p2=Object.prototype.toString,f2=Function.prototype.toString,m2=String.prototype.match,Hi=String.prototype.slice,nt=String.prototype.replace,u2=String.prototype.toUpperCase,Xc=String.prototype.toLowerCase,Qc=RegExp.prototype.test,Zc=Array.prototype.concat,Oe=Array.prototype.join,d2=Array.prototype.slice,tl=Math.floor,Ri=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Li=Object.getOwnPropertySymbols,zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,sn=typeof Symbol=="function"&&typeof Symbol.iterator=="object",$n=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===sn||!0)?Symbol.toStringTag:null,rl=Object.prototype.propertyIsEnumerable,cl=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function r2(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||Qc.call(/e/,t))return t;if(n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g,typeof e=="number"&&(s=e<0?-tl(-e):tl(e),s!==e)){var n,s,o=String(s),i=Hi.call(t,o.length+1);return nt.call(o,n,"$&_")+"."+nt.call(nt.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}return nt.call(t,n,"$&_")}ki=E2,ul=ki.custom,hl=V0(ul)?ul:null,ml={__proto__:null,double:'"',single:"'"},s2={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},ss=function e(t,n,s,o){if(i=n||{},it(i,"quoteStyle")&&!it(ml,i.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(it(i,"maxStringLength")&&(typeof i.maxStringLength=="number"?i.maxStringLength<0&&i.maxStringLength!==1/0:i.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');if(l=!it(i,"customInspect")||i.customInspect,typeof l!="boolean"&&l!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(it(i,"indent")&&i.indent!==null&&i.indent!=="	"&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(it(i,"numericSeparator")&&typeof i.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');if(y=i.numericSeparator,typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return E0(t,i);if(typeof t=="number")return t===0?1/0/t>0?"0":"-0":(j=String(t),y?r2(t,j):j);if(typeof t=="bigint")return b=String(t)+"n",y?r2(t,b):b;if(m=typeof i.depth>"u"?5:i.depth,typeof s>"u"&&(s=0),s>=m&&m>0&&typeof t=="object")return yl(t)?"[Array]":"[Object]";if(r=lv(i,s),typeof o>"u")o=[];else if(D0(o,t)>=0)return"[Circular]";function a(t,n,a){if(n&&(o=d2.call(o),o.push(n)),a){var r={depth:i.depth};return it(i,"quoteStyle")&&(r.quoteStyle=i.quoteStyle),e(t,r,s+1,o)}return e(t,i,s+1,o)}if(typeof t=="function"&&!Y0(t))return v=L7(t),g=bi(t,a),"[Function"+(v?": "+v:" (anonymous)")+"]"+(g.length>0?" { "+Oe.call(g,", ")+" }":"");if(V0(t))return _=sn?nt.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):zi.call(t),typeof t=="object"&&!sn?go(_):_;if(Q7(t)){for(var c="<"+Xc.call(String(t.nodeName)),f=t.attributes||[],h=0;h<f.length;h++)c+=" "+f[h].name+"="+J0(p7(f[h].value),"double",i);return c+=">",t.childNodes&&t.childNodes.length&&(c+="..."),c+="</"+Xc.call(String(t.nodeName))+">",c}if(yl(t))return t.length===0?"[]":(u=bi(t,a),r&&!tv(u)?"["+Xl(u,r)+"]":"[ "+Oe.call(u,", ")+" ]");if(x7(t))return d=bi(t,a),!("cause"in Error.prototype)&&"cause"in t&&!rl.call(t,"cause")?"{ ["+String(t)+"] "+Oe.call(Zc.call("[cause]: "+a(t.cause),d),", ")+" }":d.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Oe.call(d,", ")+" }";if(typeof t=="object"&&l){if(hl&&typeof t[hl]=="function"&&ki)return ki(t,{depth:m-s});if(l!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(I7(t))return p=[],Tc&&Tc.call(t,function(e,n){p.push(a(n,t,!0)+" => "+a(e,t))}),x0("Map",Zs.call(t),p,r);if(q7(t))return w=[],Lc&&Lc.call(t,function(e){w.push(a(e,t))}),x0("Set",Js.call(t),w,r);if($7(t))return Kl("WeakMap");if(Y7(t))return Kl("WeakSet");if(K7(t))return Kl("WeakRef");if(F7(t))return go(a(Number(t)));if(z7(t))return go(a(Ri.call(t)));if(T7(t))return go(g2.call(t));if(E7(t))return go(a(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof En<"u"&&t===En)return"{ [object globalThis] }";if(!w7(t)&&!Y0(t)){var i,r,l,d,u,m,p,g,v,b,j,y,_,w,O=bi(t,a),k=cl?cl(t)===Object.prototype:t instanceof Object||t.constructor===Object,C=t instanceof Object?"":"null prototype",E=!k&&$n&&Object(t)===t&&$n in t?Hi.call(ft(t),8,-1):C?"Object":"",A=k||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",x=A+(E||C?"["+Oe.call(Zc.call([],E||[],C||[]),": ")+"] ":"");return O.length===0?x+"{}":r?x+"{"+Xl(O,r)+"}":x+"{ "+Oe.call(O,", ")+" }"}return String(t)};function J0(e,t,n){var o=n.quoteStyle||t,s=ml[o];return s+e+s}function p7(e){return nt.call(String(e),/"/g,"&quot;")}function Pt(e){return!$n||typeof e!="object"||!($n in e||typeof e[$n]<"u")}function yl(e){return ft(e)==="[object Array]"&&Pt(e)}function w7(e){return ft(e)==="[object Date]"&&Pt(e)}function Y0(e){return ft(e)==="[object RegExp]"&&Pt(e)}function x7(e){return ft(e)==="[object Error]"&&Pt(e)}function E7(e){return ft(e)==="[object String]"&&Pt(e)}function F7(e){return ft(e)==="[object Number]"&&Pt(e)}function T7(e){return ft(e)==="[object Boolean]"&&Pt(e)}function V0(e){if(sn)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!zi)return!1;try{return zi.call(e),!0}catch{}return!1}function z7(e){if(!e||typeof e!="object"||!Ri)return!1;try{return Ri.call(e),!0}catch{}return!1}L0=Object.prototype.hasOwnProperty||function(e){return e in this};function it(e,t){return L0.call(e,t)}function ft(e){return p2.call(e)}function L7(e){if(e.name)return e.name;var t=m2.call(f2.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function D0(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1}function I7(e){if(!Zs||!e||typeof e!="object")return!1;try{Zs.call(e);try{Js.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function $7(e){if(!Nn||!e||typeof e!="object")return!1;try{Nn.call(e,Nn);try{Jn.call(e,Jn)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function K7(e){if(!Vc||!e||typeof e!="object")return!1;try{return Vc.call(e),!0}catch{}return!1}function q7(e){if(!Js||!e||typeof e!="object")return!1;try{Js.call(e);try{Zs.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function Y7(e){if(!Jn||!e||typeof e!="object")return!1;try{Jn.call(e,Jn);try{Nn.call(e,Nn)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function Q7(e){return!!e&&typeof e=="object"&&(typeof HTMLElement<"u"&&e instanceof HTMLElement||typeof e.nodeName=="string"&&typeof e.getAttribute=="function")}function E0(e,t){if(e.length>t.maxStringLength){var n,o,s=e.length-t.maxStringLength,i="... "+s+" more character"+(s>1?"s":"");return E0(Hi.call(e,0,t.maxStringLength),t)+i}return n=s2[t.quoteStyle||"single"],n.lastIndex=0,o=nt.call(nt.call(e,n,"\\$1"),/[\x00-\x1f]/g,J7),J0(o,"single",t)}function J7(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+u2.call(t.toString(16))}function go(e){return"Object("+e+")"}function Kl(e){return e+" { ? }"}function x0(e,t,n,s){var o=s?Xl(n,s):Oe.call(n,", ");return e+" ("+t+") {"+o+"}"}function tv(e){for(var t=0;t<e.length;t++)if(D0(e[t],`
`)>=0)return!1;return!0}function lv(e,t){var n;if(e.indent==="	")n="	";else if(typeof e.indent=="number"&&e.indent>0)n=Oe.call(Array(e.indent+1)," ");else return null;return{base:n,prev:Oe.call(Array(t+1),n)}}function Xl(e,t){if(e.length===0)return"";var n=`
`+t.prev+t.base;return n+Oe.call(e,","+n)+`
`+t.prev}function bi(e,t){var n,s,i,a,r,c,l=yl(e),o=[];if(l){o.length=e.length;for(i=0;i<e.length;i++)o[i]=it(e,i)?t(e[i],e):""}if(s=typeof Li=="function"?Li(e):[],sn){c={};for(r=0;r<s.length;r++)c["$"+s[r]]=s[r]}for(n in e)it(e,n)&&(l&&String(Number(n))===n&&n<e.length||sn&&c["$"+n]instanceof Symbol||(Qc.call(/[^\w$]/,n)?o.push(t(n,e)+": "+t(e[n],e)):o.push(n+": "+t(e[n],e))));if(typeof Li=="function")for(a=0;a<s.length;a++)rl.call(e,s[a])&&o.push("["+t(s[a])+"]: "+t(e[s[a]],e));return o}if(b0=ss,v0=Nt,vo=function(e,t,n){for(var s,o=e;(s=o.next)!=null;o=s)if(s.key===t)return o.next=s.next,n||(s.next=e.next,e.next=s),s},m0=function(e,t){if(e){var n=vo(e,t);return n&&n.value}},h0=function(e,t,n){var s=vo(e,t);s?s.value=n:e.next={key:t,next:e.next,value:n}},u0=function(e,t){return!!e&&!!vo(e,t)},d0=function(e,t){if(e)return vo(e,t,!0)},c0=function(){var e,t={assert:function(e){if(!t.has(e))throw new v0("Side channel does not contain "+b0(e))},delete:function(t){var s=e&&e.next,n=d0(e,t);return n&&s&&s===n&&(e=0[0]),!!n},get:function(t){return m0(e,t)},has:function(t){return u0(e,t)},set:function(t,n){e||(e={next:0[0]}),h0(e,t,n)}};return t},cd=Object,r0=Error,a0=EvalError,s0=RangeError,t0=ReferenceError,e0=SyntaxError,J4=URIError,q4=Math.abs,D4=Math.floor,T4=Math.max,F4=Math.min,M4=Math.pow,S4=Math.round,C4=Number.isNaN||function(e){return e!==e},O4=C4,w4=function(e){return O4(e)||e===0?e:e<0?-1:1},y4=Object.getOwnPropertyDescriptor,_o=y4,_o)try{_o([],"length")}catch{_o=null}if(Ed=_o,xo=Object.defineProperty||!1,xo)try{xo({},"a",{value:1})}catch{xo=!1}b4=xo;function xv(){return p4||(p4=1,v4=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var n,s,o,a,e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;n=42,e[t]=n;for(a in e)return!1;return!(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)&&(s=Object.getOwnPropertySymbols(e),!(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))&&(typeof Object.getOwnPropertyDescriptor!="function"||!(o=Object.getOwnPropertyDescriptor(e,t),o.value!==n||o.enumerable!==!0)))}),v4}function Cv(){if(m4)return Td;m4=1;var e=typeof Symbol<"u"&&Symbol,t=xv();return Td=function(){return!(typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol")&&t()},Td}function J1(){return t4||(t4=1,i4=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),i4}function Q1(){if(Z1)return Pd;Z1=1;var e=cd;return Pd=e.getPrototypeOf||null,Pd}G1="Function.prototype.bind called on incompatible ",Y1=Object.prototype.toString,z1=Math.max,F1="[object Function]",Ud=function(e,t){for(var n,o=[],s=0;s<e.length;s+=1)o[s]=e[s];for(n=0;n<t.length;n+=1)o[n+e.length]=t[n];return o},S1=function(e,t){for(var s=[],n=t,o=0;n<e.length;n+=1,o+=1)s[o]=e[n];return s},k1=function(e,t){for(var s="",n=0;n<e.length;n+=1)s+=e[n],n+1<e.length&&(s+=t);return s},_1=function(e){if(t=this,typeof t!="function"||Y1.apply(t)!==F1)throw new TypeError(G1+t);for(var t,n,o,i=S1(arguments,1),r=function(){if(this instanceof n){var s=t.apply(this,Ud(i,arguments));return Object(s)===s?s:this}return t.apply(e,Ud(i,arguments))},c=z1(0,t.length-i.length),a=[],s=0;s<c;s++)a[s]="$"+s;return(n=Function("binder","return function ("+k1(a,",")+"){ return binder.apply(this,arguments); }")(r),t.prototype)&&(o=function(){},o.prototype=t.prototype,n.prototype=new o,o.prototype=null),n},b1=_1,Fo=Function.prototype.bind||b1,Yo=Function.prototype.call;function m1(){return f1||(f1=1,g1=Function.prototype.apply),g1}h1=typeof Reflect<"u"&&Reflect&&Reflect.apply,a1=Fo,i1=m1(),n1=Yo,t1=h1,e1=t1||a1.call(n1,i1),Qu=Fo,Gu=Nt,Yu=Yo,qu=e1,uu=function(e){if(e.length<1||typeof e[0]!="function")throw new Gu("a function is required");return qu(Qu,Yu,e)};function Ev(){if(Wu)return hu;Wu=1,n=uu,e=Ed;try{s=[].__proto__===Array.prototype}catch(e){if(!e||typeof e!="object"||!("code"in e)||e.code!=="ERR_PROTO_ACCESS")throw e}var e,n,s,t=!!s&&e&&e(Object.prototype,"__proto__"),o=Object,i=o.getPrototypeOf;return hu=t&&typeof t.get=="function"?n([t.get]):typeof i=="function"&&function(e){return i(e==null?e:o(e))},hu}function kv(){if(Bu)return pu;Bu=1;var e=J1(),t=Q1(),n=Ev();return pu=e?function(t){return e(t)}:t?function(e){if(!e||typeof e!="object"&&typeof e!="function")throw new TypeError("getProto: not an object");return t(e)}:n?function(e){return n(e)}:null,pu}function Nv(){if(Pu)return bu;Pu=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,n=Fo;return bu=n.call(e,t),bu}if(Au=cd,ku=r0,i8=a0,Cu=s0,Eu=t0,mn=e0,Ht=Nt,Su=J4,Mu=q4,Fu=D4,Tu=T4,zu=F4,Du=M4,Nu=S4,Lu=w4,yu=Function,Bo=function(e){try{return yu('"use strict"; return ('+e+").constructor;")()}catch{}},ts=Ed,Iu=b4,Vo=function(){throw new Ht},Vu=ts?function(){try{return arguments.callee,Vo}catch{try{return ts(arguments,"callee").get}catch{return Vo}}}():Vo,It=Cv()(),B=kv(),Uu=Q1(),Ku=J1(),du=m1(),Yn=Yo,Lt={},Xu=typeof Uint8Array>"u"||!B?j:B(Uint8Array),wt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?j:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?j:ArrayBuffer,"%ArrayIteratorPrototype%":It&&B?B([][Symbol.iterator]()):j,"%AsyncFromSyncIteratorPrototype%":j,"%AsyncFunction%":Lt,"%AsyncGenerator%":Lt,"%AsyncGeneratorFunction%":Lt,"%AsyncIteratorPrototype%":Lt,"%Atomics%":typeof Atomics>"u"?j:Atomics,"%BigInt%":typeof BigInt>"u"?j:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?j:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?j:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?j:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":ku,"%eval%":eval,"%EvalError%":i8,"%Float16Array%":typeof Float16Array>"u"?j:Float16Array,"%Float32Array%":typeof Float32Array>"u"?j:Float32Array,"%Float64Array%":typeof Float64Array>"u"?j:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?j:FinalizationRegistry,"%Function%":yu,"%GeneratorFunction%":Lt,"%Int8Array%":typeof Int8Array>"u"?j:Int8Array,"%Int16Array%":typeof Int16Array>"u"?j:Int16Array,"%Int32Array%":typeof Int32Array>"u"?j:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":It&&B?B(B([][Symbol.iterator]())):j,"%JSON%":typeof JSON=="object"?JSON:j,"%Map%":typeof Map>"u"?j:Map,"%MapIteratorPrototype%":typeof Map>"u"||!It||!B?j:B((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Au,"%Object.getOwnPropertyDescriptor%":ts,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?j:Promise,"%Proxy%":typeof Proxy>"u"?j:Proxy,"%RangeError%":Cu,"%ReferenceError%":Eu,"%Reflect%":typeof Reflect>"u"?j:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?j:Set,"%SetIteratorPrototype%":typeof Set>"u"||!It||!B?j:B((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?j:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":It&&B?B(""[Symbol.iterator]()):j,"%Symbol%":It?Symbol:j,"%SyntaxError%":mn,"%ThrowTypeError%":Vu,"%TypedArray%":Xu,"%TypeError%":Ht,"%Uint8Array%":typeof Uint8Array>"u"?j:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?j:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?j:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?j:Uint32Array,"%URIError%":Su,"%WeakMap%":typeof WeakMap>"u"?j:WeakMap,"%WeakRef%":typeof WeakRef>"u"?j:WeakRef,"%WeakSet%":typeof WeakSet>"u"?j:WeakSet,"%Function.prototype.call%":Yn,"%Function.prototype.apply%":du,"%Object.defineProperty%":Iu,"%Object.getPrototypeOf%":Uu,"%Math.abs%":Mu,"%Math.floor%":Fu,"%Math.max%":Tu,"%Math.min%":zu,"%Math.pow%":Du,"%Math.round%":Nu,"%Math.sign%":Lu,"%Reflect.getPrototypeOf%":Ku},B)try{null.error}catch(e){Zu=B(B(e)),wt["%Error.prototype%"]=Zu}Ju=function e(t){if(t==="%AsyncFunction%")n=Bo("async function () {}");else if(t==="%GeneratorFunction%")n=Bo("function* () {}");else if(t==="%AsyncGeneratorFunction%")n=Bo("async function* () {}");else if(t==="%AsyncGenerator%"){var n,s,o=e("%AsyncGeneratorFunction%");o&&(n=o.prototype)}else t==="%AsyncIteratorPrototype%"&&(s=e("%AsyncGenerator%"),s&&B&&(n=B(s.prototype)));return wt[t]=n,n},au={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Bn=Fo,Do=Nv(),s1=Bn.call(Yn,Array.prototype.concat),o1=Bn.call(du,Array.prototype.splice),su=Bn.call(Yn,String.prototype.replace),To=Bn.call(Yn,String.prototype.slice),r1=Bn.call(Yn,RegExp.prototype.exec),c1=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,l1=/\\(\\)?/g,d1=function(e){var t,n=To(e,0,1),s=To(e,-1);if(n==="%"&&s!=="%")throw new mn("invalid intrinsic syntax, expected closing `%`");if(s==="%"&&n!=="%")throw new mn("invalid intrinsic syntax, expected opening `%`");return t=[],su(e,c1,function(e,n,s,o){t[t.length]=s?su(o,l1,"$1"):n||e}),t},u1=function(e,t){var s,o,n=e;if(Do(au,n)&&(o=au[n],n="%"+o[0]+"%"),Do(wt,n)){if(s=wt[n],s===Lt&&(s=Ju(n)),typeof s>"u"&&!t)throw new Ht("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:o,name:n,value:s}}throw new mn("intrinsic "+e+" does not exist!")},qo=function(e,t){if(typeof e!="string"||e.length===0)throw new Ht("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Ht('"allowMissing" argument must be a boolean');if(r1(/^%?[^%]*%?$/,e)===null)throw new mn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i,a,r,o=d1(e),u=o.length>0?o[0]:"",m=u1("%"+u+"%",t),c=m.name,n=m.value,f=!1,h=m.alias;h&&(u=h[0],o1(o,s1([0,1],h)));for(a=1,i=!0;a<o.length;a+=1){var s=o[a],l=To(s,0,1),d=To(s,-1);if((l==='"'||l==="'"||l==="`"||d==='"'||d==="'"||d==="`")&&l!==d)throw new mn("property names with quotes must have matching quotes");if((s==="constructor"||!i)&&(f=!0),u+="."+s,c="%"+u+"%",Do(wt,c))n=wt[c];else if(n!=null){if(!(s in n)){if(!t)throw new Ht("base intrinsic for "+e+" exists, but the property is not available.");return}ts&&a+1>=o.length?(r=ts(n,s),i=!!r,i&&"get"in r&&!("originalValue"in r.get)?n=r.get:n=n[s]):(i=Do(n,s),n=n[s]),i&&!f&&(wt[c]=n)}}return n},eu=qo,Jd=uu,p1=Jd([eu("%String.prototype.indexOf%")]),Zd=function(e,t){var n=eu(e,!!t);return typeof n=="function"&&p1(e,".prototype.")>-1?Jd([n]):n},v1=qo,Sn=Zd,j1=ss,y1=Nt,Yd=v1("%Map%",!0),w1=Sn("Map.prototype.get",!0),O1=Sn("Map.prototype.set",!0),x1=Sn("Map.prototype.has",!0),C1=Sn("Map.prototype.delete",!0),E1=Sn("Map.prototype.size",!0),qd=!!Yd&&function(){var e,t={assert:function(e){if(!t.has(e))throw new y1("Side channel does not contain "+j1(e))},delete:function(t){if(e){var n=C1(e,t);return E1(e)===0&&(e=0[0]),n}return!1},get:function(t){if(e)return w1(e,t)},has:function(t){return!!e&&x1(e,t)},set:function(t,n){e||(e=new Yd),O1(e,t,n)}};return t},A1=qo,So=Zd,M1=ss,ko=qd,T1=Nt,pn=A1("%WeakMap%",!0),D1=So("WeakMap.prototype.get",!0),N1=So("WeakMap.prototype.set",!0),L1=So("WeakMap.prototype.has",!0),R1=So("WeakMap.prototype.delete",!0),P1=pn?function(){var e,t,n={assert:function(e){if(!n.has(e))throw new T1("Side channel does not contain "+M1(e))},delete:function(n){if(pn&&n&&(typeof n=="object"||typeof n=="function")){if(e)return R1(e,n)}else if(ko&&t)return t.delete(n);return!1},get:function(n){return pn&&n&&(typeof n=="object"||typeof n=="function")&&e?D1(e,n):t&&t.get(n)},has:function(n){return pn&&n&&(typeof n=="object"||typeof n=="function")&&e?L1(e,n):!!t&&t.has(n)},set:function(n,s){pn&&n&&(typeof n=="object"||typeof n=="function")?(e||(e=new pn),N1(e,n,s)):ko&&(t||(t=ko()),t.set(n,s))}};return n}:ko,H1=Nt,I1=ss,B1=c0,V1=qd,$1=P1,W1=$1||V1||B1,U1=function(){var e,t={assert:function(e){if(!t.has(e))throw new H1("Side channel does not contain "+I1(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,n){e||(e=W1()),e.set(t,n)}};return t},K1=String.prototype.replace,q1=/%20/g,Qo={RFC1738:"RFC1738",RFC3986:"RFC3986"},Zo={default:Qo.RFC3986,formatters:{RFC1738:function(e){return K1.call(e,q1,"+")},RFC3986:function(e){return String(e)}},RFC1738:Qo.RFC1738,RFC3986:Qo.RFC3986},X1=Zo,Jo=Object.prototype.hasOwnProperty,Et=Array.isArray,Fe=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),Ou=function(e){for(;e.length>1;){var t,o,n=e.pop(),s=n.obj[n.prop];if(Et(s)){for(o=[],t=0;t<s.length;++t)typeof s[t]<"u"&&o.push(s[t]);n.obj[n.prop]=o}}},Ld=function(e,t){for(var s=t&&t.plainObjects?{__proto__:null}:{},n=0;n<e.length;++n)typeof e[n]<"u"&&(s[n]=e[n]);return s},n4=function e(t,n,s){if(!n)return t;if(typeof n!="object"&&typeof n!="function"){if(Et(t))t.push(n);else if(t&&typeof t=="object")(s&&(s.plainObjects||s.allowPrototypes)||!Jo.call(Object.prototype,n))&&(t[n]=!0);else return[t,n];return t}if(!t||typeof t!="object")return[t].concat(n);var o=t;return Et(t)&&!Et(n)&&(o=Ld(t,s)),Et(t)&&Et(n)?(n.forEach(function(n,o){if(Jo.call(t,o)){var i=t[o];i&&typeof i=="object"&&n&&typeof n=="object"?t[o]=e(i,n,s):t.push(n)}else t[o]=n}),t):Object.keys(n).reduce(function(t,o){var i=n[o];return Jo.call(t,o)?t[o]=e(t[o],i,s):t[o]=i,t},o)},s4=function(e,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},o4=function(e,t,n){var s=e.replace(/\+/g," ");if(n==="iso-8859-1")return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch{return s}},ei=1024,a4=function(e,t,n,s,o){if(e.length===0)return e;if(r=e,typeof e=="symbol"?r=Symbol.prototype.toString.call(e):typeof e!="string"&&(r=String(e)),n==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(u="",l=0;l<r.length;l+=ei){for(var i,r,l,u,d=r.length>=ei?r.slice(l,l+ei):r,a=[],c=0;c<d.length;++c){if(i=d.charCodeAt(c),i===45||i===46||i===95||i===126||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||o===X1.RFC1738&&(i===40||i===41)){a[a.length]=d.charAt(c);continue}if(i<128){a[a.length]=Fe[i];continue}if(i<2048){a[a.length]=Fe[192|i>>6]+Fe[128|i&63];continue}if(i<55296||i>=57344){a[a.length]=Fe[224|i>>12]+Fe[128|i>>6&63]+Fe[128|i&63];continue}c+=1,i=65536+((i&1023)<<10|d.charCodeAt(c)&1023),a[a.length]=Fe[240|i>>18]+Fe[128|i>>12&63]+Fe[128|i>>6&63]+Fe[128|i&63]}u+=a.join("")}return u},r4=function(e){for(var n=[{obj:{o:e},prop:"o"}],r=[],s=0;s<n.length;++s)for(var t,a,c=n[s],o=c.obj[c.prop],l=Object.keys(o),i=0;i<l.length;++i)a=l[i],t=o[a],typeof t=="object"&&t!==null&&r.indexOf(t)===-1&&(n.push({obj:o,prop:a}),r.push(t));return Ou(n),e},c4=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},l4=function(e){return!!e&&typeof e=="object"&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},d4=function(e,t){return[].concat(e,t)},u4=function(e,t){if(Et(e)){for(var s=[],n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)},Dd={arrayToObject:Ld,assign:s4,combine:d4,compact:r4,decode:o4,encode:a4,isBuffer:l4,isRegExp:c4,maybeMap:u4,merge:n4},zd=U1,Co=Dd,On=Zo,g4=Object.prototype.hasOwnProperty,Sd={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},Ne=Array.isArray,j4=Array.prototype.push,xd=function(e,t){j4.apply(e,Ne(t)?t:[t])},_4=Date.prototype.toISOString,Od=On.default,L={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Co.encode,encodeValuesOnly:!1,filter:0[0],format:Od,formatter:On.formatters[Od],indices:!1,serializeDate:function(e){return _4.call(e)},skipNulls:!1,strictNullHandling:!1},x4=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},ai={},E4=function e(t,n,s,o,i,a,r,c,l,d,u,h,m,f,p,g,v,b){for(var y,_,w,C,E,k,A,S,M,F,T,z,N,j=t,O=b,x=0,D=!1;(O=O.get(ai))!==0[0]&&!D;){if(A=O.get(t),x+=1,typeof A<"u"){if(A===x)throw new RangeError("Cyclic object value");D=!0}typeof O.get(ai)>"u"&&(x=0)}if(typeof d=="function"?j=d(n,j):j instanceof Date?j=m(j):s==="comma"&&Ne(j)&&(j=Co.maybeMap(j,function(e){return e instanceof Date?m(e):e})),j===null){if(a)return l&&!g?l(n,L.encoder,v,"key",f):n;j=""}if(x4(j)||Co.isBuffer(j))return l?(z=g?n:l(n,L.encoder,v,"key",f),[p(z)+"="+p(l(j,L.encoder,v,"value",f))]):[p(n)+"="+p(String(j))];if(E=[],typeof j>"u")return E;if(s==="comma"&&Ne(j)?(g&&l&&(j=Co.maybeMap(j,l)),w=[{value:j.length>0?j.join(",")||null:0[0]}]):Ne(d)?w=d:(M=Object.keys(j),w=u?M.sort(u):M),S=c?String(n).replace(/\./g,"%2E"):String(n),_=o&&Ne(j)&&j.length===1?S+"[]":S,i&&Ne(j)&&j.length===0)return _+"[]";for(k=0;k<w.length;++k)y=w[k],F=typeof y=="object"&&y&&typeof y.value<"u"?y.value:j[y],r&&F===null||(C=h&&c?String(y).replace(/\./g,"%2E"):String(y),N=Ne(j)?typeof s=="function"?s(_,C):_:_+(h?"."+C:"["+C+"]"),b.set(t,x),T=zd(),T.set(ai,b),xd(E,e(F,N,s,o,i,a,r,c,s==="comma"&&g&&Ne(j)?null:l,d,u,h,m,f,p,g,v,T)));return E},k4=function(e){if(!e)return L;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");if(s=e.charset||L.charset,typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(t=On.default,typeof e.format<"u"){if(!g4.call(On.formatters,e.format))throw new TypeError("Unknown format option provided.");t=e.format}var t,n,s,i,a=On.formatters[t],o=L.filter;if((typeof e.filter=="function"||Ne(e.filter))&&(o=e.filter),e.arrayFormat in Sd?n=e.arrayFormat:"indices"in e?n=e.indices?"indices":"repeat":n=L.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");return i=typeof e.allowDots>"u"?e.encodeDotInKeys===!0||L.allowDots:!!e.allowDots,{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:L.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:L.allowEmptyArrays,arrayFormat:n,charset:s,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:L.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?L.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:L.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:L.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:L.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:L.encodeValuesOnly,filter:o,format:t,formatter:a,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:L.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:L.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:L.strictNullHandling}},A4=function(e,t){var s,i,a,r,c,l,d,u,h,m,f,o=e,n=k4(t);if(typeof n.filter=="function"?(a=n.filter,o=a("",o)):Ne(n.filter)&&(a=n.filter,s=a),h=[],typeof o!="object"||o===null)return"";l=Sd[n.arrayFormat],f=l==="comma"&&n.commaRoundTrip,s||(s=Object.keys(o)),n.sort&&s.sort(n.sort);for(m=zd(),i=0;i<s.length;++i)c=s[i],d=o[c],n.skipNulls&&d===null||xd(h,E4(d,c,l,f,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,m));return u=h.join(n.delimiter),r=n.addQueryPrefix===!0?"?":"",n.charsetSentinel&&(n.charset==="iso-8859-1"?r+="utf8=%26%2310003%3B&":r+="utf8=%E2%9C%93&"),u.length>0?r+u:""},St=Dd,ri=Object.prototype.hasOwnProperty,bd=Array.isArray,M={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:St.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},z4=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},gd=function(e,t,n){if(e&&typeof e=="string"&&t.comma&&e.indexOf(",")>-1)return e.split(",");if(t.throwOnLimitExceeded&&n>=t.arrayLimit)throw new RangeError("Array limit exceeded. Only "+t.arrayLimit+" element"+(t.arrayLimit===1?"":"s")+" allowed in an array.");return e},N4="utf8=%26%2310003%3B",L4="utf8=%E2%9C%93",R4=function(e,t){if(a={__proto__:null},d=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=d.replace(/%5B/gi,"[").replace(/%5D/gi,"]"),l=t.parameterLimit===1/0?0[0]:t.parameterLimit,o=d.split(t.delimiter,t.throwOnLimitExceeded?l+1:l),t.throwOnLimitExceeded&&o.length>l)throw new RangeError("Parameter limit exceeded. Only "+l+" parameter"+(l===1?"":"s")+" allowed.");if(u=-1,r=t.charset,t.charsetSentinel)for(n=0;n<o.length;++n)o[n].indexOf("utf8=")===0&&(o[n]===L4?r="utf-8":o[n]===N4&&(r="iso-8859-1"),u=n,n=o.length);for(n=0;n<o.length;++n)if(n!==u){var n,s,o,i,a,r,l,d,u,m,c=o[n],f=c.indexOf("]="),h=f===-1?c.indexOf("="):f+1;h===-1?(i=t.decoder(c,M.decoder,r,"key"),s=t.strictNullHandling?null:""):(i=t.decoder(c.slice(0,h),M.decoder,r,"key"),s=St.maybeMap(gd(c.slice(h+1),t,bd(a[i])?a[i].length:0),function(e){return t.decoder(e,M.decoder,r,"value")})),s&&t.interpretNumericEntities&&r==="iso-8859-1"&&(s=z4(String(s))),c.indexOf("[]=")>-1&&(s=bd(s)?[s]:s),m=ri.call(a,i),m&&t.duplicates==="combine"?a[i]=St.combine(a[i],s):(!m||t.duplicates==="last")&&(a[i]=s)}return a},P4=function(e,t,n,s){d=0,e.length>0&&e[e.length-1]==="[]"&&(u=e.slice(0,-1).join(""),d=Array.isArray(t)&&t[u]?t[u].length:0);for(o=s?t:gd(t,n,d),l=e.length-1;l>=0;--l){if(i=e[l],i==="[]"&&n.parseArrays)a=n.allowEmptyArrays&&(o===""||n.strictNullHandling&&o===null)?[]:St.combine([],o);else{a=n.plainObjects?{__proto__:null}:{};var o,i,a,l,d,u,h=i.charAt(0)==="["&&i.charAt(i.length-1)==="]"?i.slice(1,-1):i,r=n.decodeDotInKeys?h.replace(/%2E/g,"."):h,c=parseInt(r,10);!n.parseArrays&&r===""?a={0:o}:!isNaN(c)&&i!==r&&String(c)===r&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(a=[],a[c]=o):r!=="__proto__"&&(a[r]=o)}o=a}return o},H4=function(e,t,n,s){if(e){var c,i=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,l=/(\[[^[\]]*])/,d=/(\[[^[\]]*])/g,o=n.depth>0&&l.exec(i),r=o?i.slice(0,o.index):i,a=[];if(r){if(!n.plainObjects&&ri.call(Object.prototype,r)&&!n.allowPrototypes)return;a.push(r)}for(c=0;n.depth>0&&(o=d.exec(i))!==null&&c<n.depth;){if(c+=1,!n.plainObjects&&ri.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(o[1])}if(o){if(n.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");a.push("["+i.slice(o.index)+"]")}return P4(a,t,n,s)}},I4=function(e){if(!e)return M;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof e.throwOnLimitExceeded<"u"&&typeof e.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var n,s=typeof e.charset>"u"?M.charset:e.charset,t=typeof e.duplicates>"u"?M.duplicates:e.duplicates;if(t!=="combine"&&t!=="first"&&t!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");return n=typeof e.allowDots>"u"?e.decodeDotInKeys===!0||M.allowDots:!!e.allowDots,{allowDots:n,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:M.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:M.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:M.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:M.arrayLimit,charset:s,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:M.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:M.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:M.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:M.decoder,delimiter:typeof e.delimiter=="string"||St.isRegExp(e.delimiter)?e.delimiter:M.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:M.depth,duplicates:t,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:M.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:M.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:M.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:M.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:M.strictNullHandling,throwOnLimitExceeded:typeof e.throwOnLimitExceeded=="boolean"&&e.throwOnLimitExceeded}},B4=function(e,t){if(n=I4(t),e===""||e===null||typeof e>"u")return n.plainObjects?{__proto__:null}:{};for(var n,i,c,a=typeof e=="string"?R4(e,n):e,s=n.plainObjects?{__proto__:null}:{},r=Object.keys(a),o=0;o<r.length;++o)i=r[o],c=H4(i,a[i],n,typeof e=="string"),s=St.merge(s,c,n);return n.allowSparse===!0?s:St.compact(s)},V4=A4,$4=B4,W4=Zo,U4={formats:W4,parse:$4,stringify:V4},K4=S2;function Xe(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}Y4=/^([a-z0-9.+-]+:)/i,G4=/:[0-9]*$/,X4=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Q4=["<",">",'"',"`"," ","\r",`
`,"	"],Z4=["{","}","|","\\","^","`"].concat(Q4),li=["'"].concat(Z4),md=["%","/","?",";","#"].concat(li),hd=["/","?","#"],n0=255,ud=/^[+a-z0-9A-Z_-]{0,63}$/,o0=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,i0={javascript:!0,"javascript:":!0},di={javascript:!0,"javascript:":!0},Xt={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},mi=U4;function Cp(e,t,n){if(e&&typeof e=="object"&&e instanceof Xe)return e;var s=new Xe;return s.parse(e,t,n),s}Xe.prototype.parse=function(e,t,n){if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s,o,i,a,r,c,l,d,u,h,m,p,g,v,j,y,C,k,S,F,A=e.indexOf("?"),M=A!==-1&&A<e.indexOf("#")?"?":"#",_=e.split(M),z=/\\/g;if(_[0]=_[0].replace(z,"/"),e=_.join(M),s=e,(s=s.trim(),!n&&e.split("#").length===1)&&(u=X4.exec(s),u))return this.path=s,this.href=s,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=mi.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this;if(a=Y4.exec(s),a&&(a=a[0],g=a.toLowerCase(),this.protocol=g,s=s.substr(a.length)),(n||a||s.match(/^\/\/[^@/]+@[^@/]+/))&&(C=s.substr(0,2)==="//",C&&!(a&&di[a])&&(s=s.substr(2),this.slashes=!0)),!di[a]&&(C||a&&!Xt[a])){for(i=-1,o=0;o<hd.length;o++)r=s.indexOf(hd[o]),r!==-1&&(i===-1||r<i)&&(i=r);i===-1?h=s.lastIndexOf("@"):h=s.lastIndexOf("@",i),h!==-1&&(S=s.slice(0,h),s=s.slice(h+1),this.auth=decodeURIComponent(S));for(i=-1,o=0;o<md.length;o++)r=s.indexOf(md[o]),r!==-1&&(i===-1||r<i)&&(i=r);if(i===-1&&(i=s.length),this.host=s.slice(0,i),s=s.slice(i),this.parseHost(),this.hostname=this.hostname||"",m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]",!m)for(var b=this.hostname.split(/\./),o=0,j=b.length;o<j;o++)if(c=b[o],c&&!c.match(ud)){for(var w="",f=0,T=c.length;f<T;f++)c.charCodeAt(f)>127?w+="x":w+=c[f];if(!w.match(ud)){var E=b.slice(0,o),O=b.slice(o+1),x=c.match(o0);x&&(E.push(x[1]),O.unshift(x[2])),O.length&&(s="/"+O.join(".")+s),this.hostname=E.join(".");break}}this.hostname.length>n0?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=K4.toASCII(this.hostname)),y=this.port?":"+this.port:"",k=this.hostname||"",this.host=k+y,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),s[0]!=="/"&&(s="/"+s))}if(!i0[g])for(o=0,j=li.length;o<j;o++)l=li[o],s.indexOf(l)!==-1&&(v=encodeURIComponent(l),v===l&&(v=escape(l)),s=s.split(l).join(v));return p=s.indexOf("#"),p!==-1&&(this.hash=s.substr(p),s=s.slice(0,p)),d=s.indexOf("?"),(d!==-1?(this.search=s.substr(d),this.query=s.substr(d+1),t&&(this.query=mi.parse(this.query)),s=s.slice(0,d)):t&&(this.search="",this.query={}),s&&(this.pathname=s),Xt[g]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search)&&(y=this.pathname||"",F=this.search||"",this.path=y+F),this.href=this.format(),this},Xe.prototype.format=function(){e=this.auth||"",e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var e,n,o=this.protocol||"",s=this.pathname||"",i=this.hash||"",t=!1,a="";return this.host?t=e+this.host:this.hostname&&(t=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(t+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(a=mi.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1})),n=this.search||a&&"?"+a||"",o&&o.substr(-1)!==":"&&(o+=":"),this.slashes||(!o||Xt[o])&&t!==!1?(t="//"+(t||""),s&&s.charAt(0)!=="/"&&(s="/"+s)):t||(t=""),i&&i.charAt(0)!=="#"&&(i="#"+i),n&&n.charAt(0)!=="?"&&(n="?"+n),s=s.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),n=n.replace("#","%23"),o+t+s+n+i},Xe.prototype.resolve=function(e){return this.resolveObject(Cp(e,!1,!0)).format()},Xe.prototype.resolveObject=function(e){typeof e=="string"&&(j=new Xe,j.parse(e,!1,!0),e=j);for(var t=new Xe,w=Object.keys(this),g=0;g<w.length;g++)v=w[g],t[v]=this[v];if(t.hash=e.hash,e.href==="")return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(b=Object.keys(e),l=0;l<b.length;l++)u=b[l],u!=="protocol"&&(t[u]=e[u]);return Xt[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!Xt[e.protocol]){for(f=Object.keys(e),d=0;d<f.length;d++)m=f[d],t[m]=e[m];return t.href=t.format(),t}if(t.protocol=e.protocol,!e.host&&!di[e.protocol]){for(s=(e.pathname||"").split("/");s.length&&!(e.host=s.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),s[0]!==""&&s.unshift(""),s.length<2&&s.unshift(""),t.pathname=s.join("/")}else t.pathname=e.pathname;return(t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,t.pathname||t.search)&&(O=t.pathname||"",y=t.search||"",t.path=O+y),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var o,l,d,u,m,f,p,v,b,j,y,O,E=t.pathname&&t.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",i=_||E||t.host&&e.pathname,x=i,n=t.pathname&&t.pathname.split("/")||[],s=e.pathname&&e.pathname.split("/")||[],h=t.protocol&&!Xt[t.protocol];if(h&&(t.hostname="",t.port=null,t.host&&(n[0]===""?n[0]=t.host:n.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(s[0]===""?s[0]=e.host:s.unshift(e.host)),e.host=null),i=i&&(s[0]===""||n[0]==="")),_)t.host=e.host||e.host===""?e.host:t.host,t.hostname=e.hostname||e.hostname===""?e.hostname:t.hostname,t.search=e.search,t.query=e.query,n=s;else if(s.length)n||(n=[]),n.pop(),n=n.concat(s),t.search=e.search,t.query=e.query;else if(e.search!=null)return h&&(t.host=n.shift(),t.hostname=t.host,o=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"),o&&(t.auth=o.shift(),t.hostname=o.shift(),t.host=t.hostname)),t.search=e.search,t.query=e.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t;if(!n.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var r=n.slice(-1)[0],C=(t.host||e.host||n.length>1)&&(r==="."||r==="..")||r==="",c=0,a=n.length;a>=0;a--)r=n[a],r==="."?n.splice(a,1):r===".."?(n.splice(a,1),c++):c&&(n.splice(a,1),c--);if(!i&&!x)for(;c--;c)n.unshift("..");return i&&n[0]!==""&&(!n[0]||n[0].charAt(0)!=="/")&&n.unshift(""),C&&n.join("/").substr(-1)!=="/"&&n.push(""),p=n[0]===""||n[0]&&n[0].charAt(0)==="/",h&&(t.hostname=p?"":n.length?n.shift():"",t.host=t.hostname,o=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"),o&&(t.auth=o.shift(),t.hostname=o.shift(),t.host=t.hostname)),i=i||t.host&&n.length,i&&!p&&n.unshift(""),n.length>0?t.pathname=n.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},Xe.prototype.parseHost=function(){var e=this.host,t=G4.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},ad={};function v(e,t,n=3){if(ad[t])return;let s=(new Error).stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(s=s.split(`
`).splice(n).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(s))),ad[t]=!0}function De(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function yo(e){return e.split("?")[0].split("#")[0]}function wv(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _v(e,t,n){return e.replace(new RegExp(wv(t),"g"),n)}function vv(e){let n="",i=0,s=-1,o=0,a=-1;for(let t=0;t<=e.length;++t){if(t<e.length)a=e.charCodeAt(t);else{if(a===47)break;a=47}if(a===47){if(s!==t-1&&o!==1)if(s!==t-1&&o===2){if(n.length<2||i!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46)if(n.length>2){{const e=n.lastIndexOf("/");if(e!==n.length-1){e===-1?(n="",i=0):(n=n.slice(0,e),i=n.length-1-n.lastIndexOf("/")),s=t,o=0;continue}}}else if(n.length===2||n.length===1){n="",i=0,s=t,o=0;continue}}else n.length>0?n+=`/${e.slice(s+1,t)}`:n=e.slice(s+1,t),i=t-s-1;s=t,o=0}else a===46&&o!==-1?++o:o=-1}return n}I={toPosix(e){return _v(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@/?%\s<>]*?)$/i.test(e)},isBlobUrl(e){return e.startsWith("blob:")},hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){De(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const n=/^[^/:]+:\/{0,2}/.exec(e);return n?n[0]:""},toAbsolute(e,t,n){if(De(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const s=yo(this.toPosix(t??i.ADAPTER.getBaseUrl())),o=yo(this.toPosix(n??this.rootname(s)));return e=this.toPosix(e),e.startsWith("/")?I.join(o,e.slice(1)):this.isAbsolute(e)?e:this.join(s,e)},normalize(e){if(De(e),e.length===0)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;e=this.toPosix(e);let t="";const n=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const s=e.endsWith("/");return e=vv(e),e.length>0&&s&&(e+="/"),n?`/${e}`:t+e},isAbsolute(e){return De(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...t){if(t.length===0)return".";let e;for(let s=0;s<t.length;++s){const n=t[s];if(De(n),n.length>0)if(e===0[0])e=n;else{const o=t[s-1]??"";this.joinExtensions.includes(this.extname(o).toLowerCase())?e+=`/../${n}`:e+=`/${n}`}}return e===0[0]?".":this.normalize(e)},dirname(e){if(De(e),e.length===0)return".";e=this.toPosix(e);let s=e.charCodeAt(0);const o=s===47;let t=-1,i=!0;const n=this.getProtocol(e),a=e;e=e.slice(n.length);for(let n=e.length-1;n>=1;--n)if(s=e.charCodeAt(n),s===47){if(!i){t=n;break}}else i=!1;return t===-1?o?"/":this.isUrl(a)?n+e:n:o&&t===1?"//":n+e.slice(0,t)},rootname(e){De(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const n=e.indexOf("/",t.length);n!==-1?t=e.slice(0,n):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){De(e),t&&De(t),e=yo(this.toPosix(e));let o=0,s=-1,i=!0,n;if(t!==0[0]&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let a=t.length-1,r=-1;for(n=e.length-1;n>=0;--n){const c=e.charCodeAt(n);if(c===47){if(!i){o=n+1;break}}else r===-1&&(i=!1,r=n+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(s=n):(a=-1,s=r))}return o===s?s=r:s===-1&&(s=e.length),e.slice(o,s)}for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!i){o=n+1;break}}else s===-1&&(i=!1,s=n+1);return s===-1?"":e.slice(o,s)},extname(e){De(e),e=yo(this.toPosix(e));let t=-1,o=0,n=-1,i=!0,s=0;for(let a=e.length-1;a>=0;--a){const r=e.charCodeAt(a);if(r===47){if(!i){o=a+1;break}continue}n===-1&&(i=!1,n=a+1),r===46?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||n===-1||s===0||s===1&&t===n-1&&t===o+1?"":e.slice(t,n)},parse(e){De(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=yo(this.toPosix(e));let r=e.charCodeAt(0);const c=this.isAbsolute(e);let l;t.root=this.rootname(e),c||this.hasProtocol(e)?l=1:l=0;let s=-1,o=0,n=-1,d=!0,i=e.length-1,a=0;for(;i>=l;--i){if(r=e.charCodeAt(i),r===47){if(!d){o=i+1;break}continue}n===-1&&(d=!1,n=i+1),r===46?s===-1?s=i:a!==1&&(a=1):s!==-1&&(a=-1)}return s===-1||n===-1||a===0||a===1&&s===n-1&&s===o+1?n!==-1&&(o===0&&c?t.base=t.name=e.slice(1,n):t.base=t.name=e.slice(o,n)):(o===0&&c?(t.name=e.slice(1,s),t.base=e.slice(1,n)):(t.name=e.slice(o,s),t.base=e.slice(o,n)),t.ext=e.slice(s,n)),t.dir=this.dirname(e),t},sep:"/",delimiter:":",joinExtensions:[".html"]};async function dv(){return ed??(ed=(async()=>{var s;const e=document.createElement("canvas").getContext("webgl");if(!e)return se.UNPACK;const o=await new Promise(e=>{const t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()});if(!o)return se.UNPACK;const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o);const n=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,n),e.deleteFramebuffer(i),e.deleteTexture(t),(s=e.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?se.PMA:se.UNPACK})()),ed}function ov(){return typeof Gl>"u"&&(Gl=function(){var e;const t={stencil:!0,failIfMajorPerformanceCaveat:i.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!i.ADAPTER.getWebGLRenderingContext())return!1;const s=i.ADAPTER.createCanvas();let n=s.getContext("webgl",t)||s.getContext("experimental-webgl",t);const o=!!((e=n?.getContextAttributes())!=null&&e.stencil);if(n){const e=n.getExtension("WEBGL_lose_context");e&&e.loseContext()}return n=null,o}catch{return!1}}()),Gl}w0={grad:.9,turn:360,rad:360/(2*Math.PI)},Ue=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},$=function(e,t,n){return t===0[0]&&(t=0),n===0[0]&&(n=10**t),Math.round(n*e)/n+0},re=function(e,t,n){return t===0[0]&&(t=0),n===0[0]&&(n=1),e>n?n:e>t?e:t},Bl=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},Il=function(e){return{r:re(e.r,0,255),g:re(e.g,0,255),b:re(e.b,0,255),a:re(e.a)}},yi=function(e){return{r:$(e.r),g:$(e.g),b:$(e.b),a:$(e.a,3)}},S0=/^#([0-9a-f]{3,8})$/i,uo=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},Ll=function(e){var n=e.r,s=e.g,i=e.b,r=e.a,t=Math.max(n,s,i),o=t-Math.min(n,s,i),a=o?t===n?(s-i)/o:t===s?2+(i-n)/o:4+(n-s)/o:0;return{h:60*(a<0?a+6:a),s:t?o/t*100:0,v:t/255*100,a:r}},Nl=function(e){var s=e.h,o=e.s,t=e.v,l=e.a,s=s/360*6;o/=100,t/=100;var i=Math.floor(s),n=t*(1-o),a=t*(1-(s-i)*o),r=t*(1-(1-s+i)*o),c=i%6;return{r:255*[t,a,n,n,r,t][c],g:255*[r,t,t,a,n,n][c],b:255*[n,n,r,t,t,a][c],a:l}},Dl=function(e){return{h:Bl(e.h),s:re(e.s,0,100),l:re(e.l,0,100),a:re(e.a)}},zl=function(e){return{h:$(e.h),s:$(e.s),l:$(e.l),a:$(e.a,3)}},Tl=function(e){return Nl((t=(s=e).s,{h:s.h,s:(t*=((n=s.l)<50?n:100-n)/100)>0?2*t/(n+t)*100:0,v:n+t,a:s.a}));var t,n,s},es=function(e){return{h:(n=Ll(e)).h,s:(t=(200-(s=n.s))*(o=n.v)/100)>0&&t<200?s*o/100/(t<=100?t:200-t)*100:0,l:t/2,a:n.a};var t,n,s,o},R0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,P0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,H0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,I0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wi={string:[[function(e){var t=S0.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?$(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?$(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=H0.exec(e)||I0.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:Il({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===0[0]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var n,s,o,t=R0.exec(e)||P0.exec(e);return t?(o=Dl({h:(s=t[1],n=t[2],n===0[0]&&(n="deg"),Number(s)*(w0[n]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===0[0]?1:Number(t[5])/(t[6]?100:1)}),Tl(o)):null},"hsl"]],object:[[function(e){var t=e.r,n=e.g,s=e.b,o=e.a,i=o===0[0]?1:o;return Ue(t)&&Ue(n)&&Ue(s)?Il({r:Number(t),g:Number(n),b:Number(s),a:Number(i)}):null},"rgb"],[function(e){var i,t=e.h,n=e.s,s=e.l,o=e.a,a=o===0[0]?1:o;return!Ue(t)||!Ue(n)||!Ue(s)?null:(i=Dl({h:Number(t),s:Number(n),l:Number(s),a:Number(a)}),Tl(i))},"hsl"],[function(e){var i,t=e.h,n=e.s,s=e.v,o=e.a,a=o===0[0]?1:o;return!Ue(t)||!Ue(n)||!Ue(s)?null:(i=function(e){return{h:Bl(e.h),s:re(e.s,0,100),v:re(e.v,0,100),a:re(e.a)}}({h:Number(t),s:Number(n),v:Number(s),a:Number(a)}),Nl(i))},"hsv"]]},kl=function(e,t){for(var s,n=0;n<t.length;n++)if(s=t[n][0](e),s)return[s,t[n][1]];return[null,0[0]]},$0=function(e){return typeof e=="string"?kl(e.trim(),wi.string):typeof e=="object"&&e!==null?kl(e,wi.object):[null,0[0]]},Oi=function(e,t){var n=es(e);return{h:n.h,s:re(n.s+100*t,0,100),l:n.l,a:n.a}},xi=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},xl=function(e,t){var n=es(e);return{h:n.h,s:n.s,l:re(n.l+100*t,0,100),a:n.a}},Ci=function(){function e(e){this.parsed=$0(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return $(xi(this.rgba),2)},e.prototype.isDark=function(){return xi(this.rgba)<.5},e.prototype.isLight=function(){return xi(this.rgba)>=.5},e.prototype.toHex=function(){return e=yi(this.rgba),t=e.r,n=e.g,s=e.b,i=(o=e.a)<1?uo($(255*o)):"","#"+uo(t)+uo(n)+uo(s)+i;var e,t,n,s,o,i},e.prototype.toRgb=function(){return yi(this.rgba)},e.prototype.toRgbString=function(){return e=yi(this.rgba),t=e.r,n=e.g,s=e.b,(o=e.a)<1?"rgba("+t+", "+n+", "+s+", "+o+")":"rgb("+t+", "+n+", "+s+")";var e,t,n,s,o},e.prototype.toHsl=function(){return zl(es(this.rgba))},e.prototype.toHslString=function(){return e=zl(es(this.rgba)),t=e.h,n=e.s,s=e.l,(o=e.a)<1?"hsla("+t+", "+n+"%, "+s+"%, "+o+")":"hsl("+t+", "+n+"%, "+s+"%)";var e,t,n,s,o},e.prototype.toHsv=function(){return e=Ll(this.rgba),{h:$(e.h),s:$(e.s),v:$(e.v),a:$(e.a,3)};var e},e.prototype.invert=function(){return Te({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return e===0[0]&&(e=.1),Te(Oi(this.rgba,e))},e.prototype.desaturate=function(e){return e===0[0]&&(e=.1),Te(Oi(this.rgba,-e))},e.prototype.grayscale=function(){return Te(Oi(this.rgba,-1))},e.prototype.lighten=function(e){return e===0[0]&&(e=.1),Te(xl(this.rgba,e))},e.prototype.darken=function(e){return e===0[0]&&(e=.1),Te(xl(this.rgba,-e))},e.prototype.rotate=function(e){return e===0[0]&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return typeof e=="number"?Te({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):$(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=es(this.rgba);return typeof e=="number"?Te({h:e,s:t.s,l:t.l,a:t.a}):$(t.h)},e.prototype.isEqual=function(e){return this.toHex()===Te(e).toHex()},e}(),Te=function(e){return e instanceof Ci?e:new Ci(e)},_l=[],X0=function(e){e.forEach(function(e){_l.indexOf(e)<0&&(e(Ci,wi),_l.push(e))})};function j7(e,t){var s,i,n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},o={};for(i in n)o[n[i]]=i;s={},e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";if(r=o[this.toHex()],r)return r;if(t!=null&&t.closest){var i,a,r,c,u,h,m=this.toRgb(),l=1/0,d="black";if(!s.length)for(u in n)s[u]=new e(n[u]).toRgb();for(h in n)c=(i=m,a=s[h],(i.r-a.r)**2+(i.g-a.g)**2+(i.b-a.b)**2),c<l&&(l=c,d=h);return d}},t.string.push([function(t){var s=t.toLowerCase(),o=s==="transparent"?"#0000":n[s];return o?new e(o).toRgb():null},"name"])}X0([j7]),Rt=class Gs{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Gs)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const n=typeof e;if(n!==typeof t)return!1;if(n==="number"||n==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every((e,n)=>e===t[n]);if(e!==null&&t!==null){const n=Object.keys(e),s=Object.keys(t);return n.length===s.length&&n.every(n=>e[n]===t[n])}return e===t}toRgba(){const[e,t,n,s]=this._components;return{r:e,g:t,b:n,a:s}}toRgb(){const[e,t,n]=this._components;return{r:e,g:t,b:n}}toRgbaString(){const[e,t,n]=this.toUint8RgbArray();return`rgba(${e},${t},${n},${this.alpha})`}toUint8RgbArray(e){const[t,n,s]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(n*255),e[2]=Math.round(s*255),e}toRgbArray(e){e=e??[];const[t,n,s]=this._components;return e[0]=t,e[1]=n,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,n,s,o]=Gs.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=n,this._components[2]*=s,this._components[3]*=o,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let n=this._int>>16&255,s=this._int>>8&255,o=this._int&255;return t&&(n=n*e+.5|0,s=s*e+.5|0,o=o*e+.5|0),(e*255<<24)+(n<<16)+(s<<8)+o}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,n,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(n*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,n,s,o]=this._components;return e[0]=t,e[1]=n,e[2]=s,e[3]=o,e}normalize(e){let t,n,s,o;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const i=e;t=(i>>16&255)/255,n=(i>>8&255)/255,s=(i&255)/255,o=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,n,s,o=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,n,s,o=255]=e,t/=255,n/=255,s/=255,o/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const t=Gs.HEX_PATTERN.exec(e);t&&(e=`#${t[2]}`)}const i=Te(e);i.isValid()&&({r:t,g:n,b:s,a:o}=i.rgba,t/=255,n/=255,s/=255)}if(t!==0[0])this._components[0]=t,this._components[1]=n,this._components[2]=s,this._components[3]=o,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,n]=this._components;this._int=(e*255<<16)+(t*255<<8)+(n*255|0)}_clamp(e,t=0,n=1){return typeof e=="number"?Math.min(Math.max(e,t),n):(e.forEach((s,o)=>{e[o]=Math.min(Math.max(s,t),n)}),e)}},Rt.shared=new Rt,Rt.temp=new Rt,Rt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i,O=Rt;function f7(e){return v("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),O.shared.setValue(e).toHex()}function m7(e){return v("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),O.shared.setValue(e).toNumber()}function h7(){const e=[],t=[];for(let n=0;n<32;n++)e[n]=n,t[n]=n;e[d.NORMAL_NPM]=d.NORMAL,e[d.ADD_NPM]=d.ADD,e[d.SCREEN_NPM]=d.SCREEN,t[d.NORMAL]=d.NORMAL_NPM,t[d.ADD]=d.ADD_NPM,t[d.SCREEN]=d.SCREEN_NPM;const n=[];return n.push(t),n.push(e),n}fl=h7();function o2(e,t){return fl[t?1:0][e]}function l7(e,t=null){const n=e*6;if(t=t||new Uint16Array(n),t.length!==n)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${n}`);for(let e=0,s=0;e<n;e+=6,s+=4)t[e+0]=s+0,t[e+1]=s+1,t[e+2]=s+2,t[e+3]=s+0,t[e+4]=s+2,t[e+5]=s+3;return t}function a2(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function Mi(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function c2(e){return!(e&e-1)&&!!e}function l2(e){let n=(e>65535?1:0)<<4;e>>>=n;let t=(e>255?1:0)<<3;return e>>>=t,n|=t,t=(e>15?1:0)<<2,e>>>=t,n|=t,t=(e>3?1:0)<<1,e>>>=t,n|=t,n|e>>1}function Zn(e,t,n){const o=e.length;let s;if(t>=o||n===0)return;n=t+n>o?o-t:n;const i=o-n;for(s=t;s<i;++s)e[s]=e[s+n];e.length=i}function Tt(e){return e===0?0:e<0?-1:1}h2=0;function ln(){return++h2}Bi=class{constructor(e,t,n,s){this.left=e,this.top=t,this.right=n,this.bottom=s}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},Bi.EMPTY=new Bi(0,0,0,0),Wc=Bi,$c={},Me=Object.create(null),ht=Object.create(null),j2=class{constructor(e,t,n){this._canvas=i.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||i.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}};function y2(e,t,n){for(let s=0,o=4*n*t;s<t;++s,o+=4)if(e[o+3]!==0)return!1;return!0}function _2(e,t,n,s,o){const i=4*t;for(let t=s,a=s*i+4*n;t<=o;++t,a+=i)if(e[a+3]!==0)return!1;return!0}function i7(e){const{width:n,height:o}=e,c=e.getContext("2d",{willReadFrequently:!0});if(c===null)throw new TypeError("Failed to get canvas 2D context");const i=c.getImageData(0,0,n,o).data;let r=0,t=0,a=n-1,s=o-1;for(;t<o&&y2(i,n,t);)++t;if(t===o)return Wc.EMPTY;for(;y2(i,n,s);)--s;for(;_2(i,n,r,t,s);)++r;for(;_2(i,n,a,t,s);)--a;return++a,++s,new Wc(r,t,a,s)}function n7(e){const t=i7(e),{width:n,height:s}=t;let o=null;if(!t.isEmpty()){const i=e.getContext("2d");if(i===null)throw new TypeError("Failed to get canvas 2D context");o=i.getImageData(t.left,t.top,n,s)}return{width:n,height:s,data:o}}function t7(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location;const n=new URL(e,document.baseURI);return n.hostname!==t.hostname||n.port!==t.port||n.protocol!==t.protocol?"anonymous":""}function et(e,t=1){var n;const s=(n=i.RETINA_PREFIX)==null?0[0]:n.exec(e);return s?parseFloat(s[1]):t}s=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(s||{}),Ji=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Ec=(e,t)=>Ji(e).priority??t,a={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Ji).forEach(e=>{e.type.forEach(t=>{var n,s;return(s=(n=this._removeHandlers)[t])==null?0[0]:s.call(n,e)})}),this},add(...e){return e.map(Ji).forEach(e=>{e.type.forEach(t=>{var o,i;const n=this._addHandlers,s=this._queue;n[t]?(o=n[t])==null||o.call(n,e):(s[t]=s[t]||[],(i=s[t])==null||i.push(e))})}),this},handle(e,t,n){var o;const i=this._addHandlers,a=this._removeHandlers;if(i[e]||a[e])throw new Error(`Extension type ${e} already has a handler`);i[e]=t,a[e]=n;const s=this._queue;return s[e]&&((o=s[e])==null||o.forEach(e=>t(e)),delete s[e]),this},handleByMap(e,t){return this.handle(e,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(e,t,n=-1){return this.handle(e,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((e,t)=>Ec(t,n)-Ec(e,n)))},e=>{const n=t.indexOf(e.ref);n!==-1&&t.splice(n,1)})}},oa=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}},F2=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function J5(e){let t="";for(let n=0;n<e;++n)n>0&&(t+=`
else `),n<e-1&&(t+=`if(test == ${n}.0){}`);return t}function Q5(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=t.createShader(t.FRAGMENT_SHADER);for(;;){const s=F2.replace(/%forloop%/gi,J5(e));if(t.shaderSource(n,s),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))e=e/2|0;else break}return e}ca=0,la=1,da=2,ha=3,fa=4,ba=5,ut=class _dr{constructor(){this.data=0,this.blendMode=d.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ca)}set blend(e){!!(this.data&1<<ca)!==e&&(this.data^=1<<ca)}get offsets(){return!!(this.data&1<<la)}set offsets(e){!!(this.data&1<<la)!==e&&(this.data^=1<<la)}get culling(){return!!(this.data&1<<da)}set culling(e){!!(this.data&1<<da)!==e&&(this.data^=1<<da)}get depthTest(){return!!(this.data&1<<ha)}set depthTest(e){!!(this.data&1<<ha)!==e&&(this.data^=1<<ha)}get depthMask(){return!!(this.data&1<<ba)}set depthMask(e){!!(this.data&1<<ba)!==e&&(this.data^=1<<ba)}get clockwiseFrontFace(){return!!(this.data&1<<fa)}set clockwiseFrontFace(e){!!(this.data&1<<fa)!==e&&(this.data^=1<<fa)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==d.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new _dr;return e.depthTest=!1,e.blend=!0,e}},ut.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`},Oa=[];function V2(e,t){if(!e)return null;let n="";if(typeof e=="string"){const t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(n=t[1].toLowerCase())}for(let s=Oa.length-1;s>=0;--s){const o=Oa[s];if(o.test&&o.test(e,n))return new o(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}ue=class{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,n,s,o,i,a,r){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let d=0,u=c.length;d<u;d++)c[d][l](e,t,n,s,o,i,a,r);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}},Object.defineProperties(ue.prototype,{dispatch:{value:ue.prototype.emit},run:{value:ue.prototype.emit}}),Dn=class{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new ue("setRealSize"),this.onUpdate=new ue("update"),this.onError=new ue("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(){return!1}},Ls=class extends Dn{constructor(e,t){const{width:n,height:s}=t||{};if(!n||!s)throw new Error("BufferResource width or height invalid");super(n,s),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,n){const s=e.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===se.UNPACK);const o=t.realWidth,i=t.realHeight;return n.width===o&&n.height===i?s.texSubImage2D(t.target,0,0,0,o,i,t.format,n.type,this.data):(n.width=o,n.height=i,s.texImage2D(t.target,0,n.internalFormat,o,i,0,t.format,n.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}},K2={scaleMode:Ve.NEAREST,alphaMode:se.NPM},xa=class Ni extends ns{constructor(e=null,t=null){super(),t=Object.assign({},Ni.defaultOptions,t);const{alphaMode:o,mipmap:a,anisotropicLevel:r,scaleMode:c,width:n,height:s,wrapMode:l,format:d,type:u,target:h,resolution:m,resourceOptions:f}=t;e&&!(e instanceof Dn)&&(e=V2(e,f),e.internal=!0),this.resolution=m||i.RESOLUTION,this.width=Math.round((n||0)*this.resolution)/this.resolution,this.height=Math.round((s||0)*this.resolution)/this.resolution,this._mipmap=a,this.anisotropicLevel=r,this._wrapMode=l,this._scaleMode=c,this.format=d,this.type=u,this.target=h,this.alphaMode=o,this.uid=ln(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=n>0&&s>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let n;return e!==0[0]&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),t!==0[0]&&t!==this.mipmap&&(this.mipmap=t,n=!0),n&&this.dirtyStyleId++,this}setSize(e,t,n){return n=n||this.resolution,this.setRealSize(e*n,t*n,n)}setRealSize(e,t,n){return this.resolution=n||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=c2(this.realWidth)&&c2(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ht[this.cacheId],delete Me[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ni.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,n=i.STRICT_TEXTURE_CACHE){const a=typeof e=="string";let s=null;if(a)s=e;else{if(!e._pixiId){const n=t?.pixiIdPrefix||"pixiid";e._pixiId=`${n}_${ln()}`}s=e._pixiId}let o=ht[s];if(a&&n&&!o)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return o||(o=new Ni(e,t),o.cacheId=s,Ni.addToCache(o,s)),o}static fromBuffer(e,t,s,o){e=e||new Float32Array(t*s*4);const r=new Ls(e,{width:t,height:s,...o?.resourceOptions});let i,a;return e instanceof Float32Array?(i=n.RGBA,a=c.FLOAT):e instanceof Int32Array?(i=n.RGBA_INTEGER,a=c.INT):e instanceof Uint32Array?(i=n.RGBA_INTEGER,a=c.UNSIGNED_INT):e instanceof Int16Array?(i=n.RGBA_INTEGER,a=c.SHORT):e instanceof Uint16Array?(i=n.RGBA_INTEGER,a=c.UNSIGNED_SHORT):e instanceof Int8Array?(i=n.RGBA,a=c.BYTE):(i=n.RGBA,a=c.UNSIGNED_BYTE),r.internal=!0,new Ni(r,Object.assign({},K2,{type:a,format:i},o))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ht[t]&&ht[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ht[t]=e)}static removeFromCache(e){if(typeof e=="string"){{const t=ht[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete ht[e],t}}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ht[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}},xa.defaultOptions={mipmap:ke.POW2,anisotropicLevel:0,scaleMode:Ve.LINEAR,wrapMode:Ye.CLAMP,alphaMode:se.UNPACK,target:an.TEXTURE_2D,format:n.RGBA,type:c.UNSIGNED_BYTE},xa._globalBatch=0,m=xa,Ea=class{constructor(){this.texArray=null,this.blend=0,this.type=Ce.TRIANGLES,this.start=0,this.size=0,this.data=null}},X2=0,P=class _Kt{constructor(e,t=!0,n=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=t,this.id=X2++,this.disposeRunner=new ue("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?Ee.ELEMENT_ARRAY_BUFFER:Ee.ARRAY_BUFFER}get index(){return this.type===Ee.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new _Kt(e)}},Xr=class _oo{constructor(e,t=0,n=!1,s=c.FLOAT,o,i,a,r=1){this.buffer=e,this.size=t,this.normalized=n,this.type=s,this.stride=o,this.start=i,this.instance=a,this.divisor=r}destroy(){this.buffer=null}static from(e,t,n,s,o){return new _oo(e,t,n,s,o)}},J2={Float32Array,Uint32Array,Int32Array,Uint8Array};function R5(e,t){let s=0,o=0;const n={};for(let n=0;n<e.length;n++)o+=t[n],s+=e[n].length;const i=new ArrayBuffer(s*4);let a=null,r=0;for(let s=0;s<e.length;s++){const l=t[s],d=e[s],c=a2(d);n[c]||(n[c]=new J2[c](i)),a=n[c];for(let e=0;e<d.length;e++){const t=(e/l|0)*o+r,n=e%l;a[t+n]=d[e]}r+=l}return new Float32Array(i)}Gr={5126:4,5123:2,5121:1},n3=0,s3={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Gn=class _$r{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=n3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new ue("disposeGeometry"),this.refCount=0}addAttribute(e,t,n=0,s=!1,o,i,a,r=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof P||(t instanceof Array&&(t=new Float32Array(t)),t=new P(t));const c=e.split("|");if(c.length>1){for(let e=0;e<c.length;e++)this.addAttribute(c[e],t,n,s,o);return this}let l=this.buffers.indexOf(t);return l===-1&&(this.buffers.push(t),l=this.buffers.length-1),this.attributes[e]=new Xr(l,n,s,o,i,a,r),this.instanced=this.instanced||r,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof P||(e instanceof Array&&(e=new Uint16Array(e)),e=new P(e)),e.type=Ee.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],n=[],s=new P;let e;for(e in this.attributes){const s=this.attributes[e],o=this.buffers[s.buffer];t.push(o.data),n.push(s.size*Gr[s.type]/4),s.buffer=0}for(s.data=R5(t,n),e=0;e<this.buffers.length;e++)this.buffers[e]!==this.indexBuffer&&this.buffers[e].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new _$r;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new P(this.buffers[t].data.slice(0));for(const n in this.attributes){const t=this.attributes[n];e.attributes[n]=new Xr(t.buffer,t.size,t.normalized,t.type,t.stride,t.start,t.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Ee.ELEMENT_ARRAY_BUFFER),e}static merge(e){const n=new _$r,o=[],s=[],i=[];let t;for(let n=0;n<e.length;n++){t=e[n];for(let e=0;e<t.buffers.length;e++)s[e]=s[e]||0,s[e]+=t.buffers[e].data.length,i[e]=0}for(let e=0;e<t.buffers.length;e++)o[e]=new s3[a2(t.buffers[e].data)](s[e]),n.buffers[e]=new P(o[e]);for(let n=0;n<e.length;n++){t=e[n];for(let e=0;e<t.buffers.length;e++)o[e].set(t.buffers[e].data,i[e]),i[e]+=t.buffers[e].data.length}if(n.attributes=t.attributes,t.indexBuffer){n.indexBuffer=n.buffers[t.buffers.indexOf(t.indexBuffer)],n.indexBuffer.type=Ee.ELEMENT_ARRAY_BUFFER;let o=0,i=0,a=0,s=0;for(let e=0;e<t.buffers.length;e++)if(t.buffers[e]!==t.indexBuffer){s=e;break}for(const n in t.attributes){const e=t.attributes[n];(e.buffer|0)===s&&(i+=e.size*Gr[e.type]/4)}for(let t=0;t<e.length;t++){const r=e[t].indexBuffer.data;for(let e=0;e<r.length;e++)n.indexBuffer.data[e+a]+=o;o+=e[t].buffers[s].data.length/i,a+=r.length}}return n}},qr=class extends Gn{constructor(e=!1){super(),this._buffer=new P(null,e,!1),this._indexBuffer=new P(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,c.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,c.FLOAT).addAttribute("aColor",this._buffer,4,!0,c.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,c.FLOAT).addIndex(this._indexBuffer)}},Fs=Math.PI*2,r3=180/Math.PI,c3=Math.PI/180,G=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(G||{}),y=class _It{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new _It(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}},y.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`},As=[new y,new y,new y,new y],g=class _wt{constructor(e=0,t=0,n=0,s=0){this.x=Number(e),this.y=Number(t),this.width=Number(n),this.height=Number(s),this.type=G.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new _wt(0,0,0,0)}clone(){return new _wt(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const n=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>n}const u=this.left,l=this.right,c=this.top,r=this.bottom;if(l<=u||r<=c)return!1;const n=As[0].set(e.left,e.top),i=As[1].set(e.left,e.bottom),o=As[2].set(e.right,e.top),s=As[3].set(e.right,e.bottom);if(o.x<=n.x||i.y<=n.y)return!1;const f=Math.sign(t.a*t.d-t.b*t.c);if(f===0||(t.apply(n,n),t.apply(i,i),t.apply(o,o),t.apply(s,s),Math.max(n.x,i.x,o.x,s.x)<=u||Math.min(n.x,i.x,o.x,s.x)>=l||Math.max(n.y,i.y,o.y,s.y)<=c||Math.min(n.y,i.y,o.y,s.y)>=r))return!1;const d=f*(i.y-n.y),a=f*(n.x-i.x),b=d*u+a*c,v=d*l+a*c,p=d*u+a*r,g=d*l+a*r;if(Math.max(b,v,p,g)<=d*n.x+a*n.y||Math.min(b,v,p,g)>=d*s.x+a*s.y)return!1;const m=f*(n.y-o.y),h=f*(o.x-n.x),j=m*u+h*c,y=m*l+h*c,_=m*u+h*r,w=m*l+h*r;return!(Math.max(j,y,_,w)<=m*n.x+h*n.y||Math.min(j,y,_,w)>=m*s.x+h*s.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),o=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(s-t,0),this.y=n,this.height=Math.max(o-n,0),this}ceil(e=1,t=.001){const n=Math.ceil((this.x+this.width-t)*e)/e,s=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=n-this.x,this.height=s-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),o=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=s-t,this.y=n,this.height=o-n,this}},g.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`},vr=class _Mo{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.radius=n,this.type=G.CIRC}clone(){return new _Mo(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const o=this.radius*this.radius;let n=this.x-e,s=this.y-t;return n*=n,s*=s,n+s<=o}getBounds(){return new g(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}},vr.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`},Xa=class _Do{constructor(e=0,t=0,n=0,s=0){this.x=e,this.y=t,this.width=n,this.height=s,this.type=G.ELIP}clone(){return new _Do(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let n=(e-this.x)/this.width,s=(t-this.y)/this.height;return n*=n,s*=s,n+s<=1}getBounds(){return new g(this.x-this.width,this.y-this.height,this.width,this.height)}},Xa.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`},Un=class _ai{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const t=[];for(let n=0,s=e.length;n<s;n++)t.push(e[n].x,e[n].y);e=t}this.points=e,this.type=G.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new _ai(t);return e.closeStroke=this.closeStroke,e}contains(e,t){let n=!1;const s=this.points.length/2;for(let o=0,i=s-1;o<s;i=o++){const r=this.points[o*2],a=this.points[o*2+1],l=this.points[i*2],c=this.points[i*2+1];a>t!=c>t&&e<(l-r)*((t-a)/(c-a))+r&&(n=!n)}return n}},Un.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`},Ya=class _Bo{constructor(e=0,t=0,n=0,s=0,o=20){this.x=e,this.y=t,this.width=n,this.height=s,this.radius=o,this.type=G.RREC}clone(){return new _Bo(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+n&&t<=this.y+this.height-n||e>=this.x+n&&e<=this.x+this.width-n)return!0;let s=e-(this.x+n),o=t-(this.y+n);const i=n*n;if(s*s+o*o<=i||(s=e-(this.x+this.width-n),s*s+o*o<=i)||(o=t-(this.y+this.height-n),s*s+o*o<=i)||(s=e-(this.x+n),s*s+o*o<=i))return!0}return!1}},Ya.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`},z=class _Ft{constructor(e=1,t=0,n=0,s=1,o=0,i=0){this.array=null,this.a=e,this.b=t,this.c=n,this.d=s,this.tx=o,this.ty=i}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,n,s,o,i){return this.a=e,this.b=t,this.c=n,this.d=s,this.tx=o,this.ty=i,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const n=t||this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(e,t){t=t||new y;const n=e.x,s=e.y;return t.x=this.a*n+this.c*s+this.tx,t.y=this.b*n+this.d*s+this.ty,t}applyInverse(e,t){t=t||new y;const n=1/(this.a*this.d+this.c*-this.b),s=e.x,o=e.y;return t.x=this.d*n*s+-this.c*n*o+(this.ty*this.c-this.tx*this.d)*n,t.y=this.a*n*o+-this.b*n*s+(-this.ty*this.a+this.tx*this.b)*n,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),s=this.a,o=this.c,i=this.tx;return this.a=s*t-this.b*n,this.b=s*n+this.b*t,this.c=o*t-this.d*n,this.d=o*n+this.d*t,this.tx=i*t-this.ty*n,this.ty=i*n+this.ty*t,this}append(e){const t=this.a,n=this.b,s=this.c,o=this.d;return this.a=e.a*t+e.b*s,this.b=e.a*n+e.b*o,this.c=e.c*t+e.d*s,this.d=e.c*n+e.d*o,this.tx=e.tx*t+e.ty*s+this.tx,this.ty=e.tx*n+e.ty*o+this.ty,this}setTransform(e,t,n,s,o,i,a,r,c){return this.a=Math.cos(a+c)*o,this.b=Math.sin(a+c)*o,this.c=-Math.sin(a-r)*i,this.d=Math.cos(a-r)*i,this.tx=e-(n*this.a+s*this.c),this.ty=t-(n*this.b+s*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const t=this.a,n=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,n=this.b,s=this.c,o=this.d,i=e.pivot,r=-Math.atan2(-s,o),a=Math.atan2(n,t),c=Math.abs(r+a);return c<1e-5||Math.abs(Fs-c)<1e-5?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=r,e.skew.y=a),e.scale.x=(t*t+n*n)**.5,e.scale.y=(s*s+o*o)**.5,e.position.x=this.tx+(i.x*t+i.y*s),e.position.y=this.ty+(i.x*n+i.y*o),e}invert(){const t=this.a,n=this.b,s=this.c,o=this.d,i=this.tx,e=t*o-n*s;return this.a=o/e,this.b=-n/e,this.c=-s/e,this.d=t/e,this.tx=(s*this.ty-o*i)/e,this.ty=-(t*this.ty-n*i)/e,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new _Ft;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new _Ft}static get TEMP_MATRIX(){return new _Ft}},z.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`},jt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],vt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],gt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],pt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ba=[],jr=[],os=Math.sign;function E5(){for(let e=0;e<16;e++){const t=[];Ba.push(t);for(let n=0;n<16;n++){const s=os(jt[e]*jt[n]+gt[e]*vt[n]),o=os(vt[e]*jt[n]+pt[e]*vt[n]),i=os(jt[e]*gt[n]+gt[e]*pt[n]),a=os(vt[e]*gt[n]+pt[e]*pt[n]);for(let e=0;e<16;e++)if(jt[e]===s&&vt[e]===o&&gt[e]===i&&pt[e]===a){t.push(e);break}}}for(let e=0;e<16;e++){const t=new z;t.set(jt[e],vt[e],gt[e],pt[e],0,0),jr.push(t)}}E5(),k={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>jt[e],uY:e=>vt[e],vX:e=>gt[e],vY:e=>pt[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>Ba[e][t],sub:(e,t)=>Ba[e][k.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>(e<0?-e:e)*2<=(t<0?-t:t)?t>=0?k.S:k.N:(t<0?-t:t)*2<=(e<0?-e:e)?e>0?k.E:k.W:t>0?e>0?k.SE:k.SW:e>0?k.NE:k.NW,matrixAppendRotationInv:(e,t,n=0,s=0)=>{const o=jr[k.inv(t)];o.tx=n,o.ty=s,e.append(o)}},yt=class _wr{constructor(e,t,n=0,s=0){this._x=n,this._y=s,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new _wr(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}},yt.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`},Fa=class{constructor(){this.worldTransform=new z,this.localTransform=new z,this.position=new yt(this.onChange,this,0,0),this.scale=new yt(this.onChange,this,1,1),this.pivot=new yt(this.onChange,this,0,0),this.skew=new yt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const n=e.worldTransform,s=this.worldTransform;s.a=t.a*n.a+t.b*n.c,s.b=t.a*n.b+t.b*n.d,s.c=t.c*n.a+t.d*n.c,s.d=t.c*n.b+t.d*n.d,s.tx=t.tx*n.a+t.ty*n.c+n.tx,s.ty=t.tx*n.b+t.ty*n.d+n.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}},Fa.IDENTITY=new Fa,Ma=Fa,Ma.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`},M3=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,F3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function T3(e,t,n){const s=e.createShader(t);return e.shaderSource(s,n),e.compileShader(s),s}function Vr(e){const t=new Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function D3(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Vr(2*t);case"bvec3":return Vr(3*t);case"bvec4":return Vr(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}nn=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==0[0]),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==0[0],code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==0[0],code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==0[0],code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.red!==0[0],code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(e,t)=>e.type==="vec3"&&e.size===1&&!e.isArray&&t.red!==0[0],code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],L3={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},R3={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function C5(e,t){var s;const n=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const o in e.uniforms){const i=t[o];if(!i){((s=e.uniforms[o])==null?0[0]:s.group)===!0&&(e.uniforms[o].ubo?n.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${o}, '${o}');
                    `):n.push(`
                        renderer.shader.syncUniformGroup(uv.${o}, syncData);
                    `));continue}const a=e.uniforms[o];let r=!1;for(let e=0;e<nn.length;e++)if(nn[e].test(i,a)){n.push(nn[e].code(o,a)),r=!0;break}if(!r){const e=(i.size===1&&!i.isArray?L3:R3)[i.type].replace("location",`ud["${o}"].location`);n.push(`
            cu = ud["${o}"];
            cv = cu.value;
            v = uv["${o}"];
            ${e};`)}}return new Function("ud","uv","renderer","syncData",n.join(`
`))}Qr={},yn=Qr;function x5(){if(yn===Qr||yn!=null&&yn.isContextLost()){const t=i.ADAPTER.createCanvas();let e;i.PREFER_ENV>=_t.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),yn=e}return yn}function O5(){if(!Ca){Ca=ce.MEDIUM;const e=x5();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);t&&(Ca=t.precision?ce.HIGH:ce.MEDIUM)}}return Ca}function W3(e,t){const n=e.getShaderSource(t).split(`
`).map((e,t)=>`${t}: ${e}`),o=e.getShaderInfoLog(t),a=o.split(`
`),i={},r=a.map(e=>parseFloat(e.replace(/^ERROR: 0:([\d]+):.*$/,"$1"))).filter(e=>!!(e&&!i[e])&&(i[e]=!0,!0)),s=[""];r.forEach(e=>{n[e-1]=`%c${n[e-1]}%c`,s.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const c=n.join(`
`);s[0]=c,console.error(o),console.groupCollapsed("click to view full shader code"),console.warn(...s),console.groupEnd()}function w5(e,t,n,s){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(n,e.COMPILE_STATUS)||W3(e,n),e.getShaderParameter(s,e.COMPILE_STATUS)||W3(e,s),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}K3={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function q3(e){return K3[e]}hs=null,dc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function X3(e,t){if(!hs){const t=Object.keys(dc);hs={};for(let n=0;n<t.length;++n){const s=t[n];hs[e[s]]=dc[s]}}return hs[t]}function Q3(e,t,n){if(e.substring(0,9)!=="precision"){let s=t;return t===ce.HIGH&&n!==ce.HIGH&&(s=ce.MEDIUM),`precision ${s} float;
${e}`}return n!==ce.HIGH&&e.substring(0,15)==="precision highp"?e.replace("precision highp","precision mediump"):e}function _5(){if(typeof gs=="boolean")return gs;try{gs=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{gs=!1}return gs}eh=0,vs={},ua=class Fi{constructor(e,t,n="pixi-shader",s={}){this.extra={},this.id=eh++,this.vertexSrc=e||Fi.defaultVertexSrc,this.fragmentSrc=t||Fi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(n=n.replace(/\s+/g,"-"),vs[n]?(vs[n]++,n+=`-${vs[n]}`):vs[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}
${this.fragmentSrc}`,this.vertexSrc=Q3(this.vertexSrc,Fi.defaultVertexPrecision,ce.HIGH),this.fragmentSrc=Q3(this.fragmentSrc,Fi.defaultFragmentPrecision,O5())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return F3}static get defaultFragmentSrc(){return M3}static from(e,t,n){const o=e+t;let s=$c[o];return s||($c[o]=s=new Fi(e,t,n)),s}},ua.defaultVertexPrecision=ce.HIGH,ua.defaultFragmentPrecision=Be.apple.device?ce.HIGH:ce.MEDIUM,$e=ua,ih=0,mt=class _We{constructor(e,t,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=ih++,this.static=!!t,this.ubo=!!n,e instanceof P?(this.buffer=e,this.buffer.type=Ee.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new P(new Float32Array(1)),this.buffer.type=Ee.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,n){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new _We(t,n)}static from(e,t,n){return new _We(e,t,n)}static uboFrom(e,t){return new _We(e,t??!0,!0)}},Qe=class _cr{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof mt?this.uniformGroup=t:this.uniformGroup=new mt(t):this.uniformGroup=new mt({}),this.disposeRunner=new ue("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const s in t.uniforms){const n=t.uniforms[s];if(n.group===!0&&this.checkUniformExists(e,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,n){const s=$e.from(e,t);return new _cr(s,n)}},ch=class{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;this.defaultGroupCache[e]=mt.from({uSamplers:n},!0);let t=this.fragTemplate;t=t.replace(/%count%/gi,`${e}`),t=t.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new $e(this.vertexSrc,t)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new z,default:this.defaultGroupCache[e]};return new Qe(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let n=0;n<e;n++)n>0&&(t+=`
else `),n<e-1&&(t+=`if(vTextureId < ${n}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${n}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}},Yi=class{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}};function h5(){return!Be.apple.device}function u5(e){let t=!0;const n=i.ADAPTER.getNavigator();if(Be.tablet||Be.phone){if(Be.apple.device){const e=n.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(Be.android.device){const e=n.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?e:4}qs=class{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(){}},mh=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,fh=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,jn=class He extends qs{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=qr,this.vertexSize=6,this.state=ut.for2d(),this.size=He.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??u5(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??h5(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return v("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return fh}static get defaultFragmentTemplate(){return mh}setShaderGenerator({vertex:e=He.defaultVertexSrc,fragment:t=He.defaultFragmentTemplate}={}){this.shaderGenerator=new ch(e,t)}contextChange(){const e=this.renderer.gl;i.PREFER_ENV===_t.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),He.defaultMaxTextures),this.maxTextures=Q5(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=He,n=this.size/4,s=Math.floor(n/this.maxTextures)+1;for(;e.length<n;)e.push(new Ea);for(;t.length<s;)t.push(new Yi);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:a,maxTextures:s}=this,r=He._textureArrayPool,o=this.renderer.batch,n=this._tempBoundTextures,l=this.renderer.textureGC.count;let t=++m._globalBatch,c=0,e=r[0],i=0;o.copyBoundTextures(n,s);for(let d=0;d<this._bufferSize;++d){const u=a[d];a[d]=null,u._batchEnabled!==t&&(e.count>=s&&(o.boundArray(e,n,t,s),this.buildDrawCalls(e,i,d),i=d,e=r[++c],++t),u._batchEnabled=t,u.touched=l,e.elements[e.count++]=u)}e.count>0&&(o.boundArray(e,n,t,s),this.buildDrawCalls(e,i,this._bufferSize),++c,++t);for(let e=0;e<n.length;e++)n[e]=null;m._globalBatch=t}buildDrawCalls(e,t,n){const{_bufferedElements:r,_attributeBuffer:l,_indexBuffer:d,vertexSize:u}=this,c=He._drawCallPool;let i=this._dcIndex,a=this._aIndex,o=this._iIndex,s=c[i];s.start=this._iIndex,s.texArray=e;for(let h=t;h<n;++h){const m=r[h],p=m._texture.baseTexture,f=fl[p.alphaMode?1:0][m.blendMode];r[h]=null,t<h&&s.blend!==f&&(s.size=o-s.start,t=h,s=c[++i],s.texArray=e,s.start=o),this.packInterleavedGeometry(m,l,d,a,o),a+=m.vertexData.length/2*u,o+=m.indices.length,s.blend=f}t<n&&(s.size=o-s.start,++i),this._dcIndex=i,this._aIndex=a,this._iIndex=o}bindAndClearTexArray(e){const t=this.renderer.texture;for(let n=0;n<e.count;n++)t.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:n}=this;He.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const n=this._dcIndex,{gl:e,state:s}=this.renderer,o=He._drawCallPool;let t=null;for(let i=0;i<n;i++){const{texArray:a,type:r,size:c,start:l,blend:d}=o[i];t!==a&&(t=a,this.bindAndClearTexArray(a)),this.state.blendMode=d,s.set(this.state),e.drawElements(r,c,e.UNSIGNED_SHORT,l*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),He.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const s=Mi(Math.ceil(e/8)),o=l2(s),t=s*8;this._aBuffers.length<=o&&(this._iBuffers.length=o+1);let n=this._aBuffers[t];return n||(this._aBuffers[t]=n=new oa(t*this.vertexSize*4)),n}getIndexBuffer(e){const s=Mi(Math.ceil(e/12)),t=l2(s),o=s*12;this._iBuffers.length<=t&&(this._iBuffers.length=t+1);let n=this._iBuffers[t];return n||(this._iBuffers[t]=n=new Uint16Array(o)),n}packInterleavedGeometry(e,t,n,s,o){const{uint32View:l,float32View:i}=t,d=s/this.vertexSize,r=e.uvs,c=e.indices,a=e.vertexData,u=e._texture.baseTexture._batchLocation,h=Math.min(e.worldAlpha,1),m=O.shared.setValue(e._tintRGB).toPremultiplied(h,e._texture.baseTexture.alphaMode>0);for(let e=0;e<a.length;e+=2)i[s++]=a[e],i[s++]=a[e+1],i[s++]=r[e],i[s++]=r[e+1],l[s++]=m,i[s++]=u;for(let e=0;e<c.length;e++)n[o++]=d+c[e]}},jn.defaultBatchSize=4096,jn.extension={name:"batch",type:s.RendererPlugin},jn._drawCallPool=[],jn._textureArrayPool=[],xt=jn,a.add(xt),vh=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,bh=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Ai=class An extends Qe{constructor(e,t,n){const s=$e.from(e||An.defaultVertexSrc,t||An.defaultFragmentSrc);super(s,n),this.padding=0,this.resolution=An.defaultResolution,this.multisample=An.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ut}apply(e,t,n,s){e.applyFilter(this,t,n,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return bh}static get defaultFragmentSrc(){return vh}},Ai.defaultResolution=1,Ai.defaultMultisample=D.NONE,J=Ai,ho=class{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new O(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:n,background:s,backgroundAlpha:o}=e,t=s??n;t!==0[0]&&(this.color=t),this.alpha=o}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}},ho.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},ho.extension={type:[s.RendererSystem,s.CanvasRendererSystem],name:"background"},a.add(ho),El=class{constructor(e){this.renderer=e,this.emptyRenderer=new qs(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:n}=this.renderer.texture;for(let s=t-1;s>=0;--s)e[s]=n[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,t,n,s){const{elements:a,ids:i,count:r}=e;let o=0;for(let e=0;e<r;e++){const c=a[e],l=c._batchLocation;if(l>=0&&l<s&&t[l]===c){i[e]=l;continue}for(;o<s;){const a=t[o];if(a&&a._batchEnabled===n&&a._batchLocation===o){o++;continue}i[e]=o,c._batchLocation=o,t[o]=c;break}}}destroy(){this.renderer=null}},El.extension={type:s.RendererSystem,name:"batch"},a.add(El),Fl=0,Oo=class{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Fl++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,n=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:n,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Fl++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==0[0]&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let n;if(i.PREFER_ENV>=_t.WEBGL2&&(n=e.getContext("webgl2",t)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==0[0]&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=n||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}},Oo.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Oo.extension={type:s.RendererSystem,name:"context"},a.add(Oo),Ro=class{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new ue("disposeFramebuffer"),this.multisample=D.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new m(null,{scaleMode:Ve.NEAREST,resolution:1,mipmap:ke.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new m(null,{scaleMode:Ve.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ke.OFF,format:n.DEPTH_COMPONENT,type:c.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const s=this.colorTextures[n],o=s.resolution;s.setSize(e/o,t/o)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(e/n,t/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}},ld=class extends m{constructor(e={}){if(typeof e=="number"){const t=arguments[0],n=arguments[1],s=arguments[2],o=arguments[3];e={width:t,height:n,scaleMode:s,resolution:o}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=D.NONE),super(null,e),this.mipmap=ke.OFF,this.valid=!0,this._clear=new O([0,0,0,0]),this.framebuffer=new Ro(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}},We=class extends Dn{constructor(e){const t=e,n=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,s=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(n,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,n){n===0[0]&&!t.startsWith("data:")?e.crossOrigin=t7(t):n!==!1&&(e.crossOrigin=typeof n=="string"?n:"anonymous")}upload(e,t,n,s){const o=e.gl,i=t.realWidth,a=t.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===se.UNPACK),!this.noSubImage&&t.target===o.TEXTURE_2D&&n.width===i&&n.height===a?o.texSubImage2D(o.TEXTURE_2D,0,0,0,t.format,n.type,s):(n.width=i,n.height=a,o.texImage2D(t.target,0,n.internalFormat,t.format,n.type,s)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(t,n),super.update()}dispose(){this.source=null}},dd=class extends We{constructor(e,t){if(t=t||{},typeof e=="string"){const n=new Image;We.crossOrigin(n,e,t.crossorigin),n.src=e,e=n}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??i.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==0[0]&&(this.createBitmap=e),this._load=new Promise((e,t)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,e(this.createBitmap?this.process():this))};n.complete&&n.src?s():(n.onload=s,n.onerror=e=>{t(e),this.onError.emit(e)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,n=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:n?"cors":"no-cors"}).then(e=>e.blob()).then(n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===se.UNPACK?"premultiply":"none"})).then(e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,n){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,n,this.bitmap),!this.preserveBitmap){let e=!0;const s=t._glTextures;for(const i in s){const o=s[i];if(o!==n&&o.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}},ci=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,n){const s=t.width,o=t.height;if(n){const t=e.width/2/s,i=e.height/2/o,a=e.x/s+t,r=e.y/o+i;n=k.add(n,k.NW),this.x0=a+t*k.uX(n),this.y0=r+i*k.uY(n),n=k.add(n,2),this.x1=a+t*k.uX(n),this.y1=r+i*k.uY(n),n=k.add(n,2),this.x2=a+t*k.uX(n),this.y2=r+i*k.uY(n),n=k.add(n,2),this.x3=a+t*k.uX(n),this.y3=r+i*k.uY(n)}else this.x0=e.x/s,this.y0=e.y/o,this.x1=(e.x+e.width)/s,this.y1=e.y/o,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/o,this.x3=e.x/s,this.y3=(e.y+e.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}},ci.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`},jd=new ci;function si(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}b=class _lt extends ns{constructor(e,t,n,s,o,i,a){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new g(0,0,1,1)),e instanceof _lt&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=jd,this.uvMatrix=null,this.orig=n||t,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=i?new y(i.x,i.y):new y(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e!=null&&e.url&&Me[e.url]&&_lt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,_lt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var t;const e=this._frame.clone(),s=this._frame===this.orig?e:this.orig.clone(),n=new _lt(this.baseTexture,!this.noFrame&&e,s,(t=this.trim)==null?0[0]:t.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=e),n}updateUvs(){this._uvs===jd&&(this._uvs=new ci),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},n=i.STRICT_TEXTURE_CACHE){const a=typeof e=="string";let o=null;if(a)o=e;else if(e instanceof m){if(!e.cacheId){const n=t?.pixiIdPrefix||"pixiid";e.cacheId=`${n}-${ln()}`,m.addToCache(e,e.cacheId)}o=e.cacheId}else{if(!e._pixiId){const n=t?.pixiIdPrefix||"pixiid";e._pixiId=`${n}_${ln()}`}o=e._pixiId}let s=Me[o];if(a&&n&&!s)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!s&&!(e instanceof m)?(t.resolution||(t.resolution=et(e)),s=new _lt(new m(e,t)),s.baseTexture.cacheId=o,m.addToCache(s.baseTexture,o),_lt.addToCache(s,o)):!s&&e instanceof m&&(s=new _lt(e),_lt.addToCache(s,o)),s}static fromURL(e,t){const s=Object.assign({autoLoad:!1},t?.resourceOptions),n=_lt.from(e,Object.assign({resourceOptions:s},t),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then(()=>Promise.resolve(n))}static fromBuffer(e,t,n,s){return new _lt(m.fromBuffer(e,t,n,s))}static fromLoader(e,t,n,s){const i=new m(e,Object.assign({scaleMode:m.defaultOptions.scaleMode,resolution:et(t)},s)),{resource:a}=i;a instanceof dd&&(a.url=t);const o=new _lt(i);return n||(n=t),m.addToCache(o.baseTexture,n),_lt.addToCache(o,n),n!==t&&(m.addToCache(o.baseTexture,t),_lt.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise(e=>{o.baseTexture.once("loaded",()=>e(o))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Me[t]&&Me[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),Me[t]=e)}static removeFromCache(e){if(typeof e=="string"){{const t=Me[e];if(t){const n=t.textureCacheIds.indexOf(e);return n>-1&&t.textureCacheIds.splice(n,1),delete Me[e],t}}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)Me[e.textureCacheIds[t]]===e&&delete Me[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:s,y:o,width:t,height:n}=e,i=s+t>this.baseTexture.width,a=o+n>this.baseTexture.height;if(i||a){const e=i&&a?"and":"or",r=`X: ${s} + ${t} = ${s+t} > ${this.baseTexture.width}`,c=`Y: ${o} + ${n} = ${o+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${r} ${e} ${c}`)}this.valid=t&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return _lt._EMPTY||(_lt._EMPTY=new _lt(new m),si(_lt._EMPTY),si(_lt._EMPTY.baseTexture)),_lt._EMPTY}static get WHITE(){if(!_lt._WHITE){const e=i.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),_lt._WHITE=new _lt(m.from(e)),si(_lt._WHITE),si(_lt._WHITE.baseTexture)}return _lt._WHITE}},Tn=class _vi extends b{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,n=!0){const s=this.baseTexture.resolution,o=Math.round(e*s)/s,i=Math.round(t*s)/s;this.valid=o>0&&i>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=i,n&&this.baseTexture.resize(o,i),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new _vi(new ld(e))}},Id=class{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,n=D.NONE){const s=new ld(Object.assign({width:e,height:t,resolution:1,multisample:n},this.textureOptions));return new Tn(s)}getOptimalTexture(e,t,n=1,s=D.NONE){let o;e=Math.max(Math.ceil(e*n-1e-6),1),t=Math.max(Math.ceil(t*n-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=Mi(e),t=Mi(t),o=((e&65535)<<16|t&65535)>>>0,s>1&&(o+=s*4294967296)):o=s>1?-s:-1,this.texturePool[o]||(this.texturePool[o]=[]);let i=this.texturePool[o].pop();return i||(i=this.createTexture(e,t,s)),i.filterPoolKey=o,i.setResolution(n),i}getFilterTexture(e,t,n){const s=this.getOptimalTexture(e.width,e.height,t||e.resolution,n||D.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}},Id.SCREEN_KEY=-1,Nh=class extends Gn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}},Vd=class extends Gn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new P(this.vertices),this.uvBuffer=new P(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let n=0,s=0;return this.uvs[0]=n,this.uvs[1]=s,this.uvs[2]=n+t.width/e.width,this.uvs[3]=s,this.uvs[4]=n+t.width/e.width,this.uvs[5]=s+t.height/e.height,this.uvs[6]=n,this.uvs[7]=s+t.height/e.height,n=t.x,s=t.y,this.vertices[0]=n,this.vertices[1]=s,this.vertices[2]=n+t.width,this.vertices[3]=s,this.vertices[4]=n+t.width,this.vertices[5]=s+t.height,this.vertices[6]=n,this.vertices[7]=s+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}},Rh=class{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=D.NONE,this.sourceFrame=new g,this.destinationFrame=new g,this.bindingSourceFrame=new g,this.bindingDestinationFrame=new g,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}},zo=[new y,new y,new y,new y],Go=new z,Qd=class{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Id,this.statePool=[],this.quad=new Nh,this.quadUv=new Vd,this.tempRect=new g,this.activeState={},this.globalUniforms=new mt({outputFrame:new g,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const o=this.renderer,f=this.defaultFilterStack,n=this.statePool.pop()||new Rh,s=o.renderTexture;let c,r;if(s.current){const e=s.current;c=e.resolution,r=e.multisample}else c=o.resolution,r=o.multisample;let a=t[0].resolution||c,l=t[0].multisample??r,d=t[0].padding,u=t[0].autoFit,h=t[0].legacy??!0;for(let n=1;n<t.length;n++){const e=t[n];a=Math.min(a,e.resolution||c),l=Math.min(l,e.multisample??r),d=this.useMaxPadding?Math.max(d,e.padding):d+e.padding,u=u&&e.autoFit,h=h||(e.legacy??!0)}f.length===1&&(this.defaultFilterStack[0].renderTexture=s.current),f.push(n),n.resolution=a,n.multisample=l,n.legacy=h,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(d);const m=this.tempRect.copyFrom(s.sourceFrame);o.projection.transform&&this.transformAABB(Go.copyFrom(o.projection.transform).invert(),m),u?(n.sourceFrame.fit(m),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(m)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,s.current?s.current.resolution:o.resolution,s.sourceFrame,s.destinationFrame,o.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const i=this.tempRect;i.x=0,i.y=0,i.width=n.sourceFrame.width,i.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(s.sourceFrame),n.bindingDestinationFrame.copyFrom(s.destinationFrame),n.transform=o.projection.transform,o.projection.transform=null,s.bind(n.renderTexture,n.sourceFrame,i),o.framebuffer.clear(0,0,0,0)}pop(){const a=this.defaultFilterStack,e=a.pop(),o=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const t=s.inputSize,n=s.inputPixel,i=s.inputClamp;if(t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=1/t[0],t[3]=1/t[1],n[0]=Math.round(t[0]*e.resolution),n[1]=Math.round(t[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],i[0]=.5*n[2],i[1]=.5*n[3],i[2]=e.sourceFrame.width*t[2]-.5*n[2],i[3]=e.sourceFrame.height*t[3]-.5*n[3],e.legacy){const t=s.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const r=a[a.length-1];if(this.renderer.framebuffer.blit(),o.length===1)o[0].apply(this,e.renderTexture,r.renderTexture,Se.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let s=0;for(s=0;s<o.length-1;++s){s===1&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),o[s].apply(this,t,n,Se.CLEAR,e);const i=t;t=n,n=i}o[s].apply(this,t,r.renderTexture,Se.BLEND,e),s>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(e,t=Se.CLEAR){const{renderTexture:n,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,n.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=s.stateId&1||this.forceClear;(t===Se.CLEAR||t===Se.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,n,s){const o=this.renderer;o.state.set(e.state),this.bindAndClear(n,s),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(Ce.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(Ce.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:s,destinationFrame:o}=this.activeState,{orig:i}=t._texture,n=e.set(o.width,0,0,o.height,s.x,s.y),a=t.worldTransform.copyTo(z.TEMP_MATRIX);return a.invert(),n.prepend(a),n.scale(1/i.width,1/i.height),n.translate(t.anchor.x,t.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,n=1,s=D.NONE){return this.texturePool.getOptimalTexture(e,t,n,s)}getFilterTexture(e,t,n){if(typeof e=="number"){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,n||D.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const n=zo[0],s=zo[1],o=zo[2],i=zo[3];n.set(t.left,t.top),s.set(t.left,t.bottom),o.set(t.right,t.top),i.set(t.right,t.bottom),e.apply(n,n),e.apply(s,s),e.apply(o,o),e.apply(i,i);const a=Math.min(n.x,s.x,o.x,i.x),r=Math.min(n.y,s.y,o.y,i.y),c=Math.max(n.x,s.x,o.x,i.x),l=Math.max(n.y,s.y,o.y,i.y);t.x=a,t.y=r,t.width=c-a,t.height=l-r}roundFrame(e,t,n,s,o){if(!(e.width<=0||e.height<=0||n.width<=0||n.height<=0)){if(o){const{a:e,b:t,c:n,d:s}=o;if(((t<0?-t:t)>1e-4||(n<0?-n:n)>1e-4)&&((e<0?-e:e)>1e-4||(s<0?-s:s)>1e-4))return}o=o?Go.copyFrom(o):Go.identity(),o.translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.transformAABB(o,e),e.ceil(t),this.transformAABB(o.invert(),e)}}},Qd.extension={type:s.RendererSystem,name:"filter"},a.add(Qd),Bh=class{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=D.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}},Vh=new g,tu=class{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Ro(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new g,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;i.PREFER_ENV===_t.WEBGL_LEGACY&&(t=null,n=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,n=0){const{gl:s}=this;if(e){const o=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==n&&(e.dirtyId++,e.dirtyFormat++,o.mipLevel=n),o.dirtyId!==e.dirtyId&&(o.dirtyId=e.dirtyId,o.dirtyFormat!==e.dirtyFormat?(o.dirtyFormat=e.dirtyFormat,o.dirtySize=e.dirtySize,this.updateFramebuffer(e,n)):o.dirtySize!==e.dirtySize&&(o.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){const n=e.colorTextures[t];this.renderer.texture.unbind(n.parentTextureArray||n)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const e=t.width>>n,o=t.height>>n,s=e/t.width;this.setViewport(t.x*s,t.y*s,e,o)}else{const t=e.width>>n,s=e.height>>n;this.setViewport(0,0,t,s)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,n,s){const o=this.viewport;e=Math.round(e),t=Math.round(t),n=Math.round(n),s=Math.round(s),(o.width!==n||o.height!==s||o.x!==e||o.y!==t)&&(o.x=e,o.y=t,o.width=n,o.height=s,this.gl.viewport(e,t,n,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,n,s,o=Po.COLOR|Po.DEPTH){const{gl:i}=this;i.clearColor(e,t,n,s),i.clear(o)}initFramebuffer(e){const{gl:n}=this,t=new Bh(n.createFramebuffer());return t.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=t,this.managedFramebuffers.push(e),e.disposeRunner.add(this),t}resizeFramebuffer(e){const{gl:t}=this,n=e.glFramebuffers[this.CONTEXT_UID];if(n.stencil){t.bindRenderbuffer(t.RENDERBUFFER,n.stencil);let s;this.renderer.context.webGLVersion===1?s=t.DEPTH_STENCIL:e.depth&&e.stencil?s=t.DEPTH24_STENCIL8:e.depth?s=t.DEPTH_COMPONENT24:s=t.STENCIL_INDEX8,n.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,s,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,s,e.width,e.height)}const o=e.colorTextures;let s=o.length;t.drawBuffers||(s=Math.min(s,1));for(let i=0;i<s;i++){const a=o[i],r=a.parentTextureArray||a;this.renderer.texture.bind(r,0),i===0&&n.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,n.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,n.multisample,r._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:n}=this,s=e.glFramebuffers[this.CONTEXT_UID],a=e.colorTextures;let o=a.length;n.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||n.createRenderbuffer():s.msaaBuffer&&(n.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const i=[];for(let r=0;r<o;r++){const c=a[r],l=c.parentTextureArray||c;this.renderer.texture.bind(l,0),r===0&&s.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,s.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,s.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,s.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+r,c.target,l._glTextures[this.CONTEXT_UID].texture,t),i.push(n.COLOR_ATTACHMENT0+r))}if(i.length>1&&n.drawBuffers(i),e.depthTexture&&this.writeDepthTexture){const s=e.depthTexture;this.renderer.texture.bind(s,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||n.createRenderbuffer();let o,t;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,t=n.DEPTH_STENCIL):e.depth&&e.stencil?(o=n.DEPTH_STENCIL_ATTACHMENT,t=n.DEPTH24_STENCIL8):e.depth?(o=n.DEPTH_ATTACHMENT,t=n.DEPTH_COMPONENT24):(o=n.STENCIL_ATTACHMENT,t=n.STENCIL_INDEX8),n.bindRenderbuffer(n.RENDERBUFFER,s.stencil),s.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,s.multisample,t,e.width,e.height):n.renderbufferStorage(n.RENDERBUFFER,t,e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,s.stencil)}else s.stencil&&(n.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:n}=this;let t=D.NONE;if(e<=1||n===null)return t;for(let s=0;s<n.length;s++)if(n[s]<=e){t=n[s];break}return t===1&&(t=D.NONE),t}blit(e,t,n){const{current:s,renderer:a,gl:o,CONTEXT_UID:r}=this;if(a.context.webGLVersion!==2||!s)return;const i=s.glFramebuffers[r];if(!i)return;if(!e){if(!i.msaaBuffer)return;const t=s.colorTextures[0];if(!t)return;i.blitFramebuffer||(i.blitFramebuffer=new Ro(s.width,s.height),i.blitFramebuffer.addColorTexture(0,t)),e=i.blitFramebuffer,e.colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=Vh,t.width=s.width,t.height=s.height),n||(n=t);const c=t.width===n.width&&t.height===n.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,i.framebuffer),o.blitFramebuffer(t.left,t.top,t.right,t.bottom,n.left,n.top,n.right,n.bottom,o.COLOR_BUFFER_BIT,c?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const n=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!n)return;delete e.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(e);o>=0&&this.managedFramebuffers.splice(o,1),e.disposeRunner.remove(this),t||(s.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&s.deleteRenderbuffer(n.msaaBuffer),n.stencil&&s.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&this.disposeFramebuffer(n.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<t.length;n++)this.disposeFramebuffer(t[n],e)}forceStencil(){const t=this.current;if(!t)return;const n=t.glFramebuffers[this.CONTEXT_UID];if(!n||n.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,a=t.height,e=this.gl,r=n.stencil=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r);let o,s;this.renderer.context.webGLVersion===1?(o=e.DEPTH_STENCIL_ATTACHMENT,s=e.DEPTH_STENCIL):t.depth?(o=e.DEPTH_STENCIL_ATTACHMENT,s=e.DEPTH24_STENCIL8):(o=e.STENCIL_ATTACHMENT,s=e.STENCIL_INDEX8),n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,s,i,a):e.renderbufferStorage(e.RENDERBUFFER,s,i,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,o,e.RENDERBUFFER,r)}reset(){this.current=this.unknownFramebuffer,this.viewport=new g}destroy(){this.renderer=null}},tu.extension={type:s.RendererSystem,name:"framebuffer"},a.add(tu),Ko={5126:4,5123:2,5121:1},gu=class{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let t=this.renderer.context.extensions.vertexArrayObject;i.PREFER_ENV===_t.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,n)=>t.vertexAttribDivisorANGLE(e,n),e.drawElementsInstanced=(e,n,s,o,i)=>t.drawElementsInstancedANGLE(e,n,s,o,i),e.drawArraysInstanced=(e,n,s,o)=>t.drawArraysInstancedANGLE(e,n,s,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let n=e.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);const s=n[t.program.id]||this.initGeometryVao(e,t,o);this._activeGeometry=e,this._activeVao!==s&&(this._activeVao=s,this.hasVao?i.bindVertexArray(s):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let n=0;n<e.buffers.length;n++){const s=e.buffers[n];t.update(s)}}checkCompatibility(e,t){const n=e.attributes,s=t.attributeData;for(const e in s)if(!n[e])throw new Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,t){const o=e.attributes,n=t.attributeData,s=["g",e.id];for(const e in o)n[e]&&s.push(e,n[e].location);return s.join("-")}initGeometryVao(e,t,n=!0){const c=this.gl,u=this.CONTEXT_UID,h=this.renderer.buffer,o=t.program;o.glPrograms[u]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const m=this.getSignature(e,o),a=e.glVertexArrayObjects[this.CONTEXT_UID];let i=a[m];if(i)return a[o.id]=i,i;const l=e.buffers,s=e.attributes,r={},d={};for(const e in l)r[e]=0,d[e]=0;for(const e in s)!s[e].size&&o.attributeData[e]?s[e].size=o.attributeData[e].size:s[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),r[s[e].buffer]+=s[e].size*Ko[s[e].type];for(const n in s){const e=s[n],t=e.size;e.stride===0[0]&&(r[e.buffer]===t*Ko[e.type]?e.stride=0:e.stride=r[e.buffer]),e.start===0[0]&&(e.start=d[e.buffer],d[e.buffer]+=t*Ko[e.type])}i=c.createVertexArray(),c.bindVertexArray(i);for(let e=0;e<l.length;e++){const t=l[e];h.bind(t),n&&t._glBuffers[u].refCount++}return this.activateVao(e,o),a[o.id]=i,a[m]=i,c.bindVertexArray(null),h.unbind(Ee.ARRAY_BUFFER),i}disposeGeometry(e,t){var o;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const n=e.glVertexArrayObjects[this.CONTEXT_UID],a=this.gl,s=e.buffers,i=(o=this.renderer)==null?0[0]:o.buffer;if(e.disposeRunner.remove(this),!!n){if(i)for(let e=0;e<s.length;e++){const n=s[e]._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,n.refCount===0&&!t&&i.dispose(s[e],t))}if(!t)for(const e in n)if(e[0]==="g"){const t=n[e];this._activeVao===t&&this.unbind(),a.deleteVertexArray(t)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let n=0;n<t.length;n++)this.disposeGeometry(this.managedGeometries[t[n]],e)}activateVao(e,t){const n=this.gl,a=this.CONTEXT_UID,s=this.renderer.buffer,r=e.buffers,o=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let i=null;for(const c in o){const e=o[c],l=r[e.buffer],d=l._glBuffers[a];if(t.attributeData[c]){i!==d&&(s.bind(l),i=d);const o=t.attributeData[c].location;if(n.enableVertexAttribArray(o),n.vertexAttribPointer(o,e.size,e.type||n.FLOAT,e.normalized,e.stride,e.start),e.instance)if(this.hasInstance)n.vertexAttribDivisor(o,e.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,n,s){const{gl:i}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,r=a===2?i.UNSIGNED_SHORT:i.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?i.drawElementsInstanced(e,t||o.indexBuffer.data.length,r,(n||0)*a,s||1):i.drawElements(e,t||o.indexBuffer.data.length,r,(n||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?i.drawArraysInstanced(e,n,t||o.getSize(),s||1):i.drawArrays(e,n,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}},gu.extension={type:s.RendererSystem,name:"geometry"},a.add(gu),ju=new z,sc=class{constructor(e,t){this._texture=e,this.mapCoord=new z,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===0[0]&&(t=e);const n=this.mapCoord;for(let s=0;s<e.length;s+=2){const o=e[s],i=e[s+1];t[s]=o*n.a+i*n.c+n.tx,t[s+1]=o*n.b+i*n.d+n.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const n=t._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const c=t.orig,o=t.trim;o&&(ju.set(c.width/o.width,0,0,c.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(ju));const s=t.baseTexture,a=this.uClampFrame,r=this.clampMargin/s.resolution,i=this.clampOffset;return a[0]=(t._frame.x+r+i)/s.width,a[1]=(t._frame.y+r+i)/s.height,a[2]=(t._frame.x+t._frame.width-r+i)/s.width,a[3]=(t._frame.y+t._frame.height-r+i)/s.height,this.uClampOffset[0]=i/s.realWidth,this.uClampOffset[1]=i/s.realHeight,this.isSimple=t._frame.width===s.width&&t._frame.height===s.height&&t.rotate===0,!0}},Yh=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Gh=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,Xh=class extends J{constructor(e,t,n){let s=null;typeof e!="string"&&t===0[0]&&n===0[0]&&(s=e,e=0[0],t=0[0],n=0[0]),super(e||Gh,t||Yh,n),this.maskSprite=s,this.maskMatrix=new z}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,n,s){const i=this._maskSprite,o=i._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new sc(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,i).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,n,s))}},Qh=class{constructor(e=null){this.type=R.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=J.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=R.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}},ru=class{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let n=t;if(!n.isMaskData){const e=this.maskDataPool.pop()||new Qh;e.pooled=!0,e.maskObject=t,n=e}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(s),n._colorMask=s?s._colorMask:15,n.autoDetect&&this.detect(n),n._target=e,n.type!==R.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case R.SCISSOR:this.renderer.scissor.push(n);break;case R.STENCIL:this.renderer.stencil.push(n);break;case R.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case R.COLOR:this.pushColorMask(n);break}n.type===R.SPRITE&&this.maskStack.push(n)}pop(e){const t=this.maskStack.pop();if(!!t&&t._target===e){if(t.enabled)switch(t.type){case R.SCISSOR:this.renderer.scissor.pop(t);break;case R.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case R.SPRITE:this.popSpriteMask(t);break;case R.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const e=this.maskStack[this.maskStack.length-1];e.type===R.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=R.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=R.SCISSOR:e.type=R.STENCIL:e.type=R.COLOR}pushSpriteMask(e){const{maskObject:s}=e,n=e._target;let t=e._filters;t||(t=this.alphaMaskPool[this.alphaMaskIndex],t||(t=this.alphaMaskPool[this.alphaMaskIndex]=[new Xh])),t[0].resolution=e.resolution,t[0].multisample=e.multisample,t[0].maskSprite=s;const o=n.filterArea;n.filterArea=s.getBounds(!0),this.renderer.filter.push(n,t),n.filterArea=o,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const n=e._colorMask,t=e._colorMask=n&e.colorMask;t!==n&&this.renderer.gl.colorMask((t&1)!==0,(t&2)!==0,(t&4)!==0,(t&8)!==0)}popColorMask(e){const n=e._colorMask,t=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;t!==n&&this.renderer.gl.colorMask((t&1)!==0,(t&2)!==0,(t&4)!==0,(t&8)!==0)}destroy(){this.renderer=null}},ru.extension={type:s.RendererSystem,name:"mask"},a.add(ru),Gd=class{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,s=this.getStackLength();this.maskStack=e;const n=this.getStackLength();n!==s&&(n===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}},Nd=new z,Md=[],kd=class $s extends Gd{constructor(e){super(e),this.glConst=i.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const o=e._scissorRect,{maskObject:i}=e,{renderer:n}=this,t=n.renderTexture,s=i.getBounds(!0,Md.pop()??new g);this.roundFrameToPixels(s,t.current?t.current.resolution:n.resolution,t.sourceFrame,t.destinationFrame,n.projection.transform),o&&s.fit(o),e._scissorRectLocal=s}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:n,c:s,d:o}=e;return((n<0?-n:n)>1e-4||(s<0?-s:s)>1e-4)&&((t<0?-t:t)>1e-4||(o<0?-o:o)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||$s.isMatrixRotated(t.worldTransform)||$s.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const n=e._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(e,t,n,s,o){$s.isMatrixRotated(o)||(o=o?Nd.copyFrom(o):Nd.identity(),o.translate(-n.x,-n.y).scale(s.width/n.width,s.height/n.height).translate(s.x,s.y),this.renderer.filter.transformAABB(o,e),e.fit(s),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Md.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}},kd.extension={type:s.RendererSystem,name:"scissor"},sm=kd,a.add(sm),Cd=class extends Gd{constructor(e){super(e),this.glConst=i.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const s=e.maskObject,{gl:t}=this.renderer,o=e._stencilCounter;o===0&&(this.renderer.framebuffer.forceStencil(),t.clearStencil(0),t.clear(t.STENCIL_BUFFER_BIT),t.enable(t.STENCIL_TEST)),e._stencilCounter++;const n=e._colorMask;n!==0&&(e._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilFunc(t.EQUAL,o,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.INCR),s.renderable=!0,s.render(this.renderer),this.renderer.batch.flush(),s.renderable=!1,n!==0&&(e._colorMask=n,t.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=s?s._colorMask:15;n!==0&&(s._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(s._colorMask=n,t.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}},Cd.extension={type:s.RendererSystem,name:"stencil"},a.add(Cd),rd=class{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return v("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return v("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return v("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}},rd.extension={type:[s.RendererSystem,s.CanvasRendererSystem],name:"_plugin"},a.add(rd),id=class{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new z,this.transform=null}update(e,t,n,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,s),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(e,t,n,s){const o=this.projectionMatrix,i=s?-1:1;o.identity(),o.a=1/t.width*2,o.d=i*(1/t.height*2),o.tx=-1-t.x*o.a,o.ty=-i-t.y*o.d}setTransform(){}destroy(){this.renderer=null}},id.extension={type:s.RendererSystem,name:"projection"},a.add(id),rm=new Ma,od=new g,sd=class{constructor(e){this.renderer=e,this._tempMatrix=new z}generateTexture(e,t){const{region:i,...s}=t||{},n=i?.copyTo(od)||e.getLocalBounds(od,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,s.multisample??(s.multisample=this.renderer.multisample);const a=Tn.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const r=e.transform;return e.transform=rm,this.renderer.render(e,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=r,a}destroy(){}},sd.extension={type:[s.RendererSystem,s.CanvasRendererSystem],name:"textureGenerator"},a.add(sd),Ft=new g,Xn=new g,Jl=class{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new g,this.destinationFrame=new g,this.viewportFrame=new g}contextChange(){var t;const e=(t=this.renderer)==null?0[0]:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,n){const i=this.renderer;this.current=e;let a,r,o;e?(a=e.baseTexture,o=a.resolution,t||(Ft.width=e.frame.width,Ft.height=e.frame.height,t=Ft),n||(Xn.x=e.frame.x,Xn.y=e.frame.y,Xn.width=t.width,Xn.height=t.height,n=Xn),r=a.framebuffer):(o=i.resolution,t||(Ft.width=i._view.screen.width,Ft.height=i._view.screen.height,t=Ft),n||(n=Ft,n.width=t.width,n.height=t.height));const s=this.viewportFrame;s.x=n.x*o,s.y=n.y*o,s.width=n.width*o,s.height=n.height*o,e||(s.y=i.view.height-(s.y+s.height)),s.ceil(),this.renderer.framebuffer.bind(r,s),this.renderer.projection.update(n,t,o,!r),e?this.renderer.mask.setMaskStack(a.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(n)}clear(e,t){const a=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=O.shared.setValue(e||a);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,i=s.width!==o.width||s.height!==o.height;if(i){let{x:e,y:t,width:n,height:s}=this.viewportFrame;e=Math.round(e),t=Math.round(t),n=Math.round(n),s=Math.round(s),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,n,s)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,t),i&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}},Jl.extension={type:s.RendererSystem,name:"renderTexture"},a.add(Jl),mm=class{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}};function Eg(e,t){const n={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<s;i++){const o=t.getActiveAttrib(e,i);if(o.name.startsWith("gl_"))continue;const a=X3(t,o.type),r={type:a,name:o.name,size:q3(a),location:t.getAttribLocation(e,o.name)};n[o.name]=r}return n}function Cg(e,t){const n={},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<s;i++){const o=t.getActiveUniform(e,i),a=o.name.replace(/\[.*?\]$/,""),c=!!o.name.match(/\[.*?\]$/),r=X3(t,o.type);n[a]={name:a,index:i,type:r,size:o.size,isArray:c,value:D3(r,o.size)}}return n}function xg(e,t){var a;const s=T3(e,e.VERTEX_SHADER,t.vertexSrc),o=T3(e,e.FRAGMENT_SHADER,t.fragmentSrc),n=e.createProgram();e.attachShader(n,s),e.attachShader(n,o);const i=(a=t.extra)==null?0[0]:a.transformFeedbackVaryings;if(i&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(n,i.names,i.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||w5(e,n,s,o),t.attributeData=Eg(n,e),t.uniformData=Cg(n,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const s=Object.keys(t.attributeData);s.sort((e,t)=>e>t?1:-1);for(let o=0;o<s.length;o++)t.attributeData[s[o]].location=o,e.bindAttribLocation(n,o,s[o]);e.linkProgram(n)}e.deleteShader(s),e.deleteShader(o);const r={};for(const s in t.uniformData){const o=t.uniformData[s];r[s]={location:e.getUniformLocation(n,s),value:D3(o.type,o.size)}}return new mm(n,r)}function Og(e,t,n,s,o){n.buffer.update(o)}bm={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Al={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function wg(e){const o=e.map(e=>({data:e,offset:0,dataLen:0,dirty:0}));let t=0,s=0,n=0;for(let i=0;i<o.length;i++){const e=o[i];if(t=Al[e.data.type],e.data.size>1&&(t=Math.max(t,16)*e.data.size),e.dataLen=t,s%t!==0&&s<16){const e=s%t%16;s+=e,n+=e}s+t>16?(n=Math.ceil(n/16)*16,e.offset=n,n+=t,s=t):(e.offset=n,s+=t,n+=t)}return n=Math.ceil(n/16)*16,{uboElements:o,size:n}}function jg(e,t){const n=[];for(const s in e)t[s]&&n.push(t[s]);return n.sort((e,t)=>e.index-t.index),n}function bg(e,t){if(!e.autoManage)return{size:0,syncFunc:Og};const o=jg(e.uniforms,t),{uboElements:s,size:i}=wg(o),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let i=0;i<s.length;i++){const t=s[i],a=e.uniforms[t.data.name],o=t.data.name;let r=!1;for(let e=0;e<nn.length;e++){const s=nn[e];if(s.codeUbo&&s.test(t.data,a)){n.push(`offset = ${t.offset/4};`,nn[e].codeUbo(t.data.name,a)),r=!0;break}}if(!r)if(t.data.size>1){const i=q3(t.data.type),e=Math.max(Al[t.data.type]/16,1),s=i/e,a=(4-s%4)%4;n.push(`
                cv = ud.${o}.value;
                v = uv.${o};
                offset = ${t.offset/4};

                t = 0;

                for(var i=0; i < ${t.data.size*e}; i++)
                {
                    for(var j = 0; j < ${s}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${a};
                }

                `)}else{const e=bm[t.data.type];n.push(`
                cv = ud.${o}.value;
                v = uv.${o};
                offset = ${t.offset/4};
                ${e};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}xm=0,po={textureCount:0,uboCount:0},Cl=class{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=xm++}systemCheck(){if(!_5())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const n=e.program,s=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==n&&(this.program=n,this.gl.useProgram(s.program)),t||(po.textureCount=0,po.uboCount=0,this.syncUniformGroup(e.uniformGroup,po)),s}setUniforms(e){const t=this.shader.program,n=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(n.uniformData,e,this.renderer)}syncUniformGroup(e,t){const n=this.getGlProgram();(!e.static||e.dirtyId!==n.uniformDirtyGroups[e.id])&&(n.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,n,t))}syncUniforms(e,t,n){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,n)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=C5(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const n=this.getGlProgram();if(!e.static||e.dirtyId!==0||!n.uniformGroups[e.id]){e.dirtyId=0;const s=n.uniformGroups[e.id]||this.createSyncBufferGroup(e,n,t);e.buffer.update(),s(n.uniformData,e.uniforms,this.renderer,po,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,n.uniformBufferBindings[t])}createSyncBufferGroup(e,t,n){const{gl:i}=this.renderer;this.renderer.buffer.bind(e.buffer);const a=this.gl.getUniformBlockIndex(t.program,n);t.uniformBufferBindings[n]=this.shader.uniformBindCount,i.uniformBlockBinding(t.program,a,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let s=this._uboCache[o];if(s||(s=this._uboCache[o]=bg(e,this.shader.program.uniformData)),e.autoManage){const t=new Float32Array(s.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=s.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,n){const o=e.uniforms,s=[`${n}-`];for(const e in o)s.push(e),t[e]&&s.push(t[e].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const s=this.gl,t=e.program,n=xg(s,t);return t.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}},Cl.extension={type:s.RendererSystem,name:"shader"},a.add(Cl),mo=class{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}},mo.defaultOptions={hello:!1},mo.extension={type:[s.RendererSystem,s.CanvasRendererSystem],name:"startup"},a.add(mo);function fg(e,t=[]){return t[d.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.ADD]=[e.ONE,e.ONE],t[d.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.NONE]=[0,0],t[d.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[d.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[d.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[d.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[d.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[d.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[d.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[d.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[d.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[d.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[d.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}Sm=0,Fm=1,Tm=2,zm=3,Dm=4,Nm=5,Ol=class $l{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=d.NONE,this._blendEq=!1,this.map=[],this.map[Sm]=this.setBlend,this.map[Fm]=this.setOffset,this.map[Tm]=this.setCullFace,this.map[zm]=this.setDepthTest,this.map[Dm]=this.setFrontFace,this.map[Nm]=this.setDepthMask,this.checks=[],this.defaultState=new ut,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=fg(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,n=0;for(;t;)t&1&&this.map[n].call(this,!!(e.data&1<<n)),t=t>>1,n++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck($l.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck($l.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],n=this.gl;t.length===2?n.blendFunc(t[0],t[1]):n.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,n.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const n=this.checks.indexOf(e);t&&n===-1?this.checks.push(e):!t&&n!==-1&&this.checks.splice(n,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}},Ol.extension={type:s.RendererSystem,name:"state"},Rm=Ol,a.add(Rm),Pm=class extends ns{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(t=>e.systems[t]),n=[...t,...Object.keys(e.systems).filter(e=>!t.includes(e))];for(const t of n)this.addSystem(e.systems[t],t)}addRunners(...e){e.forEach(e=>{this.runners[e]=new ue(e)})}addSystem(e,t){const n=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=n,this._systemsHash[t]=n;for(const e in this.runners)this.runners[e].add(n);return this}emitWithCustomOptions(e,t){const n=Object.keys(this._systemsHash);e.items.forEach(s=>{const o=n.find(e=>this._systemsHash[e]===s);s[e.name](t[o])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}},Hn=class Hs{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=Hs.defaultMaxIdle,this.checkCountMax=Hs.defaultCheckCountMax,this.mode=Hs.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==$a.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let n=!1;for(let s=0;s<e.length;s++){const o=e[s];o.resource&&this.count-o.touched>this.maxIdle&&(t.destroyTexture(o,!0),e[s]=null,n=!0)}if(n){let t=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[t++]=e[n]);e.length=t}}unload(e){const n=this.renderer.texture,t=e._texture;t&&!t.framebuffer&&n.destroyTexture(t);for(let t=e.children.length-1;t>=0;t--)this.unload(e.children[t])}destroy(){this.renderer=null}},Hn.defaultMode=$a.AUTO,Hn.defaultMaxIdle=60*60,Hn.defaultCheckCountMax=60*10,Hn.extension={type:s.RendererSystem,name:"textureGC"},bt=Hn,a.add(bt),Si=class{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=c.UNSIGNED_BYTE,this.internalFormat=n.RGBA,this.samplerType=0}};function hg(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[e.RGB]:o.FLOAT,[e.RGBA]:o.FLOAT,[e.ALPHA]:o.FLOAT,[e.LUMINANCE]:o.FLOAT,[e.LUMINANCE_ALPHA]:o.FLOAT,[e.R8]:o.FLOAT,[e.R8_SNORM]:o.FLOAT,[e.RG8]:o.FLOAT,[e.RG8_SNORM]:o.FLOAT,[e.RGB8]:o.FLOAT,[e.RGB8_SNORM]:o.FLOAT,[e.RGB565]:o.FLOAT,[e.RGBA4]:o.FLOAT,[e.RGB5_A1]:o.FLOAT,[e.RGBA8]:o.FLOAT,[e.RGBA8_SNORM]:o.FLOAT,[e.RGB10_A2]:o.FLOAT,[e.RGB10_A2UI]:o.FLOAT,[e.SRGB8]:o.FLOAT,[e.SRGB8_ALPHA8]:o.FLOAT,[e.R16F]:o.FLOAT,[e.RG16F]:o.FLOAT,[e.RGB16F]:o.FLOAT,[e.RGBA16F]:o.FLOAT,[e.R32F]:o.FLOAT,[e.RG32F]:o.FLOAT,[e.RGB32F]:o.FLOAT,[e.RGBA32F]:o.FLOAT,[e.R11F_G11F_B10F]:o.FLOAT,[e.RGB9_E5]:o.FLOAT,[e.R8I]:o.INT,[e.R8UI]:o.UINT,[e.R16I]:o.INT,[e.R16UI]:o.UINT,[e.R32I]:o.INT,[e.R32UI]:o.UINT,[e.RG8I]:o.INT,[e.RG8UI]:o.UINT,[e.RG16I]:o.INT,[e.RG16UI]:o.UINT,[e.RG32I]:o.INT,[e.RG32UI]:o.UINT,[e.RGB8I]:o.INT,[e.RGB8UI]:o.UINT,[e.RGB16I]:o.INT,[e.RGB16UI]:o.UINT,[e.RGB32I]:o.INT,[e.RGB32UI]:o.UINT,[e.RGBA8I]:o.INT,[e.RGBA8UI]:o.UINT,[e.RGBA16I]:o.INT,[e.RGBA16UI]:o.UINT,[e.RGBA32I]:o.INT,[e.RGBA32UI]:o.UINT,[e.DEPTH_COMPONENT16]:o.FLOAT,[e.DEPTH_COMPONENT24]:o.FLOAT,[e.DEPTH_COMPONENT32F]:o.FLOAT,[e.DEPTH_STENCIL]:o.FLOAT,[e.DEPTH24_STENCIL8]:o.FLOAT,[e.DEPTH32F_STENCIL8]:o.FLOAT}:t={[e.RGB]:o.FLOAT,[e.RGBA]:o.FLOAT,[e.ALPHA]:o.FLOAT,[e.LUMINANCE]:o.FLOAT,[e.LUMINANCE_ALPHA]:o.FLOAT,[e.DEPTH_STENCIL]:o.FLOAT},t}function ug(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[c.UNSIGNED_BYTE]:{[n.RGBA]:e.RGBA8,[n.RGB]:e.RGB8,[n.RG]:e.RG8,[n.RED]:e.R8,[n.RGBA_INTEGER]:e.RGBA8UI,[n.RGB_INTEGER]:e.RGB8UI,[n.RG_INTEGER]:e.RG8UI,[n.RED_INTEGER]:e.R8UI,[n.ALPHA]:e.ALPHA,[n.LUMINANCE]:e.LUMINANCE,[n.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[c.BYTE]:{[n.RGBA]:e.RGBA8_SNORM,[n.RGB]:e.RGB8_SNORM,[n.RG]:e.RG8_SNORM,[n.RED]:e.R8_SNORM,[n.RGBA_INTEGER]:e.RGBA8I,[n.RGB_INTEGER]:e.RGB8I,[n.RG_INTEGER]:e.RG8I,[n.RED_INTEGER]:e.R8I},[c.UNSIGNED_SHORT]:{[n.RGBA_INTEGER]:e.RGBA16UI,[n.RGB_INTEGER]:e.RGB16UI,[n.RG_INTEGER]:e.RG16UI,[n.RED_INTEGER]:e.R16UI,[n.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[c.SHORT]:{[n.RGBA_INTEGER]:e.RGBA16I,[n.RGB_INTEGER]:e.RGB16I,[n.RG_INTEGER]:e.RG16I,[n.RED_INTEGER]:e.R16I},[c.UNSIGNED_INT]:{[n.RGBA_INTEGER]:e.RGBA32UI,[n.RGB_INTEGER]:e.RGB32UI,[n.RG_INTEGER]:e.RG32UI,[n.RED_INTEGER]:e.R32UI,[n.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[c.INT]:{[n.RGBA_INTEGER]:e.RGBA32I,[n.RGB_INTEGER]:e.RGB32I,[n.RG_INTEGER]:e.RG32I,[n.RED_INTEGER]:e.R32I},[c.FLOAT]:{[n.RGBA]:e.RGBA32F,[n.RGB]:e.RGB32F,[n.RG]:e.RG32F,[n.RED]:e.R32F,[n.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[c.HALF_FLOAT]:{[n.RGBA]:e.RGBA16F,[n.RGB]:e.RGB16F,[n.RG]:e.RG16F,[n.RED]:e.R16F},[c.UNSIGNED_SHORT_5_6_5]:{[n.RGB]:e.RGB565},[c.UNSIGNED_SHORT_4_4_4_4]:{[n.RGBA]:e.RGBA4},[c.UNSIGNED_SHORT_5_5_5_1]:{[n.RGBA]:e.RGB5_A1},[c.UNSIGNED_INT_2_10_10_10_REV]:{[n.RGBA]:e.RGB10_A2,[n.RGBA_INTEGER]:e.RGB10_A2UI},[c.UNSIGNED_INT_10F_11F_11F_REV]:{[n.RGB]:e.R11F_G11F_B10F},[c.UNSIGNED_INT_5_9_9_9_REV]:{[n.RGB]:e.RGB9_E5},[c.UNSIGNED_INT_24_8]:{[n.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[c.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[n.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[c.UNSIGNED_BYTE]:{[n.RGBA]:e.RGBA,[n.RGB]:e.RGB,[n.ALPHA]:e.ALPHA,[n.LUMINANCE]:e.LUMINANCE,[n.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[c.UNSIGNED_SHORT_5_6_5]:{[n.RGB]:e.RGB},[c.UNSIGNED_SHORT_4_4_4_4]:{[n.RGBA]:e.RGBA},[c.UNSIGNED_SHORT_5_5_5_1]:{[n.RGBA]:e.RGBA}},t}ll=class{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new m,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=ug(e),this.samplerTypes=hg(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let e=0;e<t;e++)this.boundTextures[e]=null;this.emptyTextures={};const n=new Si(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Si(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,t=0){const{gl:n}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,n.activeTexture(n.TEXTURE0+t)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:n,boundTextures:t}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<t.length;e++)t[e]===this.unknownTexture&&this.bind(null,e)}for(let s=0;s<t.length;s++)t[s]===e&&(this.currentLocation!==s&&(n.activeTexture(n.TEXTURE0+s),this.currentLocation=s),n.bindTexture(e.target,this.emptyTextures[e.target].texture),t[s]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:n,CONTEXT_UID:s}=this;if(n)for(let n=e-1;n>=0;--n){const i=t[n];i&&i._glTextures[s].samplerType!==o.FLOAT&&this.renderer.texture.unbind(i)}}initTexture(e){const t=new Si(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var n;t.internalFormat=((n=this.internalFormats[e.type])==null?0[0]:n[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??o.FLOAT,this.webGLVersion===2&&e.type===c.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var n;const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const s=this.renderer;if(this.initTextureType(e,t),(n=e.resource)==null?0[0]:n.upload(s,e,t))t.samplerType!==o.FLOAT&&(this.hasIntegerTextures=!0);else{const n=e.realWidth,o=e.realHeight,i=s.gl;(t.width!==n||t.height!==o||t.dirtyId<0)&&(t.width=n,t.height=o,i.texImage2D(e.target,0,t.internalFormat,n,o,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:n}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),n.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const t=this.managedTextures.indexOf(e);t!==-1&&Zn(this.managedTextures,t,1)}}updateTextureStyle(e){var n;const t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===ke.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=Ye.CLAMP:t.wrapMode=e.wrapMode,(n=e.resource)!=null&&n.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const n=this.gl;if(t.mipmap&&e.mipmap!==ke.ON_MANUAL&&n.generateMipmap(e.target),n.texParameteri(e.target,n.TEXTURE_WRAP_S,t.wrapMode),n.texParameteri(e.target,n.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){{n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===Ve.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===Ve.LINEAR){const s=Math.min(e.anisotropicLevel,n.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,s)}}}else n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===Ve.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(e.target,n.TEXTURE_MAG_FILTER,e.scaleMode===Ve.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}},ll.extension={type:s.RendererSystem,name:"texture"},a.add(ll),qa=class{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,s=e._glTransformFeedbacks[n]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:n,renderer:s}=this;t&&s.shader.bind(t),n.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:o,CONTEXT_UID:n}=this,s=t.createTransformFeedback();e._glTransformFeedbacks[n]=s,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s);for(let s=0;s<e.buffers.length;s++){const i=e.buffers[s];i&&(o.buffer.update(i),i._glBuffers[n].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,s,i._glBuffers[n].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),s}disposeTransformFeedback(e,t){const n=e._glTransformFeedbacks[this.CONTEXT_UID],o=this.gl;e.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let n=0;n<e.buffers.length;n++){const o=e.buffers[n];if(!o)continue;const i=o._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,i.refCount===0&&!t&&s.dispose(o,t))}n&&(t||o.deleteTransformFeedback(n),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}},qa.extension={type:s.RendererSystem,name:"transformFeedback"},a.add(qa),no=class{constructor(e){this.renderer=e}init(e){this.screen=new g(0,0,e.width,e.height),this.element=e.view||i.ADAPTER.createCanvas(),this.resolution=e.resolution||i.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const n=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=n,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",n,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}},no.defaultOptions={width:800,height:600,resolution:0[0],autoDensity:!1},no.extension={type:[s.RendererSystem,s.CanvasRendererSystem],name:"_view"},a.add(no),i.PREFER_ENV=_t.WEBGL2,i.STRICT_TEXTURE_CACHE=!1,i.RENDER_OPTIONS={...Oo.defaultOptions,...ho.defaultOptions,...no.defaultOptions,...mo.defaultOptions},Object.defineProperties(i,{WRAP_MODE:{get(){return m.defaultOptions.wrapMode},set(e){v("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),m.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return m.defaultOptions.scaleMode},set(e){v("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),m.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return m.defaultOptions.mipmap},set(e){v("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),m.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return m.defaultOptions.anisotropicLevel},set(e){v("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),m.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return v("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),J.defaultResolution},set(e){J.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return v("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),J.defaultMultisample},set(e){J.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return xt.defaultMaxTextures},set(e){v("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),xt.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return xt.defaultBatchSize},set(e){v("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),xt.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return xt.canUploadSameBuffer},set(e){v("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),xt.canUploadSameBuffer=e}},GC_MODE:{get(){return bt.defaultMode},set(e){v("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),bt.defaultMode=e}},GC_MAX_IDLE:{get(){return bt.defaultMaxIdle},set(e){v("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),bt.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return bt.defaultCheckCountMax},set(e){v("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),bt.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return $e.defaultVertexPrecision},set(e){v("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),$e.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return $e.defaultFragmentPrecision},set(e){v("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),$e.defaultFragmentPrecision=e}}}),At=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(At||{}),Di=class{constructor(e,t=null,n=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=n,this.once=s}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}},nl=class Pe{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Di(null,null,1/0),this.deltaMS=1/Pe.targetFPMS,this.elapsedMS=1/Pe.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,n=At.NORMAL){return this._addListener(new Di(e,t,n))}addOnce(e,t,n=At.NORMAL){return this._addListener(new Di(e,t,n,!0))}_addListener(e){let t=this._head.next,n=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(n);break}n=t,t=t.next}e.previous||e.connect(n)}else e.connect(n);return this._startIfPossible(),this}remove(e,t){let n=this._head.next;for(;n;)n.match(e,t)?n=n.destroy():n=n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Pe.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),n=Math.min(Math.max(0,t)/1e3,Pe.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Pe._shared){const e=Pe._shared=new Pe;e.autoStart=!0,e._protected=!0}return Pe._shared}static get system(){if(!Pe._system){const e=Pe._system=new Pe;e.autoStart=!0,e._protected=!0}return Pe._system}},nl.targetFPMS=.06,ae=nl,Object.defineProperties(i,{TARGET_FPMS:{get(){return ae.targetFPMS},set(e){v("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ae.targetFPMS=e}}}),Gc=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,At.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?ae.shared:new ae,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}},Gc.extension=s.Application,a.add(Gc),qc=[],a.handleByList(s.Renderer,qc);function t8(e){for(const t of qc)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}n8=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,s8=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,o8=n8,Fc=s8,Mc=class{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{const n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}t>=D.HIGH?this.multisample=D.HIGH:t>=D.MEDIUM?this.multisample=D.MEDIUM:t>=D.LOW?this.multisample=D.LOW:this.multisample=D.NONE}destroy(){}},Mc.extension={type:s.RendererSystem,name:"_multisample"},a.add(Mc),r8=class{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}},Sc=class{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:n}=this,s=e._glBuffers[n]||this.createGLBuffer(e);t.bindBuffer(e.type,s.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:n,CONTEXT_UID:s}=this;if(this.boundBufferBases[t]!==e){const o=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,n.bindBufferBase(n.UNIFORM_BUFFER,t,o.buffer)}}bindBufferRange(e,t,n){const{gl:s,CONTEXT_UID:o}=this;n=n||0;const i=e._glBuffers[o]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,i.buffer,n*256,256)}update(e){const{gl:t,CONTEXT_UID:s}=this,n=e._glBuffers[s]||this.createGLBuffer(e);if(e._updateID!==n.updateID)if(n.updateID=e._updateID,t.bindBuffer(e.type,n.buffer),n.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const s=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;n.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,s)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const n=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),n&&(t||s.deleteBuffer(n.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let n=0;n<t.length;n++)this.dispose(this.managedBuffers[t[n]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:n}=this;return e._glBuffers[t]=new r8(n.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}},Sc.extension={type:s.RendererSystem,name:"buffer"},a.add(Sc),kc=class{constructor(e){this.renderer=e}render(e,t){const n=this.renderer;let s,o,i,a;if(t&&(s=t.renderTexture,o=t.clear,i=t.transform,a=t.skipUpdateTransform),this.renderingToScreen=!s,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=i,!n.context.isLost){if(s||(this.lastObjectRendered=e),!a){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}n.renderTexture.bind(s),n.batch.currentRenderer.start(),(o??n.background.clearBeforeRender)&&n.renderTexture.clear(),e.render(n),n.batch.currentRenderer.flush(),s&&(t.blit&&n.framebuffer.blit(),s.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}},kc.extension={type:s.RendererSystem,name:"objectRenderer"},a.add(kc),Ps=class Hl extends Pm{constructor(e){super(),this.type=Za.WEBGL,e=Object.assign({},i.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new mt({projectionMatrix:new z},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Hl.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(v("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Hl.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return!(e!=null&&e.forceCanvas)&&ov()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return v("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return v("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return v("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return v("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){v("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return v("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){v("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return v("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}},Ps.extension={type:s.Renderer,priority:1},Ps.__plugins={},Ps.__systems={},na=Ps,a.handleByMap(s.RendererPlugin,na.__plugins),a.handleByMap(s.RendererSystem,na.__systems),a.add(na),Oc=class extends Dn{constructor(e,t){const{width:n,height:s}=t||{};super(n,s),this.items=[],this.itemDirtyIds=[];for(let t=0;t<e;t++){const n=new m;this.items.push(n),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let n=0;n<this.length;n++)e[n]&&(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof Dn?this.addResourceAt(e[n],n):this.addResourceAt(V2(e[n],t),n))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(e).then(()=>{const{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),this.update(),Promise.resolve(this)}),this._load}},m8=class extends Oc{constructor(e,t){const{width:o,height:i}=t||{};let n,s;Array.isArray(e)?(n=e,s=e.length):s=e,super(s,{width:o,height:i}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=an.TEXTURE_2D_ARRAY}upload(e,t,n){const{length:o,itemDirtyIds:i,items:a}=this,{gl:s}=e;n.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,o,0,t.format,n.type,null);for(let e=0;e<o;e++){const r=a[e];i[e]<r.dirtyId&&(i[e]=r.dirtyId,r.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,e,r.resource.width,r.resource.height,1,t.format,n.type,r.resource.source))}return!0}},f8=class extends We{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return!!(t&&e instanceof t)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},wc=class Cn extends Oc{constructor(e,t){const{width:n,height:s,autoLoad:o,linkBaseTexture:i}=t||{};if(e&&e.length!==Cn.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:n,height:s});for(let e=0;e<Cn.SIDES;e++)this.items[e].target=an.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.linkBaseTexture=i!==!1,e&&this.initFromArray(e,t),o!==!1&&this.load()}bind(e){super.bind(e),e.target=an.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,n){if(n===0[0]&&(n=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=an.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,n){const s=this.itemDirtyIds;for(let o=0;o<Cn.SIDES;o++){const i=this.items[o];(s[o]<i.dirtyId||n.dirtyId<t.dirtyId)&&(i.valid&&i.resource?(i.resource.upload(e,i,n),s[o]=i.dirtyId):s[o]<-1&&(e.gl.texImage2D(i.target,0,n.internalFormat,t.realWidth,t.realHeight,0,t.format,n.type,null),s[o]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Cn.SIDES}},wc.SIDES=6,g8=wc,v8=class _zi extends We{constructor(e,t){t=t||{};let n,s,o;typeof e=="string"?(n=_zi.EMPTY,s=e,o=!0):(n=e,s=null,o=!1),super(n),this.url=s,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??o,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const n=await i.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await n.blob();if(this.destroyed)return;const t=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===se.UNPACK?"premultiply":"none"});if(this.destroyed){t.close();return}this.source=t,this.update(),e(this)}catch(e){if(this.destroyed)return;t(e),this.onError.emit(e)}}),this._load)}upload(e,t,n){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,n)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return _zi._EMPTY=_zi._EMPTY??i.ADAPTER.createCanvas(0,0),_zi._EMPTY}},ia=class Vs extends We{constructor(e,t){t=t||{},super(i.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},Vs.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;We.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,n=e.height;if(!t||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,o=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/n*t,o=this._overrideHeight||this._overrideWidth/t*n),s=Math.round(s),o=Math.round(o);const i=this.source;i.width=s,i.height=o,i._pixiId=`canvas_${ln()}`,i.getContext("2d").drawImage(e,0,0,t,n,0,0,s,o),this._resolve(),this._resolve=null}}static getSize(e){const t=Vs.SVG_SIZE.exec(e),n={};return t&&(n[t[1]]=Math.round(parseFloat(t[3])),n[t[5]]=Math.round(parseFloat(t[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Vs.SVG_XML.test(e)}},ia.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*<svg/m,ia.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,aa=ia,y8=class extends We{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},ra=class jl extends We{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const n=document.createElement("video");t.autoLoad!==!1&&n.setAttribute("preload","auto"),t.playsinline!==!1&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),t.muted===!0&&(n.setAttribute("muted",""),n.muted=!0),t.loop===!0&&n.setAttribute("loop",""),t.autoPlay!==!1&&n.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const s=e[0].src||e[0];We.crossOrigin(n,s,t.crossorigin);for(let o=0;o<e.length;++o){const i=document.createElement("source");let{src:t,mime:s}=e[o];if(t=t||e[o],t.startsWith("data:"))s=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const e=t.split("?").shift().toLowerCase(),n=e.slice(e.lastIndexOf(".")+1);s=s||jl.MIME_TYPES[n]||`video/${n}`}i.src=t,s&&(i.type=s),n.appendChild(i)}e=n}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(){if(!this.destroyed){if(this._updateFPS){const e=ae.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,n)=>{this.valid?t(this):(this._resolve=t,this._reject=n,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(ae.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ae.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ae.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||jl.TYPES.includes(t)}},ra.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],ra.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},pc=ra,Oa.push(v8,dd,f8,pc,y8,aa,Ls,g8,m8),Os=class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?g.EMPTY:(e=e||new g(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:o,b:i,c:a,d:r,tx:c,ty:l}=e,n=o*t.x+a*t.y+c,s=i*t.x+r*t.y+l;this.minX=Math.min(this.minX,n),this.maxX=Math.max(this.maxX,n),this.minY=Math.min(this.minY,s),this.maxY=Math.max(this.maxY,s)}addQuad(e){let s=this.minX,o=this.minY,i=this.maxX,a=this.maxY,t=e[0],n=e[1];s=t<s?t:s,o=n<o?n:o,i=t>i?t:i,a=n>a?n:a,t=e[2],n=e[3],s=t<s?t:s,o=n<o?n:o,i=t>i?t:i,a=n>a?n:a,t=e[4],n=e[5],s=t<s?t:s,o=n<o?n:o,i=t>i?t:i,a=n>a?n:a,t=e[6],n=e[7],s=t<s?t:s,o=n<o?n:o,i=t>i?t:i,a=n>a?n:a,this.minX=s,this.minY=o,this.maxX=i,this.maxY=a}addFrame(e,t,n,s,o){this.addFrameMatrix(e.worldTransform,t,n,s,o)}addFrameMatrix(e,t,n,s,o){const u=e.a,h=e.b,m=e.c,f=e.d,p=e.tx,g=e.ty;let r=this.minX,c=this.minY,l=this.maxX,d=this.maxY,i=u*t+m*n+p,a=h*t+f*n+g;r=i<r?i:r,c=a<c?a:c,l=i>l?i:l,d=a>d?a:d,i=u*s+m*n+p,a=h*s+f*n+g,r=i<r?i:r,c=a<c?a:c,l=i>l?i:l,d=a>d?a:d,i=u*t+m*o+p,a=h*t+f*o+g,r=i<r?i:r,c=a<c?a:c,l=i>l?i:l,d=a>d?a:d,i=u*s+m*o+p,a=h*s+f*o+g,r=i<r?i:r,c=a<c?a:c,l=i>l?i:l,d=a>d?a:d,this.minX=r,this.minY=c,this.maxX=l,this.maxY=d}addVertexData(e,t,n){let s=this.minX,o=this.minY,i=this.maxX,a=this.maxY;for(let r=t;r<n;r+=2){const c=e[r],l=e[r+1];s=c<s?c:s,o=l<o?l:o,i=c>i?c:i,a=l>a?l:a}this.minX=s,this.minY=o,this.maxX=i,this.maxY=a}addVertices(e,t,n,s){this.addVerticesMatrix(e.worldTransform,t,n,s)}addVerticesMatrix(e,t,n,s,o=0,i=o){const d=e.a,u=e.b,h=e.c,m=e.d,f=e.tx,p=e.ty;let a=this.minX,r=this.minY,c=this.maxX,l=this.maxY;for(let e=n;e<s;e+=2){const g=t[e],v=t[e+1],b=d*g+h*v+f,j=m*v+u*g+p;a=Math.min(a,b-o),c=Math.max(c,b+o),r=Math.min(r,j-i),l=Math.max(l,j+i)}this.minX=a,this.minY=r,this.maxX=c,this.maxY=l}addBounds(e){const t=this.minX,n=this.minY,s=this.maxX,o=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<n?e.minY:n,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>o?e.maxY:o}addBoundsMask(e,t){const n=e.minX>t.minX?e.minX:t.minX,s=e.minY>t.minY?e.minY:t.minY,o=e.maxX<t.maxX?e.maxX:t.maxX,i=e.maxY<t.maxY?e.maxY:t.maxY;if(n<=o&&s<=i){const e=this.minX,t=this.minY,a=this.maxX,r=this.maxY;this.minX=n<e?n:e,this.minY=s<t?s:t,this.maxX=o>a?o:a,this.maxY=i>r?i:r}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const n=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,o=e.maxX<t.x+t.width?e.maxX:t.x+t.width,i=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(n<=o&&s<=i){const e=this.minX,t=this.minY,a=this.maxX,r=this.maxY;this.minX=n<e?n:e,this.minY=s<t?s:t,this.maxX=o>a?o:a,this.maxY=i>r?i:r}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,n,s,o,i){e-=o,t-=i,n+=o,s+=i,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>s?this.maxY:s}},T=class _Vt extends ns{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ma,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Os,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let n=0;n<t.length;++n){const s=t[n];Object.defineProperty(_Vt.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new g),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new g),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Os);const n=this.transform,t=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=t?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const i=this.getBounds(!1,e);return this.parent=t,this.transform=n,this._bounds=s,this._bounds.updateID+=this._boundsID-o,i}toGlobal(e,t,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,n,s){return t&&(e=t.toGlobal(e,n,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,n=1,s=1,o=0,i=0,a=0,r=0,c=0){return this.position.x=e,this.position.y=t,this.scale.x=n||1,this.scale.y=s||1,this.rotation=o,this.skew.x=i,this.skew.y=a,this.pivot.x=r,this.pivot.y=c,this}destroy(){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new C8),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*r3}set angle(e){this.transform.rotation=e*c3}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e)return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}},C8=class extends T{constructor(){super(...arguments),this.sortDirty=null}},T.prototype.displayObjectUpdateTransform=T.prototype.updateTransform,E8=new z;function og(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}fc=class Wl extends T{constructor(){super(),this.children=[],this.sortableChildren=Wl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const n=this.getChildIndex(e),s=this.getChildIndex(t);this.children[n]=t,this.children[s]=e,this.onChildrenChange(n<s?n:s)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(e);Zn(this.children,n,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],n=this.children.indexOf(t);if(n===-1)return null;t.parent=null,t.transform._parentID=-1,Zn(this.children,n,1),this._boundsID++,this.onChildrenChange(n),t.emit("removed",this),this.emit("childRemoved",t,this,n)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Zn(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const o=e,i=t,s=i-o;let n;if(s>0&&s<=i){n=this.children.splice(o,s);for(let e=0;e<n.length;++e)n[e].parent=null,n[e].transform&&(n[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<n.length;++e)n[e].emit("removed",this),this.emit("childRemoved",n[e],this,e);return n}if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,s=this.children.length;t<s;++t){const n=this.children[t];n._lastSortedIndex=t,!e&&n.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(og),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,n=this.children.length;e<n;++e){const t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!!e.visible&&!!e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const n=super.getLocalBounds(e);if(!t)for(let e=0,n=this.children.length;e<n;++e){const t=this.children[e];t.visible&&t.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(e){const s=e.renderTexture.sourceFrame;if(!(s.width>0&&s.height>0))return;let n,t;this.cullArea?(n=this.cullArea,t=this.worldTransform):this._render!==Wl.prototype._render&&(n=this.getBounds(!0));const o=e.projection.transform;if(o&&(t?(t=E8.copyFrom(t),t.prepend(o)):t=o),n&&s.intersects(n,t))this._render(e);else if(this.cullArea)return;for(let n=0,o=this.children.length;n<o;++n){const t=this.children[n],s=t.cullable;t.cullable=s||!this.cullArea,t.render(e),t.cullable=s}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}}renderAdvanced(e){var s,o,i;const t=this.filters,n=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}const a=t&&((s=this._enabledFilters)==null?0[0]:s.length)||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==R.NONE));if(a&&e.batch.flush(),t&&(o=this._enabledFilters)!=null&&o.length&&e.filter.push(this,this._enabledFilters),n&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,n=this.children.length;t<n;++t)this.children[t].render(e)}a&&e.batch.flush(),n&&e.mask.pop(this),t&&(i=this._enabledFilters)!=null&&i.length&&e.filter.pop()}_render(){}destroy(e){super.destroy(),this.sortDirty=!1;const n=typeof e=="boolean"?e:e?.children,t=this.removeChildren(0,this.children.length);if(n)for(let n=0;n<t.length;++n)t[n].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}},fc.defaultSortableChildren=!1,ge=fc,ge.prototype.containerUpdateTransform=ge.prototype.updateTransform,Object.defineProperties(i,{SORTABLE_CHILDREN:{get(){return ge.defaultSortableChildren},set(e){v("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ge.defaultSortableChildren=e}}}),wn=new y,F8=new Uint16Array([0,1,2,0,2,3]),bs=class _dn extends ge{constructor(e){super(),this._anchor=new yt(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new O(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=d.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||b.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=F8,this.pluginName="batch",this.isSprite=!0,this._roundPixels=i.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Tt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Tt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const l=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===l._updateID)return;this._textureID!==l._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=l._updateID;const r=this.transform.worldTransform,g=r.a,f=r.b,d=r.c,u=r.d,h=r.tx,m=r.ty,e=this.vertexData,c=l.trim,o=l.orig,p=this._anchor;let s=0,n=0,a=0,t=0;if(c?(n=c.x-p._x*o.width,s=n+c.width,t=c.y-p._y*o.height,a=t+c.height):(n=-p._x*o.width,s=n+o.width,t=-p._y*o.height,a=t+o.height),e[0]=g*n+d*t+h,e[1]=u*t+f*n+m,e[2]=g*s+d*t+h,e[3]=u*t+f*s+m,e[4]=g*s+d*a+h,e[5]=u*a+f*s+m,e[6]=g*n+d*a+h,e[7]=u*a+f*n+m,this._roundPixels){const t=i.RESOLUTION;for(let n=0;n<e.length;++n)e[n]=Math.round(e[n]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const p=this._texture,e=this.vertexTrimmedData,h=p.orig,f=this._anchor,t=this.transform.worldTransform,a=t.a,r=t.b,c=t.c,l=t.d,o=t.tx,d=t.ty,s=-f._x*h.width,u=s+h.width,n=-f._y*h.height,m=n+h.height;if(e[0]=a*s+c*n+o,e[1]=l*n+r*s+d,e[2]=a*u+c*n+o,e[3]=l*n+r*u+d,e[4]=a*u+c*m+o,e[5]=l*m+r*u+d,e[6]=a*s+c*m+o,e[7]=l*m+r*s+d,this._roundPixels){const t=i.RESOLUTION;for(let n=0;n<e.length;++n)e[n]=Math.round(e[n]*t)/t}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Os),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new g),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,wn);const n=this._texture.orig.width,s=this._texture.orig.height,o=-n*this.anchor.x;let t=0;return wn.x>=o&&wn.x<o+n&&(t=-s*this.anchor.y,wn.y>=t&&wn.y<t+s)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e?.texture){const t=typeof e=="boolean"?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const n=e instanceof b?e:b.from(e,t);return new _dn(n)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Tt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Tt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||b.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}},hc=new z,T.prototype._cacheAsBitmap=!1,T.prototype._cacheData=null,T.prototype._cacheAsBitmapResolution=null,T.prototype._cacheAsBitmapMultisample=null,D8=class{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}},Object.defineProperties(T.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new D8),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),T.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},T.prototype._initCachedDisplayObject=function(e){var r,c;if((r=this._cacheData)!=null&&r.sprite)return;const a=this.alpha;this.alpha=1,e.batch.flush();const t=this.getLocalBounds(new g,!0);if((c=this.filters)!=null&&c.length){const e=this.filters[0].padding;t.pad(e)}const o=this.cacheAsBitmapResolution||e.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);const l=e.renderTexture.current,d=e.renderTexture.sourceFrame.clone(),u=e.renderTexture.destinationFrame.clone(),h=e.projection.transform,s=Tn.create({width:t.width,height:t.height,resolution:o,multisample:this.cacheAsBitmapMultisample??e.multisample}),i=`cacheAsBitmap_${ln()}`;this._cacheData.textureCacheId=i,m.addToCache(s.baseTexture,i),b.addToCache(s,i);const f=this.transform.localTransform.copyTo(hc).invert().translate(-t.x,-t.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:s,clear:!0,transform:f,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=h,e.renderTexture.bind(l,d,u),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=a;const n=new bs(s);n.transform.worldTransform=this.transform.worldTransform,n.anchor.x=-(t.x/t.width),n.anchor.y=-(t.y/t.height),n.alpha=a,n._bounds=this._bounds,this._cacheData.sprite=n,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=n.containsPoint.bind(n)},T.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},T.prototype._initCachedDisplayObjectCanvas=function(e){var r;if((r=this._cacheData)!=null&&r.sprite)return;const t=this.getLocalBounds(new g,!0),c=this.alpha;this.alpha=1;const l=e.canvasContext.activeContext,d=e._projTransform,o=this.cacheAsBitmapResolution||e.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);const i=Tn.create({width:t.width,height:t.height,resolution:o}),a=`cacheAsBitmap_${ln()}`;this._cacheData.textureCacheId=a,m.addToCache(i.baseTexture,a),b.addToCache(i,a);const s=hc;this.transform.localTransform.copyTo(s),s.invert(),s.tx-=t.x,s.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:i,clear:!0,transform:s,skipUpdateTransform:!1}),e.canvasContext.activeContext=l,e._projTransform=d,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=c;const n=new bs(i);n.transform.worldTransform=this.transform.worldTransform,n.anchor.x=-(t.x/t.width),n.anchor.y=-(t.y/t.height),n.alpha=c,n._bounds=this._bounds,this._cacheData.sprite=n,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=n.containsPoint.bind(n)},T.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},T.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},T.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,m.removeFromCache(this._cacheData.textureCacheId),b.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},T.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},T.prototype.name=null,ge.prototype.getChildByName=function(e,t){for(let t=0,n=this.children.length;t<n;t++)if(this.children[t].name===e)return this.children[t];if(t)for(let t=0,o=this.children.length;t<o;t++){const n=this.children[t];if(!n.getChildByName)continue;const s=n.getChildByName(e,!0);if(s)return s}return null},T.prototype.getGlobalPosition=function(e=new y,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e},N8=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,L8=class extends J{constructor(e=1){super(o8,N8,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},R8={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},P8=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function tg(e){const o=R8[e],i=o.length;let t=P8,n="";const a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let s;for(let t=0;t<e;t++){let r=a.replace("%index%",t.toString());s=t,t>=i&&(s=e-t-1),r=r.replace("%value%",o[s].toString()),n+=r,n+=`
`}return t=t.replace("%blur%",n),t=t.replace("%size%",e.toString()),t}I8=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function eg(e,t){const i=Math.ceil(e/2);let n=I8,s="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let t=0;t<e;t++){let n=o.replace("%index%",t.toString());n=n.replace("%sampleIndex%",`${t-(i-1)}.0`),s+=n,s+=`
`}return n=n.replace("%blur%",s),n=n.replace("%size%",e.toString()),n}va=class extends J{constructor(e,t=8,n=4,s=J.defaultResolution,o=5){const i=eg(o,e),a=tg(o);super(i,a),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=n,this.blur=t}apply(e,t,n,s){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/t.width):this.uniforms.strength=1/n.height*(n.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,n,s);else{const a=e.getFilterTexture(),r=e.renderer;let i=t,o=a;this.state.blend=!1,e.applyFilter(this,i,o,Se.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(i,Se.BLIT),this.uniforms.uSampler=o;const n=o;o=i,i=n,r.shader.bind(this),r.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,o,n,s),e.returnFilterTexture(a)}}get blur(){return this.strength}set blur(e){this.padding=1+(e<0?-e:e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}},$8=class extends J{constructor(e=8,t=4,n=J.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new va(!0,e,t,n,s),this.blurYFilter=new va(!1,e,t,n,s),this.resolution=n,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,n,s){const i=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(i&&o){const o=e.getFilterTexture();this.blurXFilter.apply(e,t,o,Se.CLEAR),this.blurYFilter.apply(e,o,n,s),e.returnFilterTexture(o)}else o?this.blurYFilter.apply(e,t,n,s):this.blurXFilter.apply(e,t,n,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},W8=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,wa=class extends J{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Fc,W8,e),this.alpha=1}_loadMatrix(e,t=!1){let n=e;t&&(this._multiply(n,this.uniforms.m,e),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(e,t,n){return e[0]=t[0]*n[0]+t[1]*n[5]+t[2]*n[10]+t[3]*n[15],e[1]=t[0]*n[1]+t[1]*n[6]+t[2]*n[11]+t[3]*n[16],e[2]=t[0]*n[2]+t[1]*n[7]+t[2]*n[12]+t[3]*n[17],e[3]=t[0]*n[3]+t[1]*n[8]+t[2]*n[13]+t[3]*n[18],e[4]=t[0]*n[4]+t[1]*n[9]+t[2]*n[14]+t[3]*n[19]+t[4],e[5]=t[5]*n[0]+t[6]*n[5]+t[7]*n[10]+t[8]*n[15],e[6]=t[5]*n[1]+t[6]*n[6]+t[7]*n[11]+t[8]*n[16],e[7]=t[5]*n[2]+t[6]*n[7]+t[7]*n[12]+t[8]*n[17],e[8]=t[5]*n[3]+t[6]*n[8]+t[7]*n[13]+t[8]*n[18],e[9]=t[5]*n[4]+t[6]*n[9]+t[7]*n[14]+t[8]*n[19]+t[9],e[10]=t[10]*n[0]+t[11]*n[5]+t[12]*n[10]+t[13]*n[15],e[11]=t[10]*n[1]+t[11]*n[6]+t[12]*n[11]+t[13]*n[16],e[12]=t[10]*n[2]+t[11]*n[7]+t[12]*n[12]+t[13]*n[17],e[13]=t[10]*n[3]+t[11]*n[8]+t[12]*n[13]+t[13]*n[18],e[14]=t[10]*n[4]+t[11]*n[9]+t[12]*n[14]+t[13]*n[19]+t[14],e[15]=t[15]*n[0]+t[16]*n[5]+t[17]*n[10]+t[18]*n[15],e[16]=t[15]*n[1]+t[16]*n[6]+t[17]*n[11]+t[18]*n[16],e[17]=t[15]*n[2]+t[16]*n[7]+t[17]*n[12]+t[18]*n[17],e[18]=t[15]*n[3]+t[16]*n[8]+t[17]*n[13]+t[18]*n[18],e[19]=t[15]*n[4]+t[16]*n[9]+t[17]*n[14]+t[18]*n[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}tint(e,t){const[n,s,o]=O.shared.setValue(e).toArray(),i=[n,0,0,0,0,0,s,0,0,0,0,0,o,0,0,0,0,0,1,0];this._loadMatrix(i,t)}greyscale(e,t){const n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const n=Math.cos(e),i=Math.sin(e),c=Math.sqrt,s=1/3,o=c(s),r=n+(1-n)*s,a=s*(1-n)-o*i,l=s*(1-n)+o*i,d=s*(1-n)+o*i,u=n+s*(1-n),h=s*(1-n)-o*i,m=s*(1-n)-o*i,f=s*(1-n)+o*i,p=n+s*(1-n),g=[r,a,l,0,0,d,u,h,0,0,m,f,p,0,0,0,0,0,1,0];this._loadMatrix(g,t)}contrast(e,t){const n=(e||0)+1,s=-.5*(n-1),o=[n,0,0,0,s,0,n,0,0,s,0,0,n,0,s,0,0,0,1,0];this._loadMatrix(o,t)}saturate(e=0,t){const s=e*2/3+1,n=(s-1)*-.5,o=[s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0];this._loadMatrix(o,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,n,s,o){e=e||.2,t=t||.15,n=n||16770432,s=s||3375104;const i=O.shared,[a,r,c]=i.setValue(n).toArray(),[l,d,u]=i.setValue(s).toArray(),h=[.3,.59,.11,0,0,a,r,c,e,0,l,d,u,t,0,a-l,r-d,c-u,0,0];this._loadMatrix(h,o)}night(e,t){e=e||.1;const n=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(n,t)}predator(e,t){const n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},wa.prototype.grayscale=wa.prototype.greyscale,K8=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,q8=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,Y8=class extends J{constructor(e,t){const n=new z;e.renderable=!1,super(q8,K8,{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=n,t==null&&(t=20),this.scale=new y(t,t)}apply(e,t,n,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,i=(o.a*o.a+o.b*o.b)**.5,a=(o.c*o.c+o.d*o.d)**.5;i!==0&&a!==0&&(this.uniforms.rotation[0]=o.a/i,this.uniforms.rotation[1]=o.b/i,this.uniforms.rotation[2]=o.c/a,this.uniforms.rotation[3]=o.d/a),e.applyFilter(this,t,n,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},G8=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,X8=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,Q8=class extends J{constructor(){super(X8,G8)}},Z8=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,J8=class extends J{constructor(e=.5,t=Math.random()){super(Fc,Z8,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}},$r={AlphaFilter:L8,BlurFilter:$8,BlurFilterPass:va,ColorMatrixFilter:wa,DisplacementFilter:Y8,FXAAFilter:Q8,NoiseFilter:J8},Object.entries($r).forEach(([e,t])=>{Object.defineProperty($r,e,{get(){return v("7.1.0",`filters.${e} has moved to ${e}`),t}})}),tf=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(ae.system.add(this.tickerUpdate,this,At.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ae.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}},ot=new tf,Ta=class _rs{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=_rs.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new y,this.page=new y,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}},rs=class extends Ta{constructor(){super(...arguments),this.client=new y,this.movement=new y,this.offset=new y,this.global=new y,this.screen=new y}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,n){return e.worldTransform.applyInverse(n||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(){throw new Error("Method not implemented.")}},he=class extends rs{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}},Qt=class extends rs{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}},Qt.DOM_DELTA_PIXEL=0,Qt.DOM_DELTA_LINE=1,Qt.DOM_DELTA_PAGE=2,lf=2048,df=new y,Na=new y,hf=class{constructor(e){this.dispatch=new ns,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((e,t)=>e.priority-t.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let n=0,s=t.length;n<s;n++)t[n].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){ot.pauseUpdate=!0;const s=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[s](this.rootTarget,this.rootTarget.eventMode,df.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,o=n.length-1;s<o;s++)if(e.currentTarget=n[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let s=n.length-2;s>=0;s--)if(e.currentTarget=n[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,n=this._allInteractiveElements){if(n.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const s=Array.isArray(t)?t:[t];for(let t=n.length-1;t>=0;t--)s.forEach(s=>{e.currentTarget=n[t],this.notifyTarget(e,s)})}propagationPath(e){const t=[e];for(let n=0;n<lf&&e!==this.rootTarget;n++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,n,s,o,i=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(ot.pauseUpdate=!1),e.interactiveChildren&&e.children){const r=e.children;for(let l=r.length-1;l>=0;l--){const d=r[l],c=this.hitTestMoveRecursive(d,this._isInteractive(t)?t:d.eventMode,n,s,o,i||o(e,n));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const t=e.isInteractive();(c.length>0||t)&&(t&&this._allInteractiveElements.push(e),c.push(e)),this._hitElements.length===0&&(this._hitElements=c),a=!0}}}const r=this._isInteractive(t),c=e.isInteractive();return r&&c&&this._allInteractiveElements.push(e),i||this._hitElements.length>0?null:a?this._hitElements:r&&!o(e,n)&&s(e,n)?c?[e]:[]:null}hitTestRecursive(e,t,n,s,o){if(this._interactivePrune(e)||o(e,n))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(ot.pauseUpdate=!1),e.interactiveChildren&&e.children){const i=e.children;for(let r=i.length-1;r>=0;r--){const c=i[r],a=this.hitTestRecursive(c,this._isInteractive(t)?t:c.eventMode,n,s,o);if(a){if(a.length>0&&!a[a.length-1].parent)continue;const t=e.isInteractive();return(a.length>0||t)&&a.push(e),a}}}const i=this._isInteractive(t),a=e.isInteractive();return i&&s(e,n)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var n;if(e.hitArea&&(e.worldTransform.applyInverse(t,Na),!e.hitArea.contains(Na.x,Na.y)))return!0;if(e._mask){const s=e._mask.isMaskData?e._mask.maskObject:e._mask;if(s&&!((n=s.containsPoint)!=null&&n.call(s,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode!=="passive"&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){var n,s;t=t??e.type;const o=`on${t}`;(s=(n=e.currentTarget)[o])==null||s.call(n,e);const i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof he)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const e=t.button===2;this.dispatchEvent(t,e?"rightdown":"mousedown")}const n=this.trackingData(e.pointerId);n.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof he)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const o=t.pointerType==="mouse"||t.pointerType==="pen",i=this.trackingData(e.pointerId),n=this.findMountedTarget(i.overTargets);if(((r=i.overTargets)==null?0[0]:r.length)>0&&n!==t.target){const i=e.type==="mousemove"?"mouseout":"pointerout",s=this.createPointerEvent(e,i,n);if(this.dispatchEvent(s,"pointerout"),o&&this.dispatchEvent(s,"mouseout"),!t.composedPath().includes(n)){const s=this.createPointerEvent(e,"pointerleave",n);for(s.eventPhase=s.AT_TARGET;s.target&&!t.composedPath().includes(s.target);)s.currentTarget=s.target,this.notifyTarget(s),o&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;this.freeEvent(s)}this.freeEvent(s)}if(n!==t.target){const a=e.type==="mousemove"?"mouseover":"pointerover",i=this.clonePointerEvent(t,a);this.dispatchEvent(i,"pointerover"),o&&this.dispatchEvent(i,"mouseover");let s=n?.parent;for(var r,c;s&&s!==this.rootTarget.parent&&s!==t.target;)s=s.parent;if(!s||s===this.rootTarget.parent){const e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==n&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),o&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(i)}const s=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(t,"pointermove"),a&&s.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),a&&s.push("globaltouchmove")),o&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),a&&s.push("globalmousemove"),this.cursor=(c=t.target)==null?0[0]:c.cursor),s.length>0&&this.all(t,s),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var s;if(!(e instanceof he)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(e.pointerId),n=this.createPointerEvent(e),o=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),o&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(s=n.target)==null?0[0]:s.cursor);const t=this.clonePointerEvent(n,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),o&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;i.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(t)}mapPointerOut(e){if(!(e instanceof he)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const o=e.pointerType==="mouse"||e.pointerType==="pen",i=this.findMountedTarget(t.overTargets),s=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(s),o&&this.dispatchEvent(s,"mouseout");const n=this.createPointerEvent(e,"pointerleave",i);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),o&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;t.overTargets=null,this.freeEvent(s),this.freeEvent(n)}this.cursor=null}mapPointerUp(e){if(!(e instanceof he)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const o=performance.now(),t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerup"),t.pointerType==="touch")this.dispatchEvent(t,"touchend");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const e=t.button===2;this.dispatchEvent(t,e?"rightup":"mouseup")}const n=this.trackingData(e.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[e.button]);let i=s;if(s&&!t.composedPath().includes(s)){let o=s;for(;o&&!t.composedPath().includes(o);){if(t.currentTarget=o,this.notifyTarget(t,"pointerupoutside"),t.pointerType==="touch")this.notifyTarget(t,"touchendoutside");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const e=t.button===2;this.notifyTarget(t,e?"rightupoutside":"mouseupoutside")}o=o.parent}delete n.pressTargetsByButton[e.button],i=o}if(i){const s=this.clonePointerEvent(t,"click");s.target=i,s.path=null,n.clicksByButton[e.button]||(n.clicksByButton[e.button]={clickCount:0,target:s.target,timeStamp:o});const a=n.clicksByButton[e.button];if(a.target===s.target&&o-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=s.target,a.timeStamp=o,s.detail=a.clickCount,s.pointerType==="mouse"){const e=s.button===2;this.dispatchEvent(s,e?"rightclick":"click")}else s.pointerType==="touch"&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(t)}mapPointerUpOutside(e){if(!(e instanceof he)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const n=this.trackingData(e.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[e.button]),t=this.createPointerEvent(e);if(s){let o=s;for(;o;)t.currentTarget=o,this.notifyTarget(t,"pointerupoutside"),t.pointerType==="touch"?this.notifyTarget(t,"touchendoutside"):(t.pointerType==="mouse"||t.pointerType==="pen")&&this.notifyTarget(t,t.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete n.pressTargetsByButton[e.button]}this.freeEvent(t)}mapWheel(e){if(!(e instanceof Qt)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let n=1;n<e.length&&e[n].parent===t;n++)t=e[n];return t}createPointerEvent(e,t,n){const s=this.allocateEvent(he);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=n??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof t=="string"&&(s.type=t),s}createWheelEvent(e){const t=this.allocateEvent(Qt);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const n=this.allocateEvent(he);return n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice(),n.type=t??n.type,n}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof he&&t instanceof he&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof rs&&t instanceof rs&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const n=e.currentTarget._events[t];if(n&&e.currentTarget.isInteractive())if("fn"in n)n.once&&e.currentTarget.removeListener(t,n.fn,0[0],!0),n.fn.call(n.context,e);else for(let s=0,o=n.length;s<o&&!e.propagationImmediatelyStopped;s++)n[s].once&&e.currentTarget.removeListener(t,n[s].fn,0[0],!0),n[s].fn.call(n[s].context,e)}},mf=1,ff={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Ra=class Zl{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new hf(null),ot.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new he(null),this.rootWheelEvent=new Qt(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Zl.defaultEventFeatures},{set:(e,t,n)=>(t==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[t]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:n}=this.renderer;this.setTargetElement(t),this.resolution=n,Zl._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let n=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(n=!1),this.currentCursor===e)return;this.currentCursor=e;const t=this.cursorStyles[e];if(t)switch(typeof t){case"string":n&&(this.domElement.style.cursor=t);break;case"function":t(e);break;case"object":n&&Object.assign(this.domElement.style,t);break}else n&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let e=0,n=t.length;e<n;e++){const s=t[e],o=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,ot.pointerMoved();const t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){const s=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const s=t!==this.domElement?"outside":"",n=this.normalizeToPointerData(e);for(let e=0,o=n.length;e<o;e++){const t=this.bootstrapEvent(this.rootPointerEvent,n[e]);t.type+=s,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let e=0,n=t.length;e<n;e++){const s=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,ot.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;ot.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;ot.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,n){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},o=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*o,e.y=(n-s.top)*(this.domElement.height/s.height)*o}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let s=0,o=e.changedTouches.length;s<o;s++){const n=e.changedTouches[s];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const n=e;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=mf),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,t.push(n)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ff[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}},Ra.extension={name:"events",type:[s.RendererSystem,s.CanvasRendererSystem]},Ra.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},Pa=Ra,a.add(Pa);function vf(e){return e==="dynamic"||e==="static"}bf={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:0[0],get interactive(){return this._internalInteractive??vf(Pa.defaultEventMode)},set interactive(e){v("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=e,this.eventMode=e?"static":"auto"},_internalEventMode:0[0],get eventMode(){return this._internalEventMode??Pa.defaultEventMode},set eventMode(e){this._internalInteractive=vf(e),this._internalEventMode=e},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(e,t,n){const r=typeof n=="boolean"&&n||typeof n=="object"&&n.capture,a=typeof n=="object"?n.signal:0[0],c=typeof n=="object"&&n.once===!0,s=typeof t=="function"?0[0]:t;e=r?`${e}capture`:e;const o=typeof t=="function"?t:t.handleEvent,i=this;a&&a.addEventListener("abort",()=>{i.off(e,o,s)}),c?i.once(e,o,s):i.on(e,o,s)},removeEventListener(e,t,n){const s=typeof n=="boolean"&&n||typeof n=="object"&&n.capture,o=typeof t=="function"?0[0]:t;e=s?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,o)},dispatchEvent(e){if(!(e instanceof Ta))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}},T.mixin(bf),jf={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1},T.mixin(jf),yf=9,is=100,wf=0,Of=0,hr=2,Ja=1,Ef=-1e3,kf=-1e3,Af=2,ol=class{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Be.tablet||Be.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${is}px`,t.style.height=`${is}px`,t.style.position="absolute",t.style.top=`${wf}px`,t.style.left=`${Of}px`,t.style.zIndex=hr.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${Ja}px`,e.style.height=`${Ja}px`,e.style.position="absolute",e.style.top=`${Ef}px`,e.style.left=`${kf}px`,e.style.zIndex=Af.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let e=0;e<t.length;e++)this.updateAccessibleObjects(t[e])}update(){const s=performance.now();if(Be.android.device&&s<this.androidUpdateCount||(this.androidUpdateCount=s+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:r,y:c,width:l,height:d}=this.renderer.view.getBoundingClientRect(),{width:o,height:i,resolution:a}=this.renderer,t=l/o*a,n=d/i*a;let e=this.div;e.style.left=`${r}px`,e.style.top=`${c}px`,e.style.width=`${o}px`,e.style.height=`${i}px`;for(let o=0;o<this.children.length;o++){const s=this.children[o];if(s.renderId!==this.renderId)s._accessibleActive=!1,Zn(this.children,o,1),this.div.removeChild(s._accessibleDiv),this.pool.push(s._accessibleDiv),s._accessibleDiv=null,o--;else{e=s._accessibleDiv;let o=s.hitArea;const i=s.worldTransform;s.hitArea?(e.style.left=`${(i.tx+o.x*i.a)*t}px`,e.style.top=`${(i.ty+o.y*i.d)*n}px`,e.style.width=`${o.width*i.a*t}px`,e.style.height=`${o.height*i.d*n}px`):(o=s.getBounds(),this.capHitArea(o),e.style.left=`${o.x*t}px`,e.style.top=`${o.y*n}px`,e.style.width=`${o.width*t}px`,e.style.height=`${o.height*n}px`,e.title!==s.accessibleTitle&&s.accessibleTitle!==null&&(e.title=s.accessibleTitle),e.getAttribute("aria-label")!==s.accessibleHint&&s.accessibleHint!==null&&e.setAttribute("aria-label",s.accessibleHint)),(s.accessibleTitle!==e.title||s.tabIndex!==e.tabIndex)&&(e.title=s.accessibleTitle,e.tabIndex=s.tabIndex,this.debug&&this.updateDebugHTML(e))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:n}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>n&&(e.height=n-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${is}px`,t.style.height=`${is}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=hr.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:s}=e.target,n=this.renderer.events.rootBoundary,o=Object.assign(new Ta(n),{target:s});n.rootTarget=this.renderer.lastObjectRendered,t.forEach(e=>n.dispatchEvent(o,e))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===yf&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}},ol.extension={name:"accessibility",type:[s.RendererPlugin,s.CanvasRendererPlugin]},a.add(ol),Ga=class Ql{constructor(e){this.stage=new ge,e=Object.assign({forceCanvas:!1},e),this.renderer=t8(e),Ql._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?0[0]:e.view}get screen(){var e;return(e=this.renderer)==null?0[0]:e.screen}destroy(e,t){const n=Ql._plugins.slice(0);n.reverse(),n.forEach(e=>{e.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}},Ga._plugins=[],Ff=Ga,a.handleByList(s.Application,Ff._plugins),Qa=class{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,t;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,t=s}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}},Qa.extension=s.Application,a.add(Qa),tr={loader:s.LoadParser,resolver:s.ResolveParser,cache:s.CacheParser,detection:s.DetectionParser},a.handle(s.Asset,e=>{const t=e.ref;Object.entries(tr).filter(([e])=>!!t[e]).forEach(([e,n])=>a.add(Object.assign(t[e],{extension:t[e].extension??n})))},e=>{const t=e.ref;Object.keys(tr).filter(e=>!!t[e]).forEach(e=>a.remove(t[e]))}),Df=class{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<t;n++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};function Vn(e,t){if(Array.isArray(t)){for(const n of t)if(e.startsWith(`data:${n}`))return!0;return!1}return e.startsWith(`data:${t}`)}function Ot(e,t){const s=e.split("?")[0],n=I.extname(s).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}de=(e,t,n=!1)=>(Array.isArray(e)||(e=[e]),t?e.map(e=>typeof e=="string"||n?t(e):e):e),Ua=(e,t)=>{const n=t.split("?")[1];return n&&(e+=`?${n}`),e};function Hf(e,t,n,s,o){const i=t[n];for(let a=0;a<i.length;a++){const r=i[a];n<t.length-1?Hf(e.replace(s[n],r),t,n+1,s,o):o.push(e.replace(s[n],r))}}function Bp(e){const s=/\{(.*?)\}/g,t=e.match(s),n=[];if(t){const s=[];t.forEach(e=>{const t=e.substring(1,e.length-1).split(",");s.push(t)}),Hf(e,s,0,t,n)}else n.push(e);return n}ls=e=>!Array.isArray(e),Vf=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const s=de(e);let n;for(let e=0;e<this.parsers.length;e++){const o=this.parsers[e];if(o.test(t)){n=o.getCacheableAssets(s,t);break}}n||(n={},s.forEach(e=>{n[e]=t}));const o=Object.keys(n),i={cacheKeys:o,keys:s};if(s.forEach(e=>{this._cacheMap.set(e,i)}),o.forEach(e=>{const s=n?n[e]:t;this._cache.has(e)&&this._cache.get(e)!==s&&console.warn("[Cache] already has key:",e),this._cache.set(e,n[e])}),t instanceof b){const e=t;s.forEach(t=>{e.baseTexture!==b.EMPTY.baseTexture&&m.addToCache(e.baseTexture,t),b.addToCache(e,t)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(e=>{this._cache.delete(e)}),t.keys.forEach(e=>{this._cacheMap.delete(e)})}get parsers(){return this._parsers}},Ct=new Vf,Wf=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,n)=>(this._parsersValidated=!1,e[t]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const n={promise:null,parser:null};return n.promise=(async()=>{var i,a;let o=null,s=null;if(t.loadParser&&(s=this._parserHash[t.loadParser],s||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!s){for(let o=0;o<this.parsers.length;o++){const n=this.parsers[o];if(n.load&&(i=n.test)!=null&&i.call(n,e,t,this)){s=n;break}}if(!s)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await s.load(e,t,this),n.parser=s;for(let s=0;s<this.parsers.length;s++){const e=this.parsers[s];e.parse&&e.parse&&await((a=e.testParse)==null?0[0]:a.call(e,o,t,this))&&(o=await e.parse(o,t,this)||o,n.parser=e)}return o})(),n}async load(e,t){this._parsersValidated||this._validateParsers();let o=0;const n={},i=ls(e),s=de(e,e=>({alias:[e],src:e})),a=s.length,r=s.map(async e=>{const s=I.toAbsolute(e.src);if(!n[e.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,e)),n[e.src]=await this.promiseCache[s].promise,t&&t(++o/a)}catch(t){throw delete this.promiseCache[s],delete n[e.src],new Error(`[Loader.load] Failed to load ${s}.
${t}`)}});return await Promise.all(r),i?n[s[0].src]:n}async unload(e){const t=de(e,e=>({alias:[e],src:e})).map(async e=>{var t,s;const o=I.toAbsolute(e.src),n=this.promiseCache[o];if(n){const i=await n.promise;delete this.promiseCache[o],(s=(t=n.parser)==null?0[0]:t.unload)==null||s.call(t,i,e,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}},be=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(be||{}),Kf=".json",qf="application/json",Yf={extension:{type:s.LoadParser,priority:be.Low},name:"loadJson",test(e){return Vn(e,qf)||Ot(e,Kf)},async load(e){return await(await i.ADAPTER.fetch(e)).json()}},a.add(Yf),Gf=".txt",Xf="text/plain",Qf={name:"loadTxt",extension:{type:s.LoadParser,priority:be.Low},test(e){return Vn(e,Xf)||Ot(e,Gf)},async load(e){return await(await i.ADAPTER.fetch(e)).text()}},a.add(Qf),Zf=["normal","bold","100","200","300","400","500","600","700","800","900"],Jf=[".ttf",".otf",".woff",".woff2"],e6=["font/ttf","font/otf","font/woff","font/woff2"],t6=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Ip(e){const o=I.extname(e),t=I.basename(e,o).replace(/(-|_)/g," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1));let s=t.length>0;for(const e of t)if(!e.match(t6)){s=!1;break}let n=t.join(" ");return s||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}s6=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Hp(e){return s6.test(e)?e:encodeURI(e)}i6={extension:{type:s.LoadParser,priority:be.Low},name:"loadWebFont",test(e){return Vn(e,e6)||Ot(e,Jf)},async load(e,t){var n,s,o;const a=i.ADAPTER.getFontFaceSet();if(a){const i=[],c=((n=t.data)==null?0[0]:n.family)??Ip(e),r=((o=(s=t.data)==null?0[0]:s.weights)==null?0[0]:o.filter(e=>Zf.includes(e)))??["normal"],l=t.data??{};for(let t=0;t<r.length;t++){const s=r[t],n=new FontFace(c,`url(${Hp(e)})`,{...l,weight:s});await n.load(),a.add(n),i.push(n)}return i.length===1?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(e=>i.ADAPTER.getFontFaceSet().delete(e))}},a.add(i6),a6=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`,on=null,Wa=class{constructor(){on||(on=URL.createObjectURL(new Blob([a6],{type:"application/javascript"}))),this.worker=new Worker(on)}},Wa.revokeObjectURL=function(){on&&(URL.revokeObjectURL(on),on=null)},l6=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`,dn=null,ir=class{constructor(){dn||(dn=URL.createObjectURL(new Blob([l6],{type:"application/javascript"}))),this.worker=new Worker(dn)}},ir.revokeObjectURL=function(){dn&&(URL.revokeObjectURL(dn),dn=null)},ar=0,f6=class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==0[0]?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new Wa;t.addEventListener("message",n=>{t.terminate(),Wa.revokeObjectURL(),e(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){rr===0[0]&&(rr=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<rr&&(this._createdWorkers++,e=(new ir).worker,e.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==0[0]?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const n=new Promise((n,s)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:s})});return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),n=e.id;this.resolveHash[ar]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:ar++,id:n})}},cr=new f6;function us(e,t,n){e.resource.internal=!0;const s=new b(e),o=()=>{delete t.promiseCache[n],Ct.has(n)&&Ct.remove(n)};return s.baseTexture.once("destroyed",()=>{n in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),o())}),s.once("destroyed",()=>{e.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),o())}),s}v6=[".jpeg",".jpg",".png",".webp",".avif"],b6=["image/jpeg","image/png","image/webp","image/avif"];async function Lp(e){const t=await i.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const n=await t.blob();return await createImageBitmap(n)}ps={name:"loadTextures",extension:{type:s.LoadParser,priority:be.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return Vn(e,b6)||Ot(e,v6)},async load(e,t,n){var i;const a=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let o;a?this.config.preferWorkers&&await cr.isImageBitmapSupported()?o=await cr.loadImageBitmap(e):o=await Lp(e):o=await new Promise((t,n)=>{const s=new Image;s.crossOrigin=this.config.crossOrigin,s.src=e,s.complete?t(s):(s.onload=()=>t(s),s.onerror=e=>n(e))});const s={...t.data};s.resolution??(s.resolution=et(e)),a&&((i=s.resourceOptions)==null?0[0]:i.ownsImageBitmap)===0[0]&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const r=new m(o,s);return r.resource.src=e,us(r,n,e)},unload(e){e.destroy(!0)}},a.add(ps),_6=".svg",w6="image/svg+xml",O6={extension:{type:s.LoadParser,priority:be.High},name:"loadSVG",test(e){return Vn(e,w6)||Ot(e,_6)},async testParse(e){return aa.test(e)},async parse(e,t,n){var s;const o=new aa(e,(s=t?.data)==null?0[0]:s.resourceOptions);await o.load();const i=new m(o,{resolution:et(e),...t?.data});return i.resource.src=t.src,us(i,n,t.src)},async load(e){return(await i.ADAPTER.fetch(e)).text()},unload:ps.unload},a.add(O6),x6=[".mp4",".m4v",".webm",".ogv"],C6=["video/mp4","video/webm","video/ogg"],E6={name:"loadVideo",extension:{type:s.LoadParser,priority:be.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(e){return Vn(e,C6)||Ot(e,x6)},async load(e,t,n){var a;let s;const r=await(await i.ADAPTER.fetch(e)).blob(),o=URL.createObjectURL(r);try{const c={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(a=t?.data)==null?0[0]:a.resourceOptions,autoLoad:!0},i=new pc(o,c);await i.load();const r=new m(i,{alphaMode:await dv(),resolution:et(e),...t?.data});r.resource.src=e,s=us(r,n,e),s.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(e){throw URL.revokeObjectURL(o),e}return s},unload(e){e.destroy(!0)}},a.add(E6),k6=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}}getAlias(e){const{alias:t,name:n,src:s,srcs:o}=e;return de(t||n||s||o,e=>typeof e=="string"?e:Array.isArray(e)?e.map(e=>e?.src??e?.srcs??e):e!=null&&e.src||e!=null&&e.srcs?e.src??e.srcs:e,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(e,t){const n=[];Array.isArray(t)?t.forEach(t=>{const i=t.src??t.srcs,s=t.alias??t.name;let o;if(typeof s=="string"){const t=this._createBundleAssetId(e,s);n.push(t),o=[s,t]}else{const t=s.map(t=>this._createBundleAssetId(e,t));n.push(...t),o=[...s,...t]}this.add({...t,alias:o,src:i})}):Object.keys(t).forEach(s=>{const o=[s,this._createBundleAssetId(e,s)];if(typeof t[s]=="string")this.add({alias:o,src:t[s]});else if(Array.isArray(t[s]))this.add({alias:o,src:t[s]});else{const e=t[s],n=e.src??e.srcs;this.add({...e,alias:o,src:Array.isArray(n)?n:[n]})}n.push(...o)}),this._bundles[e]=n}add(e,t,n,s,o){const i=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(v("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),i.push({alias:e,src:t,data:n,format:s,loadParser:o})):Array.isArray(e)?i.push(...e):i.push(e);let a;a=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},de(i).forEach(e=>{const{src:r,srcs:c}=e;let{data:n,format:s,loadParser:o}=e;const l=de(r||c).map(e=>typeof e=="string"?Bp(e):Array.isArray(e)?e:[e]),t=this.getAlias(e);Array.isArray(t)?t.forEach(a):a(t);const i=[];l.forEach(e=>{e.forEach(e=>{let a={};if(typeof e!="object"){{a.src=e;for(let t=0;t<this._parsers.length;t++){const n=this._parsers[t];if(n.test(e)){a=n.parse(e);break}}}}else n=e.data??n,s=e.format??s,o=e.loadParser??o,a={...a,...e};if(!t)throw new Error(`[Resolver] alias is undefined for this asset: ${a.src}`);a=this.buildResolvedAsset(a,{aliases:t,data:n,format:s,loadParser:o}),i.push(a)})}),t.forEach(e=>{this._assetMap[e]=i})})}resolveBundle(e){const n=ls(e);e=de(e);const t={};return e.forEach(e=>{const n=this._bundles[e];if(n){const s=this.resolve(n),o={};for(const t in s){const n=s[t];o[this._extractAssetIdFromBundle(e,t)]=n}t[e]=o}}),n?t[e[0]]:t}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const e={};for(const n in t)e[n]=t[n].src;return e}return t.src}resolve(e){const n=ls(e);e=de(e);const t={};return e.forEach(e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const s=t[0],n=this._getPreferredOrder(t);n==null||n.priority.forEach(e=>{n.params[e].forEach(n=>{const s=t.filter(t=>!!t[e]&&t[e]===n);s.length&&(t=s)})}),this._resolverHash[e]=t[0]??s}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{});t[e]=this._resolverHash[e]}),n?t[e[0]]:t}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const s=e[0],n=this._preferredOrder.find(e=>e.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:n,data:s,loadParser:o,format:i}=t;return(this._basePath||this._rootPath)&&(e.src=I.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=n??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...s||{},...e.data},e.loadParser=o??e.loadParser,e.format=i??e.format??I.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}},A6=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new k6,this.loader=new Wf,this.cache=Ct,this._backgroundLoader=new Df(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var n,s;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;typeof t=="string"&&(t=await this.load(t)),this.resolver.addManifest(t)}const t=((n=e.texturePreference)==null?0[0]:n.resolution)??1,o=typeof t=="number"?[t]:t,i=await this._detectFormats({preferredFormats:(s=e.texturePreference)==null?0[0]:s.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:o}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,n,s,o){this.resolver.add(e,t,n,s,o)}async load(e,t){this._initialized||await this.init();const o=ls(e),n=de(e).map(e=>{if(typeof e!="string"){const t=this.resolver.getAlias(e);return t.some(e=>!this.resolver.hasKey(e))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e}),i=this.resolver.resolve(n),s=await this._mapLoadToResolve(i,t);return o?s[n[0]]:s}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let s=!1;typeof e=="string"&&(s=!0,e=[e]);const o=this.resolver.resolveBundle(e),n={},a=Object.keys(o);let r=0,i=0;const c=()=>{t==null||t(++r/i)},l=a.map(e=>{const t=o[e];return i+=Object.keys(t).length,this._mapLoadToResolve(t,c).then(t=>{n[e]=t})});return await Promise.all(l),s?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(e=>{this._backgroundLoader.add(Object.values(e))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Ct.get(e);const t={};for(let n=0;n<e.length;n++)t[n]=Ct.get(e[n]);return t}async _mapLoadToResolve(e,t){const n=Object.values(e),o=Object.keys(e);this._backgroundLoader.active=!1;const i=await this.loader.load(n,t);this._backgroundLoader.active=!0;const s={};return n.forEach((e,t)=>{const n=i[e.src],a=[e.src];e.alias&&a.push(...e.alias),s[o[t]]=n,Ct.set(a,n)}),s}async unload(e){this._initialized||await this.init();const t=de(e).map(e=>typeof e!="string"?e.src:e),n=this.resolver.resolve(t);await this._unloadFromResolved(n)}async unloadBundle(e){this._initialized||await this.init(),e=de(e);const t=this.resolver.resolveBundle(e),n=Object.keys(t).map(e=>this._unloadFromResolved(t[e]));await Promise.all(n)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(e=>{Ct.remove(e.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const n of e.detections)e.skipDetections||await n.test()?t=await n.add(t):e.skipDetections||(t=await n.remove(t));return t=t.filter((e,n)=>t.indexOf(e)===n),t}get detections(){return this._detections}get preferWorkers(){return ps.config.preferWorkers}set preferWorkers(e){v("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(t=>t in e).forEach(n=>{t.config[n]=e[n]})})}},js=new A6,a.handleByList(s.LoadParser,js.loader.parsers).handleByList(s.ResolveParser,js.resolver.parsers).handleByList(s.CacheParser,js.cache.parsers).handleByList(s.DetectionParser,js.detections),M6={extension:s.CacheParser,test:e=>Array.isArray(e)&&e.every(e=>e instanceof b),getCacheableAssets:(e,t)=>{const n={};return e.forEach(e=>{t.forEach((t,s)=>{n[e+(s===0?"":s+1)]=t})}),n}},a.add(M6);async function F6(e){if("Image"in globalThis)return new Promise(t=>{const n=new Image;n.onload=()=>{t(!0)},n.onerror=()=>{t(!1)},n.src=e});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}T6={extension:{type:s.DetectionParser,priority:1},test:async()=>F6("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter(e=>e!=="avif")},a.add(T6),z6={extension:{type:s.DetectionParser,priority:0},test:async()=>F6("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter(e=>e!=="webp")},a.add(z6),dr=["png","jpg","jpeg"],N6={extension:{type:s.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...dr],remove:async e=>e.filter(e=>!dr.includes(e))},a.add(N6),L6="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function mr(e){return!L6&&document.createElement("video").canPlayType(e)!==""}P6={extension:{type:s.DetectionParser,priority:0},test:async()=>mr("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(e=>e!=="webm")},a.add(P6),H6={extension:{type:s.DetectionParser,priority:0},test:async()=>mr("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(e=>e!=="mp4"&&e!=="m4v")},a.add(H6),I6={extension:{type:s.DetectionParser,priority:0},test:async()=>mr("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(e=>e!=="ogv")},a.add(I6),B6={extension:s.ResolveParser,test:ps.test,parse:e=>{var t;return{resolution:parseFloat(((t=i.RETINA_PREFIX.exec(e))==null?0[0]:t[1])??"1"),format:I.extname(e).slice(1),src:e}}},a.add(B6),q=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e))(q||{}),ys={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};function K6(){kn={bptc:Ke.getExtension("EXT_texture_compression_bptc"),astc:Ke.getExtension("WEBGL_compressed_texture_astc"),etc:Ke.getExtension("WEBGL_compressed_texture_etc"),s3tc:Ke.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ke.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Ke.getExtension("WEBGL_compressed_texture_pvrtc")||Ke.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Ke.getExtension("WEBGL_compressed_texture_etc1"),atc:Ke.getExtension("WEBGL_compressed_texture_atc")}}q6={extension:{type:s.DetectionParser,priority:2},test:async()=>{const e=i.ADAPTER.createCanvas().getContext("webgl");return e?(Ke=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{kn||K6();const t=[];for(const e in kn)kn[e]&&t.push(e);return[...t,...e]},remove:async e=>(kn||K6(),e.filter(e=>!(e in kn)))},a.add(q6),Y6=class extends Ls{constructor(e,t={width:1,height:1,autoLoad:!0}){let s,n;typeof e=="string"?(s=e,n=new Uint8Array):(s=null,n=e),super(n,t),this.origin=s,this.buffer=n?new oa(n):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new oa(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}},Ia=class _li extends Y6{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=_li._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||_li._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e){const s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let e=0,t=this.levels;e<t;e++){const{levelID:n,levelWidth:o,levelHeight:i,levelBuffer:a}=this._levelBuffers[e];s.compressedTexImage2D(s.TEXTURE_2D,n,this.format,o,i,0,a)}return!0}onBlobLoaded(){this._levelBuffers=_li._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,n,s,o,i,a){const h=new Array(n);let m=e.byteOffset,r=i,c=a,l=r+s-1&~(s-1),d=c+o-1&~(o-1),u=l*d*ys[t];for(let i=0;i<n;i++)h[i]={levelID:i,levelWidth:n>1?r:l,levelHeight:n>1?c:d,levelBuffer:new Uint8Array(e.buffer,m,u)},m+=u,r=r>>1||1,c=c>>1||1,l=r+s-1&~(s-1),d=c+o-1&~(o-1),u=l*d*ys[t];return h}},Da=4,Cs=124,Z6=32,kr=20,ep=542327876,Es={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},np={FOURCC:2},ks={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},op=1,ip=2,ap=4,rp=64,cp=512,lp=131072,dp=827611204,up=861165636,hp=894720068,mp=808540228,fp=4,pp={[dp]:q.COMPRESSED_RGBA_S3TC_DXT1_EXT,[up]:q.COMPRESSED_RGBA_S3TC_DXT3_EXT,[hp]:q.COMPRESSED_RGBA_S3TC_DXT5_EXT},gp={70:q.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:q.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:q.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:q.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:q.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:q.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:q.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:q.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:q.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:q.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:q.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:q.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:q.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Ep(e){const a=new Uint32Array(e);if(a[0]!==ep)throw new Error("Invalid DDS file magic word");const n=new Uint32Array(e,0,Cs/Uint32Array.BYTES_PER_ELEMENT),s=n[Es.HEIGHT],o=n[Es.WIDTH],i=n[Es.MIPMAP_COUNT],r=new Uint32Array(e,Es.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Z6/Uint32Array.BYTES_PER_ELEMENT),t=r[op];if(t&ap){const l=r[np.FOURCC];if(l!==mp){const t=pp[l],n=Da+Cs,a=new Uint8Array(e,n);return[new Ia(a,{format:t,width:o,height:s,levels:i})]}const m=Da+Cs,t=new Uint32Array(a.buffer,m,kr/Uint32Array.BYTES_PER_ELEMENT),d=t[ks.DXGI_FORMAT],f=t[ks.RESOURCE_DIMENSION],p=t[ks.MISC_FLAG],u=t[ks.ARRAY_SIZE],n=gp[d];if(n===0[0])throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===fp)throw new Error("DDSParser does not support cubemap textures");if(f===6)throw new Error("DDSParser does not supported 3D texture data");const c=new Array,h=Da+Cs+kr;if(u===1)c.push(new Uint8Array(e,h));else{const d=ys[n];let t=0,a=o,r=s;for(let e=0;e<i;e++){const n=Math.max(1,a+3&-4),s=Math.max(1,r+3&-4),o=n*s*d;t+=o,a=a>>>1,r=r>>>1}let l=h;for(let n=0;n<u;n++)c.push(new Uint8Array(e,l,t)),l+=t}return c.map(e=>new Ia(e,{format:n,width:o,height:s,levels:i}))}throw t&rp?new Error("DDSParser does not support uncompressed texture data."):t&cp?new Error("DDSParser does not supported YUV uncompressed texture data."):t&lp?new Error("DDSParser does not support single-channel (lumninance) texture data!"):t&ip?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}Lr=[171,75,84,88,32,49,49,187,13,10,26,10],jp=67305985,ve={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},za=64,Pr={[c.UNSIGNED_BYTE]:1,[c.UNSIGNED_SHORT]:2,[c.INT]:4,[c.UNSIGNED_INT]:4,[c.FLOAT]:4,[c.HALF_FLOAT]:8},Op={[n.RGBA]:4,[n.RGB]:3,[n.RG]:2,[n.RED]:1,[n.LUMINANCE]:1,[n.LUMINANCE_ALPHA]:2,[n.ALPHA]:1},vp={[c.UNSIGNED_SHORT_4_4_4_4]:2,[c.UNSIGNED_SHORT_5_5_5_1]:2,[c.UNSIGNED_SHORT_5_6_5]:2};function F5(e,t,n=!1){const s=new DataView(t);if(!M5(e,s))return null;const o=s.getUint32(ve.ENDIANNESS,!0)===jp,i=s.getUint32(ve.GL_TYPE,o),g=s.getUint32(ve.GL_FORMAT,o),_=s.getUint32(ve.GL_INTERNAL_FORMAT,o),f=s.getUint32(ve.PIXEL_WIDTH,o),l=s.getUint32(ve.PIXEL_HEIGHT,o)||1,E=s.getUint32(ve.PIXEL_DEPTH,o)||1,j=s.getUint32(ve.NUMBER_OF_ARRAY_ELEMENTS,o)||1,S=s.getUint32(ve.NUMBER_OF_FACES,o),d=s.getUint32(ve.NUMBER_OF_MIPMAP_LEVELS,o),C=s.getUint32(ve.BYTES_OF_KEY_VALUE_DATA,o);if(l===0||E!==1)throw new Error("Only 2D textures are supported");if(S!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(j!==1)throw new Error("WebGL does not support array textures");const A=4,k=4,x=f+3&-4,O=l+3&-4,h=new Array(j);let y=f*l;i===0&&(y=x*O);let r;if(i!==0?Pr[i]?r=Pr[i]*Op[g]:r=vp[i]:r=ys[_],r===0[0])throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const w=n?Ap(s,C,o):null;let p=y*r,u=f,m=l,b=x,v=O,a=za+C;for(let e=0;e<d;e++){const c=s.getUint32(a,o);let n=a+4;for(let s=0;s<j;s++){let o=h[s];o||(o=h[s]=new Array(d)),o[e]={levelID:e,levelWidth:d>1||i!==0?u:b,levelHeight:d>1||i!==0?m:v,levelBuffer:new Uint8Array(t,n,p)},n+=p}a+=c+4,a=a%4!==0?a+4-a%4:a,u=u>>1||1,m=m>>1||1,b=u+A-1&-4,v=m+k-1&-4,p=b*v*r}return i!==0?{uncompressed:h.map(e=>{let t=e[0].levelBuffer,n=!1;return i===c.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):i===c.UNSIGNED_INT?(n=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):i===c.INT&&(n=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new Ls(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:i,format:n?kp(g):g}}),kvData:w}:{compressed:h.map(e=>new Ia(null,{format:_,width:f,height:l,levels:d,levelBuffers:e})),kvData:w}}function M5(e,t){for(let n=0;n<Lr.length;n++)if(t.getUint8(n)!==Lr[n])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function kp(e){switch(e){case n.RGBA:return n.RGBA_INTEGER;case n.RGB:return n.RGB_INTEGER;case n.RG:return n.RG_INTEGER;case n.RED:return n.RED_INTEGER;default:return e}}function Ap(e,t,n){const o=new Map;let s=0;for(;s<t;){const a=e.getUint32(za+s,n),r=za+s+4,c=3-(a+3)%4;if(a===0||a>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let i=0;for(;i<a&&e.getUint8(r+i)!==0;i++);if(i===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(e.buffer,r,i)),d=new DataView(e.buffer,r+i+1,a-i-1);o.set(l,d),s+=4+a+c}return o}sp={extension:{type:s.LoadParser,priority:be.High},name:"loadDDS",test(e){return Ot(e,".dds")},async load(e,t,n){const o=await(await i.ADAPTER.fetch(e)).arrayBuffer(),s=Ep(o).map(s=>{const o=new m(s,{mipmap:ke.OFF,alphaMode:se.NO_PREMULTIPLIED_ALPHA,resolution:et(e),...t.data});return us(o,n,e)});return s.length===1?s[0]:s},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}},a.add(sp),J6={extension:{type:s.LoadParser,priority:be.High},name:"loadKTX",test(e){return Ot(e,".ktx")},async load(e,t,n){const c=await(await i.ADAPTER.fetch(e)).arrayBuffer(),{compressed:l,uncompressed:o,kvData:d}=F5(e,c),a=l??o,r={mipmap:ke.OFF,alphaMode:se.NO_PREMULTIPLIED_ALPHA,resolution:et(e),...t.data},s=a.map(t=>{a===o&&Object.assign(r,{type:t.type,format:t.format});const i=t.resource??t,s=new m(i,r);return s.ktxKeyValueData=d,us(s,n,e)});return s.length===1?s[0]:s},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}},a.add(J6),X6=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],G6={extension:s.ResolveParser,test:e=>{const t=I.extname(e).slice(1);return["basis","ktx","dds"].includes(t)},parse:e=>{var t,n;const s=e.split("."),o=s.pop();if(["ktx","dds"].includes(o)){const n=s.pop();if(X6.includes(n))return{resolution:parseFloat(((t=i.RETINA_PREFIX.exec(e))==null?0[0]:t[1])??"1"),format:n,src:e}}return{resolution:parseFloat(((n=i.RETINA_PREFIX.exec(e))==null?0[0]:n[1])??"1"),format:o,src:e}}},a.add(G6),Ss=new g,R6=4,Ir=class In{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var t;const e=(t=this.renderer)==null?0[0]:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,n,s){const o=new Image;return o.src=await this.base64(e,t,n,s),o}async base64(e,t,n,s){const o=this.canvas(e,s);if(o.toBlob!==0[0])return new Promise((e,s)=>{o.toBlob(t=>{if(!t){s(new Error("ICanvas.toBlob failed!"));return}const n=new FileReader;n.onload=()=>e(n.result),n.onerror=s,n.readAsDataURL(t)},t,n)});if(o.toDataURL!==0[0])return o.toDataURL(t,n);if(o.convertToBlob!==0[0]){const e=await o.convertToBlob({type:t,quality:n});return new Promise((t,n)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=n,s.readAsDataURL(e)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:n,width:s,height:o,flipY:a,premultipliedAlpha:r}=this._rawPixels(e,t);a&&In._flipY(n,s,o),r&&In._unpremultiplyAlpha(n);const i=new j2(s,o,1),c=new ImageData(new Uint8ClampedArray(n.buffer),s,o);return i.context.putImageData(c,0,0),i.canvas}pixels(e,t){const{pixels:n,width:s,height:o,flipY:i,premultipliedAlpha:a}=this._rawPixels(e,t);return i&&In._flipY(n,s,o),a&&In._unpremultiplyAlpha(n),n}_rawPixels(e,t){const s=this.renderer;if(!s)throw new Error("The Extract has already been destroyed");let i,a=!1,r=!1,o,c=!1;e&&(e instanceof Tn?o=e:(o=s.generateTexture(e,{region:t,resolution:s.resolution,multisample:s.multisample}),c=!0,t&&(Ss.width=t.width,Ss.height=t.height,t=Ss)));const l=s.gl;if(o){if(i=o.baseTexture.resolution,t=t??o.frame,a=!1,r=o.baseTexture.alphaMode>0&&o.baseTexture.format===n.RGBA,!c){s.renderTexture.bind(o);const e=o.framebuffer.glFramebuffers[s.CONTEXT_UID];e.blitFramebuffer&&s.framebuffer.bind(e.blitFramebuffer)}}else i=s.resolution,t||(t=Ss,t.width=s.width/i,t.height=s.height/i),a=!0,r=this._rendererPremultipliedAlpha,s.renderTexture.bind();const d=Math.max(Math.round(t.width*i),1),u=Math.max(Math.round(t.height*i),1),h=new Uint8Array(R6*d*u);return l.readPixels(Math.round(t.x*i),Math.round(t.y*i),d,u,l.RGBA,l.UNSIGNED_BYTE,h),c&&(o==null||o.destroy(!0)),{pixels:h,width:d,height:u,flipY:a,premultipliedAlpha:r}}destroy(){this.renderer=null}static _flipY(e,t,n){const s=t<<2,i=n>>1,o=new Uint8Array(s);for(let t=0;t<i;t++){const a=t*s,r=(n-t-1)*s;o.set(e.subarray(a,a+s)),e.copyWithin(a,r,r+s),e.set(o,r)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let n=0;n<t;n+=4){const s=e[n+3];if(s!==0){const t=255.001/s;e[n]=e[n]*t+.5,e[n+1]=e[n+1]*t+.5,e[n+2]=e[n+2]*t+.5}}}},Ir.extension={name:"extract",type:s.RendererSystem},j6=Ir,a.add(j6),Ms={build(e){const t=e.points;let s,o,n,i,r,a;if(e.type===G.CIRC){const t=e.shape;s=t.x,o=t.y,r=a=t.radius,n=i=0}else if(e.type===G.ELIP){const t=e.shape;s=t.x,o=t.y,r=t.width,a=t.height,n=i=0}else{const t=e.shape,c=t.width/2,l=t.height/2;s=t.x+c,o=t.y+l,r=a=Math.max(0,Math.min(t.radius,Math.min(c,l))),n=c-r,i=l-a}if(!(r>=0&&a>=0&&n>=0&&i>=0)){t.length=0;return}const d=Math.ceil(2.3*(r+a)**.5),m=d*8+(n?4:0)+(i?4:0);if(t.length=m,m===0)return;if(d===0){t.length=8,t[0]=t[6]=s+n,t[1]=t[3]=o+i,t[2]=t[4]=s-n,t[5]=t[7]=o-i;return}let c=0,u=d*4+(n?2:0)+2,h=u,l=m;{const e=n+r,a=i,d=s+e,m=s-e,f=o+a;if(t[c++]=d,t[c++]=f,t[--u]=f,t[--u]=m,i){const e=o-a;t[h++]=m,t[h++]=e,t[--l]=e,t[--l]=d}}for(let e=1;e<d;e++){const m=Math.PI/2*(e/d),f=n+Math.cos(m)*r,p=i+Math.sin(m)*a,g=s+f,v=s-f,b=o+p,j=o-p;t[c++]=g,t[c++]=b,t[--u]=b,t[--u]=v,t[h++]=v,t[h++]=j,t[--l]=j,t[--l]=g}{const e=n,r=i+a,d=s+e,u=s-e,h=o+r,m=o-r;t[c++]=d,t[c++]=h,t[--l]=m,t[--l]=d,n&&(t[c++]=u,t[c++]=h,t[--l]=m,t[--l]=u)}},triangulate(e,t){const n=e.points,r=t.points,l=t.indices;if(n.length===0)return;let o=r.length/2;const c=o;let i,a;if(e.type!==G.RREC){const t=e.shape;i=t.x,a=t.y}else{const t=e.shape;i=t.x+t.width/2,a=t.y+t.height/2}const s=e.matrix;r.push(e.matrix?s.a*i+s.c*a+s.tx:i,e.matrix?s.b*i+s.d*a+s.ty:a),o++,r.push(n[0],n[1]);for(let e=2;e<n.length;e+=2)r.push(n[e],n[e+1]),l.push(o++,c,o);l.push(c+1,c,o)}};function p6(e,t=!1){const n=e.length;if(n<6)return;let s=0;for(let t=0,o=e[n-2],i=e[n-1];t<n;t+=2){const a=e[t],r=e[t+1];s+=(a-o)*(r+i),o=a,i=r}if(!t&&s>0||t&&s<=0){const t=n/2;for(let s=t+t%2;s<n;s+=2){const o=n-s-2,i=n-s-1,a=s,r=s+1;[e[o],e[a]]=[e[a],e[o]],[e[i],e[r]]=[e[r],e[i]]}}}Br={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let n=e.points;const o=e.holes,i=t.points,s=t.indices;if(n.length>=6){p6(n,!1);const a=[];for(let e=0;e<o.length;e++){const t=o[e];p6(t.points,!0),a.push(n.length/2),n=n.concat(t.points)}const e=M2(n,a,2);if(!e)return;const t=i.length/2;for(let n=0;n<e.length;n+=3)s.push(e[n]+t),s.push(e[n+1]+t),s.push(e[n+2]+t);for(let e=0;e<n.length;e++)i.push(n[e])}}},n6={build(e){const t=e.shape,n=t.x,s=t.y,o=t.width,i=t.height,a=e.points;a.length=0,o>=0&&i>=0&&a.push(n,s,n+o,s,n+o,s+i,n,s+i)},triangulate(e,t){const n=e.points,o=t.points;if(n.length===0)return;const s=o.length/2;o.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},If={build(e){Ms.build(e)},triangulate(e,t){Ms.triangulate(e,t)}},le=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(le||{}),at=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(at||{}),Vt={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let n=Math.ceil(e/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}},Ur=class{static curveTo(e,t,n,s,o,i){const y=i[i.length-2],a=i[i.length-1]-t,r=y-e,c=s-t,l=n-e,h=Math.abs(a*l-r*c);if(h<1e-8||o===0)return(i[i.length-2]!==e||i[i.length-1]!==t)&&i.push(e,t),null;const g=a*a+r*r,v=c*c+l*l,p=a*c+r*l,d=o*g**.5/h,u=o*v**.5/h,b=d*p/g,j=u*p/v,f=d*l+u*r,m=d*c+u*a,_=r*(u+b),w=a*(u+b),O=l*(d+j),x=c*(d+j),C=Math.atan2(w-m,_-f),E=Math.atan2(x-m,O-f);return{cx:f+e,cy:m+t,radius:o,startAngle:C,endAngle:E,anticlockwise:r*c>l*a}}static arc(e,t,n,s,o,i,a,r,c){const d=a-i,h=Vt._segmentsCount((d<0?-d:d)*o,Math.ceil((d<0?-d:d)/Fs)*40),l=d/(h*2),p=l*2,m=Math.cos(l),f=Math.sin(l),u=h-1,g=u%1/u;for(let e=0;e<=u;++e){const d=e+g*e,t=l+i+p*d,a=Math.cos(t),r=-Math.sin(t);c.push((m*a+f*r)*o+n,(m*-r+f*a)*o+s)}}},cf=class{constructor(){this.reset()}begin(e,t,n){this.reset(),this.style=e,this.start=t,this.attribStart=n}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}},rf=class _Oh{static curveLength(e,t,n,s,o,i,a,r){let b=0,c=0,d=0,m=0,l=0,u=0,h=0,f=0,p=0,g=0,v=0,j=e,y=t;for(let _=1;_<=10;++_)c=_/10,d=c*c,m=d*c,l=1-c,u=l*l,h=u*l,f=h*e+3*u*c*n+3*l*d*o+m*a,p=h*t+3*u*c*s+3*l*d*i+m*r,g=j-f,v=y-p,j=f,y=p,b+=(g*g+v*v)**.5;return b}static curveTo(e,t,n,s,o,i,a){const d=a[a.length-2],u=a[a.length-1];a.length-=2;const f=Vt._segmentsCount(_Oh.curveLength(d,u,e,t,n,s,o,i));let r=0,c=0,h=0,l=0,m=0;a.push(d,u);for(let g=1,p=0;g<=f;++g)p=g/f,r=1-p,c=r*r,h=c*r,l=p*p,m=l*p,a.push(h*d+3*c*p*e+3*r*l*n+m*o,h*u+3*c*p*t+3*r*l*s+m*i)}};function af(e,t,n,s,o,i,a,r){const d=e-n*o,u=t-s*o,h=e+n*i,m=t+s*i;let c,l;a?(c=s,l=-n):(c=-s,l=n);const f=d+c,p=u+l,g=h+c,v=m+l;return r.push(f,p,g,v),2}function Jt(e,t,n,s,o,i,a,r){const h=n-e,m=s-t;let c=Math.atan2(h,m),d=Math.atan2(o-e,i-t);r&&c<d?c+=Math.PI*2:!r&&c>d&&(d+=Math.PI*2);let f=c;const g=d-c,v=g<0?-g:g,l=(h*h+m*m)**.5,u=(15*v*l**.5/Math.PI>>0)+1,p=g/u;if(f+=p,r){a.push(e,t,n,s);for(let s=1,n=f;s<u;s++,n+=p)a.push(e,t,e+Math.sin(n)*l,t+Math.cos(n)*l);a.push(e,t,o,i)}else{a.push(n,s,e,t);for(let s=1,n=f;s<u;s++,n+=p)a.push(e+Math.sin(n)*l,t+Math.cos(n)*l,e,t);a.push(o,i,e,t)}return u*2}function Xp(e,t){const x=e.shape;let c=e.points||x.points.slice();const A=t.closePointEps;if(c.length===0)return;const v=e.lineStyle,O=new y(c[0],c[1]),w=new y(c[c.length-2],c[c.length-1]),C=x.type!==G.POLY||x.closeStroke,M=Math.abs(O.x-w.x)<A&&Math.abs(O.y-w.y)<A;if(C){c=c.slice(),M&&(c.pop(),c.pop(),w.set(c[c.length-2],c[c.length-1]));const e=(O.x+w.x)*.5,t=(w.y+O.y)*.5;c.unshift(e,t),c.push(e,t)}const l=t.points,_=c.length/2;let f=c.length;const k=l.length/2,g=v.width/2,E=g*g,F=v.miterLimit*v.miterLimit;let m=c[0],h=c[1],s=c[2],n=c[3],j=0,b=0,i=-(h-n),a=m-s,d=0,u=0,p=(i*i+a*a)**.5;i/=p,a/=p,i*=g,a*=g;const S=v.alignment,o=(1-S)*2,r=S*2;C||(v.cap===at.ROUND?f+=Jt(m-i*(o-r)*.5,h-a*(o-r)*.5,m-i*o,h-a*o,m+i*r,h+a*r,l,!0)+2:v.cap===at.SQUARE&&(f+=af(m,h,i,a,o,r,!0,l))),l.push(m-i*o,h-a*o,m+i*r,h+a*r);for(let e=1;e<_-1;++e){m=c[(e-1)*2],h=c[(e-1)*2+1],s=c[e*2],n=c[e*2+1],j=c[(e+1)*2],b=c[(e+1)*2+1],i=-(h-n),a=m-s,p=(i*i+a*a)**.5,i/=p,a/=p,i*=g,a*=g,d=-(n-b),u=s-j,p=(d*d+u*u)**.5,d/=p,u/=p,d*=g,u*=g;const x=s-m,C=h-n,k=s-j,A=b-n,P=x*k+C*A,z=C*k-A*x,S=z<0;if((z<0?-z:z)<.001*(P<0?-P:P)){l.push(s-i*o,n-a*o,s+i*r,n+a*r),P>=0&&(v.join===le.ROUND?f+=Jt(s,n,s-i*o,n-a*o,s-d*o,n-u*o,l,!1)+4:f+=2,l.push(s-d*r,n-u*r,s+d*o,n+u*o));continue}const R=(-i+m)*(-a+n)-(-i+s)*(-a+h),L=(-d+j)*(-u+n)-(-d+s)*(-u+b),M=(x*L-k*R)/z,T=(A*R-C*L)/z,N=(M-s)*(M-s)+(T-n)*(T-n),O=s+(M-s)*o,w=n+(T-n)*o,y=s-(M-s)*r,t=n-(T-n)*r,I=Math.min(x*x+C*C,k*k+A*A),H=S?o:r,B=I+H*H*E,V=N<=B;let D=v.join;if(D===le.MITER&&N/E>F&&(D=le.BEVEL),V)switch(D){case le.MITER:{l.push(O,w,y,t);break}case le.BEVEL:{S?l.push(O,w,s+i*r,n+a*r,O,w,s+d*r,n+u*r):l.push(s-i*o,n-a*o,y,t,s-d*o,n-u*o,y,t),f+=2;break}case le.ROUND:{S?(l.push(O,w,s+i*r,n+a*r),f+=Jt(s,n,s+i*r,n+a*r,s+d*r,n+u*r,l,!0)+4,l.push(O,w,s+d*r,n+u*r)):(l.push(s-i*o,n-a*o,y,t),f+=Jt(s,n,s-i*o,n-a*o,s-d*o,n-u*o,l,!1)+4,l.push(s-d*o,n-u*o,y,t));break}}else{switch(l.push(s-i*o,n-a*o,s+i*r,n+a*r),D){case le.MITER:{S?l.push(y,t,y,t):l.push(O,w,O,w),f+=2;break}case le.ROUND:{S?f+=Jt(s,n,s+i*r,n+a*r,s+d*r,n+u*r,l,!0)+2:f+=Jt(s,n,s-i*o,n-a*o,s-d*o,n-u*o,l,!1)+2;break}}l.push(s-d*o,n-u*o,s+d*r,n+u*r),f+=2}}m=c[(_-2)*2],h=c[(_-2)*2+1],s=c[(_-1)*2],n=c[(_-1)*2+1],i=-(h-n),a=m-s,p=(i*i+a*a)**.5,i/=p,a/=p,i*=g,a*=g,l.push(s-i*o,n-a*o,s+i*r,n+a*r),C||(v.cap===at.ROUND?f+=Jt(s-i*(o-r)*.5,n-a*(o-r)*.5,s-i*o,n-a*o,s+i*r,n+a*r,l,!1)+2:v.cap===at.SQUARE&&(f+=af(s,n,i,a,o,r,!1,l)));const T=t.indices,z=Vt.epsilon*Vt.epsilon;for(let e=k;e<f+k-2;++e)m=l[e*2],h=l[e*2+1],s=l[(e+1)*2],n=l[(e+1)*2+1],j=l[(e+2)*2],b=l[(e+2)*2+1],!(Math.abs(m*(n-b)+s*(b-h)+j*(h-n))<z)&&T.push(e,e+1,e+2)}function Qp(e,t){let s=0;const i=e.shape,n=e.points||i.points,l=i.type!==G.POLY||i.closeStroke;if(n.length===0)return;const a=t.points,r=t.indices,d=n.length/2,c=a.length/2;let o=c;for(a.push(n[0],n[1]),s=1;s<d;s++)a.push(n[s*2],n[s*2+1]),r.push(o,o+1),o++;l&&r.push(o,c)}function nf(e,t){e.lineStyle.native?Qp(e,t):Xp(e,t)}ef=class _Lh{static curveLength(e,t,n,s,o,i){const l=e-2*n+o,d=t-2*s+i,u=2*n-2*e,h=2*s-2*t,r=4*(l*l+d*d),a=4*(l*u+d*h),m=u*u+h*h,f=2*(r+a+m)**.5,c=r**.5,p=2*r*c,g=2*m**.5,v=a/c;return(p*f+c*a*(f-g)+(4*m*r-a*a)*Math.log((2*c+v+f)/(v+g)))/(4*p)}static curveTo(e,t,n,s,o){const i=o[o.length-2],a=o[o.length-1],l=Vt._segmentsCount(_Lh.curveLength(i,a,e,t,n,s));let r=0,c=0;for(let u=1;u<=l;++u){const d=u/l;r=i+(e-i)*d,c=a+(t-a)*d,o.push(r+(e+(n-e)*d-r)*d,c+(t+(s-t)*d-c)*d)}}},ka={[G.POLY]:Br,[G.CIRC]:Ms,[G.ELIP]:Ms,[G.RECT]:n6,[G.RREC]:If},Jr=[],Rs=[],rc=class __o{constructor(e,t=null,n=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=n,this.fillStyle=t,this.matrix=s,this.type=e.type}clone(){return new __o(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}},Gt=new y,cc=class Mm extends qr{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Os,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Rs.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Jr.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,n=null,s=null){const o=new rc(e,t,n,s);return this.graphicsData.push(o),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const n=new rc(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=s.lineStyle,s.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let s=0;s<t.length;++s){const n=t[s];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,Gt):Gt.copyFrom(e),n.shape.contains(Gt.x,Gt.y))){let e=!1;if(n.holes)for(let t=0;t<n.holes.length;t++)if(n.holes[t].shape.contains(Gt.x,Gt.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,n=this.graphicsData;let e=null,t=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],t=e.style);for(let o=this.shapeIndex;o<n.length;o++){this.shapeIndex++;const s=n[o],a=s.fillStyle,r=s.lineStyle;ka[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix),(a.visible||r.visible)&&this.processHoles(s.holes);for(let o=0;o<2;o++){const n=o===0?a:r;if(!n.visible)continue;const u=n.texture.baseTexture,l=this.indices.length,c=this.points.length/2;u.wrapMode=Ye.REPEAT,o===0?this.processFill(s):this.processLine(s);const d=this.points.length/2-c;d!==0&&(e&&!this._compareStyles(t,n)&&(e.end(l,c),e=null),e||(e=Jr.pop()||new cf,e.begin(n,l,c),this.batches.push(e),t=n),this.addUvs(this.points,i,n.texture,c,d,n.matrix))}}const a=this.indices.length,s=this.points.length/2;if(e&&e.end(a,s),this.batches.length===0){this.batchable=!0;return}const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,o=this.graphicsData.length;e<o;e++){const t=this.graphicsData[e],n=t.fillStyle,s=t.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,s=e.length;t<s;t++){const n=e[t];for(let e=0;e<n.size;e++){const t=n.start+e;this.indicesUint16[t]=this.indicesUint16[t]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<Mm.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++m._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Rs.push(this.drawCalls[e]);this.drawCalls.length=0;const c=this.colors,l=this.textureIds;let e=Rs.pop();e||(e=new Ea,e.texArray=new Yi),e.texArray.count=0,e.start=0,e.size=0,e.type=Ce.TRIANGLES;let n=0,s=null,i=0,o=!1,a=Ce.TRIANGLES,r=0;this.drawCalls.push(e);for(let m=0;m<this.batches.length;m++){const u=this.batches[m],f=8,h=u.style,d=h.texture.baseTexture;o!==!!h.native&&(o=!!h.native,a=o?Ce.LINES:Ce.TRIANGLES,s=null,n=f,t++),s!==d&&(s=d,d._batchEnabled!==t&&(n===f&&(t++,n=0,e.size>0&&(e=Rs.pop(),e||(e=new Ea,e.texArray=new Yi),this.drawCalls.push(e)),e.start=r,e.size=0,e.texArray.count=0,e.type=a),d.touched=1,d._batchEnabled=t,d._batchLocation=n,d.wrapMode=Ye.REPEAT,e.texArray.elements[e.texArray.count++]=d,n++)),e.size+=u.size,r+=u.size,i=d._batchLocation,this.addColors(c,h.color,h.alpha,u.attribSize,u.attribStart),this.addTextureIds(l,i,u.attribSize,u.attribStart)}m._globalBatch=t,this.packAttributes()}packAttributes(){const n=this.points,o=this.uvs,i=this.colors,a=this.textureIds,s=new ArrayBuffer(n.length*3*4),t=new Float32Array(s),r=new Uint32Array(s);let e=0;for(let s=0;s<n.length/2;s++)t[e++]=n[s*2],t[e++]=n[s*2+1],t[e++]=o[s*2],t[e++]=o[s*2+1],r[e++]=i[s],t[e++]=a[s];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Br.triangulate(e,this):ka[e.type].triangulate(e,this)}processLine(e){nf(e,this);for(let t=0;t<e.holes.length;t++)nf(e.holes[t],this)}processHoles(e){for(let n=0;n<e.length;n++){const t=e[n];ka[t.type].build(t),t.matrix&&this.transformPoints(t.points,t.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let n=0;n<e.length/2;n++){const s=e[n*2],o=e[n*2+1];e[n*2]=t.a*s+t.c*o+t.tx,e[n*2+1]=t.b*s+t.d*o+t.ty}}addColors(e,t,n,s,o=0){const i=O.shared.setValue(t).toLittleEndianNumber(),a=O.shared.setValue(i).toPremultiplied(n);e.length=Math.max(e.length,o+s);for(let t=0;t<s;t++)e[o+t]=a}addTextureIds(e,t,n,s=0){e.length=Math.max(e.length,s+n);for(let o=0;o<n;o++)e[s+o]=t}addUvs(e,t,n,s,o,i=null){let a=0;const l=t.length,r=n.frame;for(;a<o;){let n=e[(s+a)*2],c=e[(s+a)*2+1];if(i){const e=i.a*n+i.c*c+i.tx;c=i.b*n+i.d*c+i.ty,n=e}a++,t.push(n/r.width,c/r.height)}const c=n.baseTexture;(r.width<c.width||r.height<c.height)&&this.adjustUvs(t,n,l,o)}adjustUvs(e,t,n,s){const c=t.baseTexture,i=1e-6,l=n+s*2,o=t.frame,h=o.width/c.width,m=o.height/c.height;let d=o.x/o.width,u=o.y/o.height,a=Math.floor(e[n]+i),r=Math.floor(e[n+1]+i);for(let t=n+2;t<l;t+=2)a=Math.min(a,Math.floor(e[t]+i)),r=Math.min(r,Math.floor(e[t+1]+i));d-=a,u-=r;for(let t=n;t<l;t+=2)e[t]=(e[t]+d)*h,e[t+1]=(e[t+1]+u)*m}},cc.BATCHABLE_SIZE=100,b8=cc,bc=class _No{constructor(){this.color=16777215,this.alpha=1,this.texture=b.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new _No;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=b.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}},h8=class _Nh extends bc{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=at.BUTT,this.join=le.MITER,this.miterLimit=10}clone(){const e=new _Nh;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=at.BUTT,this.join=le.MITER,this.miterLimit=10}},sa={},ta=class zs extends ge{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new bc,this._lineStyle=new h8,this._matrix=null,this._holeMode=!1,this.state=ut.for2d(),this._geometry=e||new b8,this._geometry.refCount++,this._transformID=-1,this._tintColor=new O(16777215),this.blendMode=d.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new zs(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,n,s=.5,o=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:n,alignment:s,native:o}),this.lineTextureStyle(e)}lineTextureStyle(e){const n={width:0,texture:b.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:at.BUTT,join:le.MITER,miterLimit:10};e=Object.assign(n,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Un,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Un,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,s=n[n.length-2],o=n[n.length-1];return(s!==e||o!==t)&&n.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,n,s){this._initCurve();const o=this.currentPath.points;return o.length===0&&this.moveTo(0,0),ef.curveTo(e,t,n,s,o),this}bezierCurveTo(e,t,n,s,o,i){return this._initCurve(),rf.curveTo(e,t,n,s,o,i,this.currentPath.points),this}arcTo(e,t,n,s,o){this._initCurve(e,t);const a=this.currentPath.points,i=Ur.curveTo(e,t,n,s,o,a);if(i){const{cx:e,cy:t,radius:n,startAngle:s,endAngle:o,anticlockwise:a}=i;this.arc(e,t,n,s,o,a)}return this}arc(e,t,n,s,o,i=!1){if(s===o)return this;if(!i&&o<=s?o+=Fs:i&&s<=o&&(s+=Fs),o-s===0)return this;const r=e+Math.cos(s)*n,c=t+Math.sin(s)*n,l=this._geometry.closePointEps;let a=this.currentPath?this.currentPath.points:null;if(a){const e=Math.abs(a[a.length-2]-r),t=Math.abs(a[a.length-1]-c);e<l&&t<l||a.push(r,c)}else this.moveTo(r,c),a=this.currentPath.points;return Ur.arc(r,c,e,t,n,s,o,i,a),this}beginFill(e=0,t){return this.beginTextureFill({texture:b.WHITE,color:e,alpha:t})}normalizeColor(e){const t=O.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const n={texture:b.WHITE,color:16777215,matrix:null};e=Object.assign(n,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,n,s){return this.drawShape(new g(e,t,n,s))}drawRoundedRect(e,t,n,s,o){return this.drawShape(new Ya(e,t,n,s,o))}drawCircle(e,t,n){return this.drawShape(new vr(e,t,n))}drawEllipse(e,t,n,s){return this.drawShape(new Xa(e,t,n,s))}drawPolygon(...e){let t,s=!0;const n=e[0];n.points?(s=n.closeStroke,t=n.points):Array.isArray(e[0])?t=e[0]:t=e;const o=new Un(t);return o.closeStroke=s,this.drawShape(o),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===G.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,n=this.blendMode,t=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=t,this.vertexData=new Float32Array(e.points);for(let o=0;o<t;o++){const s=e.batches[o],i=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),r=new Float32Array(e.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),c=new Uint16Array(e.indicesUint16.buffer,s.start*2,s.size),l={vertexData:a,blendMode:n,indices:c,uvs:r,_batchRGB:O.shared.setValue(i).toRgbArray(),_tintRGB:i,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[o]=l}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,s=this.batches.length;t<s;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}}_renderDirect(e){const t=this._resolveDirectShader(e),n=this._geometry,o=this.worldAlpha,s=t.uniforms,i=n.drawCalls;s.translationMatrix=this.transform.worldTransform,O.shared.setValue(this._tintColor).premultiply(o).toArray(s.tint),e.shader.bind(t),e.geometry.bind(n,t),e.state.set(this.state);for(let t=0,s=i.length;t<s;t++)this._renderDrawCallDirect(e,n.drawCalls[t])}_renderDrawCallDirect(e,t){const{texArray:n,type:s,size:o,start:i}=t,a=n.count;for(let t=0;t<a;t++)e.texture.bind(n.elements[t],t);e.geometry.draw(s,o,i)}_resolveDirectShader(e){let n=this.shader;const t=this.pluginName;if(!n){if(!sa[t]){const{maxTextures:n}=e.plugins[t],s=new Int32Array(n);for(let e=0;e<n;e++)s[e]=e;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new z,default:mt.from({uSamplers:s},!0)},i=e.plugins[t]._shader.program;sa[t]=new Qe(i,o)}n=sa[t]}return n}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:n,maxX:s,maxY:o}=e.bounds;this._bounds.addFrame(this.transform,t,n,s,o)}containsPoint(e){return this.worldTransform.applyInverse(e,zs._TEMP_POINT),this._geometry.containsPoint(zs._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=O.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const n=this.transform._worldID;if(this._transformID===n)return;this._transformID=n;const e=this.transform.worldTransform,i=e.a,a=e.b,r=e.c,c=e.d,l=e.tx,d=e.ty,t=this._geometry.points,s=this.vertexData;let o=0;for(let e=0;e<t.length;e+=2){const n=t[e],u=t[e+1];s[o++]=i*n+r*u+l,s[o++]=c*u+a*n+d}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}},ta.curves=Vt,ta._TEMP_POINT=new y,qn=ta,$m=class{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}},ea=new y,Nc=new Un,Rc=class Bm extends ge{constructor(e,t,n,s=Ce.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=n||ut.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=i.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Ce.TRIANGLES&&t.length<Bm.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const s=this.geometry,t=this.shader;t.uvMatrix&&(t.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=s.indexBuffer.data,this._tintRGB=t._tintRGB,this._texture=t.texture;const n=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[n]),e.plugins[n].render(this)}calculateVertices(){const s=this.geometry.buffers[0],n=s.data,o=s._updateID;if(o===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==n.length&&(this.vertexData=new Float32Array(n.length));const e=this.transform.worldTransform,a=e.a,r=e.b,c=e.c,l=e.d,d=e.tx,u=e.ty,t=this.vertexData;for(let e=0;e<t.length/2;e++){const s=n[e*2],o=n[e*2+1];t[e*2]=a*s+c*o+d,t[e*2+1]=r*s+l*o+u}if(this._roundPixels){const e=i.RESOLUTION;for(let n=0;n<t.length;++n)t[n]=Math.round(t[n]*e)/e}this.vertexDirty=o}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new $m(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,ea);const t=this.geometry.getBuffer("aVertexPosition").data,n=Nc.points,s=this.geometry.getIndex().data,o=s.length,i=this.drawMode===4?3:1;for(let e=0;e+2<o;e+=i){const a=s[e]*2,r=s[e+1]*2,c=s[e+2]*2;if(n[0]=t[a],n[1]=t[a+1],n[2]=t[r],n[3]=t[r+1],n[4]=t[c],n[5]=t[c+1],Nc.contains(ea.x,ea.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}},Rc.BATCHABLE_SIZE=100,Pc=Rc,Cm=class extends Gn{constructor(e,t,n){super();const s=new P(e),o=new P(t,!0),i=new P(n,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,c.FLOAT).addAttribute("aTextureCoord",o,2,!1,c.FLOAT).addIndex(i),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}},Om=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,wm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,Hc=class extends Qe{constructor(e,t){const n={uSampler:e,alpha:1,uTextureMatrix:z.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(n,t.uniforms),super(t.program||$e.from(wm,Om),n),this._colorDirty=!1,this.uvMatrix=new sc(e),this.batchable=t.program===0[0],this.pluginName=t.pluginName,this._tintColor=new O(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;O.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}},Ic=class{constructor(e,t,n){this.geometry=new Gn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let n=e[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||c.FLOAT,offset:n.offset},t[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new P(l7(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){const n=this.dynamicProperties[e];n.offset=t,t+=n.size,this.dynamicStride+=n.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new P(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){const t=this.staticProperties[e];t.offset=s,s+=t.size,this.staticStride+=t.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new P(this.staticData,!0,!1);for(let n=0;n<this.dynamicProperties.length;++n){const t=this.dynamicProperties[n];e.addAttribute(t.attributeName,this.dynamicBuffer,0,t.type===c.UNSIGNED_BYTE,t.type,this.dynamicStride*4,t.offset*4)}for(let n=0;n<this.staticProperties.length;++n){const t=this.staticProperties[n];e.addAttribute(t.attributeName,this.staticBuffer,0,t.type===c.UNSIGNED_BYTE,t.type,this.staticStride*4,t.offset*4)}}uploadDynamic(e,t,n){for(let s=0;s<this.dynamicProperties.length;s++){const o=this.dynamicProperties[s];o.uploadFunction(e,t,n,o.type===c.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,n){for(let s=0;s<this.staticProperties.length;s++){const o=this.staticProperties[s];o.uploadFunction(e,t,n,o.type===c.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}},_m=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,Bc=class extends qs{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new z,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:c.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Qe.from(vm,_m,{}),this.state=ut.for2d()}render(e){const s=e.children,c=e._maxSize,i=e._batchSize,o=this.renderer;let t=s.length;if(t===0)return;t>c&&!e.autoResize&&(t=c);let n=e._buffers;n||(n=e._buffers=this.generateBuffers(e));const l=s[0]._texture.baseTexture,d=l.alphaMode>0;this.state.blendMode=o2(e.blendMode,d),o.state.set(this.state);const a=o.gl,u=e.worldTransform.copyTo(this.tempMatrix);u.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=O.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,d).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let r=!1;for(let c=0,u=0;c<t;c+=i,u+=1){let l=t-c;l>i&&(l=i),u>=n.length&&n.push(this._generateOneMoreBuffer(e));const d=n[u];d.uploadDynamic(s,c,l);const h=e._bufferUpdateIDs[u]||0;r=r||d._updateID<h,r&&(d._updateID=e._updateID,d.uploadStatic(s,c,l)),o.geometry.bind(d.geometry),a.drawElements(a.TRIANGLES,l*6,a.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],s=e._maxSize,n=e._batchSize,o=e._properties;for(let e=0;e<s;e+=n)t.push(new Ic(this.properties,o,n));return t}_generateOneMoreBuffer(e){const t=e._batchSize,n=e._properties;return new Ic(this.properties,n,t)}uploadVertices(e,t,n,s,o,i){let c=0,a=0,l=0,r=0;for(let p=0;p<n;++p){const d=e[t+p],g=d._texture,m=d.scale.x,f=d.scale.y,h=g.trim,u=g.orig;h?(a=h.x-d.anchor.x*u.width,c=a+h.width,r=h.y-d.anchor.y*u.height,l=r+h.height):(c=u.width*(1-d.anchor.x),a=u.width*-d.anchor.x,l=u.height*(1-d.anchor.y),r=u.height*-d.anchor.y),s[i]=a*m,s[i+1]=r*f,s[i+o]=c*m,s[i+o+1]=r*f,s[i+o*2]=c*m,s[i+o*2+1]=l*f,s[i+o*3]=a*m,s[i+o*3+1]=l*f,i+=o*4}}uploadPosition(e,t,n,s,o,i){for(let r=0;r<n;r++){const a=e[t+r].position;s[i]=a.x,s[i+1]=a.y,s[i+o]=a.x,s[i+o+1]=a.y,s[i+o*2]=a.x,s[i+o*2+1]=a.y,s[i+o*3]=a.x,s[i+o*3+1]=a.y,i+=o*4}}uploadRotation(e,t,n,s,o,i){for(let r=0;r<n;r++){const a=e[t+r].rotation;s[i]=a,s[i+o]=a,s[i+o*2]=a,s[i+o*3]=a,i+=o*4}}uploadUvs(e,t,n,s,o,i){for(let r=0;r<n;++r){const a=e[t+r]._texture._uvs;a?(s[i]=a.x0,s[i+1]=a.y0,s[i+o]=a.x1,s[i+o+1]=a.y1,s[i+o*2]=a.x2,s[i+o*2+1]=a.y2,s[i+o*3]=a.x3,s[i+o*3+1]=a.y3,i+=o*4):(s[i]=0,s[i+1]=0,s[i+o]=0,s[i+o+1]=0,s[i+o*2]=0,s[i+o*2+1]=0,s[i+o*3]=0,s[i+o*3+1]=0,i+=o*4)}}uploadTint(e,t,n,s,o,i){for(let r=0;r<n;++r){const c=e[t+r],a=O.shared.setValue(c._tintRGB).toPremultiplied(c.alpha,c.texture.baseTexture.alphaMode>0);s[i]=a,s[i+o]=a,s[i+o*2]=a,s[i+o*3]=a,i+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}},Bc.extension={name:"particle",type:s.RendererPlugin},a.add(Bc),to=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(to||{}),ao={willReadFrequently:!0},xe=class dt{static get experimentalLetterSpacingSupported(){let e=dt._experimentalLetterSpacingSupported;if(e!==0[0]){const t=i.ADAPTER.getCanvasRenderingContext2D().prototype;e=dt._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,n,s,o,i,a,r,c){this.text=e,this.style=t,this.width=n,this.height=s,this.lines=o,this.lineWidths=i,this.lineHeight=a,this.maxLineWidth=r,this.fontProperties=c}static measureText(e,t,n,s=dt._canvas){n=n??t.wordWrap;const c=t.toFontString(),o=dt.measureFont(c);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const l=s.getContext("2d",ao);l.font=c;const i=(n?dt.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),d=new Array(i.length);let a=0;for(let e=0;e<i.length;e++){const n=dt._measureText(i[e],t.letterSpacing,l);d[e]=n,a=Math.max(a,n)}let u=a+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const r=t.lineHeight||o.fontSize+t.strokeThickness;let h=Math.max(r,o.fontSize+t.strokeThickness*2)+t.leading+(i.length-1)*(r+t.leading);return t.dropShadow&&(h+=t.dropShadowDistance),new dt(e,t,u,h,i,d,r+t.leading,a,o)}static _measureText(e,t,n){let o=!1;dt.experimentalLetterSpacingSupported&&(dt.experimentalLetterSpacing?(n.letterSpacing=`${t}px`,n.textLetterSpacing=`${t}px`,o=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let s=n.measureText(e).width;return s>0&&(o?s-=t:s+=(dt.graphemeSegmenter(e).length-1)*t),s}static wordWrap(e,t,n=dt._canvas){const u=n.getContext("2d",ao);let o=0,s="",i="";const h=Object.create(null),{letterSpacing:r,whiteSpace:m}=t,c=dt.collapseSpaces(m),f=dt.collapseNewlines(m);let a=!c;const l=t.wordWrapWidth+r,d=dt.tokenize(e);for(let n=0;n<d.length;n++){let e=d[n];if(dt.isNewline(e)){if(!f){i+=dt.addLine(s),a=!c,s="",o=0;continue}e=" "}if(c){const t=dt.isBreakingSpace(e),n=dt.isBreakingSpace(s[s.length-1]);if(t&&n)continue}const m=dt.getFromCache(e,r,h,u);if(m>l)if(s!==""&&(i+=dt.addLine(s),s="",o=0),dt.canBreakWords(e,t.breakWords)){const n=dt.wordWrapSplit(e);for(let c=0;c<n.length;c++){let d=n[c],f=d,m=1;for(;n[c+m];){const s=n[c+m];if(dt.canBreakChars(f,s,e,c,t.breakWords))break;d+=s,f=s,m++}c+=m-1;const p=dt.getFromCache(d,r,h,u);p+o>l&&(i+=dt.addLine(s),a=!1,s="",o=0),s+=d,o+=p}}else{s.length>0&&(i+=dt.addLine(s),s="",o=0);const t=n===d.length-1;i+=dt.addLine(e,!t),a=!1,s="",o=0}else m+o>l&&(a=!1,i+=dt.addLine(s),s="",o=0),(s.length>0||!dt.isBreakingSpace(e)||a)&&(s+=e,o+=m)}return i+=dt.addLine(s,!1),i}static addLine(e,t=!0){return e=dt.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,n,s){let o=n[e];return typeof o!="number"&&(o=dt._measureText(e,t,s)+t,n[e]=o),o}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const n=e[t];if(!dt.isBreakingSpace(n))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e=="string"&&dt._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e){return typeof e=="string"&&dt._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const n=[];let t="";if(typeof e!="string")return n;for(let s=0;s<e.length;s++){const o=e[s],i=e[s+1];if(dt.isBreakingSpace(o,i)||dt.isNewline(o)){t!==""&&(n.push(t),t=""),n.push(o);continue}t+=o}return t!==""&&n.push(t),n}static canBreakWords(e,t){return t}static canBreakChars(){return!0}static wordWrapSplit(e){return dt.graphemeSegmenter(e)}static measureFont(e){if(dt._fonts[e])return dt._fonts[e];const n={ascent:0,descent:0,fontSize:0},h=dt._canvas,t=dt._context;t.font=e;const u=dt.METRICS_STRING+dt.BASELINE_SYMBOL,a=Math.ceil(t.measureText(u).width);let s=Math.ceil(t.measureText(dt.BASELINE_SYMBOL).width);const r=Math.ceil(dt.HEIGHT_MULTIPLIER*s);if(s=s*dt.BASELINE_MULTIPLIER|0,a===0||r===0)return dt._fonts[e]=n,n;h.width=a,h.height=r,t.fillStyle="#f00",t.fillRect(0,0,a,r),t.font=e,t.textBaseline="alphabetic",t.fillStyle="#000",t.fillText(u,0,s);const d=t.getImageData(0,0,a,r).data,m=d.length,i=a*4;let o=0,c=0,l=!1;for(o=0;o<s;++o){for(let e=0;e<i;e+=4)if(d[c+e]!==255){l=!0;break}if(l)break;c+=i}for(n.ascent=s-o,c=m-i,l=!1,o=r;o>s;--o){for(let e=0;e<i;e+=4)if(d[c+e]!==255){l=!0;break}if(l)break;c-=i}return n.descent=o-s,n.fontSize=n.ascent+n.descent,dt._fonts[e]=n,n}static clearMetrics(e=""){e?delete dt._fonts[e]:dt._fonts={}}static get _canvas(){var e;if(!dt.__canvas){let t;try{const n=new OffscreenCanvas(0,0);if((e=n.getContext("2d",ao))!=null&&e.measureText)return dt.__canvas=n,n;t=i.ADAPTER.createCanvas()}catch{t=i.ADAPTER.createCanvas()}t.width=t.height=10,dt.__canvas=t}return dt.__canvas}static get _context(){return dt.__context||(dt.__context=dt._canvas.getContext("2d",ao)),dt.__context}},xe.METRICS_STRING="|\xC9q\xC5",xe.BASELINE_SYMBOL="M",xe.BASELINE_MULTIPLIER=1.4,xe.HEIGHT_MULTIPLIER=2,xe.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(e=>e.segment)}return e=>[...e]})(),xe.experimentalLetterSpacing=!1,xe._fonts={},xe._newlines=[10,13],xe._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],lt=xe,am=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],pl=class Pn{constructor(e){this.styleID=0,this.reset(),bl(this,e,e)}clone(){const e={};return bl(e,this,Pn.defaultStyle),new Pn(e)}reset(){bl(this,Pn.defaultStyle,Pn.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=gl(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=gl(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){zg(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=gl(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let t=e[n].trim();!/(["'])[^'"]+\1/.test(t)&&!am.includes(t)&&(t=`"${t}"`),e[n]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}},pl.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:to.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100},rt=pl;function gl(e){const n=O.shared,t=e=>{const t=n.setValue(e);return t.alpha===1?t.toHex():t.toRgbaString()};return Array.isArray(e)?e.map(t):t(e)}function zg(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}function bl(e,t,n){for(const s in n)Array.isArray(t[s])?e[s]=t[s].slice():e[s]=t[s]}qh={texture:!0,children:!1,baseTexture:!0},wl=class nh extends bs{constructor(e,t,n){let o=!1;n||(n=i.ADAPTER.createCanvas(),o=!0),n.width=3,n.height=3;const s=b.from(n);s.orig=new g,s.trim=new g,super(s),this._ownCanvas=o,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=nh.defaultResolution??i.RESOLUTION,this._autoResolution=nh.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return lt.experimentalLetterSpacing}static set experimentalLetterSpacing(e){v("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),lt.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const n=this.context,s=lt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),h=s.width,u=s.height,i=s.lines,r=s.lineHeight,l=s.lineWidths,d=s.maxLineWidth,a=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,h)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,u)+t.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=t.strokeThickness,n.textBaseline=t.textBaseline,n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit;let o,c;const m=t.dropShadow?2:1;for(let e=0;e<m;++e){const f=t.dropShadow&&e===0,h=f?Math.ceil(Math.max(1,u)+t.padding*2):0,g=h*this._resolution;if(f){n.fillStyle="black",n.strokeStyle="black";const s=t.dropShadowColor,o=t.dropShadowBlur*this._resolution,e=t.dropShadowDistance*this._resolution;n.shadowColor=O.shared.setValue(s).setAlpha(t.dropShadowAlpha).toRgbaString(),n.shadowBlur=o,n.shadowOffsetX=Math.cos(t.dropShadowAngle)*e,n.shadowOffsetY=Math.sin(t.dropShadowAngle)*e+g}else n.fillStyle=this._generateFillStyle(t,i,s),n.strokeStyle=t.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let p=(r-a.fontSize)/2;r-a.fontSize<0&&(p=0);for(let e=0;e<i.length;e++)o=t.strokeThickness/2,c=t.strokeThickness/2+e*r+a.ascent+p,t.align==="right"?o+=d-l[e]:t.align==="center"&&(o+=(d-l[e])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(i[e],o+t.padding,c+t.padding-h,!0),t.fill&&this.drawLetterSpacing(i[e],o+t.padding,c+t.padding-h)}this.updateTexture()}drawLetterSpacing(e,t,n,s=!1){const o=this._style.letterSpacing;let c=!1;if(lt.experimentalLetterSpacingSupported&&(lt.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,c=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||c){s?this.context.strokeText(e,t,n):this.context.fillText(e,t,n);return}let a=t;const i=lt.graphemeSegmenter(e);let l=this.context.measureText(e).width,r=0;for(let e=0;e<i.length;++e){const t=i[e];s?this.context.strokeText(t,a,n):this.context.fillText(t,a,n);let c="";for(let t=e+1;t<i.length;++t)c+=i[t];r=this.context.measureText(c).width,a+=l-r+o,l=r}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=n7(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,s=this._style,n=s.trim?0:s.padding,o=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,n){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let r;const d=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,l=this.canvas.width/this._resolution-d-a*2,c=this.canvas.height/this._resolution-d-a*2,s=o.slice(),i=e.fillGradientStops.slice();if(!i.length){const e=s.length+1;for(let t=1;t<e;++t)i.push(t/e)}if(s.unshift(o[0]),i.unshift(0),s.push(o[o.length-1]),i.push(1),e.fillGradientType===to.LINEAR_VERTICAL){r=this.context.createLinearGradient(l/2,a,l/2,c+a);const o=n.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){const u=n.lineHeight*(e-1)+o,a=n.lineHeight*e;let l=a;e>0&&u>a&&(l=(a+u)/2);const d=a+o,h=n.lineHeight*(e+1);let m=d;e+1<t.length&&h<d&&(m=(d+h)/2);const f=(m-l)/c;for(let e=0;e<s.length;e++){let t=0;typeof i[e]=="number"?t=i[e]:t=e/s.length;let n=Math.min(1,Math.max(0,l/c+t*f));n=Number(n.toFixed(5)),r.addColorStop(n,s[e])}}}else{r=this.context.createLinearGradient(a,c/2,l+a,c/2);const t=s.length+1;let e=1;for(let n=0;n<s.length;n++){let o;typeof i[n]=="number"?o=i[n]:o=e/t,r.addColorStop(o,s[n]),e++}}return r}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},qh,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Tt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Tt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof rt?this._style=e:this._style=new rt(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}},wl.defaultAutoResolution=!0,Sl=wl,Uh=class{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}};function Hg(e,t){var n;let s=!1;if((n=e?._textures)!=null&&n.length)for(let n=0;n<e._textures.length;n++)if(e._textures[n]instanceof b){const o=e._textures[n].baseTexture;t.includes(o)||(t.push(o),s=!0)}return s}function Ig(e,t){if(e.baseTexture instanceof m){const n=e.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Bg(e,t){if(e._texture&&e._texture instanceof b){const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Vg(e,t){return t instanceof Sl&&(t.updateText(!0),!0)}function $g(e,t){if(t instanceof rt){const e=t.toFontString();return lt.measureFont(e),!0}return!1}function Wg(e,t){if(e instanceof Sl){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const n=e._texture.baseTexture;return t.includes(n)||t.push(n),!0}return!1}function Ug(e,t){return e instanceof rt&&(t.includes(e)||t.push(e),!0)}Ml=class Um{constructor(e){this.limiter=new Uh(Um.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Wg),this.registerFindHook(Ug),this.registerFindHook(Hg),this.registerFindHook(Ig),this.registerFindHook(Bg),this.registerUploadHook(Vg),this.registerUploadHook($g)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,ae.system.addOnce(this.tick,this,At.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed)for(let n=0,s=this.uploadHooks.length;n<s;n++)if(this.uploadHooks[n](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)ae.system.addOnce(this.tick,this,At.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,n=e.length;t<n;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,n=this.addHooks.length;t<n&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ge)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&ae.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}},Ml.uploadsPerFrame=4,_i=Ml,Object.defineProperties(i,{UPLOADS_PER_FRAME:{get(){return _i.uploadsPerFrame},set(e){v("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),_i.uploadsPerFrame=e}}});function zh(e,t){return t instanceof m&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function Gg(e,t){if(!(t instanceof qn))return!1;const{geometry:n}=t;t.finishPoly(),n.updateBatches();const{batches:s}=n;for(let t=0;t<s.length;t++){const{texture:n}=s[t].style;n&&zh(e,n.baseTexture)}return n.batchable||e.geometry.bind(n,t._resolveDirectShader(e)),!0}function Xg(e,t){return e instanceof qn&&(t.push(e),!0)}Rl=class extends _i{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Xg),this.registerUploadHook(zh),this.registerUploadHook(Gg)}},Rl.extension={name:"prepare",type:s.RendererSystem},a.add(Rl),Sh=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Ah=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Eh=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Vl=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Ch=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,fo=new z,Ul=class extends qs{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Vd,this.state=ut.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Qe.from(Vl,Ch,e),this.shader=t.context.webGLVersion>1?Qe.from(Ah,Sh,e):Qe.from(Vl,Eh,e)}render(e){const a=this.renderer,r=this.quad;let t=r.vertices;t[0]=t[6]=e._width*-e.anchor.x,t[1]=t[3]=e._height*-e.anchor.y,t[2]=t[4]=e._width*(1-e.anchor.x),t[5]=t[7]=e._height*(1-e.anchor.y);const g=e.uvRespectAnchor?e.anchor.x:0,h=e.uvRespectAnchor?e.anchor.y:0;t=r.uvs,t[0]=t[6]=-g,t[1]=t[3]=-h,t[2]=t[4]=1-g,t[5]=t[7]=1-h,r.invalidate();const o=e._texture,s=o.baseTexture,p=s.alphaMode>0,i=e.tileTransform.localTransform,c=e.uvMatrix;let l=s.isPowerOfTwo&&o.frame.width===s.width&&o.frame.height===s.height;l&&(s._glTextures[a.CONTEXT_UID]?l=s.wrapMode!==Ye.CLAMP:s.wrapMode===Ye.CLAMP&&(s.wrapMode=Ye.REPEAT));const n=l?this.simpleShader:this.shader,m=o.width,f=o.height,u=e._width,d=e._height;fo.set(i.a*m/u,i.b*m/d,i.c*f/u,i.d*f/d,i.tx/u,i.ty/d),fo.invert(),l?fo.prepend(c.mapCoord):(n.uniforms.uMapCoord=c.mapCoord.toArray(!0),n.uniforms.uClampFrame=c.uClampFrame,n.uniforms.uClampOffset=c.uClampOffset),n.uniforms.uTransform=fo.toArray(!0),n.uniforms.uColor=O.shared.setValue(e.tint).premultiply(e.worldAlpha,p).toArray(n.uniforms.uColor),n.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),n.uniforms.uSampler=o,a.shader.bind(n),a.geometry.bind(r),this.state.blendMode=o2(e.blendMode,p),a.state.set(this.state),a.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}},Ul.extension={name:"tilingSprite",type:s.RendererPlugin},a.add(Ul),ql=class Rn{constructor(e,t,n){this.linkedSheets=[],(e instanceof m||e instanceof b)&&(e={texture:e,data:t,resolutionFilename:n});const{texture:s,data:i,resolutionFilename:a=null,cachePrefix:r=""}=e;this.cachePrefix=r,this._texture=s instanceof b?s:null,this.baseTexture=s instanceof m?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=i;const o=this.baseTexture.resource;this.resolution=this._updateResolution(a||(o?o.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:n}=this.data.meta;let t=et(e,null);return t===null&&(t=typeof n=="number"?n:parseFloat(n??"1")),t!==1&&this.baseTexture.setResolution(t),t}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Rn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const n=Rn.BATCH_SIZE;for(;t-e<n&&t<this._frameKeys.length;){const i=this._frameKeys[t],s=this._frames[i],o=s.frame;if(o){let e=null,t=null;const n=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,a=new g(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);s.rotated?e=new g(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):e=new g(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(t=new g(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[i]=new b(this.baseTexture,e,a,t,s.rotated?2:0,s.anchor,s.borders),b.addToCache(this.textures[i],this.cachePrefix+i.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let n=0;n<e[t].length;n++){const s=e[t][n];this.animations[t].push(this.textures[s])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Rn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Rn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}},ql.BATCH_SIZE=1e3,nd=ql,yh=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function jh(e,t,n){const s={};if(e.forEach(e=>{s[e]=t}),Object.keys(t.textures).forEach(e=>{s[`${t.cachePrefix}${e}`]=t.textures[e]}),!n){const n=I.dirname(e[0]);t.linkedSheets.forEach((e,o)=>{Object.assign(s,jh([`${n}/${t.data.meta.related_multi_packs[o]}`],e,!0))})}return s}gh={extension:s.Asset,cache:{test:e=>e instanceof nd,getCacheableAssets:(e,t)=>jh(e,t,!1)},resolver:{test:e=>{const t=e.split("?")[0].split("."),n=t.pop(),s=t.pop();return n==="json"&&yh.includes(s)},parse:e=>{var t;const n=e.split(".");return{resolution:parseFloat(((t=i.RETINA_PREFIX.exec(e))==null?0[0]:t[1])??"1"),format:n[n.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:s.LoadParser,priority:be.Normal},async testParse(e,t){return I.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,n){var r,c;const{texture:i,imageFilename:d,cachePrefix:u}=t?.data??{};let s=I.dirname(t.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let a;if(i&&i.baseTexture)a=i;else{const o=Ua(s+(d??e.meta.image),t.src);a=(await n.load([o]))[o]}const o=new nd({texture:a.baseTexture,data:e,resolutionFilename:t.src,cachePrefix:u});await o.parse();const l=(r=e?.meta)==null?0[0]:r.related_multi_packs;if(Array.isArray(l)){const e=[];for(const i of l){if(typeof i!="string")continue;let o=s+i;(c=t.data)!=null&&c.ignoreMultiPack||(o=Ua(o,t.src),e.push(n.load({src:o,data:{ignoreMultiPack:!0}})))}const i=await Promise.all(e);o.linkedSheets=i,i.forEach(e=>{e.linkedSheets=[o].concat(o.linkedSheets.filter(t=>t!==e))})}return o},unload(e){e.destroy(!0)}}},a.add(gh),bo=class{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}},jo=class{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const s=e.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const e in s){const i=s[e].match(/^[a-z]+/gm)[0],n=s[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(const i in n){const e=n[i].split("="),a=e[0],t=e[1].replace(/"/gm,""),s=parseFloat(t),r=isNaN(s)?t:s;o[a]=r}t[i].push(o)}const n=new bo;return t.info.forEach(e=>n.info.push({face:e.face,size:parseInt(e.size,10)})),t.common.forEach(e=>n.common.push({lineHeight:parseInt(e.lineHeight,10)})),t.page.forEach(e=>n.page.push({id:parseInt(e.id,10),file:e.file})),t.char.forEach(e=>n.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)})),t.kerning.forEach(e=>n.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)})),t.distanceField.forEach(e=>n.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType})),n}},vi=class{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new bo,s=e.getElementsByTagName("info"),a=e.getElementsByTagName("common"),o=e.getElementsByTagName("page"),r=e.getElementsByTagName("char"),n=e.getElementsByTagName("kerning"),i=e.getElementsByTagName("distanceField");for(let e=0;e<s.length;e++)t.info.push({face:s[e].getAttribute("face"),size:parseInt(s[e].getAttribute("size"),10)});for(let e=0;e<a.length;e++)t.common.push({lineHeight:parseInt(a[e].getAttribute("lineHeight"),10)});for(let e=0;e<o.length;e++)t.page.push({id:parseInt(o[e].getAttribute("id"),10)||0,file:o[e].getAttribute("file")});for(let n=0;n<r.length;n++){const e=r[n];t.char.push({id:parseInt(e.getAttribute("id"),10),page:parseInt(e.getAttribute("page"),10)||0,x:parseInt(e.getAttribute("x"),10),y:parseInt(e.getAttribute("y"),10),width:parseInt(e.getAttribute("width"),10),height:parseInt(e.getAttribute("height"),10),xoffset:parseInt(e.getAttribute("xoffset"),10),yoffset:parseInt(e.getAttribute("yoffset"),10),xadvance:parseInt(e.getAttribute("xadvance"),10)})}for(let e=0;e<n.length;e++)t.kerning.push({first:parseInt(n[e].getAttribute("first"),10),second:parseInt(n[e].getAttribute("second"),10),amount:parseInt(n[e].getAttribute("amount"),10)});for(let e=0;e<i.length;e++)t.distanceField.push({fieldType:i[e].getAttribute("fieldType"),distanceRange:parseInt(i[e].getAttribute("distanceRange"),10)});return t}},gi=class{static test(e){return!!(typeof e=="string"&&e.includes("<font>"))&&vi.test(i.ADAPTER.parseXML(e))}static parse(e){return vi.parse(i.ADAPTER.parseXML(e))}},fi=[jo,vi,gi];function p5(e){for(let t=0;t<fi.length;t++)if(fi[t].test(e))return fi[t];return null}function g5(e,t,n,s,o,i){const r=n.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let d;const m=n.dropShadow?n.dropShadowDistance:0,l=n.padding||0,h=e.width/s-m-l*2,u=e.height/s-m-l*2,a=r.slice(),c=n.fillGradientStops.slice();if(!c.length){const e=a.length+1;for(let t=1;t<e;++t)c.push(t/e)}if(a.unshift(r[0]),c.unshift(0),a.push(r[r.length-1]),c.push(1),n.fillGradientType===to.LINEAR_VERTICAL){d=t.createLinearGradient(h/2,l,h/2,u+l);let e=0;const s=(i.fontProperties.fontSize+n.strokeThickness)/u;for(let t=0;t<o.length;t++){const n=i.lineHeight*t;for(let t=0;t<a.length;t++){let i=0;typeof c[t]=="number"?i=c[t]:i=t/a.length;const r=n/u+i*s;let o=Math.max(e,r);o=Math.min(o,1),d.addColorStop(o,a[t]),e=o}}}else{d=t.createLinearGradient(l,u/2,h+l,u/2);const n=a.length+1;let e=1;for(let t=0;t<a.length;t++){let s;typeof c[t]=="number"?s=c[t]:s=e/n,d.addColorStop(s,a[t]),e++}}return d}function v5(e,t,n,s,o,i,a){const r=n.text,c=n.fontProperties;t.translate(s,o),t.scale(i,i);const l=a.strokeThickness/2,d=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=g5(e,t,a,i,[r],n),t.strokeStyle=a.stroke,a.dropShadow){const n=a.dropShadowColor,s=a.dropShadowBlur*i,e=a.dropShadowDistance*i;t.shadowColor=O.shared.setValue(n).setAlpha(a.dropShadowAlpha).toRgbaString(),t.shadowBlur=s,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*e,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*e}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(r,l,d+n.lineHeight-c.descent),a.fill&&t.fillText(r,l,d+n.lineHeight-c.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function hi(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function th(e){return Array.from?Array.from(e):e.split("")}function y5(e){typeof e=="string"&&(e=[e]);const t=[];for(let s=0,o=e.length;s<o;s++){const n=e[s];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const e=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<e)throw new Error("[BitmapFont]: Invalid character range.");for(let n=e,o=s;n<=o;n++)t.push(String.fromCharCode(n))}else t.push(...th(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}Ze=class er{constructor(e,t,n){var a;const[r]=e.info,[c]=e.common,[l]=e.page,[o]=e.distanceField,s=et(l.file),i={};this._ownsTextures=n,this.font=r.face,this.size=r.size,this.lineHeight=c.lineHeight/s,this.chars={},this.pageTextures=i;for(let n=0;n<e.page.length;n++){const{id:s,file:a}=e.page[n];i[s]=t instanceof Array?t[n]:t[a],o!=null&&o.fieldType&&o.fieldType!=="none"&&(i[s].baseTexture.alphaMode=se.NO_PREMULTIPLIED_ALPHA,i[s].baseTexture.mipmap=ke.OFF)}for(let t=0;t<e.char.length;t++){const{id:h,page:n}=e.char[t];let{x:o,y:a,width:r,height:c,xoffset:l,yoffset:d,xadvance:u}=e.char[t];o/=s,a/=s,r/=s,c/=s,l/=s,d/=s,u/=s;const m=new g(o+i[n].frame.x/s,a+i[n].frame.y/s,r,c);this.chars[h]={xOffset:l,yOffset:d,xAdvance:u,kerning:{},texture:new b(i[n].baseTexture,m),page:n}}for(let t=0;t<e.kerning.length;t++){let{first:o,second:n,amount:i}=e.kerning[t];o/=s,n/=s,i/=s,this.chars[n]&&(this.chars[n].kerning[o]=i)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=((a=o?.fieldType)==null?0[0]:a.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,n){let s;if(e instanceof bo)s=e;else{const t=p5(e);if(!t)throw new Error("Unrecognized data format for font.");s=t.parse(e)}t instanceof b&&(t=[t]);const o=new er(s,t,n);return er.available[o.font]=o,o}static uninstall(e){const t=er.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete er.available[e]}static from(e,t,n){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:w,padding:O,resolution:r,textureWidth:v,textureHeight:p,..._}=Object.assign({},er.defaultOptions,n),h=y5(w),s=t instanceof rt?t:new rt(t),y=v,d=new bo;d.info[0]={face:s.fontFamily,size:s.fontSize},d.common[0]={lineHeight:s.fontSize};let o=0,c=0,a,l,g,u=0;const f=[];for(let e=0;e<h.length;e++){a||(a=i.ADAPTER.createCanvas(),a.width=v,a.height=p,l=a.getContext("2d"),g=new m(a,{resolution:r,..._}),f.push(new b(g)),d.page.push({id:f.length-1,file:""}));const n=h[e],t=lt.measureText(n,s,!1,a),x=t.width,j=Math.ceil(t.height),w=Math.ceil((s.fontStyle==="italic"?2:1)*x);if(c>=p-j*r){if(c===0)throw new Error(`[BitmapFont] textureHeight ${p}px is too small (fontFamily: '${s.fontFamily}', fontSize: ${s.fontSize}px, char: '${n}')`);--e,a=null,l=null,g=null,c=0,o=0,u=0;continue}if(u=Math.max(j+t.fontProperties.descent,u),w*r+o>=y){if(o===0)throw new Error(`[BitmapFont] textureWidth ${v}px is too small (fontFamily: '${s.fontFamily}', fontSize: ${s.fontSize}px, char: '${n}')`);--e,c+=u*r,c=Math.ceil(c),o=0,u=0;continue}v5(a,l,t,o,c,r,s);const C=hi(t.text);d.char.push({id:C,page:f.length-1,x:o/r,y:c/r,width:w,height:j,xoffset:0,yoffset:0,xadvance:x-(s.dropShadow?s.dropShadowDistance:0)-(s.stroke?s.strokeThickness:0)}),o+=(w+2*O)*r,o=Math.ceil(o)}if(n==null||!n.skipKerning)for(let e=0,n=h.length;e<n;e++){const t=h[e];for(let e=0;e<n;e++){const s=h[e],i=l.measureText(t).width,a=l.measureText(s).width,o=l.measureText(t+s).width-(i+a);o&&d.kerning.push({first:hi(t),second:hi(s),amount:o})}}const j=new er(d,f,!0);return er.available[e]!==0[0]&&er.uninstall(e),er.available[e]=j,j}},Ze.ALPHA=[["a","z"],["A","Z"]," "],Ze.NUMERIC=[["0","9"]],Ze.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ze.ASCII=[[" ","~"]],Ze.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ze.ALPHANUMERIC},Ze.available={},qe=Ze,$3=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,B3=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`,pd=[],vd=[],yd=[],_3=class jm extends ge{constructor(e,t={}){super();const{align:s,tint:o,maxWidth:a,letterSpacing:r,fontName:n,fontSize:c}=Object.assign({},jm.styleDefaults,t);if(!qe.available[n])throw new Error(`Missing BitmapFont "${n}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=s,this._tintColor=new O(o),this._font=0[0],this._fontName=n,this._fontSize=c,this.text=e,this._maxWidth=a,this._maxLineHeight=0,this._letterSpacing=r,this._anchor=new yt(()=>{this.dirty=!0},this,0,0),this._roundPixels=i.ROUND_PIXELS,this.dirty=!0,this._resolution=i.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var k;const s=qe.available[this._fontName],E=this.fontSize,o=E/s.size,e=new y,t=[],u=[],h=[],S=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",g=th(S),O=this._maxWidth*s.size/E,A=s.distanceFieldType==="none"?pd:vd;let r=null,a=0,n=0,p=0,l=-1,v=0,_=0,w=0,m=0;for(let c=0;c<g.length;c++){const d=g[c],f=hi(d);if(/(?:\s)/.test(d)&&(l=c,v=a,m++),d==="\r"||d===`
`){u.push(a),h.push(-1),n=Math.max(n,a),++p,++_,e.x=0,e.y+=s.lineHeight,r=null,m=0;continue}const o=s.chars[f];if(!o)continue;r&&o.kerning[r]&&(e.x+=o.kerning[r]);const i=yd.pop()||{texture:b.EMPTY,line:0,charCode:0,prevSpaces:0,position:new y};i.texture=o.texture,i.line=p,i.charCode=f,i.position.x=Math.round(e.x+o.xOffset+this._letterSpacing/2),i.position.y=Math.round(e.y+o.yOffset),i.prevSpaces=m,t.push(i),a=i.position.x+Math.max(o.xAdvance-o.xOffset,o.texture.orig.width),e.x+=o.xAdvance+this._letterSpacing,w=Math.max(w,o.yOffset+o.texture.height),r=f,l!==-1&&O>0&&e.x>O&&(++_,Zn(t,1+l-_,1+c-l),c=l,l=-1,u.push(v),h.push(t.length>0?t[t.length-1].prevSpaces:0),n=Math.max(n,v),p++,e.x=0,e.y+=s.lineHeight,r=null,m=0)}const j=g[g.length-1];j!=="\r"&&j!==`
`&&(/(?:\s)/.test(j)&&(a=v),u.push(a),n=Math.max(n,a),h.push(-1));const x=[];for(let e=0;e<=p;e++){let t=0;this._align==="right"?t=n-u[e]:this._align==="center"?t=(n-u[e])/2:this._align==="justify"&&(t=h[e]<0?0:(n-u[e])/h[e]),x.push(t)}const C=t.length,i={},c=[],f=this._activePagesMeshData;A.push(...f);for(let n=0;n<C;n++){const o=t[n].texture,e=o.baseTexture.uid;if(!i[e]){let t=A.pop();if(!t){const i=new Cm;let e,n;s.distanceFieldType==="none"?(e=new Hc(b.EMPTY),n=d.NORMAL):(e=new Hc(b.EMPTY,{program:$e.from(B3,$3),uniforms:{uFWidth:0}}),n=d.NORMAL_NPM);const o=new Pc(i,e);o.blendMode=n,t={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}t.index=0,t.indexCount=0,t.vertexCount=0,t.uvsCount=0,t.total=0;const{_textureCache:n}=this;n[e]=n[e]||new b(o.baseTexture),t.mesh.texture=n[e],t.mesh.tint=this._tintColor.value,c.push(t),i[e]=t}i[e].total++}for(let e=0;e<f.length;e++)c.includes(f[e])||this.removeChild(f[e].mesh);for(let e=0;e<c.length;e++)c[e].mesh.parent!==this&&this.addChild(c[e].mesh);this._activePagesMeshData=c;for(const n in i){const e=i[n],t=e.total;if(!(((k=e.indices)==null?0[0]:k.length)>6*t)||e.vertices.length<Pc.BATCHABLE_SIZE*2)e.vertices=new Float32Array(4*2*t),e.uvs=new Float32Array(4*2*t),e.indices=new Uint16Array(6*t);else{const n=e.total,t=e.vertices;for(let e=n*4*2;e<t.length;e++)t[e]=0}e.mesh.size=6*t}for(let d=0;d<C;d++){const a=t[d];let u=a.position.x+x[a.line]*(this._align==="justify"?a.prevSpaces:1);this._roundPixels&&(u=Math.round(u));const r=u*o,c=a.position.y*o,h=a.texture,n=i[h.baseTexture.uid],l=h.frame,s=h._uvs,e=n.index++;n.indices[e*6+0]=0+e*4,n.indices[e*6+1]=1+e*4,n.indices[e*6+2]=2+e*4,n.indices[e*6+3]=0+e*4,n.indices[e*6+4]=2+e*4,n.indices[e*6+5]=3+e*4,n.vertices[e*8+0]=r,n.vertices[e*8+1]=c,n.vertices[e*8+2]=r+l.width*o,n.vertices[e*8+3]=c,n.vertices[e*8+4]=r+l.width*o,n.vertices[e*8+5]=c+l.height*o,n.vertices[e*8+6]=r,n.vertices[e*8+7]=c+l.height*o,n.uvs[e*8+0]=s.x0,n.uvs[e*8+1]=s.y0,n.uvs[e*8+2]=s.x1,n.uvs[e*8+3]=s.y1,n.uvs[e*8+4]=s.x2,n.uvs[e*8+5]=s.y2,n.uvs[e*8+6]=s.x3,n.uvs[e*8+7]=s.y3}this._textWidth=n*o,this._textHeight=(e.y+s.lineHeight)*o;for(const a in i){const e=i[a];if(this.anchor.x!==0||this.anchor.y!==0){let t=0;const n=this._textWidth*this.anchor.x,s=this._textHeight*this.anchor.y;for(let o=0;o<e.total;o++)e.vertices[t++]-=n,e.vertices[t++]-=s,e.vertices[t++]-=n,e.vertices[t++]-=s,e.vertices[t++]-=n,e.vertices[t++]-=s,e.vertices[t++]-=n,e.vertices[t++]-=s}this._maxLineHeight=w*o;const t=e.mesh.geometry.getBuffer("aVertexPosition"),n=e.mesh.geometry.getBuffer("aTextureCoord"),s=e.mesh.geometry.getIndex();t.data=e.vertices,n.data=e.uvs,s.data=e.indices,t.update(),n.update(),s.update()}for(let e=0;e<t.length;e++)yd.push(t[e]);this._font=s,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:n,size:s}=qe.available[this._fontName];if(n!=="none"){const{a:n,b:o,c:i,d:a}=this.worldTransform,r=(n*n+o*o)**.5,c=(i*i+a*a)**.5,l=((r<0?-r:r)+(c<0?-c:c))/2,d=this.fontSize/s,u=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=l*t*d*u}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=qe.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!qe.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??qe.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,n=qe.available[this._fontName].distanceFieldType==="none"?pd:vd;n.push(...this._activePagesMeshData);for(const e of this._activePagesMeshData)this.removeChild(e.mesh);this._activePagesMeshData=[],n.filter(e=>t[e.mesh.texture.baseTexture.uid]).forEach(e=>{e.mesh.texture=b.EMPTY});for(const e in t)t[e].destroy(),delete t[e];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}},_3.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},j3=[".xml",".fnt"],b3={extension:{type:s.LoadParser,priority:be.Normal},name:"loadBitmapFont",test(e){return j3.includes(I.extname(e).toLowerCase())},async testParse(e){return jo.test(e)||gi.test(e)},async parse(e,t,n){const o=jo.test(e)?jo.parse(e):gi.parse(e),{src:i}=t,{page:a}=o,s=[];for(let e=0;e<a.length;++e){const n=a[e].file;let t=I.join(I.dirname(i),n);t=Ua(t,i),s.push(t)}const r=await n.load(s),c=s.map(e=>r[e]);return qe.install(o,c,!0)},async load(e){return(await i.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}},a.add(b3),ii=class Ui extends rt{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new Ui(Object.keys(Ui.defaultOptions).reduce((t,n)=>({...t,[n]:e[n]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete Ui.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:n}=Ui;if(n[e]){const t=n[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return i.ADAPTER.fetch(e).then(e=>e.blob()).then(async e=>new Promise((t,n)=>{const o=URL.createObjectURL(e),s=new FileReader;s.onload=()=>t([o,s.result]),s.onerror=n,s.readAsDataURL(e)})).then(async([s,o])=>{const i=Object.assign({family:I.basename(e,I.extname(e)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:o,refs:1,originalUrl:e,fontFace:null},t);n[e]=i,this._fonts.push(i),this.styleID++;const a=new FontFace(i.family,`url(${i.src})`,{weight:i.weight,style:i.style,display:i.display});i.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(e=>!this._overrides.includes(e));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(e=>this._overrides.includes(e));e.length>0&&(this._overrides=this._overrides.filter(t=>!e.includes(t)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=m7(e)),typeof e=="number"?f7(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),o=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const n=`${s}px ${o}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${n} ${e}`}reset(){Object.assign(this,Ui.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=i.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}},ii.availableFonts={},ii.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100},oi=ii,wo=class Gi extends bs{constructor(e="",t={}){super(b.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const o=new Image,s=b.from(o,{scaleMode:i.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new g,s.trim=new g,this.texture=s;const a="http://www.w3.org/2000/svg",r="http://www.w3.org/1999/xhtml",c=document.createElementNS(a,"svg"),n=document.createElementNS(a,"foreignObject"),l=document.createElementNS(r,"div"),d=document.createElementNS(r,"style");n.setAttribute("width","10000"),n.setAttribute("height","10000"),n.style.overflow="hidden",c.appendChild(n),this.maxWidth=Gi.defaultMaxWidth,this.maxHeight=Gi.defaultMaxHeight,this._domElement=l,this._styleElement=d,this._svgRoot=c,this._foreignObject=n,this._foreignObject.appendChild(d),this._foreignObject.appendChild(l),this._image=o,this._loadImage=new Image,this._autoResolution=Gi.defaultAutoResolution,this._resolution=Gi.defaultResolution??i.RESOLUTION,this.text=e,this.style=t}measureText(e){var n,s;const{text:o,style:t,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:o,style:t.toCSS(i)}),this._styleElement.textContent=t.toGlobalCSS(),document.body.appendChild(this._svgRoot);const d=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:r}=d;(a>this.maxWidth||r>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const c=Math.min(this.maxWidth,Math.ceil(a)),l=Math.min(this.maxHeight,Math.ceil(r));return this._svgRoot.setAttribute("width",c.toString()),this._svgRoot.setAttribute("height",l.toString()),o!==this._text&&(this._domElement.innerHTML=this._text),t!==this._style&&(Object.assign(this._domElement,{style:(n=this._style)==null?0[0]:n.toCSS(i)}),this._styleElement.textContent=(s=this._style)==null?0[0]:s.toGlobalCSS()),{width:c+t.padding*2,height:l+t.padding*2}}async updateText(e=!0){const{style:n,_image:s,_loadImage:t}=this;if(this.localStyleID!==n.styleID&&(this.dirty=!0,this.localStyleID=n.styleID),!this.dirty&&e)return;const{width:o,height:i}=this.measureText();s.width=t.width=Math.ceil(Math.max(1,o)),s.height=t.height=Math.ceil(Math.max(1,i)),this._updateID++;const a=this._updateID;await new Promise(e=>{t.onload=async()=>{if(a<this._updateID){e();return}await n.onBeforeDraw(),s.src=t.src,t.onload=null,t.src="",this.updateTexture(),e()};const o=(new XMLSerializer).serializeToString(this._svgRoot);t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(o)}`})}get source(){return this._image}updateTexture(){const{style:o,texture:e,_image:t,resolution:s}=this,{padding:n}=o,{baseTexture:i}=e;e.trim.width=e._frame.width=t.width/s,e.trim.height=e._frame.height=t.height/s,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),i.setRealSize(t.width,t.height,s),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var n,s,o,i,a;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Gi.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&((n=this._style)==null||n.cleanFonts()),this._style=t,(s=this._svgRoot)==null||s.remove(),this._svgRoot=t,(o=this._domElement)==null||o.remove(),this._domElement=t,(i=this._foreignObject)==null||i.remove(),this._foreignObject=t,(a=this._styleElement)==null||a.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Tt(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Tt(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof oi?(this.ownsStyle=!1,this._style=e):e instanceof rt?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=oi.from(e)):(this.ownsStyle=!0,this._style=new oi(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===0[0]?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}},wo.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},wo.defaultMaxWidth=2024,wo.defaultMaxHeight=2024,wo.defaultAutoResolution=!0,i3=16777215,o3=.25,t3=16777215,e3=1,Z2=1.5,tt=!1,ni=e=>{const t={tint:e!=null&&e.fill?new O(e.fill).toNumber():i3,alpha:e?.fillOpacity!==0[0]?Math.min(e.fillOpacity,1):String(e?.fill).toLowerCase().startsWith("rgba(")?new O(e?.fill).alpha:o3},n={tint:e!=null&&e.stroke?new O(e.stroke).toNumber():t3,alpha:e?.strokeOpacity!==0[0]?Math.min(e.strokeOpacity,1):String(e?.stroke).toLowerCase().startsWith("rgba(")?new O(e?.stroke).alpha:e3,lineWidth:e?.strokeWidth===0[0]?Z2:e.strokeWidth};return{fillStyle:t,strokeStyle:n}},fn=e=>(t,n,s,o={})=>{const{fillStyle:c,strokeStyle:a}=ni(s),i=new qn;o.strokeOnly||(i.beginFill(16777215),e(n,i),i.endFill(),i.tint=c.tint,i.alpha=c.alpha),t.addChild(i);const r=new qn,l=a.lineWidth===1?1:a.lineWidth/xn;return r.lineStyle(l,16777215,1,.5,a.lineWidth===1),e(n,r),r.tint=a.tint||16777215,r.alpha=a.alpha,t.addChild(r),{fill:i,stroke:r,strokeWidth:a.lineWidth}},U2=fn((e,t)=>{const{x:n,y:s,w:o,h:i}=e.geometry;t.drawRect(n,s,o,i)}),W2=fn((e,t)=>{const{cx:n,cy:s,rx:o,ry:i}=e.geometry;t.drawEllipse(n,s,o,i)}),$2=fn((e,t)=>{const[[n,s],[o,i]]=e.geometry.points;t.moveTo(n,s),t.lineTo(o,i),t.closePath()}),B2=fn((e,t)=>{const n=e.geometry.points.reduce((e,t)=>[...e,...t],[]);t.drawPolygon(n)}),I2=fn((e,t)=>{const{points:n,closed:s}=e.geometry;if(n.length===0)return;s||t.beginFill(0,0);const o=(e,n)=>{const[i,a]=e.point,[s,o]=n.point;if(e.type==="CURVE"||n.type==="CURVE"){const r=e.type==="CURVE"&&e.outHandle?e.outHandle[0]:i,c=e.type==="CURVE"&&e.outHandle?e.outHandle[1]:a,l=n.type==="CURVE"&&n.inHandle?n.inHandle[0]:s,d=n.type==="CURVE"&&n.inHandle?n.inHandle[1]:o;t.bezierCurveTo(r,c,l,d,s,o)}else t.lineTo(s,o)},i=n[0];t.moveTo(i.point[0],i.point[1]);for(let e=1;e<n.length;e++){const t=n[e-1],s=n[e];o(t,s)}if(s&&n.length>2){const e=n[n.length-1],s=n[0];o(e,s),t.closePath()}else t.endFill()}),P2=fn((e,t)=>{const n=e=>e.points.reduce((e,t)=>[...e,...t],[]);e.geometry.polygons.forEach(e=>{const[s,...o]=e.rings;t.drawPolygon(n(s)),o.forEach(e=>{t.beginHole(),t.drawPolygon(n(e)),t.endHole()})})}),Ad=e=>{const t=e.viewport.getContainerSize().x;return e.viewport.getZoom(!0)*t/e.world.getContentFactor()},Fd=(e,t,n,s)=>()=>{const a=e.viewport.viewportToImageRectangle(e.viewport.getBounds(!0)),i=Ad(e);(i!==xn||!tt)&&(tt=!0,n.forEach(({stroke:e,strokeWidth:t})=>{const{lineStyle:n}=e.geometry.graphicsData[0];t>1?(tt=i===xn,n.width=t/i,n.native=!1,e.geometry.invalidate()):t===1&&!n.native&&(n.width=1,n.native=!0,e.geometry.invalidate())})),xn=i;const l=e.viewport.getFlip();let o=Math.PI*e.viewport.getRotation(!0)/180;o<0&&(o+=2*Math.PI),o>2*Math.PI&&(o-=2*Math.PI);const d=l?e.viewport._containerInnerSize.x+a.x*i:-a.x*i,u=-a.y*i;let r,c;o>0&&o<=Math.PI/2?(r=a.height*i,c=0):o>Math.PI/2&&o<=Math.PI?(r=a.width*i,c=a.height*i):o>Math.PI&&o<=Math.PI*1.5?(r=0,c=a.width*i):(r=0,c=0),t.position.x=r+d*Math.cos(o)-u*Math.sin(o),t.position.y=c+d*Math.sin(o)+u*Math.cos(o),t.scale.set(l?-i:i,i),t.rotation=o,s.render(t)},z2=(e,t)=>{const n=new qn,i=t8({width:t.width,height:t.height,backgroundAlpha:0,view:t,antialias:!0,resolution:2}),s=new Map;let o=new Set,a,r;xn=Ad(e);const l=(e,t)=>{tt=!1;const c=s.get(e.id);c&&(c.fill.destroy(),c.stroke.destroy());const{selector:o}=e.target,a=typeof r=="function"?r(e,t):r;let i;if(o.type===f.RECTANGLE)i=U2(n,o,a);else if(o.type===f.POLYGON)i=B2(n,o,a);else if(o.type===f.ELLIPSE)i=W2(n,o,a);else if(o.type===f.MULTIPOLYGON)i=P2(n,o,a);else if(o.type===f.POLYLINE){const e=o;i=I2(n,e,a,{strokeOnly:!e.geometry.closed})}else o.type===f.LINE?i=$2(n,o,a):console.warn(`Unsupported shape type: ${o.type}`);i&&s.set(e.id,{annotation:e,...i})},u=e=>{const t=s.get(e.id);t&&(s.delete(e.id),t.fill.destroy(),t.stroke.destroy())},d=(e,t,i)=>{tt=!1;const a=s.get(e.id);if(a&&(s.delete(e.id),a.fill.destroy(),a.stroke.destroy(),l(t,i),o.has(t.id))){const{fill:e,stroke:o}=s.get(t.id);n.removeChild(e),n.removeChild(o)}},c=(e,t)=>{const n=s.get(e);n&&(s.delete(e),n.fill.destroy(),n.stroke.destroy(),l(n.annotation,t))},h=(e,t)=>{i.resize(e,t),i.render(n)},m=e=>{tt=!1;const{children:t}=n;s.forEach(({fill:s,stroke:i,annotation:a})=>{const r=!e||o.has(a.id)||e(a);r&&!t.includes(s)?(n.addChild(s),n.addChild(i)):!r&&t.includes(s)&&(n.removeChild(s),n.removeChild(i))}),i.render(n)},p=e=>{const t=new Set(e.selected.map(e=>e.id)),r=e.selected.filter(({id:e})=>!o.has(e)),l=[...o].filter(e=>!t.has(e));r.forEach(({id:e,editable:t})=>{if(t){const t=s.get(e);t&&vl(t.annotation.target.selector)&&(n.removeChild(t.fill),n.removeChild(t.stroke))}else c(e,{selected:!0,hovered:e===a})}),l.forEach(e=>c(e,{hovered:e===a})),o=t,i.render(n)},g=e=>{a!==e&&(e&&o.has(e)||(a&&!o.has(a)&&c(a,{selected:o.has(a)}),e&&c(e,{selected:o.has(e),hovered:!0}),a=e,i.render(n)))},v=t=>{if(typeof t=="function")s.forEach(({annotation:e,fill:n,stroke:i,strokeWidth:r})=>{r>1&&(tt=!1);const u={selected:o.has(e.id),hovered:a===e.id},{fillStyle:d,strokeStyle:l}=ni(t(e,u));n.tint=d.tint,n.alpha=d.alpha,i.tint=l.tint||16777215,i.alpha=l.alpha,s.set(e.id,{annotation:e,fill:n,stroke:i,strokeWidth:l.lineWidth})});else{const{fillStyle:n,strokeStyle:e}=ni(t);e.lineWidth>1&&(tt=!1),s.forEach(({annotation:t,fill:o,stroke:i,strokeWidth:a})=>{o.tint=n.tint,o.alpha=n.alpha,i.tint=e.tint||16777215,i.alpha=e.alpha,s.set(t.id,{annotation:t,fill:o,stroke:i,strokeWidth:e.lineWidth})})}r=t,i.render(n),Fd(e,n,s,i)()},b=e=>{e?t.classList.remove("hidden"):t.classList.add("hidden")};return{addAnnotation:l,destroy:()=>i.destroy(),getScale:()=>xn,redraw:Fd(e,n,s,i),removeAnnotation:u,resize:h,setFilter:m,setHovered:g,setSelected:p,setStyle:v,setVisible:b,updateAnnotation:d}};function Z5(e,t,n){let m,h,{filter:a}=t,{state:g}=t,{style:u}=t,{viewer:o}=t,{visible:p=!0}=t;const{store:i,hover:l,selection:w,viewport:d}=g;Eo(e,l,e=>n(11,m=e)),Eo(e,w,e=>n(8,h=e));const v=sl(),O=pe?10:2;let s,r;const b=e=>{const t=new tn.default.Point(e.x,e.y),{x:n,y:s}=o.viewport.pointFromPixel(t);return o.viewport.viewportToImageCoordinates(n,s)},j=()=>O/s.getScale(),y=e=>{const{x:t,y:n}=e.position;r={x:t,y:n}},x=e=>t=>{const{x:o,y:r}=b(new tn.default.Point(t.offsetX,t.offsetY)),c=j(),n=i.getAt(o,r,a,c);n?(e.classList.add("hover"),m!==n.id&&(l.set(n.id),s.setHovered(n.id))):(e.classList.remove("hover"),m&&(l.set(0[0]),s.setHovered(0[0])))},_=e=>{if(!r)return;const t=e.originalEvent,{x:o,y:c}=e.position,n=o-r.x,s=c-r.y;if((n*n+s*s)**.5<5){const{x:s,y:o}=b(e.position),r=j(),n=i.getAt(s,o,a,r);n?v("click",{originalEvent:t,annotation:n}):v("click",{originalEvent:t})}r=0[0]};let c;return so(()=>{var t;const{offsetWidth:m,offsetHeight:p}=o.canvas,e=document.createElement("canvas");e.width=m,e.height=p,e.className="a9s-gl-canvas",(t=o.element.querySelector(".openseadragon-canvas"))==null||t.appendChild(e),n(7,s=z2(o,e));const a=x(e);e.addEventListener("pointermove",a);const r=new ResizeObserver(t=>{try{const{width:n,height:o}=t[0].contentRect;e.width=n,e.height=o,s.resize(n,o)}catch{console.warn("WebGL canvas already disposed")}});r.observe(e);const l=()=>{const e=o.viewport.getBounds();c=o.viewport.viewportToImageRectangle(e);const{x:t,y:n,width:s,height:a}=c,r=i.getIntersecting(t,n,s,a);d.set(r.map(e=>e.id))};o.addHandler("canvas-press",y),o.addHandler("canvas-release",_),o.addHandler("update-viewport",s.redraw),o.addHandler("animation-finish",l);const g=e=>e.filter(e=>ct(e)),v=e=>ct(e.oldValue)&&ct(e.newValue),u=e=>{const{selector:t}=e.target;if(t.type===f.POLYGON){const n=A3(t);return{...e,target:{...e.target,selector:{...n}}}}if(t.type===f.MULTIPOLYGON){const n=z3(t);return{...e,target:{...e.target,selector:{...n}}}}return e},h=e=>{const{created:t,updated:n,deleted:o}=e.changes,a=(t||[]).filter(e=>ct(e)).map(u);if(g(o||[]).forEach(e=>s.removeAnnotation(e)),a.forEach(e=>s.addAnnotation(e)),(n||[]).filter(e=>v(e)).map(({oldValue:e,newValue:t})=>({oldValue:e,newValue:u(t)})).forEach(({oldValue:e,newValue:t})=>s.updateAnnotation(e,t)),c){const{x:e,y:t,width:n,height:s}=c,o=i.getIntersecting(e,t,n,s);d.set(o.map(e=>e.id))}else d.set(i.all().map(e=>e.id));s.redraw()};return i.observe(h),()=>{var t;e.removeEventListener("pointermove",a),r.disconnect(),o.removeHandler("canvas-press",y),o.removeHandler("canvas-release",_),o.removeHandler("update-viewport",s.redraw),o.removeHandler("animation-finish",l),i.unobserve(h),s.destroy(),(t=e.parentNode)==null||t.removeChild(e)}}),e.$$set=e=>{"filter"in e&&n(2,a=e.filter),"state"in e&&n(3,g=e.state),"style"in e&&n(4,u=e.style),"viewer"in e&&n(5,o=e.viewer),"visible"in e&&n(6,p=e.visible)},e.$$.update=()=>{e.$$.dirty&132&&(s==null||s.setFilter(a)),e.$$.dirty&384&&(s==null||s.setSelected(h)),e.$$.dirty&144&&(s==null||s.setStyle(u)),e.$$.dirty&192&&(s==null||s.setVisible(p))},[l,w,a,g,u,o,p,s,h]}T2=class extends Q{constructor(e){super(),te(this,e,Z5,null,U,{filter:2,state:3,style:4,viewer:5,visible:6})}},Rd=(e,t,n,s)=>{if(!s)return e;if(t.shiftKey||t.ctrlKey||t.metaKey){const t=(n.selected||[]).map(e=>e.id);return t.includes(e)?t.filter(t=>t!==e):[...t,e]}return e},x2=e=>({transform:e&2,scale:e&1}),Hd=e=>({transform:e[1],scale:e[0]});function s7(e){let n;const s=e[4].default,t=Jg(s,e,e[3],Hd);return{c(){t&&t.c()},m(e,s){t&&t.m(e,s),n=!0},p(e,[o]){t&&t.p&&(!n||o&11)&&n5(t,s,e,e[3],n?e5(s,e[3],o,x2):o5(e[3]),Hd)},i(e){n||(h(t,e),n=!0)},o(e){p(t,e),n=!1},d(e){t&&t.d(e)}}}function o7(e,t,n){let{$$slots:c={},$$scope:o}=t,{viewer:s}=t,i=1,a;const r=()=>{const t=s.viewport.getContainerSize().x,r=s.viewport.getZoom(!0),c=s.viewport.getFlip(),e=s.viewport.pixelFromPoint(new tn.default.Point(0,0),!0);c&&(e.x=t-e.x);const o=r*t/s.world.getContentFactor(),l=c?-o:o,d=s.viewport.getRotation(!0);n(1,a=`translate(${e.x}, ${e.y}) scale(${l}, ${o}) rotate(${d})`),n(0,i=r*t/s.world.getContentFactor())};return so(()=>(s.addHandler("update-viewport",r),()=>{s.removeHandler("update-viewport",r)})),e.$$set=e=>{"viewer"in e&&n(2,s=e.viewer),"$$scope"in e&&n(3,o=e.$$scope)},[i,a,s,o,c]}Xo=class extends Q{constructor(e){super(),te(this,e,o7,s7,U,{viewer:2})}};function a7(e,t,n){const u=sl();let{drawingMode:c}=t,{opts:l}=t,{target:i}=t,{tool:d}=t,{transform:a}=t,{viewer:o}=t,{viewportScale:r}=t,s;return so(()=>{const e=i.closest("svg"),t=[],h=(n,s,i)=>{if(e==null||e.addEventListener(n,s,i),t.push(()=>e?.removeEventListener(n,s,i)),n==="pointerup"||n==="dblclick"){const e=e=>{const{originalEvent:t}=e;s(t)},i=n==="pointerup"?"canvas-click":"canvas-double-click";o.addHandler(i,e),t.push(()=>o.removeHandler(i,e))}else if(n==="pointermove"){const e=e=>{const{originalEvent:t}=e;s(t)};o.addHandler("canvas-drag",e),t.push(()=>o.removeHandler("canvas-drag",e))}};return n(7,s=new d({target:i,props:{addEventListener:h,drawingMode:c,opts:l,transform:a,viewportScale:r,svgEl:e}})),s.$on("create",e=>u("create",e.detail)),()=>{t.forEach(e=>e()),s.$destroy()}}),e.$$set=e=>{"drawingMode"in e&&n(0,c=e.drawingMode),"opts"in e&&n(1,l=e.opts),"target"in e&&n(2,i=e.target),"tool"in e&&n(3,d=e.tool),"transform"in e&&n(4,a=e.transform),"viewer"in e&&n(5,o=e.viewer),"viewportScale"in e&&n(6,r=e.viewportScale)},e.$$.update=()=>{e.$$.dirty&144&&s&&s.$set({transform:a}),e.$$.dirty&192&&s&&s.$set({viewportScale:r})},[c,l,i,d,a,o,r,s]}var wu,Ru,vu,Hu,l0,lu,f0,Uo,iu,C0,q0,tn,G0,w2,Kd,Wd,$d,O2,e7,X5,ti,R2,q2,Y2,G2,Q2,Ge,h3,p3,g3,O3,C3,P3,U3,J3,oh,ah,rh,dh,uh,hh,_h,td,lo,gn,il,Bt,el,Jc,Pi,Ii,un,eo,vn,Je,Em,f,Am,qi,$t,Zi,Im,ne,Xs,Ys,Wm,Ks,qm,Ym,p8,ma,Ie,_8,k8,A8,_a,Ka,S8,nc,tc,H8,ct,Ns,B8,sf,Yr,Kr,pf,Ts,gf,_f,xf,Wr,o6,g6,S6,U6,wp,_p,yp,bp,W,Nr,tp,Q6,Er,gr,rn,W6,_s,$6,V6,K,ur,D6,y6,lr,m6,h6,u6,d6,c6,V,r6,ds,Uf,$f,Bf,Pf,Rf,Lf,nr,Nf,zf,Tf,Mf,Sf,cs,pe,Cf,sr,Va,Ut,Zr,x8,O8,w8,Kn,gc,vc,_c,j8,u8,xc,d8,l8,Km,Vm,Fn,Hm,dl,vl,Lm,ym,lm,cm,im,ui,fd,_d,om,em,$h,Ih,Hh,Ph,Lh,Bd,Dh,pi,io,Kt,Qs,cn,Kc,ph,Vi,Ki,Yt,Bs,qt,Q,sh,we,En,uc,Z3,G3,Zt,ya,fs,ms,ic,Y3,V3,I3,H3,N3,z3,S3,A3,k3,Rr,Cr,E3,Or,x3,X,br,w3,y3,or,v3,Ov,f3,_t,Za,Po,d,Ce,n,an,o,c,Ve,Ye,ke,se,Se,$a,ce,D,R,Ee,m3,i,Ha,yr,_r,wr,La,xr,en,xs,Le,Ar,Sr,Mr,Fr,Tr,zr,Dr,d3,Be,Hr,l3,ns,Sa,D2,M2,Us,S2,Nt,A2,k2,E2,Qi,Xi,Zs,Tc,Wi,$i,Js,Lc,C2,Nn,b2,Jn,v2,Vc,g2,p2,f2,m2,Hi,nt,u2,Xc,Qc,Zc,Oe,d2,tl,Ri,Li,zi,sn,$n,rl,cl,ki,ul,hl,ml,s2,ss,L0,b0,v0,vo,m0,h0,u0,d0,c0,cd,r0,a0,s0,t0,e0,J4,q4,D4,T4,F4,M4,S4,C4,O4,w4,y4,_o,Ed,xo,b4,v4,p4,Td,m4,i4,t4,Pd,Z1,G1,Y1,z1,F1,Ud,S1,k1,_1,b1,Fo,Yo,g1,f1,h1,a1,i1,n1,t1,e1,Qu,Gu,Yu,qu,uu,hu,Wu,pu,Bu,bu,Pu,j,Au,ku,i8,Cu,Eu,mn,Ht,Su,Mu,Fu,Tu,zu,Du,Nu,Lu,yu,Bo,ts,Iu,Vo,Vu,It,B,Uu,Ku,du,Yn,Lt,Xu,wt,Zu,Ju,au,Bn,Do,s1,o1,su,To,r1,c1,l1,d1,u1,qo,eu,Jd,p1,Zd,v1,Sn,j1,y1,Yd,w1,O1,x1,C1,E1,qd,A1,So,M1,ko,T1,pn,D1,N1,L1,R1,P1,H1,I1,B1,V1,$1,W1,U1,K1,q1,Qo,Zo,X1,Jo,Et,Fe,Ou,Ld,n4,s4,o4,ei,a4,r4,c4,l4,d4,u4,Dd,zd,Co,On,g4,Sd,Ne,j4,xd,_4,Od,L,x4,ai,E4,k4,A4,St,ri,bd,M,z4,gd,N4,L4,R4,P4,H4,I4,B4,V4,$4,W4,U4,K4,Y4,G4,X4,Q4,Z4,li,md,hd,n0,ud,o0,i0,di,Xt,mi,ad,I,ed,Gl,w0,Ue,$,re,Bl,Il,yi,S0,uo,Ll,Nl,Dl,zl,Tl,es,R0,P0,H0,I0,wi,kl,$0,Oi,xi,xl,Ci,Te,_l,X0,Rt,O,fl,h2,Bi,Wc,$c,Me,ht,j2,s,Ji,Ec,a,oa,F2,ca,la,da,ha,fa,ba,ut,Oa,ue,Dn,Ls,K2,xa,m,Ea,X2,P,Xr,J2,Gr,n3,s3,Gn,qr,Fs,r3,c3,y,G,As,g,vr,Xa,Un,Ya,z,jt,vt,gt,pt,Ba,jr,os,k,yt,Fa,Ma,M3,F3,nn,L3,R3,Qr,yn,Ca,K3,hs,dc,gs,eh,vs,ua,$e,ih,mt,Qe,ch,Yi,qs,mh,fh,jn,xt,vh,bh,Ai,J,ho,El,Fl,Oo,Ro,ld,We,dd,ci,jd,b,Tn,Id,Nh,Vd,Rh,zo,Go,Qd,Bh,Vh,tu,Ko,gu,ju,sc,Yh,Gh,Xh,Qh,ru,Gd,Nd,Md,kd,sm,Cd,rd,id,rm,od,sd,Ft,Xn,Jl,mm,bm,Al,xm,po,Cl,mo,Sm,Fm,Tm,zm,Dm,Nm,Ol,Rm,Pm,Hn,bt,Si,ll,qa,no,At,Di,nl,ae,Gc,qc,n8,s8,o8,Fc,Mc,r8,Sc,kc,Ps,na,Oc,m8,f8,wc,g8,v8,ia,aa,y8,ra,pc,Os,T,C8,E8,fc,ge,wn,F8,bs,hc,D8,N8,L8,R8,P8,I8,va,$8,W8,wa,K8,q8,Y8,G8,X8,Q8,Z8,J8,$r,tf,ot,Ta,rs,he,Qt,lf,df,Na,hf,mf,ff,Ra,Pa,bf,jf,yf,is,wf,Of,hr,Ja,Ef,kf,Af,ol,Ga,Ff,Qa,tr,Df,de,Ua,ls,Vf,Ct,Wf,be,Kf,qf,Yf,Gf,Xf,Qf,Zf,Jf,e6,t6,s6,i6,a6,on,Wa,l6,dn,ir,ar,rr,f6,cr,v6,b6,ps,_6,w6,O6,x6,C6,E6,k6,A6,js,M6,T6,z6,dr,N6,L6,P6,H6,I6,B6,q,ys,Ke,kn,q6,Y6,Ia,Da,Cs,Z6,kr,ep,Es,np,ks,op,ip,ap,rp,cp,lp,dp,up,hp,mp,fp,pp,gp,Lr,jp,ve,za,Pr,Op,vp,sp,J6,X6,G6,Ss,R6,Ir,j6,Ms,Br,n6,If,le,at,Vt,Ur,cf,rf,ef,ka,Jr,Rs,rc,Gt,cc,b8,bc,h8,sa,ta,qn,$m,ea,Nc,Rc,Pc,Cm,Om,wm,Hc,Ic,_m,vm,Bc,to,ao,xe,lt,am,pl,rt,qh,wl,Sl,Uh,Ml,_i,Rl,Sh,Ah,Eh,Vl,Ch,fo,Ul,ql,nd,yh,gh,bo,jo,vi,gi,fi,Ze,qe,$3,B3,pd,vd,yd,_3,j3,b3,ii,oi,wo,i3,o3,t3,e3,Z2,tt,xn,ni,fn,U2,W2,$2,B2,I2,P2,Ad,Fd,z2,T2,Rd,x2,Hd,Xo,e4,Q0,Xd,nu,K0,z0,T0,F0,k0,ou,O0,_0,p0,cu,mu,f4,h4,$u,$o,Ho,r7=class extends Q{constructor(e){super(),te(this,e,a7,null,U,{drawingMode:0,opts:1,target:2,tool:3,transform:4,viewer:5,viewportScale:6})}},{Boolean:c7}=pi;function i2(e,t,n){const s=e.slice();s[41]=t[n];const o=s[19](s[41].target.selector);return s[42]=o,s}function d7(e){let o=`${e[2]}-${e[7]}`,n,s,t=n2(e);return{c(){t.c(),n=st()},m(e,o){t.m(e,o),S(e,n,o),s=!0},p(e,s){s[0]&132&&U(o,o=`${e[2]}-${e[7]}`)?(ye(),p(t,1,1,N),je(),t=n2(e),t.c(),h(t,1),t.m(n.parentNode,n)):t.p(e,s)},i(){s||(h(t),s=!0)},o(){p(t),s=!1},d(e){e&&C(n),t.d(e)}}}function u7(e){let s,o,n=Dt(e[9].filter(e[29])),t=[];for(let s=0;s<n.length;s+=1)t[s]=Z0(i2(e,n,s));const i=e=>p(t[e],1,1,()=>{t[e]=null});return{c(){for(let e=0;e<t.length;e+=1)t[e].c();s=st()},m(e,n){for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,n);S(e,s,n),o=!0},p(e,o){if(o[0]&713474|o[1]&512){n=Dt(e[9].filter(e[29]));let a;for(a=0;a<n.length;a+=1){const i=i2(e,n,a);t[a]?(t[a].p(i,o),h(t[a],1)):(t[a]=Z0(i),t[a].c(),h(t[a],1),t[a].m(s.parentNode,s))}for(ye(),a=n.length;a<t.length;a+=1)i(a);je()}},i(){if(!o){for(let e=0;e<n.length;e+=1)h(t[e]);o=!0}},o(){t=t.filter(c7);for(let e=0;e<t.length;e+=1)p(t[e]);o=!1},d(e){e&&C(s),ji(t,e)}}}function n2(e){let t,n;return t=new r7({props:{target:e[8],tool:e[10],drawingMode:e[4],transform:{elementToImage:e[13]},viewer:e[3],viewportScale:e[40],opts:e[5]}}),t.$on("create",e[18]),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n[0]&256&&(s.target=e[8]),n[0]&1024&&(s.tool=e[10]),n[0]&16&&(s.drawingMode=e[4]),n[0]&8&&(s.viewer=e[3]),n[1]&512&&(s.viewportScale=e[40]),n[0]&32&&(s.opts=e[5]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function t2(e){let o=e[41].id,n,s,t=e2(e);return{c(){t.c(),n=st()},m(e,o){t.m(e,o),S(e,n,o),s=!0},p(e,s){s[0]&512&&U(o,o=e[41].id)?(ye(),p(t,1,1,N),je(),t=e2(e),t.c(),h(t,1),t.m(n.parentNode,n)):t.p(e,s)},i(){s||(h(t),s=!0)},o(){p(t),s=!1},d(e){e&&C(n),t.d(e)}}}function e2(e){let t,n;return t=new f3({props:{target:e[8],editor:e[19](e[41].target.selector),annotation:e[41],style:e[1],transform:{elementToImage:e[13]},viewportScale:e[40]}}),t.$on("grab",e[14]),t.$on("change",function(){wd(e[17](e[41]))&&e[17](e[41]).apply(this,arguments)}),t.$on("release",e[15]),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(n,s){e=n;const o={};s[0]&256&&(o.target=e[8]),s[0]&512&&(o.editor=e[19](e[41].target.selector)),s[0]&512&&(o.annotation=e[41]),s[0]&2&&(o.style=e[1]),s[1]&512&&(o.viewportScale=e[40]),t.$set(o)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function Z0(e){let n,s,t=e[42]&&t2(e);return{c(){t&&t.c(),n=st()},m(e,o){t&&t.m(e,o),S(e,n,o),s=!0},p(e,s){e[42]?t?(t.p(e,s),s[0]&512&&h(t,1)):(t=t2(e),t.c(),h(t,1),t.m(n.parentNode,n)):t&&(ye(),p(t,1,1,()=>{t=null}),je())},i(){s||(h(t),s=!0)},o(){p(t),s=!1},d(e){e&&C(n),t&&t.d(e)}}}function g7(e){let o,i,n,s,c,a,l,d;const u=[u7,d7],r=[];function m(e){var n;return e[8]&&((n=e[9])==null?0[0]:n.length)===1?0:e[8]&&e[10]&&e[0]?1:-1}return~(n=m(e))&&(s=r[n]=u[n](e)),{c(){o=F("svg"),i=F("g"),s&&s.c(),t(i,"transform",c=e[39]),t(i,"class","svelte-g4ws1v"),t(o,"tabindex",0),t(o,"class","a9s-annotationlayer a9s-osd-drawinglayer svelte-g4ws1v"),zn(o,"drawing",e[0]),zn(o,"editing",e[9]),zn(o,"hover",e[6])},m(t,s){S(t,o,s),Re(o,i),~n&&r[n].m(i,null),e[30](i),a=!0,l||(d=i5(o,"pointermove",e[16]),l=!0)},p(e,l){let d=n;n=m(e),n===d?~n&&r[n].p(e,l):(s&&(ye(),p(r[d],1,1,()=>{r[d]=null}),je()),~n?(s=r[n],s?s.p(e,l):(s=r[n]=u[n](e),s.c()),h(s,1),s.m(i,null)):s=null),(!a||l[1]&256&&c!==(c=e[39]))&&t(i,"transform",c),(!a||l[0]&1)&&zn(o,"drawing",e[0]),(!a||l[0]&512)&&zn(o,"editing",e[9]),(!a||l[0]&64)&&zn(o,"hover",e[6])},i(){a||(h(s),a=!0)},o(){p(s),a=!1},d(t){t&&C(o),~n&&r[n].d(),e[30](null),l=!1,d()}}}function v7(e){let t,n;return t=new Xo({props:{viewer:e[3],$$slots:{default:[g7,({transform:e,scale:t})=>({39:e,40:t}),({transform:e,scale:t})=>[0,(e?256:0)|(t?512:0)]]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n[0]&8&&(s.viewer=e[3]),n[0]&2047|n[1]&17152&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function b7(e,t,n){let p,u,f,h,v,{drawingEnabled:i}=t,{filter:r}=t,{multiSelect:_}=t,{preferredDrawingMode:y}=t,{state:j}=t,{style:O=0[0]}=t,{toolName:m=fd()[0]}=t,{user:c}=t,{viewer:s}=t;const z=pe?10:2;let x=!1,C=0;const F=()=>n(7,C+=1),A=()=>m,S=()=>i;let b;const{store:o,selection:a,hover:d}=j;Eo(e,a,e=>n(28,h=e)),Eo(e,d,e=>n(33,v=e));let w,l,k;const M=e=>{o.unobserve(w);const t=e.filter(({editable:e})=>e).map(({id:e})=>e);t.length>0?(n(9,l=t.map(e=>o.getAnnotation(e))),w=e=>{const{updated:t}=e.changes;n(9,l=(t||[]).map(e=>e.newValue))},o.observe(w,{annotations:t}),s.forceRedraw()):n(9,l=0[0])},E=(e,t)=>{const{x:n,y:o}=s.viewport.viewerElementToImageCoordinates(new tn.default.Point(e,t));return[n,o]},T=()=>{const e=s.viewport.getContainerSize().x;return s.viewport.getZoom(!0)*e/s.world.getContentFactor()},g=()=>z/T(),D=e=>{s.setMouseNavEnabled(!1),k=e.timeStamp},N=e=>{if(s.setMouseNavEnabled(!0),performance.now()-(k||0)<300){const{offsetX:n,offsetY:s}=e.detail,[i,c]=E(n,s),u=g(),t=o.getAt(i,c,0[0],u);if(t&&(!r||r(t))&&!l.find(e=>e.id===t.id)){d.set(t.id);const n=Rd(t.id,e.detail,a,_);a.userSelect(n)}}},L=e=>{const i=new tn.default.Point(e.offsetX,e.offsetY),n=s.viewport.pointFromPixel(i),{x:a,y:c}=s.viewport.viewportToImageCoordinates(n.x,n.y),l=g(),t=o.getAt(a,c,r,l);t?v!==t.id&&d.set(t.id):v&&d.set(0[0])},R=e=>t=>{var i;const{target:n}=e,a=10*60*1e3,s=((i=n.creator)==null?0[0]:i.id)!==c.id||!n.created||(new Date).getTime()-n.created.getTime()>a;o.updateTarget({...n,selector:t.detail,created:s?n.created:new Date,updated:s?new Date:0[0],updatedBy:s?c:0[0]})},P=e=>{const t=xp(),n={id:t,bodies:[],target:{annotation:t,selector:e.detail,creator:c,created:new Date}};o.addAnnotation(n),a.setSelected(n.id),s.setMouseNavEnabled(!0)},H=e=>vl(e);so(()=>{const e=e=>{if(h.selected.length===0)return;const{offsetX:i,offsetY:a}=e,t=s.viewport.pointFromPixel(new tn.default.Point(i,a)),{x:c,y:l}=s.viewport.viewportToImageCoordinates(t.x,t.y),d=g();n(6,x=!!o.getAt(c,l,r,d))};return s.element.addEventListener("pointermove",e),()=>{var t;(t=s.element)==null||t.removeEventListener("pointermove",e)}});const I=e=>ct(e);function B(e){Qs[e?"unshift":"push"](()=>{b=e,n(8,b)})}return e.$$set=e=>{"drawingEnabled"in e&&n(0,i=e.drawingEnabled),"filter"in e&&n(20,r=e.filter),"multiSelect"in e&&n(21,_=e.multiSelect),"preferredDrawingMode"in e&&n(22,y=e.preferredDrawingMode),"state"in e&&n(23,j=e.state),"style"in e&&n(1,O=e.style),"toolName"in e&&n(2,m=e.toolName),"user"in e&&n(24,c=e.user),"viewer"in e&&n(3,s=e.viewer)},e.$$.update=()=>{e.$$.dirty[0]&4&&n(10,{tool:p,opts:u}=_d(m)||{tool:0[0],opts:0[0]},p,(n(5,u),n(2,m))),e.$$.dirty[0]&4194336&&n(4,f=u?.drawingMode||y),e.$$.dirty[0]&25&&(i&&f==="drag"?s.setMouseNavEnabled(!1):s.setMouseNavEnabled(!0)),e.$$.dirty[0]&1&&i&&a.clear(),e.$$.dirty[0]&268435481&&h.selected.length===0&&f==="drag"&&i&&s.setMouseNavEnabled(!1),e.$$.dirty[0]&268435456&&M(h.selected)},[i,O,m,s,f,u,x,C,b,l,p,a,d,E,D,N,L,R,P,H,r,_,y,j,c,F,A,S,h,I,B]}Q0=class extends Q{constructor(e){super(),te(this,e,b7,v7,U,{drawingEnabled:0,filter:20,multiSelect:21,preferredDrawingMode:22,state:23,style:1,toolName:2,user:24,viewer:3,cancelDrawing:25,getDrawingTool:26,isDrawingEnabled:27},null,[-1,-1])}get cancelDrawing(){return this.$$.ctx[25]}get getDrawingTool(){return this.$$.ctx[26]}get isDrawingEnabled(){return this.$$.ctx[27]}};function y7(e){let o,n,i,a,r,c,s,l=e[2].appearance.label+"",m,d,u,h;return{c(){o=F("g"),n=F("rect"),s=F("text"),m=Oh(l),t(n,"class","a9s-presence-label-bg svelte-1rehw2p"),t(n,"x",e[0]),t(n,"y",i=e[1]-18/e[3]),t(n,"height",a=18/e[3]),t(n,"fill",r=e[2].appearance.color),t(n,"stroke",c=e[2].appearance.color),t(s,"font-size",d=12/e[3]),t(s,"x",u=e[0]+Math.round(5/e[3])),t(s,"y",h=e[1]-5/e[3]),t(s,"class","svelte-1rehw2p"),t(o,"class","a9s-presence-label")},m(t,i){S(t,o,i),Re(o,n),Re(o,s),Re(s,m),e[6](o)},p(e,[o]){o&1&&t(n,"x",e[0]),o&10&&i!==(i=e[1]-18/e[3])&&t(n,"y",i),o&8&&a!==(a=18/e[3])&&t(n,"height",a),o&4&&r!==(r=e[2].appearance.color)&&t(n,"fill",r),o&4&&c!==(c=e[2].appearance.color)&&t(n,"stroke",c),o&4&&l!==(l=e[2].appearance.label+"")&&r5(m,l),o&8&&d!==(d=12/e[3])&&t(s,"font-size",d),o&9&&u!==(u=e[0]+Math.round(5/e[3]))&&t(s,"x",u),o&10&&h!==(h=e[1]-5/e[3])&&t(s,"y",h)},i:N,o:N,d(t){t&&C(o),e[6](null)}}}function _7(e,t,n){let{x:a}=t,{y:r}=t,{user:c}=t,{scale:o}=t,{hAlign:i=null}=t,s;const l=e=>{const n=s.querySelector("text"),o=s.querySelector("rect"),t=n.getBBox().width+10/e;i==="CENTER"&&s.setAttribute("style",`transform: translateX(-${t/2}px)`),o.setAttribute("width",`${t}`)};function d(e){Qs[e?"unshift":"push"](()=>{s=e,n(4,s)})}return e.$$set=e=>{"x"in e&&n(0,a=e.x),"y"in e&&n(1,r=e.y),"user"in e&&n(2,c=e.user),"scale"in e&&n(3,o=e.scale),"hAlign"in e&&n(5,i=e.hAlign)},e.$$.update=()=>{e.$$.dirty&24&&s&&l(o)},[a,r,c,o,s,i,d]}Xd=class extends Q{constructor(e){super(),te(this,e,_7,y7,U,{x:0,y:1,user:2,scale:3,hAlign:5})}};function O7(e){let o,s,n,a,r,i;return s=new Xd({props:{scale:e[1],user:e[0],x:e[3][0],y:e[3][1],hAlign:"CENTER"}}),{c(){o=F("g"),oe(s.$$.fragment),n=F("polygon"),t(n,"class","a9s-presence-shape a9s-presence-polygon svelte-fgq4n0"),t(n,"stroke",a=e[0].appearance.color),t(n,"fill","transparent"),t(n,"points",r=e[2].points.map(nu).join(" ")),t(o,"class","a9s-presence-overlay")},m(e,t){S(e,o,t),Z(s,o,null),Re(o,n),i=!0},p(e,[o]){const c={};o&2&&(c.scale=e[1]),o&1&&(c.user=e[0]),o&8&&(c.x=e[3][0]),o&8&&(c.y=e[3][1]),s.$set(c),(!i||o&1&&a!==(a=e[0].appearance.color))&&t(n,"stroke",a),(!i||o&4&&r!==(r=e[2].points.map(nu).join(" ")))&&t(n,"points",r)},i(e){i||(h(s.$$.fragment,e),i=!0)},o(e){p(s.$$.fragment,e),i=!1},d(e){e&&C(o),ee(s)}}}nu=e=>e.join(",");function C7(e,t,n){let s,i,{annotation:o}=t,{user:a}=t,{scale:r}=t;const c=e=>{let[t,...n]=e.points;return n.forEach(([e,n])=>{n<t[1]&&(t=[e,n])}),t};return e.$$set=e=>{"annotation"in e&&n(4,o=e.annotation),"user"in e&&n(0,a=e.user),"scale"in e&&n(1,r=e.scale)},e.$$.update=()=>{e.$$.dirty&16&&n(2,s=o.target.selector.geometry),e.$$.dirty&4&&n(3,i=c(s))},[a,r,s,i,o]}K0=class extends Q{constructor(e){super(),te(this,e,C7,O7,U,{annotation:4,user:0,scale:1})}};function k7(e){let i,o,n,a,r,c,l,d,s;return o=new Xd({props:{scale:e[1],user:e[0],x:e[2].x,y:e[2].y}}),{c(){i=F("g"),oe(o.$$.fragment),n=F("rect"),t(n,"class","a9s-presence-shape a9s-presence-rectangle svelte-gze948"),t(n,"stroke",a=e[0].appearance.color),t(n,"fill","transparent"),t(n,"x",r=e[2].x),t(n,"y",c=e[2].y),t(n,"width",l=e[2].w),t(n,"height",d=e[2].h),t(i,"class","a9s-presence-overlay")},m(e,t){S(e,i,t),Z(o,i,null),Re(i,n),s=!0},p(e,[i]){const u={};i&2&&(u.scale=e[1]),i&1&&(u.user=e[0]),i&4&&(u.x=e[2].x),i&4&&(u.y=e[2].y),o.$set(u),(!s||i&1&&a!==(a=e[0].appearance.color))&&t(n,"stroke",a),(!s||i&4&&r!==(r=e[2].x))&&t(n,"x",r),(!s||i&4&&c!==(c=e[2].y))&&t(n,"y",c),(!s||i&4&&l!==(l=e[2].w))&&t(n,"width",l),(!s||i&4&&d!==(d=e[2].h))&&t(n,"height",d)},i(e){s||(h(o.$$.fragment,e),s=!0)},o(e){p(o.$$.fragment,e),s=!1},d(e){e&&C(i),ee(o)}}}function A7(e,t,n){let o,{annotation:s}=t,{user:i}=t,{scale:a}=t;return e.$$set=e=>{"annotation"in e&&n(3,s=e.annotation),"user"in e&&n(0,i=e.user),"scale"in e&&n(1,a=e.scale)},e.$$.update=()=>{e.$$.dirty&8&&n(2,o=s.target.selector.geometry)},[i,a,o,s]}var S7=class extends Q{constructor(e){super(),te(this,e,A7,k7,U,{annotation:3,user:0,scale:1})}},{Boolean:M7}=pi;function U0(e,t,n){const s=e.slice();return s[8]=t[n],s}function W0(e){let t,n;return t=new Xo({props:{viewer:e[0],$$slots:{default:[R7,({transform:e,scale:t})=>({6:e,7:t}),({transform:e,scale:t})=>(e?64:0)|(t?128:0)]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&1&&(s.viewer=e[0]),n&2244&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function B0(e){let s,o,n=Dt(e[2]),t=[];for(let s=0;s<n.length;s+=1)t[s]=N0(U0(e,n,s));const i=e=>p(t[e],1,1,()=>{t[e]=null});return{c(){for(let e=0;e<t.length;e+=1)t[e].c();s=st()},m(e,n){for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,n);S(e,s,n),o=!0},p(e,o){if(o&132){n=Dt(e[2]);let a;for(a=0;a<n.length;a+=1){const i=U0(e,n,a);t[a]?(t[a].p(i,o),h(t[a],1)):(t[a]=N0(i),t[a].c(),h(t[a],1),t[a].m(s.parentNode,s))}for(ye(),a=n.length;a<t.length;a+=1)i(a);je()}},i(){if(!o){for(let e=0;e<n.length;e+=1)h(t[e]);o=!0}},o(){t=t.filter(M7);for(let e=0;e<t.length;e+=1)p(t[e]);o=!1},d(e){e&&C(s),ji(t,e)}}}function D7(e){let t,n;return t=new K0({props:{annotation:e[8].annotation,user:e[8].selectedBy,scale:e[7]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&4&&(s.annotation=e[8].annotation),n&4&&(s.user=e[8].selectedBy),n&128&&(s.scale=e[7]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function N7(e){let t,n;return t=new S7({props:{annotation:e[8].annotation,user:e[8].selectedBy,scale:e[7]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&4&&(s.annotation=e[8].annotation),n&4&&(s.user=e[8].selectedBy),n&128&&(s.scale=e[7]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function N0(e){let t,n,o,i;const a=[N7,D7],s=[];function r(e){return e[8].annotation.target.selector.type===f.RECTANGLE?0:e[8].annotation.target.selector.type===f.POLYGON?1:-1}return~(t=r(e))&&(n=s[t]=a[t](e)),{c(){n&&n.c(),o=st()},m(e,n){~t&&s[t].m(e,n),S(e,o,n),i=!0},p(e,i){let c=t;t=r(e),t===c?~t&&s[t].p(e,i):(n&&(ye(),p(s[c],1,1,()=>{s[c]=null}),je()),~t?(n=s[t],n?n.p(e,i):(n=s[t]=a[t](e),n.c()),h(n,1),n.m(o.parentNode,o)):n=null)},i(){i||(h(n),i=!0)},o(){p(n),i=!1},d(e){e&&C(o),~t&&s[t].d(e)}}}function R7(e){let o,s,a,i,n=e[2].length>0&&B0(e);return{c(){o=F("svg"),s=F("g"),n&&n.c(),t(s,"transform",a=e[6]),t(o,"class","a9s-osd-presencelayer svelte-1krwc4m")},m(e,t){S(e,o,t),Re(o,s),n&&n.m(s,null),i=!0},p(e,o){e[2].length>0?n?(n.p(e,o),o&4&&h(n,1)):(n=B0(e),n.c(),h(n,1),n.m(s,null)):n&&(ye(),p(n,1,1,()=>{n=null}),je()),(!i||o&64&&a!==(a=e[6]))&&t(s,"transform",a)},i(){i||(h(n),i=!0)},o(){p(n),i=!1},d(e){e&&C(o),n&&n.d()}}}function P7(e){let o=!!e[1],n,s,t=o&&W0(e);return{c(){t&&t.c(),n=st()},m(e,o){t&&t.m(e,o),S(e,n,o),s=!0},p(e,[s]){s&2&&(o=!!e[1]),o?t?(t.p(e,s),s&2&&h(t,1)):(t=W0(e),t.c(),h(t,1),t.m(n.parentNode,n)):t&&(ye(),p(t,1,1,()=>{t=null}),je())},i(){s||(h(t),s=!0)},o(){p(t),s=!1},d(e){e&&C(n),t&&t.d(e)}}}function H7(e,t,n){let{store:s}=t,{viewer:r}=t,{provider:a}=t,o=[],i;const c=(e,t)=>{n(2,o=[...o.filter(({selectedBy:t})=>t.presenceKey!==e.presenceKey),...(t||[]).map(t=>({annotation:s.getAnnotation(t),selectedBy:e}))].filter(({annotation:e})=>(e||console.warn("Selection event on unknown annotation"),!!e))),i&&s.unobserve(i),i=e=>{const{deleted:t,updated:s}=e.changes,i=new Set((t||[]).map(e=>e.id)),a=o.filter(({annotation:e})=>!i.has(e.id)).map(e=>{const t=(s||[]).find(t=>t.oldValue.id===e.annotation.id);return t?{selectedBy:e.selectedBy,annotation:t.newValue}:e});n(2,o=a)},s.observe(i,{annotations:o.map(e=>e.annotation.id)})};return l5(()=>{i&&s.unobserve(i)}),e.$$set=e=>{"store"in e&&n(3,s=e.store),"viewer"in e&&n(0,r=e.viewer),"provider"in e&&n(1,a=e.provider)},e.$$.update=()=>{e.$$.dirty&2&&a&&a.on("selectionChange",c)},[r,a,o,s]}z0=class extends Q{constructor(e){super(),te(this,e,H7,P7,U,{store:3,viewer:0,provider:1})}};function B7(e){let n,s,o,i,a;return{c(){n=F("ellipse"),t(n,"cx",s=e[0].cx),t(n,"cy",o=e[0].cy),t(n,"rx",i=e[0].rx),t(n,"ry",a=e[0].ry)},m(e,t){S(e,n,t)},p(e,[r]){r&1&&s!==(s=e[0].cx)&&t(n,"cx",s),r&1&&o!==(o=e[0].cy)&&t(n,"cy",o),r&1&&i!==(i=e[0].rx)&&t(n,"rx",i),r&1&&a!==(a=e[0].ry)&&t(n,"ry",a)},i:N,o:N,d(e){e&&C(n)}}}function V7(e,t,n){let o,{annotation:s}=t;return e.$$set=e=>{"annotation"in e&&n(1,s=e.annotation)},e.$$.update=()=>{e.$$.dirty&2&&n(0,o=s.target.selector.geometry)},[o,s]}T0=class extends Q{constructor(e){super(),te(this,e,V7,B7,U,{annotation:1})}};function W7(e){let n,s,o,i,a;return{c(){n=F("line"),t(n,"x1",s=e[0].points[0][0]),t(n,"y1",o=e[0].points[0][1]),t(n,"x2",i=e[0].points[1][0]),t(n,"y2",a=e[0].points[1][1])},m(e,t){S(e,n,t)},p(e,[r]){r&1&&s!==(s=e[0].points[0][0])&&t(n,"x1",s),r&1&&o!==(o=e[0].points[0][1])&&t(n,"y1",o),r&1&&i!==(i=e[0].points[1][0])&&t(n,"x2",i),r&1&&a!==(a=e[0].points[1][1])&&t(n,"y2",a)},i:N,o:N,d(e){e&&C(n)}}}function U7(e,t,n){let o,{annotation:s}=t;return e.$$set=e=>{"annotation"in e&&n(1,s=e.annotation)},e.$$.update=()=>{e.$$.dirty&2&&n(0,o=s.target.selector.geometry)},[o,s]}F0=class extends Q{constructor(e){super(),te(this,e,U7,W7,U,{annotation:1})}};function M0(e,t,n){const s=e.slice();return s[2]=t[n],s}function A0(e){let s,n;return{c(){s=F("path"),n=F("path"),t(s,"fill-rule","evenodd"),t(s,"d",Ie(e[2])),t(n,"class","a9s-inner"),t(n,"fill-rule","evenodd"),t(n,"d",Ie(e[2]))},m(e,t){S(e,s,t),S(e,n,t)},p:N,d(e){e&&(C(s),C(n))}}}function G7(e){let s,n=Dt(e[0]),t=[];for(let s=0;s<n.length;s+=1)t[s]=A0(M0(e,n,s));return{c(){s=F("g");for(let e=0;e<t.length;e+=1)t[e].c()},m(e,n){S(e,s,n);for(let e=0;e<t.length;e+=1)t[e]&&t[e].m(s,null)},p(e,[o]){if(o&1){n=Dt(e[0]);let i;for(i=0;i<n.length;i+=1){const a=M0(e,n,i);t[i]?t[i].p(a,o):(t[i]=A0(a),t[i].c(),t[i].m(s,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},i:N,o:N,d(e){e&&C(s),ji(t,e)}}}function X7(e,t,n){let{annotation:s}=t;const{polygons:o}=s.target.selector.geometry;return e.$$set=e=>{"annotation"in e&&n(1,s=e.annotation)},[o,s]}k0=class extends Q{constructor(e){super(),te(this,e,X7,G7,U,{annotation:1})}};function Z7(e){let n,s;return{c(){n=F("polygon"),t(n,"points",s=e[0].points.map(ou).join(" "))},m(e,t){S(e,n,t)},p(e,[o]){o&1&&s!==(s=e[0].points.map(ou).join(" "))&&t(n,"points",s)},i:N,o:N,d(e){e&&C(n)}}}ou=e=>e.join(",");function ev(e,t,n){let o,{annotation:s}=t;return e.$$set=e=>{"annotation"in e&&n(1,s=e.annotation)},e.$$.update=()=>{e.$$.dirty&2&&n(0,o=s.target.selector.geometry)},[o,s]}O0=class extends Q{constructor(e){super(),te(this,e,ev,Z7,U,{annotation:1})}};function nv(e){let n;return{c(){n=F("path"),t(n,"d",e[0])},m(e,t){S(e,n,t)},p(e,[s]){s&1&&t(n,"d",e[0])},i:N,o:N,d(e){e&&C(n)}}}function sv(e,t,n){let s,i,{annotation:o}=t;return e.$$set=e=>{"annotation"in e&&n(1,o=e.annotation)},e.$$.update=()=>{e.$$.dirty&2&&n(2,s=o.target.selector.geometry),e.$$.dirty&4&&n(0,i=tc(s))},[i,o,s]}_0=class extends Q{constructor(e){super(),te(this,e,sv,nv,U,{annotation:1})}};function iv(e){let n,s,o,i,a;return{c(){n=F("rect"),t(n,"x",s=e[0].x),t(n,"y",o=e[0].y),t(n,"width",i=e[0].w),t(n,"height",a=e[0].h)},m(e,t){S(e,n,t)},p(e,[r]){r&1&&s!==(s=e[0].x)&&t(n,"x",s),r&1&&o!==(o=e[0].y)&&t(n,"y",o),r&1&&i!==(i=e[0].w)&&t(n,"width",i),r&1&&a!==(a=e[0].h)&&t(n,"height",a)},i:N,o:N,d(e){e&&C(n)}}}function av(e,t,n){let o,{annotation:s}=t;return e.$$set=e=>{"annotation"in e&&n(1,s=e.annotation)},e.$$.update=()=>{e.$$.dirty&2&&n(0,o=s.target.selector.geometry)},[o,s]}var rv=class extends Q{constructor(e){super(),te(this,e,av,iv,U,{annotation:1})}},{Boolean:cv}=pi;function y0(e,t,n){const s=e.slice();return s[10]=t[n],s}function j0(e){let t,n;return t=new Xo({props:{viewer:e[0],$$slots:{default:[bv,({transform:e})=>({9:e}),({transform:e})=>e?512:0]},$$scope:{ctx:e}}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&1&&(s.viewer=e[0]),n&8710&&(s.$$scope={dirty:n,ctx:e}),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function uv(e){let t,n;return t=new F0({props:{annotation:e[10]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&2&&(s.annotation=e[10]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function hv(e){let t,n;return t=new T0({props:{annotation:e[10]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&2&&(s.annotation=e[10]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function mv(e){let t,n;return t=new _0({props:{annotation:e[10]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&2&&(s.annotation=e[10]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function T5(e){let t,n;return t=new k0({props:{annotation:e[10]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&2&&(s.annotation=e[10]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function pv(e){let t,n;return t=new O0({props:{annotation:e[10]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&2&&(s.annotation=e[10]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function gv(e){let t,n;return t=new rv({props:{annotation:e[10]}}),{c(){oe(t.$$.fragment)},m(e,s){Z(t,e,s),n=!0},p(e,n){const s={};n&2&&(s.annotation=e[10]),t.$set(s)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){p(t.$$.fragment,e),n=!1},d(e){ee(t,e)}}}function g0(e){let t,n,o,i;const a=[gv,pv,T5,mv,hv,uv],s=[];function r(e){return e[10].target.selector.type===f.RECTANGLE?0:e[10].target.selector.type===f.POLYGON?1:e[10].target.selector.type===f.MULTIPOLYGON?2:e[10].target.selector.type===f.POLYLINE?3:e[10].target.selector.type===f.ELLIPSE?4:e[10].target.selector.type===f.LINE?5:-1}return~(t=r(e))&&(n=s[t]=a[t](e)),{c(){n&&n.c(),o=st()},m(e,n){~t&&s[t].m(e,n),S(e,o,n),i=!0},p(e,i){let c=t;t=r(e),t===c?~t&&s[t].p(e,i):(n&&(ye(),p(s[c],1,1,()=>{s[c]=null}),je()),~t?(n=s[t],n?n.p(e,i):(n=s[t]=a[t](e),n.c()),h(n,1),n.m(o.parentNode,o)):n=null)},i(){i||(h(n),i=!0)},o(){p(n),i=!1},d(e){e&&C(o),~t&&s[t].d(e)}}}function bv(e){let c,a,i,j,b,v,d,o,l,u,m,f,g,s,r=Dt(e[1].filter(e[6])),n=[];for(let t=0;t<r.length;t+=1)n[t]=g0(y0(e,r,t));const y=e=>p(n[e],1,1,()=>{n[e]=null});return{c(){var s,r,h,p;c=F("svg"),a=F("g"),i=F("rect"),o=F("rect");for(let e=0;e<n.length;e+=1)n[e].c();t(i,"class","a9s-union-bg svelte-jwrce3"),t(i,"x",j=(s=e[2])==null?0[0]:s.minX),t(i,"y",b=(r=e[2])==null?0[0]:r.minY),t(i,"width",v=e[2]?e[2].maxX-e[2].minX:0),t(i,"height",d=e[2]?e[2].maxY-e[2].minY:0),t(o,"class","a9s-union-fg svelte-jwrce3"),t(o,"x",l=(h=e[2])==null?0[0]:h.minX),t(o,"y",u=(p=e[2])==null?0[0]:p.minY),t(o,"width",m=e[2]?e[2].maxX-e[2].minX:0),t(o,"height",f=e[2]?e[2].maxY-e[2].minY:0),t(a,"transform",g=e[9]),t(c,"class","a9s-osd-selectionlayer svelte-jwrce3")},m(e,t){S(e,c,t),Re(c,a),Re(a,i),Re(a,o);for(let e=0;e<n.length;e+=1)n[e]&&n[e].m(a,null);s=!0},p(e,c){var p,_,w,O;if((!s||c&4&&j!==(j=(p=e[2])==null?0[0]:p.minX))&&t(i,"x",j),(!s||c&4&&b!==(b=(_=e[2])==null?0[0]:_.minY))&&t(i,"y",b),(!s||c&4&&v!==(v=e[2]?e[2].maxX-e[2].minX:0))&&t(i,"width",v),(!s||c&4&&d!==(d=e[2]?e[2].maxY-e[2].minY:0))&&t(i,"height",d),(!s||c&4&&l!==(l=(w=e[2])==null?0[0]:w.minX))&&t(o,"x",l),(!s||c&4&&u!==(u=(O=e[2])==null?0[0]:O.minY))&&t(o,"y",u),(!s||c&4&&m!==(m=e[2]?e[2].maxX-e[2].minX:0))&&t(o,"width",m),(!s||c&4&&f!==(f=e[2]?e[2].maxY-e[2].minY:0))&&t(o,"height",f),c&2){r=Dt(e[1].filter(e[6]));let t;for(t=0;t<r.length;t+=1){const s=y0(e,r,t);n[t]?(n[t].p(s,c),h(n[t],1)):(n[t]=g0(s),n[t].c(),h(n[t],1),n[t].m(a,null))}for(ye(),t=r.length;t<n.length;t+=1)y(t);je()}(!s||c&512&&g!==(g=e[9]))&&t(a,"transform",g)},i(){if(!s){for(let e=0;e<r.length;e+=1)h(n[e]);s=!0}},o(){n=n.filter(cv);for(let e=0;e<n.length;e+=1)p(n[e]);s=!1},d(e){e&&C(c),ji(n,e)}}}function jv(e){let o=!!e[2],n,s,t=o&&j0(e);return{c(){t&&t.c(),n=st()},m(e,o){t&&t.m(e,o),S(e,n,o),s=!0},p(e,[s]){s&4&&(o=!!e[2]),o?t?(t.p(e,s),s&4&&h(t,1)):(t=j0(e),t.c(),h(t,1),t.m(n.parentNode,n)):t&&(ye(),p(t,1,1,()=>{t=null}),je())},i(){s||(h(t),s=!0)},o(){p(t),s=!1},d(e){e&&C(n),t&&t.d(e)}}}function yv(e,t,n){let s,r,i,{state:o}=t,{viewer:a}=t;const{store:l}=o,{selection:c}=o;Eo(e,c,e=>n(5,i=e));const d=e=>{let t=-1/0,n=-1/0,s=1/0,o=1/0;for(let a of e.filter(e=>ct(e))){const{bounds:i}=a.target.selector.geometry;i.maxX>t&&(t=i.maxX),i.maxY>n&&(n=i.maxY),i.minX<s&&(s=i.minX),i.minY<o&&(o=i.minY)}return a.forceRedraw(),{maxX:t,maxY:n,minX:s,minY:o}},u=e=>ct(e);return e.$$set=e=>{"state"in e&&n(4,o=e.state),"viewer"in e&&n(0,a=e.viewer)},e.$$.update=()=>{e.$$.dirty&32&&n(1,s=i.selected.map(({id:e})=>l.getAnnotation(e))),e.$$.dirty&2&&n(2,r=s.length>1?d(s):0[0])},[a,s,r,c,o,i,u]}p0=class extends Q{constructor(e){super(),te(this,e,yv,jv,U,{state:4,viewer:0})}},cu=(e,t)=>{t==="auto"?e.addHandler("open",t=>{const n=e.world.getItemCount();e.world.getItemAt(n-1).addOnceHandler("fully-loaded-change",t=>{const{fullyLoaded:n}=t;if(n){const t=e.canvas.querySelector("canvas"),n=Ph(t);e.element.setAttribute("data-theme",n)}})}):e.element.setAttribute("data-theme",t)},mu=(e,t,n)=>(s,o={})=>{const v=typeof s=="string"?s:s.id,h=t.getAnnotation(v);if(!h||!ct(h))return;const c=e.container.getBoundingClientRect(),{padding:i}=o;let[a,d,u,r]=i?Array.isArray(i)?i:[i,i,i,i]:[0,0,0,0];a=a/c.height,d=d/c.width,u=u/c.height,r=r/c.width;const{minX:f,minY:p,maxX:b,maxY:g}=h.target.selector.geometry.bounds,l=b-f,m=g-p,j=f-r*l,y=p-a*m,_=l+(d+r)*l,w=m+(a+u)*m,O=e.viewport.imageToViewportRectangle(j,y,_,w);e.viewport[n](O,o.immediately)},f4=(e,t)=>mu(e,t,"fitBounds"),h4=(e,t)=>mu(e,t,"fitBoundsWithConstraints"),$u=(e,t={})=>{const n=Lh(t,{drawingEnabled:!1,drawingMode:pe?"drag":"click",userSelectAction:$d.EDIT,theme:"light"}),o=Ih(n),{hover:f,selection:i,store:r}=o,c=O3(r,n.initialHistory),l=C3(o,c,n.adapter,n.autoSave);let u=uh(),d=n.drawingEnabled,h=n.drawingMode,m=n.modalSelect;const b=Dh(c,e.element),a=new T2({target:e.element,props:{state:o,viewer:e,style:n.style,filter:0[0]}}),p=new z0({target:e.element.querySelector(".openseadragon-canvas"),props:{provider:0[0],store:r,viewer:e}}),s=new Q0({target:e.element.querySelector(".openseadragon-canvas"),props:{drawingEnabled:!!d,filter:0[0],multiSelect:n.multiSelect,preferredDrawingMode:h,state:o,style:n.style,user:u,viewer:e}}),k=new p0({target:e.element.querySelector(".openseadragon-canvas"),props:{state:o,viewer:e}});a.$on("click",e=>{const{originalEvent:t,annotation:s}=e.detail,o=e=>Rd(e.id,t,i,n.multiSelect);m?i.isEmpty()&&s&&i.userSelect(o(s),t):s&&!(h==="click"&&d)?i.userSelect(o(s),t):i.isEmpty()||(n.multiSelect?t.metaKey||t.shiftKey||t.ctrlKey||i.userSelect([],t):i.userSelect([],t))}),e.element.addEventListener("pointerdown",e=>{if(f.current){const t=r.getAnnotation(f.current);l.emit("clickAnnotation",t,e)}}),cu(e,n.theme);const g=U3(o,c,n.adapter),j=()=>s.cancelDrawing(),y=()=>{a.$destroy(),p.$destroy(),s.$destroy(),k.$destroy(),b.destroy(),c.destroy()},_=f4(e,r),w=h4(e,r),O=()=>s.getDrawingTool(),x=()=>u,C=()=>s.isDrawingEnabled(),E=(e,t,n)=>om(e,t,n),v=(e,t)=>Lm(e,t),A=e=>{if(!_d(e))throw`No drawing tool named ${e}`;s.$set({toolName:e})},S=e=>{d=e,s.$set({drawingEnabled:e})},M=e=>{a.$set({filter:e}),s.$set({filter:e})},F=e=>m=e,T=e=>{a.$set({style:e}),s.$set({style:e})},z=e=>p.$set({provider:e}),D=t=>cu(e,t),N=e=>{u=e,s.$set({user:e})},L=e=>a.$set({visible:e});return{...g,cancelDrawing:j,destroy:y,fitBounds:_,fitBoundsWithConstraints:w,getDrawingTool:O,getUser:x,isDrawingEnabled:C,listDrawingTools:fd,on:l.on,off:l.off,registerDrawingTool:E,registerShapeEditor:v,setDrawingEnabled:S,setDrawingTool:A,setFilter:M,setModalSelect:F,setPresenceProvider:z,setStyle:T,setTheme:D,setUser:N,setVisible:L,state:o,viewer:e}},$o=Uo(C0());async function Av(e){const t=await fetch(e);if(!t.ok)throw new Error(`Response status: ${t.status}`);const n=await t.json();return new $o.Manifest(n)}async function Sv(e){const n=e+"/info.json",t=await fetch(n);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.json()}function Mv(e,t=0){const n=e.getSequenceByIndex(t),s=n.getCanvasByIndex(0);return s}function Fv(e,t=0){const n=e.getSequenceByIndex(t);return n.getCanvases()}function Tv(e,t=0){const n=Mv(e,t),s=n.getContent()[0],o=s.getBody()[0],i=o.getServices()[0];return i.id}function zv(e,t=0){const s=Fv(e,t),o=Dv(s),i=o[0].getItems(),n=[];for(const t of i){let e=t.getTarget();if(e===0[0])continue;if(typeof e=="string"&&e.match(/#xywh/gi)){const n=/#xywh=(\d+,\d+,\d+,\d+)$/i,s=e.match(n);e={source:e.replace(n,""),selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:`xywh=pixel:${s[1]}`}},t.__jsonld.target=e}n.push(t)}return n}function Dv(e,t){const n=[];return e.length&&e.forEach(e=>{const s=e.getProperty("annotations")||[];return n.push(...s.map(e=>{const n=e.items;return new $o.AnnotationPage({...e,items:n.map(e=>new $o.Annotation(e,t)),type:e.type},t)})),[]}),n}Ho=!1;async function Lv(e,t,n=0){const a=await Av(t),i=Tv(a,n);let s;try{s=await Sv(i),console.log(`Loaded service`,s)}catch{console.warn(`Failed to get ${i}`)}if(s===0[0])throw new Error("Failed to find service");const r={showNavigator:!1,showNavigationControl:!1,id:e,preserveViewport:!0,visibilityRatio:1,minZoomLevel:.5,defaultZoomLevel:.5,drawer:"canvas",crossOriginPolicy:"Anonymous",tileSources:[s],gestureSettingsMouse:{clickToZoom:!1},gestureSettingsTouch:{pinchRotate:!1,dragToPan:!1}};Ho&&(r.showNavigationControl=!0);const c=(0,q0.default)(r),d=(e,t)=>{let s=!1;e.bodies[0].type=="Boolean"&&(s=e.bodies[0].value);const{hovered:n,selected:o}=t||{};return s&&Ho?{fill:"#000000",stroke:"#ff0000",fillOpacity:n?.7:.3,strokeOpacity:n?.7:.5,strokeWidth:n?2:1}:e.bodies[0].type=="TextualBody"?{fill:"#ffffff",stroke:"#ff0000",fillOpacity:n?.2:0,strokeOpacity:n?.7:.5,strokeWidth:n?2:1}:{fillOpacity:0,strokeOpacity:0}},u={autoSave:!1,drawingEnabled:!1,style:d,adapter:Tf(i)},o=$u(c,u);o.on("mouseEnterAnnotation",function(e){let t;e.body[0].type=="InteractiveResource"&&(t=e.body[0].haptics.vibrate),"vibrate"in window.navigator?t&&window.navigator.vibrate(200):console.warn("Vibrate not supported!")}),o.on("mouseLeaveAnnotation",function(){"vibrate"in window.navigator&&window.navigator.vibrate(0)});const l=zv(a,n);let h=l.map(e=>e.__jsonld);return Ho&&console.log(`Loaded annotations`,l),o.setAnnotations(h),window.anno=o,c}window.touchViewer=Lv})()