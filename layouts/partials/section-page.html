{{- $head := .CurrentSection -}}
{{- $pages := slice -}}
{{- if .IsHome -}}
    {{- $pages = where .Site.Pages "Section" "home" -}}

{{ warnf "--> %v" $pages}}
{{- else -}}
    {{- $pages = .Pages -}}
{{- end -}}

{{- $sections := newScratch -}}
{{- $sections.Set "sections" slice -}}

{{- if ne .Content "" -}}
    <div class="{{ printf "%s-section" (path.Base $head.Permalink) }} section-head">{{ .Content }}</div>
{{- end -}}

{{- range $i, $section := $pages -}}
    {{- $class := "odd" -}}
    {{- if modBool $i 2  -}}
        {{- $class = "even" -}}
    {{- end -}}

    {{- $nav := path.Base .Permalink -}}
    {{- $nav = replaceRE "^/$" "root" $nav -}}
    {{- $class = printf "section-%s %s" $nav $class -}}

    {{- $id := substr (md5 $class) 0 8 -}}

    {{- if ne .Content "" -}}
        <div id="{{ $id }}" data-section="{{ $nav }}" class="{{ $class }} {{ printf "%s-section" (path.Base $section.Permalink) }} section-content">

            <h1 class="section-content-title">
                {{- .Title -}}
            </h1>
            <div class="section-content-body">
                {{- .Content -}}
            </div>

            {{- if eq .Kind "Section" -}}
                {{- errorf "%s is a nested section" (path.Base .Permalink) -}}
            {{- end -}}

        </div>
        {{- $sections.Add "sections" (dict "nav" $nav "title" .Title) -}}
    {{- end -}}
{{- end -}}

{{- if ne ($sections.Get "sections" ) nil -}}
    <div class="section-menu">
        <ul>
        {{- range $i, $section := $sections.Get "sections" -}}
            <li><a href="#{{ $section.nav }}">{{ $section.title }}</a></li>
        {{- end -}}
        </ul>
    </div>
{{- end -}}
